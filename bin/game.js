"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(T){let A=0,E=[],R=[];const z={baseUrl:""},O={};function d(T,E,R){let z=null,V={},U=null;"function"==typeof T?V=T:"string"==typeof T?(z=T,"function"==typeof E?V=E:E instanceof Array&&(U=E,V=R)):T instanceof Array&&(U=T,"function"==typeof E&&(V=E)),U=U||["require","exports","module"],null===z&&(z="unnamed-module-"+A++),z=g(z),U=(U||[]).map((T=>function(T,A){return T?b(A,T):A}(z,T))),O[z]||(O[z]={name:z,parent:null,dclamd:1,dependencies:U,handlers:[],exports:{},dependants:new Set}),O[z].dependencies=U,p(U,(function(T){const A=O[z];if(!A)throw new Error("Could not access registered module "+z);let E=A.exports;E="function"==typeof V?V.apply(globalObject,T)||E:V,A.exports=E,u(z)}),(T=>{if("function"!=typeof onerror)throw T;onerror(T)}),z)}function u(T){const A=O[T];if(!A)throw new Error("Could not access registered module "+T);A.dclamd=2;let E=A.handlers;if(E&&E.length)for(let A=0;A<E.length;A++)E[A](O[T])}function c(T,A,E){if(!O[T])return null;if(T==A||50==E)return[T];const R=O[T].dependencies;for(let z=0,O=R.length;z<O;z++){let O=c(R[z],A,E+1);if(null!==O)return O.push(T),O}return null}function a(T,A){let E=O[T];if(!E)return!1;let R={};for(let T in O)R[T]=!1;let z=[];for(z.push(E),R[T]=!0;z.length>0;){let T=z.shift().dependencies;if(T)for(let E=0,V=T.length;E<V;E++){let V=T[E];if(V===A)return!0;let U=O[V];U&&!R[V]&&(R[V]=!0,z.push(U))}}return!1}function p(T,A,E,z){let V=new Array(T.length).fill(null),U=0,H=!1;if("string"==typeof T){if(O[T]){if(1===O[T].dclamd)throw new Error(`Trying to load ${T} from ${z}. The first module is still loading.`);return O[T]}throw new Error(T+" has not been defined. Please include it as a dependency in "+z+"'s define()")}const G=T.length;for(let X=0;X<G;X++)switch(T[X]){case"require":let h=function(T,A,E){return p(T,A,E,z)};h.toUrl=function(T){return b(T,z)},V[X]=h,U++;break;case"exports":if(!O[z])throw new Error("Parent module "+z+" not registered yet");V[X]=O[z].exports,U++;break;case"module":V[X]={id:z,uri:b(z)},U++;break;default:{const Q=T[X],m=()=>{V[X]=O[Q].exports,U++,U===G&&A&&(H=!0,A(V))};if(a(Q,z)){const T=c(Q,z,0);T&&(T.reverse(),T.push(Q),R.push(T)),w(Q,(()=>{}),E,z),m()}else w(Q,m,E,z);break}}!H&&U===G&&A&&A(V)}function h(T,A){return function(){return dcl.callRpc(T,A.name,E.slice.call(arguments,0))}}function w(T,A,E,R){if(O[T])return O[T].dependants.add(R),void(1===O[T].dclamd?A&&O[T].handlers.push(A):A&&A(O[T]));if(O[T]={name:T,parent:R,dclamd:1,handlers:[A],dependencies:[],dependants:new Set([R]),exports:{}},0===T.indexOf("@")){let A=O[T].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(T,A).then((E=>{for(let T in E.methods){const R=E.methods[T];A[R.name]=h(E.rpcHandle,R)}u(T)})).catch((T=>{E(T)}))}}function g(T){let A,E=T;for(A=/\/\.\//;A.test(E);)E=E.replace(A,"/");for(E=E.replace(/^\.\//g,""),A=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;A.test(E);)E=E.replace(A,"/");return E=E.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),E=E.replace(/^\//g,""),E}function b(T,A){switch(T){case"require":case"exports":case"module":return T}return A?function(T,A){let E=T;if(!E.startsWith("@")&&(E.startsWith("./")||E.startsWith("../"))){const T=A.split("/");T.pop(),E=g(T.join("/")+"/"+E)}return E}(T,A):g(T)}T.config=function(T){if("object"==typeof T)for(let A in T)T.hasOwnProperty(A)&&(z[A]=T[A])},T.define=d,function(T){T.amd={},T.modules=O}(d=T.define||(T.define={})),T.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const T=new Set,A=[];for(let E in O)O[E]&&(1===O[E].dclamd&&A.push(O[E]),O[E].dependencies.forEach((A=>{"require"!=A&&"exports"!=A&&"module"!=A&&(O[A]||T.add(A))})));const E=[];if(R.length&&E.push(`\n> Cyclic dependencies: ${R.map((T=>"\n  - "+T.join(" -> "))).join("")}`),T.size&&E.push(`\n> Undeclared/unknown modules: ${Array.from(T).map((T=>"\n  - "+T)).join("")}`),A.length&&E.push(`\n> These modules didn't load: ${A.map((T=>"\n  - "+T.name)).join("")}.\n`),E.length)throw new Error(E.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(T){var A=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(T){return T.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(T){return T.firstPersonCameraEntity}},t}(),n=function(T,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(T[E]=A[E])})(T,A)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function o(T,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function o(){this.constructor=T}n(T,A),T.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}var i=function(){return(i=Object.assign||function(T){for(var A,E=1,R=arguments.length;E<R;E++)for(var z in A=arguments[E])Object.prototype.hasOwnProperty.call(A,z)&&(T[z]=A[z]);return T}).apply(this,arguments)};function r(T,A,E,R){var z,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(T,A,E,R);else for(var U=T.length-1;U>=0;U--)(z=T[U])&&(V=(O<3?z(V):O>3?z(A,E,V):z(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}function u(T){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&T[A],R=0;if(E)return E.call(T);if(T&&"number"==typeof T.length)return{next:function(){return T&&R>=T.length&&(T=void 0),{value:T&&T[R++],done:!T}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(T,A){var E="function"==typeof Symbol&&T[Symbol.iterator];if(!E)return T;var R,z,O=E.call(T),V=[];try{for(;(void 0===A||A-- >0)&&!(R=O.next()).done;)V.push(R.value)}catch(T){z={error:T}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(z)throw z.error}}return V}function h(T,A){for(var E=0,R=A.length,z=T.length;E<R;E++,z++)T[z]=A[E];return T}var E=0;function l(){for(var T=[],A=0;A<arguments.length;A++)T[A]=arguments[A];"undefined"!=typeof dcl?dcl.log.apply(dcl,h([],p(T))):console.log.apply(console,h(["DEBUG:"],p(T)))}function d(T,A){"undefined"!=typeof dcl?dcl.error(T,A):console.error("ERROR:",T,A)}function f(T){if(E++,0===T.length)throw new Error("newId(type: string): type cannot be empty");return T+E.toString(36)}function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(T){var A=16*Math.random()|0;return("x"===T?A:3&A|8).toString(16)}))}function v(T,A){for(var E=[],R=0;R<T;++R)E.push(A());return E}var R=[];function _(T){if(!("__event_name__"in T)||"string"!=typeof T.__event_name__)throw new Error("The EventConstructor is not registered");return T.__event_name__}var z=function(){function t(){this.listeners={}}return t.prototype.addListener=function(T,A,E){if(!T||"function"!=typeof T)throw new Error("Invalid EventConstructor");var R=_(T),z=this.listeners[R];z||(z=this.listeners[R]=[]);for(var O=0;O<z.length;O++)if(z[O].listener===A)throw new Error("The provided listener is already registered");return z.push({listener:A,fn:E}),this},t.prototype.removeListener=function(T,A){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var E=_(A),R=this.listeners[E];if(!R)return!1;for(var z=0;z<R.length;z++)if(R[z].listener===T)return R.splice(z,1),!0;return!1},t.prototype.fireEvent=function(T){var A=_(T.constructor),E=this.listeners[A];if(E)for(var R=0;R<E.length;R++)try{var z=E[R];z.fn.call(z.listener,T)}catch(T){d(T)}return this},t}();function x(){var T=f("EV");if(-1!==R.indexOf(T))throw new Error("The event name "+T+" is already taken");return R.push(T),function(A){return A.__event_name__=T,A}}var O,V=r([x()],(function(T,A,E){this.entity=T,this.componentName=A,this.component=E})),U=r([x()],(function(T,A,E){this.entity=T,this.componentName=A,this.classId=E})),H=r([x()],(function(T,A){this.entity=T,this.parent=A}));T.UIValueType=void 0,(O=T.UIValueType||(T.UIValueType={}))[O.PERCENT=0]="PERCENT",O[O.PIXELS=1]="PIXELS";var G=function(){function e(A){if(this.type=T.UIValueType.PIXELS,"string"==typeof A){var E=A;E.indexOf("px")>-1?this.type=T.UIValueType.PIXELS:E.indexOf("%")>-1&&(this.type=T.UIValueType.PERCENT),this.value=parseFloat(E)}else this.value=A}return e.prototype.toString=function(){var A=this.value.toString();return this.type===T.UIValueType.PERCENT?A+="%":A+="px",A},e}(),X="__name__symbol_",Q="__classId__symbol_",Z="__component__id_",K=r([x()],(function(T,A,E){this.componentId=T,this.componentName=A,this.classId=E})),J=r([x()],(function(T){this.componentId=T})),$=r([x()],(function(T,A){this.componentId=T,this.component=A}));function M(T,A){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+T);var R=E,i=function(){var E=Array.prototype.slice.call(arguments),z=new(R.bind.apply(R,h([void 0],p(E))));return Object.defineProperty(z,X,{enumerable:!1,writable:!1,configurable:!1,value:T}),void 0!==A&&Object.defineProperty(z,Q,{enumerable:!1,writable:!1,configurable:!1,value:A}),z};return void 0!==A&&(i.__classId__symbol_=A),i.__name__symbol_=T,i.isComponent=!0,i.originalClassName=T,(i.prototype=E.prototype).constructor=E,i}}function F(T,A){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+T);if("number"!=typeof A||isNaN(A))throw new Error("classId: "+A+" is an invalid integer");var R=E,i=function(){if(!F.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var E=Array.prototype.slice.call(arguments),z=new(R.bind.apply(R,h([void 0],p(E)))),O=f("C");return Object.defineProperty(z,X,{enumerable:!1,writable:!1,configurable:!1,value:T}),Object.defineProperty(z,Z,{enumerable:!1,writable:!1,configurable:!1,value:O}),void 0!==A&&Object.defineProperty(z,Q,{enumerable:!1,writable:!1,configurable:!1,value:A}),F.engine&&F.engine.registerComponent(z),z};return void 0!==A&&(i.__classId__symbol_=A),i.__name__symbol_=T,i.isComponent=!0,i.isDisposableComponent=!0,i.originalClassName=T,(i.prototype=E.prototype).constructor=E,i}}function L(T){if(!T)throw new TypeError(T+" is not a component.");if(T.__name__symbol_)return T.__name__symbol_;throw new TypeError(T+" is not a registered component.")}function N(T){if(!T)throw new TypeError(T+" is not a component.");if(T.__classId__symbol_)return T.__classId__symbol_;if(!T.__name__symbol_)throw new TypeError(T+" is not a registered component.");return null}function D(T){if(!T)throw new TypeError(T+" is not a component.");if(T.__component__id_)return T.__component__id_;throw new TypeError(T+" is not a registered disposable component.")}!function(T){T.engine=null}(F||(F={}));var et=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(T,A){if(delete T[A]){var E=A+"_"+Math.random();T[E]=void 0,Object.defineProperty(T,E,i(i({},Object.getOwnPropertyDescriptor(T,E)),{enumerable:!1})),Object.defineProperty(T,A.toString(),{get:function(){return this[E]},set:function(T){var R=this[E];if(this.data[A]=T?D(T):null,this[E]=T,T!==R){this.dirty=!0;for(var z=0;z<this.subscriptions.length;z++)this.subscriptions[z](A,T,R)}},enumerable:!0})}},t.field=function(T,A){delete T[A]&&Object.defineProperty(T,A.toString(),{get:function(){return this.data[A]},set:function(T){var E=this.data[A];if(this.data[A]=T,T!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](A,T,E)}},enumerable:!0})},t.uiValue=function(T,A){delete T[A]&&Object.defineProperty(T,A.toString(),{get:function(){return this.data[A].toString()},set:function(T){var E=this.data[A],R=new G(T);if(this.data[A]=R,R!==E){this.dirty=!0;for(var z=0;z<this.subscriptions.length;z++)this.subscriptions[z](A,R,E)}},enumerable:!0})},t.readonly=function(T,A){delete T[A]&&Object.defineProperty(T,A.toString(),{get:function(){if(A in this.data==0)throw new Error("The field "+A+" is uninitialized");return this.data[A]},set:function(T){if(A in this.data)throw new Error("The field "+A+" is readonly");this.data[A]=T,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(T){return this.subscriptions.push(T),this},t.prototype.toJSON=function(){return this.data},t}();function B(T){return Z in T}var nt=function(){function t(){for(var T=[],A=0;A<arguments.length;A++)T[A]=arguments[A];if(this.entities=[],this.active=!1,this._requiresNames=[],!T)throw new Error("ComponentGroup: Could not load the requires list");if(!(T instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return T.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(A){var R=T[A],z=null;if(!R)throw new Error("ComponentGroup: the required component at location "+A+" is invalid");try{z=L(R)}catch(T){throw new Error("ComponentGroup: the required component at location "+A+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(E._requiresNames.some((function(T){return T===z})))throw new Error("ComponentGroup: the required component list has a repeated name "+z);E._requiresNames.push(z)},E=this,R=0;R<T.length;R++)n(R)}return t.prototype.hasEntity=function(T){return!!T.isAddedToEngine()&&-1!==this.entities.indexOf(T)},t.prototype.addEntity=function(T){if(!T.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(T)&&this.entities.push(T)},t.prototype.removeEntity=function(T){var A=this.entities.indexOf(T);-1!==A&&this.entities.splice(A,1)},t.prototype.componentRemoved=function(T,A){-1!==this._requiresNames.indexOf(A)&&this.removeEntity(T)},t.prototype.meetsRequirements=function(T){for(var A=0;A<this._requiresNames.length;A++)if(!(this._requiresNames[A]in T.components))return!1;return!0},t}(),ot=function(){function t(T){this.name=T,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(T){if("function"==typeof T)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof T)throw new Error("You passed a "+typeof T+", an instance of component is expected");var A=L(T);if(this.components[A]){if(this.components[A]===T)return T;this.removeComponent(this.components[A],!1)}return this.addComponent(T)},t.prototype.hasComponent=function(T){var A=typeof T;if("string"!==A&&"object"!==A&&"function"!==A)throw new Error("Entity#has(component): component is not a class, name or instance");if(null==T)return!1;var E="string"===A?T:L(T),R=this.components[E];return!!R&&("object"===A?R===T:"function"!==A||R instanceof T)},t.prototype.getComponent=function(T){var A=typeof T;if("string"!==A&&"function"!==A)throw new Error("Entity#get(component): component is not a class or name");var E="string"===A?T:L(T),R=this.components[E];if(!R)throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'"');if("function"===A){if(R instanceof T)return R;throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'" (by instance)')}return R},t.prototype.getComponentOrNull=function(T){var A=typeof T;if("string"!==A&&"function"!==A)throw new Error("Entity#getOrNull(component): component is not a class or name");var E="string"===A?T:L(T),R=this.components[E];return R?"function"===A?R instanceof T?R:null:R:null},t.prototype.getComponentOrCreate=function(T){if("function"!=typeof T)throw new Error("Entity#getOrCreate(component): component is not a class");var A=this.getComponentOrNull(T);return A||(L(A=new T),this.addComponentOrReplace(A)),A},t.prototype.addComponent=function(T){if("object"!=typeof T)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var A=L(T),E=N(T);if(this.components[A])throw new Error('A component of type "'+A+'" is already present in entity "'+this.identifier+'"');this.components[A]=T,this.eventManager&&this.eventManager.fireEvent(new U(this,A,E));var R=T;return"function"==typeof R.addedToEntity&&R.addedToEntity(this),T},t.prototype.removeComponent=function(T,A){void 0===A&&(A=!0);var E=typeof T;if("string"!==E&&"function"!==E&&"object"!==E)throw new Error("Entity#remove(component): component is not a class, class or name");var R="string"===E?T:L(T),z=this.components[R];if(z){if("function"===E)return z instanceof T?(delete this.components[R],void(z&&(A&&this.eventManager&&this.eventManager.fireEvent(new V(this,R,z)),"function"==typeof z.removedFromEntity&&z.removedFromEntity(this)))):void l('Entity Warning: Trying to remove wrong (by constructor) component "'+R+'" from entity "'+this.identifier+'"');delete this.components[R],z&&(A&&this.eventManager&&this.eventManager.fireEvent(new V(this,R,z)),"function"==typeof z.removedFromEntity&&z.removedFromEntity(this))}else l('Entity Warning: Trying to remove inexisting component "'+R+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(T){var A;if(T&&"getEntityRepresentation"in T){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");A=T.getEntityRepresentation(this.engine)}else A=!T&&this.engine?this.engine.rootEntity:T;var E=this.getParent();if(A===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(A===E)return this;var R=this.getCircularAncestor(A);if(R)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+R+'")');return E&&delete E.children[this.uuid],null!==A&&"0"!==A.uuid&&(!A.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),A.isAddedToEngine()&&!this.isAddedToEngine()&&A.engine.addEntity(this)),this._parent=A||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new H(this,A)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(T){for(var A=this.engine?this.engine.rootEntity:null,E=T;E&&E!==A;){var R=E.getParent();if(R===this)return E.uuid;E=R}return null},t.prototype.registerAsChild=function(){var T=this.getParent();this.uuid&&T&&(T.children[this.uuid]=this)},t}(),it=function(){function t(T){this.eventManager=new z,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(U,this,this.componentAddedHandler),this.eventManager.addListener(V,this,this.componentRemovedHandler),this.rootEntity=T,this.firstPersonCameraEntity=new ot,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new ot,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(T){var A=T.getParent();if(T.isAddedToEngine())return T;for(var E in T.eventManager=this.eventManager,T.engine=this,this._entities[T.uuid]=T,this.checkRequirementsAndAdd(T),A?A.isAddedToEngine()||A===this.rootEntity||l("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+A.uuid):T.setParent(this.rootEntity),T.alive=!0,T.children){var R=T.children[E];R&&(R.isAddedToEngine()||this.addEntity(R))}return T},t.prototype.removeEntity=function(T){var A=T.uuid;if(T.isAddedToEngine()){for(var E in T.components){var R=this._componentGroups[E];if(R)for(var z in R)R[z].removeEntity(T);delete this.entityLists[E][A]}for(var O=0;O<this.simpleSystems.length;O++){var V=this.simpleSystems[O];V.onRemoveEntity&&V.onRemoveEntity(T)}for(var O in T.children){var U=T.children[O];U&&this.removeEntity(U)}return T.alive=!1,T.eventManager=null,delete this._entities[A],!0}for(var E in l("Engine: Trying to remove non existent entity from engine."),T.isAddedToEngine()?l("Engine: Entity id: "+A):l('Engine: Entity "'+T.uuid+'" has not been added to any engine yet.'),l("Engine: Entity's components:"),T.components)l(E);return!1},t.prototype.addSystem=function(T,A){if(void 0===A&&(A=0),-1!==this.addedSystems.indexOf(T))return l("Engine: Trying to add a system that is already added. Aborting"),T;if(this.systems.length>0)for(var E=0;E<this.systems.length;E++){var R=this.systems[E],z=E===this.systems.length-1;if(R.priority>A){this.addedSystems.push(T),this.systems.splice(E,0,{system:T,priority:A});break}if(z){this.addedSystems.push(T),this.systems.splice(E+1,0,{system:T,priority:A});break}}else this.addedSystems.push(T),this.systems.splice(1,0,{system:T,priority:A});return this.registerSystem(T),T},t.prototype.removeSystem=function(T){var A=this.addedSystems.indexOf(T);if(-1!==A){T.active=!1,T.deactivate&&T.deactivate(),this.addedSystems.splice(A,1);for(var E=0;E<this.systems.length;E++)this.systems[E].system===T&&this.systems.splice(E,1);return!0}return!1},t.prototype.update=function(T){for(var A in this.systems){var E=this.systems[A].system;if(E.active&&E.update)try{E.update(T)}catch(T){d(T)}}return this},t.prototype.getEntitiesWithComponent=function(T){var A="string"==typeof T?T:L(T);return A in this.entityLists?this.entityLists[A]:this.entityLists[A]={}},t.prototype.registerComponent=function(T){var A=D(T),E=L(T),R=N(T);this._disposableComponents[A]=T,null!==R&&(this.eventManager.fireEvent(new K(A,E,R)),this.eventManager.fireEvent(new $(A,T)))},t.prototype.disposeComponent=function(T){var A=D(T);return delete this._disposableComponents[A]&&(this.eventManager.fireEvent(new J(A)),T.onDispose&&T.onDispose(),!0)},t.prototype.updateComponent=function(T){this.eventManager.fireEvent(new $(D(T),T))},t.prototype.getComponentGroup=function(){for(var T=[],A=0;A<arguments.length;A++)T[A]=arguments[A];var E=void 0;if(T.length>0&&(H=this._componentGroups[L(T[0])]))for(var R=T.slice(),z=0;z<H.length;z++){var O=H[z];if(R.length===O.requires.length){for(var V=0;V<R.length&&-1!==O.requires.indexOf(R[V]);V++)V===R.length-1&&(E=O);if(E)break}}if(E)return E;(E=new(nt.bind.apply(nt,h([void 0],p(T))))).active=!0;var U=E.requiresNames;for(z=0;z<U.length;z++){var H,G=U[z];(H=this._componentGroups[G])||(this._componentGroups[G]=H=[]),-1===H.indexOf(E)&&H.push(E)}for(var X in this._entities)this.checkRequirements(this._entities[X],E);return E},t.prototype.removeComponentGroup=function(T){if(T.active){T.active=!1;for(var A=T.requiresNames,E=0;E<A.length;E++){var R=A[E],z=this._componentGroups[R];if(z){var O=z.indexOf(T);-1!==O&&z.splice(O,1)}}return!0}return!1},t.prototype.registerSystem=function(T){T.active=!0,T.activate&&T.activate(this),this.simpleSystems.push(T)},t.prototype.checkRequirementsAndAdd=function(T){if(T.isAddedToEngine()){for(var A in T.components){A in this.entityLists||(this.entityLists[A]={}),this.entityLists[A][T.uuid]=T;var E=this._componentGroups[A];if(E)for(var R in E)this.checkRequirements(T,E[R])}for(var z=0;z<this.simpleSystems.length;z++){var O=this.simpleSystems[z];O.onAddEntity&&O.onAddEntity(T)}}},t.prototype.checkRequirements=function(T,A){A.meetsRequirements(T)?A.hasEntity(T)||A.addEntity(T):A.hasEntity(T)&&A.removeEntity(T)},t.prototype.componentAddedHandler=function(T){var A,E=T.entity,R=T.componentName;if(E.isAddedToEngine()){this.entityLists[R]?this.entityLists[R][E.uuid]=E:this.entityLists[R]=((A={})[E.uuid]=E,A);var z=this._componentGroups[R];if(z)for(var O in z)this.checkRequirements(E,z[O])}},t.prototype.componentRemovedHandler=function(T){var A=T.entity,E=T.componentName;if(A.isAddedToEngine()){delete this.entityLists[E][A.uuid];var R=this._componentGroups[E];if(R)for(var z in R)this.checkRequirements(A,R[z])}},t}(),rt=Promise.resolve().then.bind(Promise.resolve());function W(T){var A=rt(T);return A.isComplete=!1,A.then((function(T){A.isComplete=!0,A.result=T,A.didFail=!1})).catch((function(T){A.isComplete=!0,A.error=T,A.didFail=!0,d("executeTask: FAILED "+T.toString(),T)})),A}var st,at,lt=function(){function t(T,A,E,R){void 0===A&&(A=!1),this.initalize(T,A,E,R)}return t.prototype.initalize=function(T,A,E,R){return void 0===A&&(A=!1),this.mask=T,this.skipNextObservers=A,this.target=E,this.currentTarget=R,this},t}(),Y=function(T,A,E){void 0===E&&(E=null),this.callback=T,this.mask=A,this.scope=E,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},ut=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(T,A,E,R){var z,O;void 0===E&&(E=-1),void 0===R&&(R=null);var V=new t;V._observers=new Array,V._observables=T;try{for(var U=u(T),H=U.next();!H.done;H=U.next()){var G=H.value.add(A,E,!1,R);G&&V._observers.push(G)}}catch(T){z={error:T}}finally{try{H&&!H.done&&(O=U.return)&&O.call(U)}finally{if(z)throw z.error}}return V},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var T=0;T<this._observers.length;T++)this._observables[T].remove(this._observers[T]);this._observers=null,this._observables=null},t}(),ct=function(){function t(T){this._observers=new Array,this._onObserverAdded=null,this._eventState=new lt(0),T&&(this._onObserverAdded=T)}return t.prototype.add=function(T,A,E,R,z){if(void 0===A&&(A=-1),void 0===E&&(E=!1),void 0===R&&(R=null),void 0===z&&(z=!1),!T)return null;var O=new Y(T,A,R);return O.unregisterOnNextCall=z,E?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},t.prototype.addOnce=function(T){return this.add(T,void 0,void 0,void 0,!0)},t.prototype.remove=function(T){return!!T&&-1!==this._observers.indexOf(T)&&(this._deferUnregister(T),!0)},t.prototype.removeCallback=function(T,A){for(var E=0;E<this._observers.length;E++)if(this._observers[E].callback===T&&(!A||A===this._observers[E].scope))return this._deferUnregister(this._observers[E]),!0;return!1},t.prototype.notifyObservers=function(T,A,E,R){var z,O;if(void 0===A&&(A=-1),!this._observers.length)return!0;var V=this._eventState;V.mask=A,V.target=E,V.currentTarget=R,V.skipNextObservers=!1,V.lastReturnValue=T;try{for(var U=u(this._observers),H=U.next();!H.done;H=U.next()){var G=H.value;if(!G._willBeUnregistered&&(G.mask&A&&(G.scope?V.lastReturnValue=G.callback.apply(G.scope,[T,V]):V.lastReturnValue=G.callback(T,V),G.unregisterOnNextCall&&this._deferUnregister(G)),V.skipNextObservers))return!1}}catch(T){z={error:T}}finally{try{H&&!H.done&&(O=U.return)&&O.call(U)}finally{if(z)throw z.error}}return!0},t.prototype.notifyObserversWithPromise=function(T,A,E,R){var z=this;void 0===A&&(A=-1);var O=Promise.resolve(T);if(!this._observers.length)return O;var V=this._eventState;return V.mask=A,V.target=E,V.currentTarget=R,V.skipNextObservers=!1,this._observers.forEach((function(E){V.skipNextObservers||E._willBeUnregistered||E.mask&A&&(O=E.scope?O.then((function(A){return V.lastReturnValue=A,E.callback.apply(E.scope,[T,V])})):O.then((function(A){return V.lastReturnValue=A,E.callback(T,V)})),E.unregisterOnNextCall&&z._deferUnregister(E))})),O.then((function(){return T}))},t.prototype.notifyObserver=function(T,A,E){void 0===E&&(E=-1);var R=this._eventState;R.mask=E,R.skipNextObservers=!1,T.callback(A,R)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var T=new t;return T._observers=this._observers.slice(0),T},t.prototype.hasSpecificMask=function(T){var A,E;void 0===T&&(T=-1);try{for(var R=u(this._observers),z=R.next();!z.done;z=R.next()){var O=z.value;if(O.mask&T||O.mask===T)return!0}}catch(T){A={error:T}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}return!1},t.prototype._deferUnregister=function(T){var A=this;T.unregisterOnNextCall=!1,T._willBeUnregistered=!0,W((function(){return function(T,A,E,R){return new(E||(E=Promise))((function(A,z){function s(T){try{u(R.next(T))}catch(T){z(T)}}function a(T){try{u(R.throw(T))}catch(T){z(T)}}function u(T){var R;T.done?A(T.value):(R=T.value,R instanceof E?R:new E((function(T){T(R)}))).then(s,a)}u((R=R.apply(T,[])).next())}))}(A,0,void 0,(function(){return function(T,A){var E,R,z,O,V={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(U){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(z=2&O[0]?R.return:O[0]?R.throw||((z=R.return)&&z.call(R),0):R.next)&&!(z=z.call(R,O[1])).done)return z;switch(R=0,z&&(O=[2&O[0],z.value]),O[0]){case 0:case 1:z=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((z=(z=V.trys).length>0&&z[z.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!z||O[1]>z[0]&&O[1]<z[3])){V.label=O[1];break}if(6===O[0]&&V.label<z[1]){V.label=z[1],z=O;break}if(z&&V.label<z[2]){V.label=z[2],V.ops.push(O);break}z[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(T,V)}catch(T){O=[6,T],R=0}finally{E=z=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,U])}}}(this,(function(A){return[2,this._remove(T)]}))}))}))},t.prototype._remove=function(T){if(!T)return!1;var A=this._observers.indexOf(T);return-1!==A&&(this._observers.splice(A,1),!0)},t}(),ht=r([x()],(function(T,A){this.uuid=T,this.payload=A})),pt=r([x()],(function(T){this.payload=T})),dt=r([x()],(function(T){this.payload=T}));function tt(T){return function(){at&&at.subscribe(T)}}var ft=new ct(tt("cameraModeChanged")),vt=new ct(tt("idleStateChanged")),mt=new ct(tt("onEnterScene")),gt=mt,wt=new ct(tt("onLeaveScene")),bt=wt,xt=new ct(tt("sceneStart")),Tt=new ct(tt("playerExpression")),At=new ct(tt("onPointerLock")),St=new ct(tt("videoEvent")),Et=new ct(tt("profileChanged")),Ct=new ct(tt("playerConnected")),It=new ct(tt("playerDisconnected")),Rt=new ct(tt("onRealmChanged"));function yt(T){(at=T)&&at.onEvent((function(T){switch(T.type){case"onEnterScene":return void mt.notifyObservers(T.data);case"onLeaveScene":return void wt.notifyObservers(T.data);case"cameraModeChanged":return void ft.notifyObservers(T.data);case"idleStateChanged":return void vt.notifyObservers(T.data);case"sceneStart":return void xt.notifyObservers(T.data);case"playerExpression":return void Tt.notifyObservers(T.data);case"videoEvent":var A=T.data,E=F.engine.disposableComponents[A.componentId];return E&&E.update(A),void St.notifyObservers(A);case"profileChanged":return void Et.notifyObservers(T.data);case"onPointerLock":return void At.notifyObservers(T.data);case"playerConnected":return void Ct.notifyObservers(T.data);case"playerDisconnected":return void It.notifyObservers(T.data);case"onRealmChanged":return void Rt.notifyObservers(T.data)}}))}var _t,Pt,zt=function(){function t(T){this.dcl=T,this.cachedComponents={}}return t.prototype.activate=function(T){var A=this;this.engine=T,T.eventManager.addListener(U,this,this.componentAdded),T.eventManager.addListener(V,this,this.componentRemoved),T.eventManager.addListener(K,this,this.disposableComponentCreated),T.eventManager.addListener(J,this,this.disposableComponentRemoved),T.eventManager.addListener($,this,this.disposableComponentUpdated),T.eventManager.addListener(H,this,this.parentChanged);var E=T.rootEntity.uuid;this.dcl.addEntity(E),this.dcl.onUpdate((function(E){T.update(E),A.presentEntities()})),this.dcl.onEvent((function(A){var E=A.data;switch(A.type){case"uuidEvent":T.eventManager.fireEvent(new ht(E.uuid,E.payload));break;case"raycastResponse":("HitFirst"===E.queryType||"HitAll"===E.queryType)&&T.eventManager.fireEvent(new pt(E));break;case"actionButtonEvent":T.eventManager.fireEvent(new dt(E.payload))}}))},t.prototype.onAddEntity=function(T){if(T&&T.isAddedToEngine()){var A=T.uuid,E=T.getParent();for(var R in this.dcl.addEntity(A),E&&this.dcl.setParent(A,E.uuid),this.cachedComponents[A]={},T.components){var z=T.components[R],O=N(z);if(null!==O)if(B(z))this.dcl.attachEntityComponent(T.uuid,R,D(z));else{var V=JSON.stringify(z);this.dcl.updateEntityComponent(A,R,O,V),this.cachedComponents[A][R]=V}}}},t.prototype.onRemoveEntity=function(T){if(T.isAddedToEngine()){var A=T.uuid;this.dcl.removeEntity(A),delete this.cachedComponents[A]}},t.prototype.presentEntities=function(){for(var T in this.engine.entities){var A=this.engine.entities[T];for(var E in A.components){var R=N(V=A.components[E]);if(null!==R&&!B(V)){var z=this.getJsonIfDirty(A.uuid,E,V);z&&(this.dcl.updateEntityComponent(A.uuid,E,R,z),this.clearDirty(A.uuid,E,V,z))}}}for(var O in this.engine.disposableComponents){var V;(V=this.engine.disposableComponents[O])instanceof et&&V.dirty&&(this.dcl.componentUpdated(O,JSON.stringify(V)),V.dirty=!1)}},t.prototype.componentAdded=function(T){if(T.entity.isAddedToEngine()){var A=T.entity.components[T.componentName];if(B(A))this.dcl.attachEntityComponent(T.entity.uuid,T.componentName,D(A));else if(null!==T.classId){var E=JSON.stringify(A);this.dcl.updateEntityComponent(T.entity.uuid,T.componentName,T.classId,E),this.cachedComponents[T.entity.uuid][T.componentName]=E}}},t.prototype.componentRemoved=function(T){T.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(T.entity.uuid,T.componentName),delete this.cachedComponents[T.entity.uuid][T.componentName])},t.prototype.disposableComponentCreated=function(T){this.dcl.componentCreated(T.componentId,T.componentName,T.classId)},t.prototype.disposableComponentRemoved=function(T){this.dcl.componentDisposed(T.componentId)},t.prototype.disposableComponentUpdated=function(T){this.dcl.componentUpdated(T.componentId,JSON.stringify(T.component))},t.prototype.parentChanged=function(T){this.dcl.setParent(T.entity.uuid,T.parent?T.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(T,A,E){var R=JSON.stringify(E);return R!==this.cachedComponents[T][A]&&R},t.prototype.clearDirty=function(T,A,E,R){this.cachedComponents[T][A]=R},t}();T.Orientation=void 0,(_t=T.Orientation||(T.Orientation={}))[_t.CW=0]="CW",_t[_t.CCW=1]="CCW",T.Space=void 0,(Pt=T.Space||(T.Space={}))[Pt.LOCAL=0]="LOCAL",Pt[Pt.WORLD=1]="WORLD",Pt[Pt.BONE=2]="BONE";var Bt,Ot,Lt,Mt,Nt=1/2.2,kt=2.2,qt=1e-6,Dt=Math.PI/180,Vt=360/(2*Math.PI),Wt=function(){function t(){}return t.WithinEpsilon=function(T,A,E){void 0===E&&(E=1401298e-51);var R=T-A;return-E<=R&&R<=E},t.ToHex=function(T){var A=T.toString(16);return T<=15?("0"+A).toUpperCase():A.toUpperCase()},t.Sign=function(T){var A=+T;return 0===A||isNaN(A)?A:A>0?1:-1},t.Clamp=function(T,A,E){return void 0===A&&(A=0),void 0===E&&(E=1),Math.min(E,Math.max(A,T))},t.Log2=function(T){return Math.log(T)*Math.LOG2E},t.Repeat=function(T,A){return T-Math.floor(T/A)*A},t.Normalize=function(T,A,E){return(T-A)/(E-A)},t.Denormalize=function(T,A,E){return T*(E-A)+A},t.DeltaAngle=function(T,A){var E=t.Repeat(A-T,360);return E>180&&(E-=360),E},t.PingPong=function(T,A){var E=t.Repeat(T,2*A);return A-Math.abs(E-A)},t.SmoothStep=function(T,A,E){var R=t.Clamp(E);return A*(R=-2*R*R*R+3*R*R)+T*(1-R)},t.MoveTowards=function(T,A,E){return Math.abs(A-T)<=E?A:T+t.Sign(A-T)*E},t.MoveTowardsAngle=function(T,A,E){var R=t.DeltaAngle(T,A);return-E<R&&R<E?A:t.MoveTowards(T,T+R,E)},t.Lerp=function(T,A,E){return T+(A-T)*E},t.LerpAngle=function(T,A,E){var R=t.Repeat(A-T,360);return R>180&&(R-=360),T+R*t.Clamp(E)},t.InverseLerp=function(T,A,E){return T!==A?t.Clamp((E-T)/(A-T)):0},t.Hermite=function(T,A,E,R,z){var O=z*z,V=z*O;return T*(2*V-3*O+1)+E*(-2*V+3*O)+A*(V-2*O+z)+R*(V-O)},t.RandomRange=function(T,A){return T===A?T:Math.random()*(A-T)+T},t.RangeToPercent=function(T,A,E){return(T-A)/(E-A)},t.PercentToRange=function(T,A,E){return(E-A)*T+A},t.NormalizeRadians=function(T){return T-t.TwoPi*Math.floor((T+Math.PI)/t.TwoPi)},t.TwoPi=2*Math.PI,t}(),Ut=function(){function t(T,A,E,R){this.x=T,this.y=A,this.z=E,this.w=R}return t.Add=function(T,A){return new t(T.x,T.y,T.z,T.w).addInPlace(A)},t.FromArray=function(T,A){return void 0===A&&(A=0),new t(T[A],T[A+1],T[A+2],T[A+3])},t.FromArrayToRef=function(T,A,E){E.x=T[A],E.y=T[A+1],E.z=T[A+2],E.w=T[A+3]},t.FromFloatArrayToRef=function(T,A,E){t.FromArrayToRef(T,A,E)},t.FromFloatsToRef=function(T,A,E,R,z){z.x=T,z.y=A,z.z=E,z.w=R},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(T){var A=t.Zero();return t.NormalizeToRef(T,A),A},t.NormalizeToRef=function(T,A){A.copyFrom(T),A.normalize()},t.Minimize=function(T,A){var E=new t(T.x,T.y,T.z,T.w);return E.minimizeInPlace(A),E},t.Maximize=function(T,A){var E=new t(T.x,T.y,T.z,T.w);return E.maximizeInPlace(A),E},t.Distance=function(T,A){return Math.sqrt(t.DistanceSquared(T,A))},t.DistanceSquared=function(T,A){var E=T.x-A.x,R=T.y-A.y,z=T.z-A.z,O=T.w-A.w;return E*E+R*R+z*z+O*O},t.Center=function(T,A){var E=t.Add(T,A);return E.scaleInPlace(.5),E},t.TransformNormal=function(T,A){var E=t.Zero();return t.TransformNormalToRef(T,A,E),E},t.TransformNormalToRef=function(T,A,E){var R=A.m,z=T.x*R[0]+T.y*R[4]+T.z*R[8],O=T.x*R[1]+T.y*R[5]+T.z*R[9],V=T.x*R[2]+T.y*R[6]+T.z*R[10];E.x=z,E.y=O,E.z=V,E.w=T.w},t.TransformNormalFromFloatsToRef=function(T,A,E,R,z,O){var V=z.m;O.x=T*V[0]+A*V[4]+E*V[8],O.y=T*V[1]+A*V[5]+E*V[9],O.z=T*V[2]+A*V[6]+E*V[10],O.w=R},t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var T=this.x||0;return 397*(T=397*(T=397*T^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){var T=new Array;return this.toArray(T,0),T},t.prototype.toArray=function(T,A){return void 0===A&&(A=0),T[A]=this.x,T[A+1]=this.y,T[A+2]=this.z,T[A+3]=this.w,this},t.prototype.addInPlace=function(T){return this.x+=T.x,this.y+=T.y,this.z+=T.z,this.w+=T.w,this},t.prototype.add=function(T){return new t(this.x+T.x,this.y+T.y,this.z+T.z,this.w+T.w)},t.prototype.addToRef=function(T,A){return A.x=this.x+T.x,A.y=this.y+T.y,A.z=this.z+T.z,A.w=this.w+T.w,this},t.prototype.subtractInPlace=function(T){return this.x-=T.x,this.y-=T.y,this.z-=T.z,this.w-=T.w,this},t.prototype.subtract=function(T){return new t(this.x-T.x,this.y-T.y,this.z-T.z,this.w-T.w)},t.prototype.subtractToRef=function(T,A){return A.x=this.x-T.x,A.y=this.y-T.y,A.z=this.z-T.z,A.w=this.w-T.w,this},t.prototype.subtractFromFloats=function(T,A,E,R){return new t(this.x-T,this.y-A,this.z-E,this.w-R)},t.prototype.subtractFromFloatsToRef=function(T,A,E,R,z){return z.x=this.x-T,z.y=this.y-A,z.z=this.z-E,z.w=this.w-R,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(T){return this.x*=T,this.y*=T,this.z*=T,this.w*=T,this},t.prototype.scale=function(T){return new t(this.x*T,this.y*T,this.z*T,this.w*T)},t.prototype.scaleToRef=function(T,A){return A.x=this.x*T,A.y=this.y*T,A.z=this.z*T,A.w=this.w*T,this},t.prototype.scaleAndAddToRef=function(T,A){return A.x+=this.x*T,A.y+=this.y*T,A.z+=this.z*T,A.w+=this.w*T,this},t.prototype.equals=function(T){return T&&this.x===T.x&&this.y===T.y&&this.z===T.z&&this.w===T.w},t.prototype.equalsWithEpsilon=function(T,A){return void 0===A&&(A=qt),T&&Wt.WithinEpsilon(this.x,T.x,A)&&Wt.WithinEpsilon(this.y,T.y,A)&&Wt.WithinEpsilon(this.z,T.z,A)&&Wt.WithinEpsilon(this.w,T.w,A)},t.prototype.equalsToFloats=function(T,A,E,R){return this.x===T&&this.y===A&&this.z===E&&this.w===R},t.prototype.multiplyInPlace=function(T){return this.x*=T.x,this.y*=T.y,this.z*=T.z,this.w*=T.w,this},t.prototype.multiply=function(T){return new t(this.x*T.x,this.y*T.y,this.z*T.z,this.w*T.w)},t.prototype.multiplyToRef=function(T,A){return A.x=this.x*T.x,A.y=this.y*T.y,A.z=this.z*T.z,A.w=this.w*T.w,this},t.prototype.multiplyByFloats=function(T,A,E,R){return new t(this.x*T,this.y*A,this.z*E,this.w*R)},t.prototype.divide=function(T){return new t(this.x/T.x,this.y/T.y,this.z/T.z,this.w/T.w)},t.prototype.divideToRef=function(T,A){return A.x=this.x/T.x,A.y=this.y/T.y,A.z=this.z/T.z,A.w=this.w/T.w,this},t.prototype.divideInPlace=function(T){return this.divideToRef(T,this)},t.prototype.minimizeInPlace=function(T){return T.x<this.x&&(this.x=T.x),T.y<this.y&&(this.y=T.y),T.z<this.z&&(this.z=T.z),T.w<this.w&&(this.w=T.w),this},t.prototype.maximizeInPlace=function(T){return T.x>this.x&&(this.x=T.x),T.y>this.y&&(this.y=T.y),T.z>this.z&&(this.z=T.z),T.w>this.w&&(this.w=T.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var T=this.length();return 0===T?this:this.scaleInPlace(1/T)},t.prototype.toVector3=function(){return new Gt(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(T){return this.x=T.x,this.y=T.y,this.z=T.z,this.w=T.w,this},t.prototype.copyFromFloats=function(T,A,E,R){return this.x=T,this.y=A,this.z=E,this.w=R,this},t.prototype.set=function(T,A,E,R){return this.copyFromFloats(T,A,E,R)},t.prototype.setAll=function(T){return this.x=this.y=this.z=this.w=T,this},t}(),Ht=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}return Object.defineProperty(t.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!1,configurable:!0}),t.FromArray=function(T,A){void 0===A&&(A=0);var E=new t;return t.FromArrayToRef(T,A,E),E},t.FromArrayToRef=function(T,A,E){for(var R=0;R<16;R++)E._m[R]=T[R+A];E._markAsUpdated()},t.FromFloatArrayToRefScaled=function(T,A,E,R){for(var z=0;z<16;z++)R._m[z]=T[z+A]*E;R._markAsUpdated()},t.FromValuesToRef=function(T,A,E,R,z,O,V,U,H,G,X,Q,Z,K,J,$,et){var nt=et._m;nt[0]=T,nt[1]=A,nt[2]=E,nt[3]=R,nt[4]=z,nt[5]=O,nt[6]=V,nt[7]=U,nt[8]=H,nt[9]=G,nt[10]=X,nt[11]=Q,nt[12]=Z,nt[13]=K,nt[14]=J,nt[15]=$,et._markAsUpdated()},t.FromValues=function(T,A,E,R,z,O,V,U,H,G,X,Q,Z,K,J,$){var et=new t,nt=et._m;return nt[0]=T,nt[1]=A,nt[2]=E,nt[3]=R,nt[4]=z,nt[5]=O,nt[6]=V,nt[7]=U,nt[8]=H,nt[9]=G,nt[10]=X,nt[11]=Q,nt[12]=Z,nt[13]=K,nt[14]=J,nt[15]=$,et._markAsUpdated(),et},t.Compose=function(T,A,E){var R=new t;return t.ComposeToRef(T,A,E,R),R},t.ComposeToRef=function(T,A,E,R){t.ScalingToRef(T.x,T.y,T.z,Xt.Matrix[1]),A.toRotationMatrix(Xt.Matrix[0]),Xt.Matrix[1].multiplyToRef(Xt.Matrix[0],R),R.setTranslation(E)},t.Identity=function(){var T=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return T._updateIdentityStatus(!0),T},t.IdentityToRef=function(T){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,T),T._updateIdentityStatus(!0)},t.Zero=function(){var T=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return T._updateIdentityStatus(!1),T},t.RotationX=function(T){var A=new t;return t.RotationXToRef(T,A),A},t.Invert=function(T){var A=new t;return T.invertToRef(A),A},t.RotationXToRef=function(T,A){var E=Math.sin(T),R=Math.cos(T);t.FromValuesToRef(1,0,0,0,0,R,E,0,0,-E,R,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)},t.RotationY=function(T){var A=new t;return t.RotationYToRef(T,A),A},t.RotationYToRef=function(T,A){var E=Math.sin(T),R=Math.cos(T);t.FromValuesToRef(R,0,-E,0,0,1,0,0,E,0,R,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)},t.RotationZ=function(T){var A=new t;return t.RotationZToRef(T,A),A},t.RotationZToRef=function(T,A){var E=Math.sin(T),R=Math.cos(T);t.FromValuesToRef(R,E,0,0,-E,R,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(1===R&&0===E)},t.RotationAxis=function(T,A){var E=new t;return t.RotationAxisToRef(T,A,E),E},t.RotationAxisToRef=function(T,A,E){var R=Math.sin(-A),z=Math.cos(-A),O=1-z;T.normalize();var V=E._m;V[0]=T.x*T.x*O+z,V[1]=T.x*T.y*O-T.z*R,V[2]=T.x*T.z*O+T.y*R,V[3]=0,V[4]=T.y*T.x*O+T.z*R,V[5]=T.y*T.y*O+z,V[6]=T.y*T.z*O-T.x*R,V[7]=0,V[8]=T.z*T.x*O-T.y*R,V[9]=T.z*T.y*O+T.x*R,V[10]=T.z*T.z*O+z,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,E._markAsUpdated()},t.RotationYawPitchRoll=function(T,A,E){var R=new t;return t.RotationYawPitchRollToRef(T,A,E,R),R},t.RotationYawPitchRollToRef=function(T,A,E,R){jt.RotationYawPitchRollToRef(T,A,E,Xt.Quaternion[0]),Xt.Quaternion[0].toRotationMatrix(R)},t.Scaling=function(T,A,E){var R=new t;return t.ScalingToRef(T,A,E,R),R},t.ScalingToRef=function(T,A,E,R){t.FromValuesToRef(T,0,0,0,0,A,0,0,0,0,E,0,0,0,0,1,R),R._updateIdentityStatus(1===T&&1===A&&1===E)},t.Translation=function(T,A,E){var R=new t;return t.TranslationToRef(T,A,E,R),R},t.TranslationToRef=function(T,A,E,R){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,T,A,E,1,R),R._updateIdentityStatus(0===T&&0===A&&0===E)},t.Lerp=function(T,A,E){var R=new t;return t.LerpToRef(T,A,E,R),R},t.LerpToRef=function(T,A,E,R){for(var z=0;z<16;z++)R._m[z]=T._m[z]*(1-E)+A._m[z]*E;R._markAsUpdated()},t.DecomposeLerp=function(T,A,E){var R=new t;return t.DecomposeLerpToRef(T,A,E,R),R},t.DecomposeLerpToRef=function(T,A,E,R){var z=Xt.Vector3[0],O=Xt.Quaternion[0],V=Xt.Vector3[1];T.decompose(z,O,V);var U=Xt.Vector3[2],H=Xt.Quaternion[1],G=Xt.Vector3[3];A.decompose(U,H,G);var X=Xt.Vector3[4];Gt.LerpToRef(z,U,E,X);var Q=Xt.Quaternion[2];jt.SlerpToRef(O,H,E,Q);var Z=Xt.Vector3[5];Gt.LerpToRef(V,G,E,Z),t.ComposeToRef(X,Q,Z,R)},t.LookAtLH=function(T,A,E){var R=new t;return t.LookAtLHToRef(T,A,E,R),R},t.LookAtLHToRef=function(T,A,E,R){var z=Xt.Vector3[0],O=Xt.Vector3[1],V=Xt.Vector3[2];A.subtractToRef(T,V),V.normalize(),Gt.CrossToRef(E,V,z);var U=z.lengthSquared();0===U?z.x=1:z.normalizeFromLength(Math.sqrt(U)),Gt.CrossToRef(V,z,O),O.normalize();var H=-Gt.Dot(z,T),G=-Gt.Dot(O,T),X=-Gt.Dot(V,T);t.FromValuesToRef(z.x,O.x,V.x,0,z.y,O.y,V.y,0,z.z,O.z,V.z,0,H,G,X,1,R)},t.LookAtRH=function(T,A,E){var R=new t;return t.LookAtRHToRef(T,A,E,R),R},t.LookAtRHToRef=function(T,A,E,R){var z=Xt.Vector3[0],O=Xt.Vector3[1],V=Xt.Vector3[2];T.subtractToRef(A,V),V.normalize(),Gt.CrossToRef(E,V,z);var U=z.lengthSquared();0===U?z.x=1:z.normalizeFromLength(Math.sqrt(U)),Gt.CrossToRef(V,z,O),O.normalize();var H=-Gt.Dot(z,T),G=-Gt.Dot(O,T),X=-Gt.Dot(V,T);t.FromValuesToRef(z.x,O.x,V.x,0,z.y,O.y,V.y,0,z.z,O.z,V.z,0,H,G,X,1,R)},t.OrthoLH=function(T,A,E,R){var z=new t;return t.OrthoLHToRef(T,A,E,R,z),z},t.OrthoLHToRef=function(T,A,E,R,z){var O=2/T,V=2/A,U=2/(R-E),H=-(R+E)/(R-E);t.FromValuesToRef(O,0,0,0,0,V,0,0,0,0,U,0,0,0,H,1,z),z._updateIdentityStatus(1===O&&1===V&&1===U&&0===H)},t.OrthoOffCenterLH=function(T,A,E,R,z,O){var V=new t;return t.OrthoOffCenterLHToRef(T,A,E,R,z,O,V),V},t.OrthoOffCenterLHToRef=function(T,A,E,R,z,O,V){var U=2/(A-T),H=2/(R-E),G=2/(O-z),X=-(O+z)/(O-z),Q=(T+A)/(T-A),Z=(R+E)/(E-R);t.FromValuesToRef(U,0,0,0,0,H,0,0,0,0,G,0,Q,Z,X,1,V),V._markAsUpdated()},t.OrthoOffCenterRH=function(T,A,E,R,z,O){var V=new t;return t.OrthoOffCenterRHToRef(T,A,E,R,z,O,V),V},t.OrthoOffCenterRHToRef=function(T,A,E,R,z,O,V){t.OrthoOffCenterLHToRef(T,A,E,R,z,O,V),V._m[10]*=-1},t.PerspectiveLH=function(T,A,E,R){var z=new t,O=2*E/T,V=2*E/A,U=(R+E)/(R-E),H=-2*R*E/(R-E);return t.FromValuesToRef(O,0,0,0,0,V,0,0,0,0,U,1,0,0,H,0,z),z._updateIdentityStatus(!1),z},t.PerspectiveFovLH=function(T,A,E,R){var z=new t;return t.PerspectiveFovLHToRef(T,A,E,R,z),z},t.PerspectiveFovLHToRef=function(T,A,E,R,z,O){void 0===O&&(O=!0);var V=E,U=R,H=1/Math.tan(.5*T),G=O?H/A:H,X=O?H:H*A,Q=(U+V)/(U-V),Z=-2*U*V/(U-V);t.FromValuesToRef(G,0,0,0,0,X,0,0,0,0,Q,1,0,0,Z,0,z),z._updateIdentityStatus(!1)},t.PerspectiveFovRH=function(T,A,E,R){var z=new t;return t.PerspectiveFovRHToRef(T,A,E,R,z),z},t.PerspectiveFovRHToRef=function(T,A,E,R,z,O){void 0===O&&(O=!0);var V=E,U=R,H=1/Math.tan(.5*T),G=O?H/A:H,X=O?H:H*A,Q=-(U+V)/(U-V),Z=-2*U*V/(U-V);t.FromValuesToRef(G,0,0,0,0,X,0,0,0,0,Q,-1,0,0,Z,0,z),z._updateIdentityStatus(!1)},t.PerspectiveFovWebVRToRef=function(T,A,E,R,z){void 0===z&&(z=!1);var O=z?-1:1,V=Math.tan(T.upDegrees*Math.PI/180),U=Math.tan(T.downDegrees*Math.PI/180),H=Math.tan(T.leftDegrees*Math.PI/180),G=Math.tan(T.rightDegrees*Math.PI/180),X=2/(H+G),Q=2/(V+U),Z=R._m;Z[0]=X,Z[1]=Z[2]=Z[3]=Z[4]=0,Z[5]=Q,Z[6]=Z[7]=0,Z[8]=(H-G)*X*.5,Z[9]=-(V-U)*Q*.5,Z[10]=-E/(A-E),Z[11]=1*O,Z[12]=Z[13]=Z[15]=0,Z[14]=-2*E*A/(E-A),R._markAsUpdated()},t.GetAsMatrix2x2=function(T){return[T._m[0],T._m[1],T._m[4],T._m[5]]},t.GetAsMatrix3x3=function(T){return[T._m[0],T._m[1],T._m[2],T._m[4],T._m[5],T._m[6],T._m[8],T._m[9],T._m[10]]},t.Transpose=function(T){var A=new t;return t.TransposeToRef(T,A),A},t.TransposeToRef=function(T,A){var E=A._m,R=T._m;E[0]=R[0],E[1]=R[4],E[2]=R[8],E[3]=R[12],E[4]=R[1],E[5]=R[5],E[6]=R[9],E[7]=R[13],E[8]=R[2],E[9]=R[6],E[10]=R[10],E[11]=R[14],E[12]=R[3],E[13]=R[7],E[14]=R[11],E[15]=R[15],A._updateIdentityStatus(T._isIdentity,T._isIdentityDirty)},t.Reflection=function(T){var A=new t;return t.ReflectionToRef(T,A),A},t.ReflectionToRef=function(T,A){T.normalize();var E=T.normal.x,R=T.normal.y,z=T.normal.z,O=-2*E,V=-2*R,U=-2*z;t.FromValuesToRef(O*E+1,V*E,U*E,0,O*R,V*R+1,U*R,0,O*z,V*z,U*z+1,0,O*T.d,V*T.d,U*T.d,1,A)},t.FromXYZAxesToRef=function(T,A,E,R){t.FromValuesToRef(T.x,T.y,T.z,0,A.x,A.y,A.z,0,E.x,E.y,E.z,0,0,0,0,1,R)},t.FromQuaternionToRef=function(T,A){var E=T.x*T.x,R=T.y*T.y,z=T.z*T.z,O=T.x*T.y,V=T.z*T.w,U=T.z*T.x,H=T.y*T.w,G=T.y*T.z,X=T.x*T.w;A._m[0]=1-2*(R+z),A._m[1]=2*(O+V),A._m[2]=2*(U-H),A._m[3]=0,A._m[4]=2*(O-V),A._m[5]=1-2*(z+E),A._m[6]=2*(G+X),A._m[7]=0,A._m[8]=2*(U+H),A._m[9]=2*(G-X),A._m[10]=1-2*(R+E),A._m[11]=0,A._m[12]=0,A._m[13]=0,A._m[14]=0,A._m[15]=1,A._markAsUpdated()},t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},t.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var T=this._m;this._isIdentity=1===T[0]&&0===T[1]&&0===T[2]&&0===T[3]&&0===T[4]&&1===T[5]&&0===T[6]&&0===T[7]&&0===T[8]&&0===T[9]&&1===T[10]&&0===T[11]&&0===T[12]&&0===T[13]&&0===T[14]&&1===T[15]}return this._isIdentity},t.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},t.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var T=this._m,A=T[0],E=T[1],R=T[2],z=T[3],O=T[4],V=T[5],U=T[6],H=T[7],G=T[8],X=T[9],Q=T[10],Z=T[11],K=T[12],J=T[13],$=T[14],et=T[15],nt=Q*et-$*Z,ot=X*et-J*Z,it=X*$-J*Q,rt=G*et-K*Z,st=G*$-Q*K,at=G*J-K*X;return A*+(V*nt-U*ot+H*it)+E*-(O*nt-U*rt+H*st)+R*+(O*ot-V*rt+H*at)+z*-(O*it-V*st+U*at)},t.prototype.toArray=function(){return this._m},t.prototype.asArray=function(){return this._m},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},t.prototype.add=function(T){var A=new t;return this.addToRef(T,A),A},t.prototype.addToRef=function(T,A){for(var E=0;E<16;E++)A._m[E]=this._m[E]+T._m[E];return A._markAsUpdated(),this},t.prototype.addToSelf=function(T){for(var A=0;A<16;A++)this._m[A]+=T._m[A];return this._markAsUpdated(),this},t.prototype.invertToRef=function(T){if(!0===this._isIdentity)return t.IdentityToRef(T),this;var A=this._m,E=A[0],R=A[1],z=A[2],O=A[3],V=A[4],U=A[5],H=A[6],G=A[7],X=A[8],Q=A[9],Z=A[10],K=A[11],J=A[12],$=A[13],et=A[14],nt=A[15],ot=Z*nt-et*K,it=Q*nt-$*K,rt=Q*et-$*Z,st=X*nt-J*K,at=X*et-Z*J,lt=X*$-J*Q,ut=+(U*ot-H*it+G*rt),ct=-(V*ot-H*st+G*at),ht=+(V*it-U*st+G*lt),pt=-(V*rt-U*at+H*lt),dt=E*ut+R*ct+z*ht+O*pt;if(0===dt)return T.copyFrom(this),this;var ft=1/dt,vt=H*nt-et*G,mt=U*nt-$*G,gt=U*et-$*H,wt=V*nt-J*G,bt=V*et-J*H,xt=V*$-J*U,Tt=H*K-Z*G,At=U*K-Q*G,St=U*Z-Q*H,Et=V*K-X*G,Ct=V*Z-X*H,It=V*Q-X*U,Rt=-(R*ot-z*it+O*rt),_t=+(E*ot-z*st+O*at),Pt=-(E*it-R*st+O*lt),zt=+(E*rt-R*at+z*lt),Bt=+(R*vt-z*mt+O*gt),Ot=-(E*vt-z*wt+O*bt),Lt=+(E*mt-R*wt+O*xt),Mt=-(E*gt-R*bt+z*xt),Nt=-(R*Tt-z*At+O*St),kt=+(E*Tt-z*Et+O*Ct),qt=-(E*At-R*Et+O*It),Dt=+(E*St-R*Ct+z*It);return t.FromValuesToRef(ut*ft,Rt*ft,Bt*ft,Nt*ft,ct*ft,_t*ft,Ot*ft,kt*ft,ht*ft,Pt*ft,Lt*ft,qt*ft,pt*ft,zt*ft,Mt*ft,Dt*ft,T),this},t.prototype.addAtIndex=function(T,A){return this._m[T]+=A,this._markAsUpdated(),this},t.prototype.multiplyAtIndex=function(T,A){return this._m[T]*=A,this._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(T,A,E){return this._m[12]=T,this._m[13]=A,this._m[14]=E,this._markAsUpdated(),this},t.prototype.setTranslation=function(T){return this.setTranslationFromFloats(T.x,T.y,T.z)},t.prototype.getTranslation=function(){return new Gt(this._m[12],this._m[13],this._m[14])},t.prototype.getTranslationToRef=function(T){return T.x=this._m[12],T.y=this._m[13],T.z=this._m[14],this},t.prototype.removeRotationAndScaling=function(){var T=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,T[12],T[13],T[14],T[15],this),this._updateIdentityStatus(0===T[12]&&0===T[13]&&0===T[14]&&1===T[15]),this},t.prototype.multiply=function(T){var A=new t;return this.multiplyToRef(T,A),A},t.prototype.copyFrom=function(T){T.copyToArray(this._m);var A=T;return this._updateIdentityStatus(A._isIdentity,A._isIdentityDirty,A._isIdentity3x2,A._isIdentity3x2Dirty),this},t.prototype.copyToArray=function(T,A){void 0===A&&(A=0);for(var E=0;E<16;E++)T[A+E]=this._m[E];return this},t.prototype.multiplyToRef=function(T,A){return this._isIdentity?(A.copyFrom(T),this):T._isIdentity?(A.copyFrom(this),this):(this.multiplyToArray(T,A._m,0),A._markAsUpdated(),this)},t.prototype.multiplyToArray=function(T,A,E){var R=this._m,z=T.m,O=R[0],V=R[1],U=R[2],H=R[3],G=R[4],X=R[5],Q=R[6],Z=R[7],K=R[8],J=R[9],$=R[10],et=R[11],nt=R[12],ot=R[13],it=R[14],rt=R[15],st=z[0],at=z[1],lt=z[2],ut=z[3],ct=z[4],ht=z[5],pt=z[6],dt=z[7],ft=z[8],vt=z[9],mt=z[10],gt=z[11],wt=z[12],bt=z[13],xt=z[14],Tt=z[15];return A[E]=O*st+V*ct+U*ft+H*wt,A[E+1]=O*at+V*ht+U*vt+H*bt,A[E+2]=O*lt+V*pt+U*mt+H*xt,A[E+3]=O*ut+V*dt+U*gt+H*Tt,A[E+4]=G*st+X*ct+Q*ft+Z*wt,A[E+5]=G*at+X*ht+Q*vt+Z*bt,A[E+6]=G*lt+X*pt+Q*mt+Z*xt,A[E+7]=G*ut+X*dt+Q*gt+Z*Tt,A[E+8]=K*st+J*ct+$*ft+et*wt,A[E+9]=K*at+J*ht+$*vt+et*bt,A[E+10]=K*lt+J*pt+$*mt+et*xt,A[E+11]=K*ut+J*dt+$*gt+et*Tt,A[E+12]=nt*st+ot*ct+it*ft+rt*wt,A[E+13]=nt*at+ot*ht+it*vt+rt*bt,A[E+14]=nt*lt+ot*pt+it*mt+rt*xt,A[E+15]=nt*ut+ot*dt+it*gt+rt*Tt,this},t.prototype.equals=function(T){var A=T;if(!A)return!1;if((this._isIdentity||A._isIdentity)&&!this._isIdentityDirty&&!A._isIdentityDirty)return this._isIdentity&&A._isIdentity;var E=this.m,R=A.m;return E[0]===R[0]&&E[1]===R[1]&&E[2]===R[2]&&E[3]===R[3]&&E[4]===R[4]&&E[5]===R[5]&&E[6]===R[6]&&E[7]===R[7]&&E[8]===R[8]&&E[9]===R[9]&&E[10]===R[10]&&E[11]===R[11]&&E[12]===R[12]&&E[13]===R[13]&&E[14]===R[14]&&E[15]===R[15]},t.prototype.clone=function(){var T=new t;return T.copyFrom(this),T},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var T=this._m[0]||0,A=1;A<16;A++)T=397*T^(this._m[A]||0);return T},t.prototype.decompose=function(T,A,E){if(this._isIdentity)return E&&E.setAll(0),T&&T.setAll(1),A&&A.copyFromFloats(0,0,0,1),!0;var R=this._m;E&&E.copyFromFloats(R[12],R[13],R[14]);var z=T||Xt.Vector3[0];if(z.x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),z.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),z.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),this.determinant()<=0&&(z.y*=-1),0===z.x||0===z.y||0===z.z)return A&&A.copyFromFloats(0,0,0,1),!1;if(A){var O=1/z.x,V=1/z.y,U=1/z.z;t.FromValuesToRef(R[0]*O,R[1]*O,R[2]*O,0,R[4]*V,R[5]*V,R[6]*V,0,R[8]*U,R[9]*U,R[10]*U,0,0,0,0,1,Xt.Matrix[0]),jt.FromRotationMatrixToRef(Xt.Matrix[0],A)}return!0},t.prototype.getRow=function(T){if(T<0||T>3)return null;var A=4*T;return new Ut(this._m[A+0],this._m[A+1],this._m[A+2],this._m[A+3])},t.prototype.setRow=function(T,A){return this.setRowFromFloats(T,A.x,A.y,A.z,A.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(T){return t.TransposeToRef(this,T),this},t.prototype.setRowFromFloats=function(T,A,E,R,z){if(T<0||T>3)return this;var O=4*T;return this._m[O+0]=A,this._m[O+1]=E,this._m[O+2]=R,this._m[O+3]=z,this._markAsUpdated(),this},t.prototype.scale=function(T){var A=new t;return this.scaleToRef(T,A),A},t.prototype.scaleToRef=function(T,A){for(var E=0;E<16;E++)A._m[E]=this._m[E]*T;return A._markAsUpdated(),this},t.prototype.scaleAndAddToRef=function(T,A){for(var E=0;E<16;E++)A._m[E]+=this._m[E]*T;return A._markAsUpdated(),this},t.prototype.toNormalMatrix=function(T){var A=Xt.Matrix[0];this.invertToRef(A),A.transposeToRef(T);var E=T._m;t.FromValuesToRef(E[0],E[1],E[2],0,E[4],E[5],E[6],0,E[8],E[9],E[10],0,0,0,0,1,T)},t.prototype.getRotationMatrix=function(){var T=new t;return this.getRotationMatrixToRef(T),T},t.prototype.getRotationMatrixToRef=function(T){var A=Xt.Vector3[0];if(!this.decompose(A))return t.IdentityToRef(T),this;var E=this._m,R=1/A.x,z=1/A.y,O=1/A.z;return t.FromValuesToRef(E[0]*R,E[1]*R,E[2]*R,0,E[4]*z,E[5]*z,E[6]*z,0,E[8]*O,E[9]*O,E[10]*O,0,0,0,0,1,T),this},t.prototype.toggleModelMatrixHandInPlace=function(){var T=this._m;T[2]*=-1,T[6]*=-1,T[8]*=-1,T[9]*=-1,T[14]*=-1,this._markAsUpdated()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var T=this._m;T[8]*=-1,T[9]*=-1,T[10]*=-1,T[11]*=-1,this._markAsUpdated()},t.prototype._updateIdentityStatus=function(T,A,E,R){void 0===A&&(A=!1),void 0===E&&(E=!1),void 0===R&&(R=!0),this.updateFlag=t._updateFlagSeed++,this._isIdentity=T,this._isIdentity3x2=T||E,this._isIdentityDirty=!this._isIdentity&&A,this._isIdentity3x2Dirty=!this._isIdentity3x2&&R},t._updateFlagSeed=0,t._identityReadOnly=t.Identity(),t}(),jt=function(){function t(T,A,E,R){void 0===T&&(T=0),void 0===A&&(A=0),void 0===E&&(E=0),void 0===R&&(R=1),this.x=T,this.y=A,this.z=E,this.w=R}return t.FromRotationMatrix=function(T){var A=new t;return t.FromRotationMatrixToRef(T,A),A},t.FromRotationMatrixToRef=function(T,A){var E,R=T.m,z=R[0],O=R[4],V=R[8],U=R[1],H=R[5],G=R[9],X=R[2],Q=R[6],Z=R[10],K=z+H+Z;K>0?(E=.5/Math.sqrt(K+1),A.w=.25/E,A.x=(Q-G)*E,A.y=(V-X)*E,A.z=(U-O)*E):z>H&&z>Z?(E=2*Math.sqrt(1+z-H-Z),A.w=(Q-G)/E,A.x=.25*E,A.y=(O+U)/E,A.z=(V+X)/E):H>Z?(E=2*Math.sqrt(1+H-z-Z),A.w=(V-X)/E,A.x=(O+U)/E,A.y=.25*E,A.z=(G+Q)/E):(E=2*Math.sqrt(1+Z-z-H),A.w=(U-O)/E,A.x=(V+X)/E,A.y=(G+Q)/E,A.z=.25*E)},t.Dot=function(T,A){return T.x*A.x+T.y*A.y+T.z*A.z+T.w*A.w},t.AreClose=function(T,A){return t.Dot(T,A)>=0},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(T){return new t(-T.x,-T.y,-T.z,T.w)},t.IsIdentity=function(T){return T&&0===T.x&&0===T.y&&0===T.z&&1===T.w},t.RotationAxis=function(T,A){var E=A*Dt;return t.RotationAxisToRef(T,E,new t)},t.RotationAxisToRef=function(T,A,E){var R=A*Dt,z=Math.sin(R/2);return T.normalize(),E.w=Math.cos(R/2),E.x=T.x*z,E.y=T.y*z,E.z=T.z*z,E},t.FromArray=function(T,A){return void 0===A&&(A=0),new t(T[A],T[A+1],T[A+2],T[A+3])},t.FromEulerAnglesRef=function(T,A,E,R){return t.RotationYawPitchRollToRef(A*Dt,T*Dt,E*Dt,R)},t.RotationYawPitchRoll=function(T,A,E){var R=new t;return t.RotationYawPitchRollToRef(T,A,E,R),R},t.RotationYawPitchRollToRef=function(T,A,E,R){var z=.5*A,O=.5*T,V=.5*E,U=Math.cos(z),H=Math.cos(O),G=Math.cos(V),X=Math.sin(z),Q=Math.sin(O),Z=Math.sin(V);R.x=H*X*G+Q*U*Z,R.y=Q*U*G-H*X*Z,R.z=H*U*Z-Q*X*G,R.w=H*U*G+Q*X*Z},t.RotationAlphaBetaGamma=function(T,A,E){var R=new t;return t.RotationAlphaBetaGammaToRef(T,A,E,R),R},t.RotationAlphaBetaGammaToRef=function(T,A,E,R){var z=.5*(E+T),O=.5*(E-T),V=.5*A;R.x=Math.cos(O)*Math.sin(V),R.y=Math.sin(O)*Math.sin(V),R.z=Math.sin(z)*Math.cos(V),R.w=Math.cos(z)*Math.cos(V)},t.RotationQuaternionFromAxis=function(T,A,E){var R=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(T,A,E,R),R},t.RotationQuaternionFromAxisToRef=function(T,A,E,R){var z=Xt.Matrix[0];Ht.FromXYZAxesToRef(T.normalize(),A.normalize(),E.normalize(),z),t.FromRotationMatrixToRef(z,R)},t.Slerp=function(T,A,E){var R=t.Identity;return t.SlerpToRef(T,A,E,R),R},t.SlerpToRef=function(T,A,E,R){var z,O,V=T.x*A.x+T.y*A.y+T.z*A.z+T.w*A.w,U=!1;if(V<0&&(U=!0,V=-V),V>.999999)O=1-E,z=U?-E:E;else{var H=Math.acos(V),G=1/Math.sin(H);O=Math.sin((1-E)*H)*G,z=U?-Math.sin(E*H)*G:Math.sin(E*H)*G}R.x=O*T.x+z*A.x,R.y=O*T.y+z*A.y,R.z=O*T.z+z*A.z,R.w=O*T.w+z*A.w},t.Hermite=function(T,A,E,R,z){var O=z*z,V=z*O,U=2*V-3*O+1,H=-2*V+3*O,G=V-2*O+z,X=V-O;return new t(T.x*U+E.x*H+A.x*G+R.x*X,T.y*U+E.y*H+A.y*G+R.y*X,T.z*U+E.z*H+A.z*G+R.z*X,T.w*U+E.w*H+A.w*G+R.w*X)},Object.defineProperty(t,"Identity",{get:function(){return new t(0,0,0,1)},enumerable:!1,configurable:!0}),t.Angle=function(T,A){var E=t.Dot(T,A);return 2*Math.acos(Math.min(Math.abs(E),1))*Vt},t.Euler=function(T,A,E){return t.RotationYawPitchRoll(A*Dt,T*Dt,E*Dt)},t.LookRotation=function(T,A){void 0===A&&(A=Xt.staticUp);var E=Gt.Normalize(T),R=Gt.Normalize(Gt.Cross(A,E)),z=Gt.Cross(E,R),O=R.x,V=R.y,U=R.z,H=z.x,G=z.y,X=z.z,Q=E.x,Z=E.y,K=E.z,J=O+G+K,$=new t;if(J>0){var et=Math.sqrt(J+1);return $.w=.5*et,et=.5/et,$.x=(X-Z)*et,$.y=(Q-U)*et,$.z=(V-H)*et,$}if(O>=G&&O>=K){var nt=Math.sqrt(1+O-G-K),ot=.5/nt;return $.x=.5*nt,$.y=(V+H)*ot,$.z=(U+Q)*ot,$.w=(X-Z)*ot,$}if(G>K){var it=Math.sqrt(1+G-O-K),rt=.5/it;return $.x=(H+V)*rt,$.y=.5*it,$.z=(Z+X)*rt,$.w=(Q-U)*rt,$}var st=Math.sqrt(1+K-O-G),at=.5/st;return $.x=(Q+U)*at,$.y=(Z+X)*at,$.z=.5*st,$.w=(V-H)*at,$},t.RotateTowards=function(T,A,E){var R=t.Angle(T,A);if(0===R)return A;var z=Math.min(1,E/R);return t.Slerp(T,A,z)},t.FromToRotation=function(T,A,E){void 0===E&&(E=Xt.staticUp);var R=T.normalize(),z=A.normalize(),O=Gt.Cross(R,z),V=Math.sqrt(R.lengthSquared()*z.lengthSquared())+Gt.Dot(R,z);return O.lengthSquared()<1e-4?Math.abs(V)<1e-4?new t(E.x,E.y,E.z,0).normalized:t.Identity:new t(O.x,O.y,O.z,V).normalized},Object.defineProperty(t.prototype,"normalized",{get:function(){return this.normalize()},enumerable:!1,configurable:!0}),t.prototype.setFromToRotation=function(T,A,E){void 0===E&&(E=Xt.staticUp);var R=t.FromToRotation(T,A,E);this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w},Object.defineProperty(t.prototype,"eulerAngles",{get:function(){var T=new Gt,A=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,E=this.x*this.w-this.y*this.z;return E>.4995*A?(T.x=Math.PI/2,T.y=2*Math.atan2(this.y,this.x),T.z=0):E<-.4995*A?(T.x=-Math.PI/2,T.y=-2*Math.atan2(this.y,this.x),T.z=0):(T.x=Math.asin(2*(this.w*this.x-this.y*this.z)),T.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),T.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),T.x*=Vt,T.y*=Vt,T.z*=Vt,T.x=Wt.Repeat(T.x,360),T.y=Wt.Repeat(T.y,360),T.z=Wt.Repeat(T.z,360),T},set:function(T){this.setEuler(T.x,T.y,T.z)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var T=this.x||0;return 397*(T=397*(T=397*T^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(T){return T&&this.x===T.x&&this.y===T.y&&this.z===T.z&&this.w===T.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(T){return this.x=T.x,this.y=T.y,this.z=T.z,this.w=T.w,this},t.prototype.copyFromFloats=function(T,A,E,R){return this.x=T,this.y=A,this.z=E,this.w=R,this},t.prototype.set=function(T,A,E,R){return this.copyFromFloats(T,A,E,R)},t.prototype.setEuler=function(T,A,E){return t.RotationYawPitchRollToRef(A*Dt,T*Dt,E*Dt,this),this},t.prototype.add=function(T){return new t(this.x+T.x,this.y+T.y,this.z+T.z,this.w+T.w)},t.prototype.addInPlace=function(T){return this.x+=T.x,this.y+=T.y,this.z+=T.z,this.w+=T.w,this},t.prototype.subtract=function(T){return new t(this.x-T.x,this.y-T.y,this.z-T.z,this.w-T.w)},t.prototype.scale=function(T){return new t(this.x*T,this.y*T,this.z*T,this.w*T)},t.prototype.scaleToRef=function(T,A){return A.x=this.x*T,A.y=this.y*T,A.z=this.z*T,A.w=this.w*T,this},t.prototype.scaleInPlace=function(T){return this.x*=T,this.y*=T,this.z*=T,this.w*=T,this},t.prototype.scaleAndAddToRef=function(T,A){return A.x+=this.x*T,A.y+=this.y*T,A.z+=this.z*T,A.w+=this.w*T,this},t.prototype.multiply=function(T){var A=new t(0,0,0,1);return this.multiplyToRef(T,A),A},t.prototype.multiplyToRef=function(T,A){var E=this.x*T.w+this.y*T.z-this.z*T.y+this.w*T.x,R=-this.x*T.z+this.y*T.w+this.z*T.x+this.w*T.y,z=this.x*T.y-this.y*T.x+this.z*T.w+this.w*T.z,O=-this.x*T.x-this.y*T.y-this.z*T.z+this.w*T.w;return A.copyFromFloats(E,R,z,O),this},t.prototype.multiplyInPlace=function(T){return this.multiplyToRef(T,this),this},t.prototype.conjugateToRef=function(T){return T.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){return new t(-this.x,-this.y,-this.z,this.w)},t.prototype.normalize=function(){var T=1/this.length;return this.x*=T,this.y*=T,this.z*=T,this.w*=T,this},t.prototype.angleAxis=function(T,A){if(0===A.lengthSquared())return t.Identity;var E=t.Identity,R=T*Dt;R*=.5;var z=A.normalize();return z=A.scaleInPlace(Math.sin(R)),E.x=z.x,E.y=z.y,E.z=z.z,E.w=Math.cos(R),E.normalize()},t.prototype.toRotationMatrix=function(T){return Ht.FromQuaternionToRef(this,T),this},t.prototype.fromRotationMatrix=function(T){return t.FromRotationMatrixToRef(T,this),this},t}(),Gt=function(){function t(T,A,E){void 0===T&&(T=0),void 0===A&&(A=0),void 0===E&&(E=0),this.x=T,this.y=A,this.z=E}return Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var T=Math.abs(this.x),A=Math.abs(this.y);if(T!==A)return!0;var E=Math.abs(this.z);return T!==E||A!==E},enumerable:!1,configurable:!0}),t.Add=function(T,A){return new t(T.x,T.y,T.z).addInPlace(A)},t.GetClipFactor=function(T,A,E,R){var z=t.Dot(T,E)-R;return z/(z-(t.Dot(A,E)-R))},t.GetAngleBetweenVectors=function(T,A,E){var R=T.normalizeToRef(Xt.Vector3[1]),z=A.normalizeToRef(Xt.Vector3[2]),O=t.Dot(R,z),V=Xt.Vector3[3];return t.CrossToRef(R,z,V),t.Dot(V,E)>0?Math.acos(O):-Math.acos(O)},t.FromArray=function(T,A){return void 0===A&&(A=0),new t(T[A],T[A+1],T[A+2])},t.FromFloatArray=function(T,A){return t.FromArray(T,A)},t.FromArrayToRef=function(T,A,E){E.x=T[A],E.y=T[A+1],E.z=T[A+2]},t.FromFloatArrayToRef=function(T,A,E){return t.FromArrayToRef(T,A,E)},t.FromFloatsToRef=function(T,A,E,R){R.copyFromFloats(T,A,E)},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},t.Down=function(){return new t(0,-1,0)},t.Forward=function(){return new t(0,0,1)},t.Backward=function(){return new t(0,0,-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(T,A){var E=t.Zero();return t.TransformCoordinatesToRef(T,A,E),E},t.TransformCoordinatesToRef=function(T,A,E){return t.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,A,E)},t.TransformCoordinatesFromFloatsToRef=function(T,A,E,R,z){var O=R.m,V=T*O[0]+A*O[4]+E*O[8]+O[12],U=T*O[1]+A*O[5]+E*O[9]+O[13],H=T*O[2]+A*O[6]+E*O[10]+O[14],G=1/(T*O[3]+A*O[7]+E*O[11]+O[15]);z.x=V*G,z.y=U*G,z.z=H*G},t.TransformNormal=function(T,A){var E=t.Zero();return t.TransformNormalToRef(T,A,E),E},t.TransformNormalToRef=function(T,A,E){this.TransformNormalFromFloatsToRef(T.x,T.y,T.z,A,E)},t.TransformNormalFromFloatsToRef=function(T,A,E,R,z){var O=R.m;z.x=T*O[0]+A*O[4]+E*O[8],z.y=T*O[1]+A*O[5]+E*O[9],z.z=T*O[2]+A*O[6]+E*O[10]},t.CatmullRom=function(T,A,E,R,z){var O=z*z,V=z*O;return new t(.5*(2*A.x+(-T.x+E.x)*z+(2*T.x-5*A.x+4*E.x-R.x)*O+(-T.x+3*A.x-3*E.x+R.x)*V),.5*(2*A.y+(-T.y+E.y)*z+(2*T.y-5*A.y+4*E.y-R.y)*O+(-T.y+3*A.y-3*E.y+R.y)*V),.5*(2*A.z+(-T.z+E.z)*z+(2*T.z-5*A.z+4*E.z-R.z)*O+(-T.z+3*A.z-3*E.z+R.z)*V))},t.Clamp=function(T,A,E){var R=new t;return t.ClampToRef(T,A,E,R),R},t.ClampToRef=function(T,A,E,R){var z=T.x;z=(z=z>E.x?E.x:z)<A.x?A.x:z;var O=T.y;O=(O=O>E.y?E.y:O)<A.y?A.y:O;var V=T.z;V=(V=V>E.z?E.z:V)<A.z?A.z:V,R.copyFromFloats(z,O,V)},t.Hermite=function(T,A,E,R,z){var O=z*z,V=z*O,U=2*V-3*O+1,H=-2*V+3*O,G=V-2*O+z,X=V-O;return new t(T.x*U+E.x*H+A.x*G+R.x*X,T.y*U+E.y*H+A.y*G+R.y*X,T.z*U+E.z*H+A.z*G+R.z*X)},t.Lerp=function(T,A,E){var R=new t(0,0,0);return t.LerpToRef(T,A,E,R),R},t.LerpToRef=function(T,A,E,R){R.x=T.x+(A.x-T.x)*E,R.y=T.y+(A.y-T.y)*E,R.z=T.z+(A.z-T.z)*E},t.Dot=function(T,A){return T.x*A.x+T.y*A.y+T.z*A.z},t.Cross=function(T,A){var E=t.Zero();return t.CrossToRef(T,A,E),E},t.CrossToRef=function(T,A,E){var R=T.y*A.z-T.z*A.y,z=T.z*A.x-T.x*A.z,O=T.x*A.y-T.y*A.x;E.copyFromFloats(R,z,O)},t.Normalize=function(T){var A=t.Zero();return t.NormalizeToRef(T,A),A},t.NormalizeToRef=function(T,A){T.normalizeToRef(A)},t.Minimize=function(T,A){var E=new t(T.x,T.y,T.z);return E.minimizeInPlace(A),E},t.Maximize=function(T,A){var E=new t(T.x,T.y,T.z);return E.maximizeInPlace(A),E},t.Distance=function(T,A){return Math.sqrt(t.DistanceSquared(T,A))},t.DistanceSquared=function(T,A){var E=T.x-A.x,R=T.y-A.y,z=T.z-A.z;return E*E+R*R+z*z},t.Center=function(T,A){var E=t.Add(T,A);return E.scaleInPlace(.5),E},t.RotationFromAxis=function(T,A,E){var R=t.Zero();return t.RotationFromAxisToRef(T,A,E,R),R},t.RotationFromAxisToRef=function(T,A,E,R){var z=Xt.Quaternion[0];jt.RotationQuaternionFromAxisToRef(T,A,E,z),R.copyFrom(z.eulerAngles)},t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var T=this.x||0;return 397*(T=397*T^(this.y||0))^(this.z||0)},t.prototype.asArray=function(){var T=[];return this.toArray(T,0),T},t.prototype.toArray=function(T,A){return void 0===A&&(A=0),T[A]=this.x,T[A+1]=this.y,T[A+2]=this.z,this},t.prototype.toQuaternion=function(){return jt.Identity.setEuler(this.y,this.x,this.z)},t.prototype.addInPlace=function(T){return this.addInPlaceFromFloats(T.x,T.y,T.z)},t.prototype.addInPlaceFromFloats=function(T,A,E){return this.x+=T,this.y+=A,this.z+=E,this},t.prototype.add=function(T){return new t(this.x+T.x,this.y+T.y,this.z+T.z)},t.prototype.addToRef=function(T,A){return A.copyFromFloats(this.x+T.x,this.y+T.y,this.z+T.z)},t.prototype.subtractInPlace=function(T){return this.x-=T.x,this.y-=T.y,this.z-=T.z,this},t.prototype.subtract=function(T){return new t(this.x-T.x,this.y-T.y,this.z-T.z)},t.prototype.subtractToRef=function(T,A){return this.subtractFromFloatsToRef(T.x,T.y,T.z,A)},t.prototype.subtractFromFloats=function(T,A,E){return new t(this.x-T,this.y-A,this.z-E)},t.prototype.subtractFromFloatsToRef=function(T,A,E,R){return R.copyFromFloats(this.x-T,this.y-A,this.z-E)},t.prototype.applyMatrix4=function(T){this.applyMatrix4ToRef(T,this)},t.prototype.applyMatrix4ToRef=function(T,A){var E=this,R=E.x,z=E.y,O=E.z,V=T.m,U=1/(V[3]*R+V[7]*z+V[11]*O+V[15]);return A.x=(V[0]*R+V[4]*z+V[8]*O+V[12])*U,A.y=(V[1]*R+V[5]*z+V[9]*O+V[13])*U,A.z=(V[2]*R+V[6]*z+V[10]*O+V[14])*U,A},t.prototype.rotate=function(T){return this.rotateToRef(T,this)},t.prototype.rotateToRef=function(T,A){var E=this,R=E.x,z=E.y,O=E.z,V=T.x,U=T.y,H=T.z,G=T.w,X=G*R+U*O-H*z,Q=G*z+H*R-V*O,Z=G*O+V*z-U*R,K=-V*R-U*z-H*O;return A.x=X*G+K*-V+Q*-H-Z*-U,A.y=Q*G+K*-U+Z*-V-X*-H,A.z=Z*G+K*-H+X*-U-Q*-V,A},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(T){return this.x*=T,this.y*=T,this.z*=T,this},t.prototype.scale=function(T){return new t(this.x*T,this.y*T,this.z*T)},t.prototype.scaleToRef=function(T,A){return A.copyFromFloats(this.x*T,this.y*T,this.z*T)},t.prototype.scaleAndAddToRef=function(T,A){return A.addInPlaceFromFloats(this.x*T,this.y*T,this.z*T)},t.prototype.equals=function(T){return T&&this.x===T.x&&this.y===T.y&&this.z===T.z},t.prototype.equalsWithEpsilon=function(T,A){return void 0===A&&(A=qt),T&&Wt.WithinEpsilon(this.x,T.x,A)&&Wt.WithinEpsilon(this.y,T.y,A)&&Wt.WithinEpsilon(this.z,T.z,A)},t.prototype.equalsToFloats=function(T,A,E){return this.x===T&&this.y===A&&this.z===E},t.prototype.multiplyInPlace=function(T){return this.x*=T.x,this.y*=T.y,this.z*=T.z,this},t.prototype.multiply=function(T){return this.multiplyByFloats(T.x,T.y,T.z)},t.prototype.multiplyToRef=function(T,A){return A.copyFromFloats(this.x*T.x,this.y*T.y,this.z*T.z)},t.prototype.multiplyByFloats=function(T,A,E){return new t(this.x*T,this.y*A,this.z*E)},t.prototype.divide=function(T){return new t(this.x/T.x,this.y/T.y,this.z/T.z)},t.prototype.divideToRef=function(T,A){return A.copyFromFloats(this.x/T.x,this.y/T.y,this.z/T.z)},t.prototype.divideInPlace=function(T){return this.divideToRef(T,this)},t.prototype.minimizeInPlace=function(T){return this.minimizeInPlaceFromFloats(T.x,T.y,T.z)},t.prototype.maximizeInPlace=function(T){return this.maximizeInPlaceFromFloats(T.x,T.y,T.z)},t.prototype.minimizeInPlaceFromFloats=function(T,A,E){return T<this.x&&(this.x=T),A<this.y&&(this.y=A),E<this.z&&(this.z=E),this},t.prototype.maximizeInPlaceFromFloats=function(T,A,E){return T>this.x&&(this.x=T),A>this.y&&(this.y=A),E>this.z&&(this.z=E),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){return this.normalizeFromLength(this.length())},t.prototype.normalizeFromLength=function(T){return 0===T||1===T?this:this.scaleInPlace(1/T)},t.prototype.normalizeToNew=function(){var T=new t(0,0,0);return this.normalizeToRef(T),T},t.prototype.normalizeToRef=function(T){var A=this.length();return 0===A||1===A?T.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/A,T)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(T){return this.copyFromFloats(T.x,T.y,T.z)},t.prototype.copyFromFloats=function(T,A,E){return this.x=T,this.y=A,this.z=E,this},t.prototype.set=function(T,A,E){return this.copyFromFloats(T,A,E)},t.prototype.setAll=function(T){return this.x=this.y=this.z=T,this},t}(),Xt={Vector3:v(6,Gt.Zero),Matrix:v(2,Ht.Identity),Quaternion:v(3,jt.Zero),staticUp:Gt.Up(),tmpMatrix:Ht.Zero()},Yt=function(){function t(T){this._radians=T,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(T,A){var E=A.subtract(T);return new t(Math.atan2(E.y,E.x))},t.FromRadians=function(T){return new t(T)},t.FromDegrees=function(T){return new t(T*Math.PI/180)},t.prototype.degrees=function(){return 180*this._radians/Math.PI},t.prototype.radians=function(){return this._radians},t}(),Qt=function(){function t(T,A){void 0===T&&(T=0),void 0===A&&(A=0),this.x=T,this.y=A}return t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.Add=function(T,A){return new t(T.x,T.y).addInPlace(A)},t.FromArray=function(T,A){return void 0===A&&(A=0),new t(T[A],T[A+1])},t.FromArrayToRef=function(T,A,E){E.x=T[A],E.y=T[A+1]},t.CatmullRom=function(T,A,E,R,z){var O=z*z,V=z*O;return new t(.5*(2*A.x+(-T.x+E.x)*z+(2*T.x-5*A.x+4*E.x-R.x)*O+(-T.x+3*A.x-3*E.x+R.x)*V),.5*(2*A.y+(-T.y+E.y)*z+(2*T.y-5*A.y+4*E.y-R.y)*O+(-T.y+3*A.y-3*E.y+R.y)*V))},t.Clamp=function(T,A,E){var R=T.x;R=(R=R>E.x?E.x:R)<A.x?A.x:R;var z=T.y;return new t(R,z=(z=z>E.y?E.y:z)<A.y?A.y:z)},t.Hermite=function(T,A,E,R,z){var O=z*z,V=z*O,U=2*V-3*O+1,H=-2*V+3*O,G=V-2*O+z,X=V-O;return new t(T.x*U+E.x*H+A.x*G+R.x*X,T.y*U+E.y*H+A.y*G+R.y*X)},t.Lerp=function(T,A,E){return new t(T.x+(A.x-T.x)*E,T.y+(A.y-T.y)*E)},t.Dot=function(T,A){return T.x*A.x+T.y*A.y},t.Normalize=function(T){var A=new t(T.x,T.y);return A.normalize(),A},t.Minimize=function(T,A){return new t(T.x<A.x?T.x:A.x,T.y<A.y?T.y:A.y)},t.Maximize=function(T,A){return new t(T.x>A.x?T.x:A.x,T.y>A.y?T.y:A.y)},t.Transform=function(T,A){var E=t.Zero();return t.TransformToRef(T,A,E),E},t.TransformToRef=function(T,A,E){var R=A.m,z=T.x*R[0]+T.y*R[4]+R[12],O=T.x*R[1]+T.y*R[5]+R[13];E.x=z,E.y=O},t.PointInTriangle=function(T,A,E,R){var z=.5*(-E.y*R.x+A.y*(-E.x+R.x)+A.x*(E.y-R.y)+E.x*R.y),O=z<0?-1:1,V=(A.y*R.x-A.x*R.y+(R.y-A.y)*T.x+(A.x-R.x)*T.y)*O,U=(A.x*E.y-A.y*E.x+(A.y-E.y)*T.x+(E.x-A.x)*T.y)*O;return V>0&&U>0&&V+U<2*z*O},t.Distance=function(T,A){return Math.sqrt(t.DistanceSquared(T,A))},t.DistanceSquared=function(T,A){var E=T.x-A.x,R=T.y-A.y;return E*E+R*R},t.Center=function(T,A){var E=t.Add(T,A);return E.scaleInPlace(.5),E},t.DistanceOfPointFromSegment=function(T,A,E){var R=t.DistanceSquared(A,E);if(0===R)return t.Distance(T,A);var z=E.subtract(A),O=Math.max(0,Math.min(1,t.Dot(T.subtract(A),z)/R)),V=A.add(z.multiplyByFloats(O,O));return t.Distance(T,V)},t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){return 397*(this.x||0)^(this.y||0)},t.prototype.toArray=function(T,A){return void 0===A&&(A=0),T[A]=this.x,T[A+1]=this.y,this},t.prototype.asArray=function(){var T=new Array;return this.toArray(T,0),T},t.prototype.copyFrom=function(T){return this.x=T.x,this.y=T.y,this},t.prototype.copyFromFloats=function(T,A){return this.x=T,this.y=A,this},t.prototype.set=function(T,A){return this.copyFromFloats(T,A)},t.prototype.add=function(T){return new t(this.x+T.x,this.y+T.y)},t.prototype.addToRef=function(T,A){return A.x=this.x+T.x,A.y=this.y+T.y,this},t.prototype.addInPlace=function(T){return this.x+=T.x,this.y+=T.y,this},t.prototype.addVector3=function(T){return new t(this.x+T.x,this.y+T.y)},t.prototype.subtract=function(T){return new t(this.x-T.x,this.y-T.y)},t.prototype.subtractToRef=function(T,A){return A.x=this.x-T.x,A.y=this.y-T.y,this},t.prototype.subtractInPlace=function(T){return this.x-=T.x,this.y-=T.y,this},t.prototype.multiplyInPlace=function(T){return this.x*=T.x,this.y*=T.y,this},t.prototype.multiply=function(T){return new t(this.x*T.x,this.y*T.y)},t.prototype.multiplyToRef=function(T,A){return A.x=this.x*T.x,A.y=this.y*T.y,this},t.prototype.multiplyByFloats=function(T,A){return new t(this.x*T,this.y*A)},t.prototype.divide=function(T){return new t(this.x/T.x,this.y/T.y)},t.prototype.divideToRef=function(T,A){return A.x=this.x/T.x,A.y=this.y/T.y,this},t.prototype.divideInPlace=function(T){return this.divideToRef(T,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(T){return this.x*=T,this.y*=T,this},t.prototype.scale=function(T){var A=new t(0,0);return this.scaleToRef(T,A),A},t.prototype.scaleToRef=function(T,A){return A.x=this.x*T,A.y=this.y*T,this},t.prototype.scaleAndAddToRef=function(T,A){return A.x+=this.x*T,A.y+=this.y*T,this},t.prototype.equals=function(T){return T&&this.x===T.x&&this.y===T.y},t.prototype.equalsWithEpsilon=function(T,A){return void 0===A&&(A=qt),T&&Wt.WithinEpsilon(this.x,T.x,A)&&Wt.WithinEpsilon(this.y,T.y,A)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var T=this.length();if(0===T)return this;var A=1/T;return this.x*=A,this.y*=A,this},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),Ft=function(A,E,R){this.startPoint=A,this.midPoint=E,this.endPoint=R;var z=Math.pow(E.x,2)+Math.pow(E.y,2),O=(Math.pow(A.x,2)+Math.pow(A.y,2)-z)/2,V=(z-Math.pow(R.x,2)-Math.pow(R.y,2))/2,U=(A.x-E.x)*(E.y-R.y)-(E.x-R.x)*(A.y-E.y);this.centerPoint=new Qt((O*(E.y-R.y)-V*(A.y-E.y))/U,((A.x-E.x)*V-(E.x-R.x)*O)/U),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Yt.BetweenTwoPoints(this.centerPoint,this.startPoint);var H=this.startAngle.degrees(),G=Yt.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),X=Yt.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();G-H>180&&(G-=360),G-H<-180&&(G+=360),X-G>180&&(X-=360),X-G<-180&&(X+=360),this.orientation=G-H<0?T.Orientation.CW:T.Orientation.CCW,this.angle=Yt.FromDegrees(this.orientation===T.Orientation.CW?H-X:X-H)},Zt=function(){function t(){}return t.X=new Gt(1,0,0),t.Y=new Gt(0,1,0),t.Z=new Gt(0,0,1),t}(),Jt=function(){function t(){}return t.Interpolate=function(T,A,E,R,z){for(var O=1-3*R+3*A,V=3*R-6*A,U=3*A,H=T,G=0;G<5;G++){var X=H*H;H-=1/(3*O*X+2*V*H+U)*(O*(X*H)+V*X+U*H-T),H=Math.min(1,Math.max(0,H))}return 3*Math.pow(1-H,2)*H*E+3*(1-H)*Math.pow(H,2)*z+Math.pow(H,3)},t}(),$t=function(){function t(T,A,E,R){void 0===T&&(T=0),void 0===A&&(A=0),void 0===E&&(E=0),void 0===R&&(R=1),this.r=T,this.g=A,this.b=E,this.a=R}return t.FromHexString=function(T){if("#"!==T.substring(0,1)||9!==T.length)return new t(0,0,0,0);var A=parseInt(T.substring(1,3),16),E=parseInt(T.substring(3,5),16),R=parseInt(T.substring(5,7),16),z=parseInt(T.substring(7,9),16);return t.FromInts(A,E,R,z)},t.Lerp=function(T,A,E){var R=new t(0,0,0,0);return t.LerpToRef(T,A,E,R),R},t.LerpToRef=function(T,A,E,R){R.r=T.r+(A.r-T.r)*E,R.g=T.g+(A.g-T.g)*E,R.b=T.b+(A.b-T.b)*E,R.a=T.a+(A.a-T.a)*E},t.Red=function(){return new t(1,0,0,1)},t.Green=function(){return new t(0,1,0,1)},t.Blue=function(){return new t(0,0,1,1)},t.Black=function(){return new t(0,0,0,1)},t.White=function(){return new t(1,1,1,1)},t.Purple=function(){return new t(.5,0,.5,1)},t.Magenta=function(){return new t(1,0,1,1)},t.Yellow=function(){return new t(1,1,0,1)},t.Gray=function(){return new t(.5,.5,.5,1)},t.Teal=function(){return new t(0,1,1,1)},t.Clear=function(){return new t(0,0,0,0)},t.FromColor3=function(T,A){return void 0===A&&(A=1),new t(T.r,T.g,T.b,A)},t.FromArray=function(T,A){return void 0===A&&(A=0),new t(T[A],T[A+1],T[A+2],T[A+3])},t.FromInts=function(T,A,E,R){return new t(T/255,A/255,E/255,R/255)},t.CheckColors4=function(T,A){if(T.length===3*A){for(var E=[],R=0;R<T.length;R+=3){var z=R/3*4;E[z]=T[R],E[z+1]=T[R+1],E[z+2]=T[R+2],E[z+3]=1}return E}return T},t.prototype.addInPlace=function(T){return this.r+=T.r,this.g+=T.g,this.b+=T.b,this.a+=T.a,this},t.prototype.asArray=function(){var T=new Array;return this.toArray(T,0),T},t.prototype.toArray=function(T,A){return void 0===A&&(A=0),T[A]=this.r,T[A+1]=this.g,T[A+2]=this.b,T[A+3]=this.a,this},t.prototype.add=function(T){return new t(this.r+T.r,this.g+T.g,this.b+T.b,this.a+T.a)},t.prototype.subtract=function(T){return new t(this.r-T.r,this.g-T.g,this.b-T.b,this.a-T.a)},t.prototype.subtractToRef=function(T,A){return A.r=this.r-T.r,A.g=this.g-T.g,A.b=this.b-T.b,A.a=this.a-T.a,this},t.prototype.scale=function(T){return new t(this.r*T,this.g*T,this.b*T,this.a*T)},t.prototype.scaleToRef=function(T,A){return A.r=this.r*T,A.g=this.g*T,A.b=this.b*T,A.a=this.a*T,this},t.prototype.scaleAndAddToRef=function(T,A){return A.r+=this.r*T,A.g+=this.g*T,A.b+=this.b*T,A.a+=this.a*T,this},t.prototype.clampToRef=function(T,A,E){return void 0===T&&(T=0),void 0===A&&(A=1),E.r=Wt.Clamp(this.r,T,A),E.g=Wt.Clamp(this.g,T,A),E.b=Wt.Clamp(this.b,T,A),E.a=Wt.Clamp(this.a,T,A),this},t.prototype.multiply=function(T){return new t(this.r*T.r,this.g*T.g,this.b*T.b,this.a*T.a)},t.prototype.multiplyToRef=function(T,A){return A.r=this.r*T.r,A.g=this.g*T.g,A.b=this.b*T.b,A.a=this.a*T.a,A},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var T=this.r||0;return 397*(T=397*(T=397*T^(this.g||0))^(this.b||0))^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(T){return this.r=T.r,this.g=T.g,this.b=T.b,this.a=T.a,this},t.prototype.copyFromFloats=function(T,A,E,R){return this.r=T,this.g=A,this.b=E,this.a=R,this},t.prototype.set=function(T,A,E,R){return this.copyFromFloats(T,A,E,R)},t.prototype.toHexString=function(){var T=255*this.r|0,A=255*this.g|0,E=255*this.b|0,R=255*this.a|0;return"#"+Wt.ToHex(T)+Wt.ToHex(A)+Wt.ToHex(E)+Wt.ToHex(R)},t.prototype.toLinearSpace=function(){var T=new t;return this.toLinearSpaceToRef(T),T},t.prototype.toLinearSpaceToRef=function(T){return T.r=Math.pow(this.r,kt),T.g=Math.pow(this.g,kt),T.b=Math.pow(this.b,kt),T.a=this.a,this},t.prototype.toGammaSpace=function(){var T=new t;return this.toGammaSpaceToRef(T),T},t.prototype.toGammaSpaceToRef=function(T){return T.r=Math.pow(this.r,Nt),T.g=Math.pow(this.g,Nt),T.b=Math.pow(this.b,Nt),T.a=this.a,this},t}(),ee=function(){function t(T,A,E){void 0===T&&(T=0),void 0===A&&(A=0),void 0===E&&(E=0),this.r=T,this.g=A,this.b=E}return t.FromHexString=function(T){if("#"!==T.substring(0,1)||7!==T.length)return new t(0,0,0);var A=parseInt(T.substring(1,3),16),E=parseInt(T.substring(3,5),16),R=parseInt(T.substring(5,7),16);return t.FromInts(A,E,R)},t.FromArray=function(T,A){return void 0===A&&(A=0),new t(T[A],T[A+1],T[A+2])},t.FromInts=function(T,A,E){return new t(T/255,A/255,E/255)},t.Lerp=function(T,A,E){var R=new t(0,0,0);return t.LerpToRef(T,A,E,R),R},t.LerpToRef=function(T,A,E,R){R.r=T.r+(A.r-T.r)*E,R.g=T.g+(A.g-T.g)*E,R.b=T.b+(A.b-T.b)*E},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var T=this.r||0;return 397*(T=397*T^(this.g||0))^(this.b||0)},t.prototype.toArray=function(T,A){return void 0===A&&(A=0),T[A]=this.r,T[A+1]=this.g,T[A+2]=this.b,this},t.prototype.toColor4=function(T){return void 0===T&&(T=1),new $t(this.r,this.g,this.b,T)},t.prototype.asArray=function(){var T=new Array;return this.toArray(T,0),T},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(T){return new t(this.r*T.r,this.g*T.g,this.b*T.b)},t.prototype.multiplyToRef=function(T,A){return A.r=this.r*T.r,A.g=this.g*T.g,A.b=this.b*T.b,this},t.prototype.equals=function(T){return T&&this.r===T.r&&this.g===T.g&&this.b===T.b},t.prototype.equalsFloats=function(T,A,E){return this.r===T&&this.g===A&&this.b===E},t.prototype.scale=function(T){return new t(this.r*T,this.g*T,this.b*T)},t.prototype.scaleToRef=function(T,A){return A.r=this.r*T,A.g=this.g*T,A.b=this.b*T,this},t.prototype.scaleAndAddToRef=function(T,A){return A.r+=this.r*T,A.g+=this.g*T,A.b+=this.b*T,this},t.prototype.clampToRef=function(T,A,E){return void 0===T&&(T=0),void 0===A&&(A=1),E.r=Wt.Clamp(this.r,T,A),E.g=Wt.Clamp(this.g,T,A),E.b=Wt.Clamp(this.b,T,A),this},t.prototype.add=function(T){return new t(this.r+T.r,this.g+T.g,this.b+T.b)},t.prototype.addToRef=function(T,A){return A.r=this.r+T.r,A.g=this.g+T.g,A.b=this.b+T.b,this},t.prototype.subtract=function(T){return new t(this.r-T.r,this.g-T.g,this.b-T.b)},t.prototype.subtractToRef=function(T,A){return A.r=this.r-T.r,A.g=this.g-T.g,A.b=this.b-T.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(T){return this.r=T.r,this.g=T.g,this.b=T.b,this},t.prototype.copyFromFloats=function(T,A,E){return this.r=T,this.g=A,this.b=E,this},t.prototype.set=function(T,A,E){return this.copyFromFloats(T,A,E)},t.prototype.toHexString=function(){var T=255*this.r|0,A=255*this.g|0,E=255*this.b|0;return"#"+Wt.ToHex(T)+Wt.ToHex(A)+Wt.ToHex(E)},t.prototype.toLinearSpace=function(){var T=new t;return this.toLinearSpaceToRef(T),T},t.prototype.toLinearSpaceToRef=function(T){return T.r=Math.pow(this.r,kt),T.g=Math.pow(this.g,kt),T.b=Math.pow(this.b,kt),this},t.prototype.toGammaSpace=function(){var T=new t;return this.toGammaSpaceToRef(T),T},t.prototype.toGammaSpaceToRef=function(T){return T.r=Math.pow(this.r,Nt),T.g=Math.pow(this.g,Nt),T.b=Math.pow(this.b,Nt),this},t.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b}},t}(),ne=function(){function t(T){this._length=0,this._points=T,this._length=this._computeLength(T)}return t.CreateQuadraticBezier=function(T,A,E,R){R=R>2?R:3;for(var z=new Array,s=function(T,A,E,R){return(1-T)*(1-T)*A+2*T*(1-T)*E+T*T*R},O=0;O<=R;O++)z.push(new Gt(s(O/R,T.x,A.x,E.x),s(O/R,T.y,A.y,E.y),s(O/R,T.z,A.z,E.z)));return new t(z)},t.CreateCubicBezier=function(T,A,E,R,z){z=z>3?z:4;for(var O=new Array,a=function(T,A,E,R,z){return(1-T)*(1-T)*(1-T)*A+3*T*(1-T)*(1-T)*E+3*T*T*(1-T)*R+T*T*T*z},V=0;V<=z;V++)O.push(new Gt(a(V/z,T.x,A.x,E.x,R.x),a(V/z,T.y,A.y,E.y,R.y),a(V/z,T.z,A.z,E.z,R.z)));return new t(O)},t.CreateHermiteSpline=function(T,A,E,R,z){for(var O=new Array,V=1/z,U=0;U<=z;U++)O.push(Gt.Hermite(T,A,E,R,U*V));return new t(O)},t.CreateCatmullRomSpline=function(T,A,E){var R=new Array,z=1/A,O=0;if(E){for(var V=T.length,U=0;U<V;U++){O=0;for(var H=0;H<A;H++)R.push(Gt.CatmullRom(T[U%V],T[(U+1)%V],T[(U+2)%V],T[(U+3)%V],O)),O+=z}R.push(R[0])}else{var G=new Array;for(G.push(T[0].clone()),Array.prototype.push.apply(G,T),G.push(T[T.length-1].clone()),U=0,U=0;U<G.length-3;U++)for(O=0,H=0;H<A;H++)R.push(Gt.CatmullRom(G[U],G[U+1],G[U+2],G[U+3],O)),O+=z;U--,R.push(Gt.CatmullRom(G[U],G[U+1],G[U+2],G[U+3],O))}return new t(R)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype.continue=function(T){for(var A=this._points[this._points.length-1],E=this._points.slice(),R=T.getPoints(),z=1;z<R.length;z++)E.push(R[z].subtract(R[0]).add(A));return new t(E)},t.prototype._computeLength=function(T){for(var A=0,E=1;E<T.length;E++)A+=T[E].subtract(T[E-1]).length();return A},t}(),oe=function(){function t(T,A,E,R){this.normal=new Gt(T,A,E),this.d=R}return t.FromArray=function(T){return new t(T[0],T[1],T[2],T[3])},t.FromPoints=function(T,A,E){var R=new t(0,0,0,0);return R.copyFromPoints(T,A,E),R},t.FromPositionAndNormal=function(T,A){var E=new t(0,0,0,0);return A.normalize(),E.normal=A,E.d=-(A.x*T.x+A.y*T.y+A.z*T.z),E},t.SignedDistanceToPlaneFromPositionAndNormal=function(T,A,E){var R=-(A.x*T.x+A.y*T.y+A.z*T.z);return Gt.Dot(E,A)+R},t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){return 397*this.normal.getHashCode()^(this.d||0)},t.prototype.normalize=function(){var T=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),A=0;return 0!==T&&(A=1/T),this.normal.x*=A,this.normal.y*=A,this.normal.z*=A,this.d*=A,this},t.prototype.transform=function(T){var A=Xt.Matrix[0];Ht.TransposeToRef(T,A);var E=A.m,R=this.normal.x,z=this.normal.y,O=this.normal.z,V=this.d;return new t(R*E[0]+z*E[1]+O*E[2]+V*E[3],R*E[4]+z*E[5]+O*E[6]+V*E[7],R*E[8]+z*E[9]+O*E[10]+V*E[11],R*E[12]+z*E[13]+O*E[14]+V*E[15])},t.prototype.dotCoordinate=function(T){return this.normal.x*T.x+this.normal.y*T.y+this.normal.z*T.z+this.d},t.prototype.copyFromPoints=function(T,A,E){var R,z=A.x-T.x,O=A.y-T.y,V=A.z-T.z,U=E.x-T.x,H=E.y-T.y,G=E.z-T.z,X=O*G-V*H,Q=V*U-z*G,Z=z*H-O*U,K=Math.sqrt(X*X+Q*Q+Z*Z);return R=0!==K?1/K:0,this.normal.x=X*R,this.normal.y=Q*R,this.normal.z=Z*R,this.d=-(this.normal.x*T.x+this.normal.y*T.y+this.normal.z*T.z),this},t.prototype.isFrontFacingTo=function(T,A){return Gt.Dot(this.normal,T)<=A},t.prototype.signedDistanceTo=function(T){return Gt.Dot(T,this.normal)+this.d},t}(),ie=function(){function t(){}return t.GetPlanes=function(T){for(var A=[],E=0;E<6;E++)A.push(new oe(0,0,0,0));return t.GetPlanesToRef(T,A),A},t.GetNearPlaneToRef=function(T,A){var E=T.m;A.normal.x=E[3]+E[2],A.normal.y=E[7]+E[6],A.normal.z=E[11]+E[10],A.d=E[15]+E[14],A.normalize()},t.GetFarPlaneToRef=function(T,A){var E=T.m;A.normal.x=E[3]-E[2],A.normal.y=E[7]-E[6],A.normal.z=E[11]-E[10],A.d=E[15]-E[14],A.normalize()},t.GetLeftPlaneToRef=function(T,A){var E=T.m;A.normal.x=E[3]+E[0],A.normal.y=E[7]+E[4],A.normal.z=E[11]+E[8],A.d=E[15]+E[12],A.normalize()},t.GetRightPlaneToRef=function(T,A){var E=T.m;A.normal.x=E[3]-E[0],A.normal.y=E[7]-E[4],A.normal.z=E[11]-E[8],A.d=E[15]-E[12],A.normalize()},t.GetTopPlaneToRef=function(T,A){var E=T.m;A.normal.x=E[3]-E[1],A.normal.y=E[7]-E[5],A.normal.z=E[11]-E[9],A.d=E[15]-E[13],A.normalize()},t.GetBottomPlaneToRef=function(T,A){var E=T.m;A.normal.x=E[3]+E[1],A.normal.y=E[7]+E[5],A.normal.z=E[11]+E[9],A.d=E[15]+E[13],A.normalize()},t.GetPlanesToRef=function(T,A){t.GetNearPlaneToRef(T,A[0]),t.GetFarPlaneToRef(T,A[1]),t.GetLeftPlaneToRef(T,A[2]),t.GetRightPlaneToRef(T,A[3]),t.GetTopPlaneToRef(T,A[4]),t.GetBottomPlaneToRef(T,A[5])},t}(),re=function(){function e(T,A){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Qt(T,A))}return e.StartingAt=function(T,A){return new e(T,A)},e.prototype.addLineTo=function(T,A){if(this.closed)return this;var E=new Qt(T,A),R=this._points[this._points.length-1];return this._points.push(E),this._length+=E.subtract(R).length(),this},e.prototype.addArcTo=function(A,E,R,z,O){if(void 0===O&&(O=36),this.closed)return this;var V=this._points[this._points.length-1],U=new Qt(A,E),H=new Qt(R,z),G=new Ft(V,U,H),X=G.angle.radians()/O;G.orientation===T.Orientation.CW&&(X*=-1);for(var Q=G.startAngle.radians()+X,Z=0;Z<O;Z++){var K=Math.cos(Q)*G.radius+G.centerPoint.x,J=Math.sin(Q)*G.radius+G.centerPoint.y;this.addLineTo(K,J),Q+=X}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var T=this._length;if(!this.closed){var A=this._points[this._points.length-1];T+=this._points[0].subtract(A).length()}return T},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(T){if(T<0||T>1)return Qt.Zero();for(var A=T*this.length(),E=0,R=0;R<this._points.length;R++){var z=(R+1)%this._points.length,O=this._points[R],V=this._points[z].subtract(O),U=V.length()+E;if(A>=E&&A<=U){var H=V.normalize(),G=A-E;return new Qt(O.x+H.x*G,O.y+H.y*G)}E=U}return Qt.Zero()},e}(),se=function(){function t(T,A,E){void 0===A&&(A=null),this.path=T,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var R=0;R<T.length;R++)this._curve[R]=T[R].clone();this._raw=E||!1,this._compute(A)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(T,A){void 0===A&&(A=null);for(var E=0;E<T.length;E++)this._curve[E].x=T[E].x,this._curve[E].y=T[E].y,this._curve[E].z=T[E].z;return this._compute(A),this},t.prototype._compute=function(T){var A=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[A-1]=this._curve[A-1].subtract(this._curve[A-2]),this._raw||this._tangents[A-1].normalize();var E,R,z,O,V=this._tangents[0],U=this._normalVector(this._curve[0],V,T);this._normals[0]=U,this._raw||this._normals[0].normalize(),this._binormals[0]=Gt.Cross(V,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var H=1;H<A;H++)E=this._getLastNonNullVector(H),H<A-1&&(R=this._getFirstNonNullVector(H),this._tangents[H]=E.add(R),this._tangents[H].normalize()),this._distances[H]=this._distances[H-1]+E.length(),z=this._tangents[H],O=this._binormals[H-1],this._normals[H]=Gt.Cross(O,z),this._raw||this._normals[H].normalize(),this._binormals[H]=Gt.Cross(z,this._normals[H]),this._raw||this._binormals[H].normalize()},t.prototype._getFirstNonNullVector=function(T){for(var A=1,E=this._curve[T+A].subtract(this._curve[T]);0===E.length()&&T+A+1<this._curve.length;)A++,E=this._curve[T+A].subtract(this._curve[T]);return E},t.prototype._getLastNonNullVector=function(T){for(var A=1,E=this._curve[T].subtract(this._curve[T-A]);0===E.length()&&T>A+1;)A++,E=this._curve[T].subtract(this._curve[T-A]);return E},t.prototype._normalVector=function(T,A,E){var R,z,O=A.length();(0===O&&(O=1),null==E)?(z=Wt.WithinEpsilon(Math.abs(A.y)/O,1,qt)?Wt.WithinEpsilon(Math.abs(A.x)/O,1,qt)?Wt.WithinEpsilon(Math.abs(A.z)/O,1,qt)?Gt.Zero():new Gt(0,0,1):new Gt(1,0,0):new Gt(0,-1,0),R=Gt.Cross(A,z)):(R=Gt.Cross(A,E),Gt.CrossToRef(R,A,R));return R.normalize(),R},t}(),ae=function(){function t(T,A){this.width=T,this.height=A}return Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),t.Zero=function(){return new t(0,0)},t.Lerp=function(T,A,E){return new t(T.width+(A.width-T.width)*E,T.height+(A.height-T.height)*E)},t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){return 397*(this.width||0)^(this.height||0)},t.prototype.copyFrom=function(T){this.width=T.width,this.height=T.height},t.prototype.copyFromFloats=function(T,A){return this.width=T,this.height=A,this},t.prototype.set=function(T,A){return this.copyFromFloats(T,A)},t.prototype.multiplyByFloats=function(T,A){return new t(this.width*T,this.height*A)},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(T){return!!T&&this.width===T.width&&this.height===T.height},t.prototype.add=function(T){return new t(this.width+T.width,this.height+T.height)},t.prototype.subtract=function(T){return new t(this.width-T.width,this.height-T.height)},t}(),le={looping:!0,speed:1,weight:1,layer:0},ue=function(T){function e(A,E){void 0===E&&(E=le);var R=T.call(this)||this;return R.isAnimationClip=!0,R.looping=le.looping,R.weight=le.weight,R.playing=!1,R.shouldReset=!1,R.speed=le.speed,R.name=f("AnimClip"),R.layer=le.layer,R.clip=A,R.setParams(i({},E)),R}return o(e,T),e.prototype.setParams=function(T){return this.looping=void 0!==T.looping?T.looping:this.looping,this.speed=T.speed||this.speed,this.weight=T.weight||this.weight,this.layer=T.layer||this.layer,this},e.prototype.toJSON=function(){var A=JSON.parse(JSON.stringify(T.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),A},e.prototype.play=function(T){var A;void 0===T&&(T=!1),null===(A=this.owner)||void 0===A||A.play(this,T)},e.prototype.pause=function(){var T;null===(T=this.owner)||void 0===T||T.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var T;null===(T=this.owner)||void 0===T||T.stop(this)},r([et.readonly],e.prototype,"clip",void 0),r([et.field],e.prototype,"looping",void 0),r([et.field],e.prototype,"weight",void 0),r([et.field],e.prototype,"playing",void 0),r([et.field],e.prototype,"shouldReset",void 0),r([et.field],e.prototype,"speed",void 0),r([et.readonly],e.prototype,"name",void 0),e}(et);T.InputEventType=void 0,(Bt=T.InputEventType||(T.InputEventType={}))[Bt.DOWN=0]="DOWN",Bt[Bt.UP=1]="UP",T.CameraMode=void 0,(Ot=T.CameraMode||(T.CameraMode={}))[Ot.FirstPerson=0]="FirstPerson",Ot[Ot.ThirdPerson=1]="ThirdPerson",Ot[Ot.BuildingToolGodMode=2]="BuildingToolGodMode",T.LandRole=void 0,(Lt=T.LandRole||(T.LandRole={})).OWNER="owner",Lt.OPERATOR="operator",T.ActionButton=void 0,(Mt=T.ActionButton||(T.ActionButton={})).POINTER="POINTER",Mt.PRIMARY="PRIMARY",Mt.SECONDARY="SECONDARY",Mt.ANY="ANY",Mt.FORWARD="FORWARD",Mt.BACKWARD="BACKWARD",Mt.RIGHT="RIGHT",Mt.LEFT="LEFT",Mt.JUMP="JUMP",Mt.WALK="WALK",Mt.ACTION_3="ACTION_3",Mt.ACTION_4="ACTION_4",Mt.ACTION_5="ACTION_5",Mt.ACTION_6="ACTION_6";var ce,he,Kt=function(T){if(this.callback=T,!T||!("apply"in T)||!("call"in T))throw new Error("Callback is not a function");fe.ensureInstance()},pe=function(T){function e(){return null!==T&&T.apply(this,arguments)||this}return o(e,T),r([M("pointerDown")],e)}(Kt),de=function(T){function e(){return null!==T&&T.apply(this,arguments)||this}return o(e,T),r([M("pointerUp")],e)}(Kt),te=function(T,A){this.fn=T,this.useRaycast=A},fe=function(){function e(){this.buttonIdMapping=[T.ActionButton.POINTER,T.ActionButton.PRIMARY,T.ActionButton.SECONDARY,T.ActionButton.ANY,T.ActionButton.FORWARD,T.ActionButton.BACKWARD,T.ActionButton.RIGHT,T.ActionButton.LEFT,T.ActionButton.JUMP,T.ActionButton.WALK,T.ActionButton.ACTION_3,T.ActionButton.ACTION_4,T.ActionButton.ACTION_5,T.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(T,A){var E;return i(i({},T),((E={})[A]={BUTTON_DOWN:[],BUTTON_UP:[]},E))}),{}),this.internalState=this.buttonIdMapping.reduce((function(T,A){var E;return i(i({},T),((E={})[A]={BUTTON_DOWN:!1},E))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(T){return this.internalState[T]},e.prototype.subscribe=function(T,A,E,R){var z=this;return this.subscriptions[A][T].push(new te(R,E)),function(){z.unsubscribe(T,A,R)}},e.prototype.unsubscribe=function(T,A,E){var R=this.getSubscriptionId(T,A,E);return R>-1&&this.subscriptions[A][T].splice(R,1)},e.prototype.handlePointerEvent=function(A){var E=this.getPointerById(A.buttonId);if(E){var R=i(i({},A),{button:E,direction:(new Gt).copyFrom(A.direction),origin:(new Gt).copyFrom(A.origin),hit:void 0}),z=A.hit?i(i({},A.hit),{hitPoint:(new Gt).copyFrom(A.hit.hitPoint),normal:(new Gt).copyFrom(A.hit.normal),worldNormal:(new Gt).copyFrom(A.hit.worldNormal)}):void 0;if(A.type===T.InputEventType.DOWN){this.internalState[E].BUTTON_DOWN=!0;for(var O=0;O<this.subscriptions[E].BUTTON_DOWN.length;O++)(V=this.subscriptions[E].BUTTON_DOWN[O]).useRaycast?R.hit=z:R.hit=void 0,V.fn(R);z&&z.entityId&&F.engine&&(H=(U=F.engine.entities[z.entityId])&&U.getComponentOrNull(pe))&&(R.hit=z,H.callback(R))}else{for(this.internalState[E].BUTTON_DOWN=!1,O=0;O<this.subscriptions[E].BUTTON_UP.length;O++){var V;(V=this.subscriptions[E].BUTTON_UP[O]).useRaycast?R.hit=z:R.hit=void 0,V.fn(R)}var U,H;z&&z.entityId&&F.engine&&(H=(U=F.engine.entities[z.entityId])&&U.getComponentOrNull(de))&&(R.hit=z,H.callback(R))}}},e.prototype.getSubscriptionId=function(T,A,E){for(var R=0;R<this.subscriptions[A][T].length;R++)if(this.subscriptions[A][T][R].fn===E)return R;return-1},e.prototype.getPointerById=function(A){if(A<0||A>=this.buttonIdMapping.length)return null;var E=this.buttonIdMapping[A];return E===T.ActionButton.ANY?null:E},e}();T.CLASS_ID=void 0,(ce=T.CLASS_ID||(T.CLASS_ID={}))[ce.TRANSFORM=1]="TRANSFORM",ce[ce.UUID_CALLBACK=8]="UUID_CALLBACK",ce[ce.BOX_SHAPE=16]="BOX_SHAPE",ce[ce.SPHERE_SHAPE=17]="SPHERE_SHAPE",ce[ce.PLANE_SHAPE=18]="PLANE_SHAPE",ce[ce.CONE_SHAPE=19]="CONE_SHAPE",ce[ce.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",ce[ce.TEXT_SHAPE=21]="TEXT_SHAPE",ce[ce.NFT_SHAPE=22]="NFT_SHAPE",ce[ce.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",ce[ce.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",ce[ce.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",ce[ce.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",ce[ce.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",ce[ce.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",ce[ce.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",ce[ce.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",ce[ce.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",ce[ce.BILLBOARD=32]="BILLBOARD",ce[ce.ANIMATION=33]="ANIMATION",ce[ce.FONT=34]="FONT",ce[ce.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",ce[ce.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",ce[ce.GLTF_SHAPE=54]="GLTF_SHAPE",ce[ce.OBJ_SHAPE=55]="OBJ_SHAPE",ce[ce.AVATAR_SHAPE=56]="AVATAR_SHAPE",ce[ce.BASIC_MATERIAL=64]="BASIC_MATERIAL",ce[ce.PBR_MATERIAL=65]="PBR_MATERIAL",ce[ce.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",ce[ce.SOUND=67]="SOUND",ce[ce.TEXTURE=68]="TEXTURE",ce[ce.VIDEO_CLIP=70]="VIDEO_CLIP",ce[ce.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",ce[ce.AUDIO_CLIP=200]="AUDIO_CLIP",ce[ce.AUDIO_SOURCE=201]="AUDIO_SOURCE",ce[ce.AUDIO_STREAM=202]="AUDIO_STREAM",ce[ce.GIZMOS=203]="GIZMOS",ce[ce.SMART_ITEM=204]="SMART_ITEM",ce[ce.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",ce[ce.NAME=300]="NAME",ce[ce.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",ce[ce.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",T.AvatarModifiers=void 0,(he=T.AvatarModifiers||(T.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",he.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var ye,ve=function(A){function n(T){var E=A.call(this)||this;return E.area=T.area,E.modifiers=T.modifiers,E}return o(n,A),r([et.field],n.prototype,"area",void 0),r([et.field],n.prototype,"modifiers",void 0),r([M("engine.avatarModifierArea",T.CLASS_ID.AVATAR_MODIFIER_AREA)],n)}(et),me=function(A){function n(T){void 0===T&&(T={});var E=A.call(this)||this;return E.position=T.position||Gt.Zero(),E.rotation=T.rotation||jt.Identity,E.scale=T.scale||new Gt(1,1,1),E}return o(n,A),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(T,A){void 0===A&&(A=Xt.staticUp);var E=new Ht;return Ht.LookAtLHToRef(this.position,T,A,E),E.invert(),jt.FromRotationMatrixToRef(E,this.rotation),this},n.prototype.rotate=function(T,A){return this.rotation.multiplyInPlace(this.rotation.angleAxis(A,T)),this},n.prototype.translate=function(T){return this.position.addInPlace(T),this},r([et.field],n.prototype,"position",void 0),r([et.field],n.prototype,"rotation",void 0),r([et.field],n.prototype,"scale",void 0),r([M("engine.transform",T.CLASS_ID.TRANSFORM)],n)}(et),ge=function(A){function n(T,E,R){void 0===T&&(T=!0),void 0===E&&(E=!0),void 0===R&&(R=!0);var z=A.call(this)||this;return z.x=!0,z.y=!0,z.z=!0,z.x=T,z.y=E,z.z=R,z}return o(n,A),r([et.field],n.prototype,"x",void 0),r([et.field],n.prototype,"y",void 0),r([et.field],n.prototype,"z",void 0),r([M("engine.billboard",T.CLASS_ID.BILLBOARD)],n)}(et),we=function(T){function e(){var A=null!==T&&T.apply(this,arguments)||this;return A.withCollisions=!0,A.isPointerBlocker=!0,A.visible=!0,A}return o(e,T),r([et.field],e.prototype,"withCollisions",void 0),r([et.field],e.prototype,"isPointerBlocker",void 0),r([et.field],e.prototype,"visible",void 0),e}(et),be=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return o(n,A),r([et.field],n.prototype,"uvs",void 0),r([F("engine.shape",T.CLASS_ID.BOX_SHAPE)],n)}(we),xe=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return o(n,A),r([F("engine.shape",T.CLASS_ID.SPHERE_SHAPE)],n)}(we),Te=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return o(n,A),r([et.field],n.prototype,"segments",void 0),r([et.field],n.prototype,"arc",void 0),r([F("engine.shape",T.CLASS_ID.CIRCLE_SHAPE)],n)}(we),Ae=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.width=1,T.height=1,T}return o(n,A),r([et.field],n.prototype,"width",void 0),r([et.field],n.prototype,"height",void 0),r([et.field],n.prototype,"uvs",void 0),r([F("engine.shape",T.CLASS_ID.PLANE_SHAPE)],n)}(we),Se=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.radiusTop=0,T.radiusBottom=1,T.segmentsHeight=1,T.segmentsRadial=36,T.openEnded=!1,T.radius=null,T.arc=360,T}return o(n,A),r([et.field],n.prototype,"radiusTop",void 0),r([et.field],n.prototype,"radiusBottom",void 0),r([et.field],n.prototype,"segmentsHeight",void 0),r([et.field],n.prototype,"segmentsRadial",void 0),r([et.field],n.prototype,"openEnded",void 0),r([et.field],n.prototype,"radius",void 0),r([et.field],n.prototype,"arc",void 0),r([F("engine.shape",T.CLASS_ID.CONE_SHAPE)],n)}(we),Ee=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.radiusTop=1,T.radiusBottom=1,T.segmentsHeight=1,T.segmentsRadial=36,T.openEnded=!1,T.radius=null,T.arc=360,T}return o(n,A),r([et.field],n.prototype,"radiusTop",void 0),r([et.field],n.prototype,"radiusBottom",void 0),r([et.field],n.prototype,"segmentsHeight",void 0),r([et.field],n.prototype,"segmentsRadial",void 0),r([et.field],n.prototype,"openEnded",void 0),r([et.field],n.prototype,"radius",void 0),r([et.field],n.prototype,"arc",void 0),r([F("engine.shape",T.CLASS_ID.CYLINDER_SHAPE)],n)}(we),Ce=function(A){function n(T){var E=A.call(this)||this;return E.src=T,E}return o(n,A),r([we.readonly],n.prototype,"src",void 0),r([F("engine.shape",T.CLASS_ID.GLTF_SHAPE)],n)}(we);T.PictureFrameStyle=void 0,(ye=T.PictureFrameStyle||(T.PictureFrameStyle={}))[ye.Classic=0]="Classic",ye[ye.Baroque_Ornament=1]="Baroque_Ornament",ye[ye.Diamond_Ornament=2]="Diamond_Ornament",ye[ye.Minimal_Wide=3]="Minimal_Wide",ye[ye.Minimal_Grey=4]="Minimal_Grey",ye[ye.Blocky=5]="Blocky",ye[ye.Gold_Edges=6]="Gold_Edges",ye[ye.Gold_Carved=7]="Gold_Carved",ye[ye.Gold_Wide=8]="Gold_Wide",ye[ye.Gold_Rounded=9]="Gold_Rounded",ye[ye.Metal_Medium=10]="Metal_Medium",ye[ye.Metal_Wide=11]="Metal_Wide",ye[ye.Metal_Slim=12]="Metal_Slim",ye[ye.Metal_Rounded=13]="Metal_Rounded",ye[ye.Pins=14]="Pins",ye[ye.Minimal_Black=15]="Minimal_Black",ye[ye.Minimal_White=16]="Minimal_White",ye[ye.Tape=17]="Tape",ye[ye.Wood_Slim=18]="Wood_Slim",ye[ye.Wood_Wide=19]="Wood_Wide",ye[ye.Wood_Twigs=20]="Wood_Twigs",ye[ye.Canvas=21]="Canvas",ye[ye.None=22]="None";var Ie,Re=function(A){function n(E,R){void 0===R&&(R={});var z=A.call(this)||this;z.src=E;var O=new ee(.6404918,.611472,.8584906),V=T.PictureFrameStyle.Classic;return"r"in R?O=R:null!=R&&(R.color&&(O=R.color),R.style&&(V=R.style)),z.color=O,z.style=V,z}return o(n,A),r([we.readonly],n.prototype,"src",void 0),r([we.readonly],n.prototype,"style",void 0),r([et.field],n.prototype,"color",void 0),r([F("engine.shape",T.CLASS_ID.NFT_SHAPE)],n)}(we),_e=function(A){function n(T,E){var R=A.call(this)||this;if(R.src=T,E)for(var z in E)R[z]=E[z];return R}return o(n,A),r([et.readonly],n.prototype,"src",void 0),r([et.readonly],n.prototype,"samplingMode",void 0),r([et.readonly],n.prototype,"wrap",void 0),r([et.readonly],n.prototype,"hasAlpha",void 0),r([F("engine.texture",T.CLASS_ID.TEXTURE)],n)}(et),Pe=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.states=[],T}return o(n,A),n.prototype.addClip=function(T){var A=this;return this.states.push(T),T.onChange((function(){A.dirty=!0})),T.owner=this,this},n.prototype.getClip=function(T){for(var A=0;A<this.states.length;A++){var E=this.states[A];if(E.clip===T)return E}var R=new ue(T);return this.addClip(R),R},n.prototype.stop=function(T){if(T)T.playing=!1,T.shouldReset=!0;else for(var A=0;A<this.states.length;A++){var E=this.states[A];this.stop(E)}},n.prototype.play=function(T,A){void 0===A&&(A=!1);for(var E=0;E<this.states.length;E++){var R=this.states[E];R.layer===T.layer&&T!==R&&this.pause(R)}A&&(T.shouldReset=!0),T.playing=!0,T.dirty=!0,T.data.nonce=Math.random()},n.prototype.pause=function(T){if(T)T.playing=!1;else for(var A=0;A<this.states.length;A++){var E=this.states[A];this.pause(E)}},r([et.readonly],n.prototype,"states",void 0),r([M("engine.animator",T.CLASS_ID.ANIMATION)],n)}(we),ze=function(A){function n(T){var E=A.call(this)||this;return E.src=T,E}return o(n,A),r([et.readonly],n.prototype,"src",void 0),r([F("engine.shape",T.CLASS_ID.OBJ_SHAPE)],n)}(we),Be=function(A){function n(T){void 0===T&&(T="");var E=A.call(this)||this;return E.src=T,E}return o(n,A),r([et.readonly],n.prototype,"src",void 0),r([F("engine.font",T.CLASS_ID.FONT)],n)}(et);T.Fonts=void 0,(Ie=T.Fonts||(T.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",Ie.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",Ie.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",Ie.LiberationSans="builtin:LiberationSans SDF",Ie.SansSerif="SansSerif",Ie.SansSerif_Heavy="SansSerif_Heavy",Ie.SansSerif_Bold="SansSerif_Bold",Ie.SansSerif_SemiBold="SansSerif_SemiBold";var Fe,Oe=function(A){function n(T){var E=A.call(this)||this;return E.outlineWidth=0,E.outlineColor=new ee(1,1,1),E.color=new ee(1,1,1),E.fontSize=10,E.opacity=1,E.value="",E.lineSpacing="0px",E.lineCount=0,E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=new ee(1,1,1),E.hTextAlign="center",E.vTextAlign="center",E.width=1,E.height=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.billboard=!1,E.visible=!0,T&&(E.value=T),E}return o(n,A),r([et.field],n.prototype,"outlineWidth",void 0),r([et.field],n.prototype,"outlineColor",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"fontSize",void 0),r([et.component],n.prototype,"font",void 0),r([et.field],n.prototype,"opacity",void 0),r([et.field],n.prototype,"value",void 0),r([et.field],n.prototype,"lineSpacing",void 0),r([et.field],n.prototype,"lineCount",void 0),r([et.field],n.prototype,"textWrapping",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"hTextAlign",void 0),r([et.field],n.prototype,"vTextAlign",void 0),r([et.field],n.prototype,"width",void 0),r([et.field],n.prototype,"height",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([et.field],n.prototype,"billboard",void 0),r([et.field],n.prototype,"visible",void 0),r([M("engine.text",T.CLASS_ID.TEXT_SHAPE)],n)}(et);T.TransparencyMode=void 0,(Fe=T.TransparencyMode||(T.TransparencyMode={}))[Fe.OPAQUE=0]="OPAQUE",Fe[Fe.ALPHA_TEST=1]="ALPHA_TEST",Fe[Fe.ALPHA_BLEND=2]="ALPHA_BLEND",Fe[Fe.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Fe[Fe.AUTO=4]="AUTO";var Le,Me=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.alphaTest=.5,E.castShadows=!0,E.transparencyMode=T.TransparencyMode.AUTO,E}return o(n,A),r([et.field],n.prototype,"alphaTest",void 0),r([et.field],n.prototype,"albedoColor",void 0),r([et.field],n.prototype,"emissiveColor",void 0),r([et.field],n.prototype,"metallic",void 0),r([et.field],n.prototype,"roughness",void 0),r([et.field],n.prototype,"reflectivityColor",void 0),r([et.field],n.prototype,"directIntensity",void 0),r([et.field],n.prototype,"microSurface",void 0),r([et.field],n.prototype,"emissiveIntensity",void 0),r([et.field],n.prototype,"specularIntensity",void 0),r([et.component],n.prototype,"albedoTexture",void 0),r([et.component],n.prototype,"alphaTexture",void 0),r([et.component],n.prototype,"emissiveTexture",void 0),r([et.component],n.prototype,"bumpTexture",void 0),r([et.field],n.prototype,"castShadows",void 0),r([et.field],n.prototype,"transparencyMode",void 0),r([F("engine.material",T.CLASS_ID.PBR_MATERIAL)],n)}(et),Ne=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.alphaTest=.5,T.castShadows=!0,T}return o(n,A),r([et.component],n.prototype,"texture",void 0),r([et.field],n.prototype,"alphaTest",void 0),r([et.field],n.prototype,"castShadows",void 0),r([F("engine.material",T.CLASS_ID.BASIC_MATERIAL)],n)}(et),ke=function(T){function e(A){var E=T.call(this)||this;if(E.uuid=f("UUID"),!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");return E.callback=A,E}return o(e,T),e.uuidEvent=function(T,A){if(delete T[A]){var E=A+"_"+Math.random();T[E]=void 0,Object.defineProperty(T,E,i(i({},Object.getOwnPropertyDescriptor(T,E)),{enumerable:!1})),Object.defineProperty(T,A.toString(),{get:function(){return this[E]},set:function(T){var R=this[E];if(T){if(!(T instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[A]=T.uuid}else this.data[A]=null;if(this[E]=T,T!==R){this.dirty=!0;for(var z=0;z<this.subscriptions.length;z++)this.subscriptions[z](A,T,R)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([et.field],e.prototype,"callback",void 0),e}(et),qe=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.button=T.ActionButton.ANY,E.hoverText="Interact",E.distance=10,E.showFeedback=!0,E}return o(n,A),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([et.field],n.prototype,"button",void 0),r([et.field],n.prototype,"hoverText",void 0),r([et.field],n.prototype,"distance",void 0),r([et.field],n.prototype,"showFeedback",void 0),n}(ke),De=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.type="onPointerLock",T}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onPointerLock",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),Ve=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.type="onAnimationEnd",T}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onAnimationEnd",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),We=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return o(n,A),r([M("engine.smartItem",T.CLASS_ID.SMART_ITEM)],n)}(et),Ue=function(A){function n(T){var E=A.call(this)||this;return E.url=T,E}return o(n,A),r([et.readonly],n.prototype,"url",void 0),r([F("engine.VideoClip",T.CLASS_ID.VIDEO_CLIP)],n)}(et);T.VideoStatus=void 0,(Le=T.VideoStatus||(T.VideoStatus={}))[Le.NONE=0]="NONE",Le[Le.ERROR=1]="ERROR",Le[Le.LOADING=2]="LOADING",Le[Le.READY=3]="READY",Le[Le.PLAYING=4]="PLAYING",Le[Le.BUFFERING=5]="BUFFERING";var He,je=function(A){function n(E,R){var z=A.call(this)||this;if(z.volume=1,z.playbackRate=1,z.loop=!1,z.seek=-1,z._position=-1,z._videoLength=-1,z._status=T.VideoStatus.NONE,z.playing=!1,!(E instanceof Ue))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(z.videoClipId=D(E),R)for(var O in R)z[O]=R[O];return z}return o(n,A),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(T){this.seek=T,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var T=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.seek=-1,T}return A.prototype.toJSON.call(this)},n.prototype.update=function(A){A.videoClipId==this.videoClipId&&(this._status=A.videoStatus||T.VideoStatus.NONE,this._videoLength=A.totalVideoLength,this._position=A.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([et.readonly],n.prototype,"videoClipId",void 0),r([et.readonly],n.prototype,"samplingMode",void 0),r([et.readonly],n.prototype,"wrap",void 0),r([et.field],n.prototype,"volume",void 0),r([et.field],n.prototype,"playbackRate",void 0),r([et.field],n.prototype,"loop",void 0),r([et.field],n.prototype,"seek",void 0),r([et.field],n.prototype,"playing",void 0),r([F("engine.VideoTexture",T.CLASS_ID.VIDEO_TEXTURE)],n)}(et),Ge=function(){function e(){var A=this;this.position=new Gt,this.rotation=new jt,this.feetPosition=new Gt,this.worldPosition=new Gt,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=T.CameraMode.FirstPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(T){switch(T.type){case"positionChanged":A.positionChanged(T.data);break;case"rotationChanged":A.rotationChanged(T.data);break;case"cameraModeChanged":A.cameraModeChanged(T.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return A.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return A.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return A.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return A.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return A.lastEventPosition.y-A.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return A.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return A.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return A.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return A.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(T){this.lastEventPosition=T.position,this.lastEventWorldPosition=T.cameraPosition,this._playerHeight=T.playerHeight},e.prototype.rotationChanged=function(T){this.lastEventRotation=T.quaternion},e.prototype.cameraModeChanged=function(T){this._cameraMode=T.cameraMode},e}();!function(T){T.HitFirst="rqhf",T.HitAll="rqha"}(He||(He={}));var Xe,Ye=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(T){var A=Ge.instance.rotation,E=Ht.Identity();A.toRotationMatrix(E);var R=Gt.TransformCoordinates(Gt.Forward(),E);return{origin:Ge.instance.position,direction:R,distance:T}},t.prototype.getRayFromPositions=function(T,A){var E=A.subtract(T),R=E.length();return{origin:T,direction:E.normalize(),distance:R}},t.prototype.hitFirst=function(T,A,E){var R="number"==typeof E?He.HitFirst+E:y();this.queries[R]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitFirst",ray:T})},t.prototype.hitAll=function(T,A,E){var R="number"==typeof E?He.HitAll+E:y();this.queries[R]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitAll",ray:T})},t.prototype.hitFirstAvatar=function(T,A){l("not implemented yet")},t.prototype.hitAllAvatars=function(T,A){l("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(T){this.queries[T.payload.queryId](T.payload.payload),delete this.queries[T.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(T){this.queries[T.payload.queryId](T.payload.payload),delete this.queries[T.payload.queryId]},t}(),Qe=function(){function t(){}return t.prototype.activate=function(T){T.eventManager.addListener(pt,this,(function(T){"HitFirst"===T.payload.queryType?Ye.instance.handleRaycastHitFirstResponse(T):"HitAll"===T.payload.queryType&&Ye.instance.handleRaycastHitAllResponse(T)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),Ze=function(){function t(){}return t.prototype.activate=function(T){T.eventManager.addListener(dt,this,(function(T){fe.instance.handlePointerEvent(T.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),Ke=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(T){T.eventManager.addListener(ht,this,this.handleEvent),T.eventManager.addListener(U,this,this.componentAdded),T.eventManager.addListener(V,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(T){for(var A in T.components){var E=T.components[A];E instanceof ke&&(this.handlerMap[E.uuid]=E)}},t.prototype.onRemoveEntity=function(T){for(var A in T.components){var E=T.components[A];E instanceof ke&&delete this.handlerMap[E.uuid]}},t.prototype.componentAdded=function(T){if(T.entity.isAddedToEngine()){var A=T.entity.components[T.componentName];A instanceof ke&&(this.handlerMap[A.uuid]=A)}},t.prototype.componentRemoved=function(T){T.entity.isAddedToEngine()&&T.component instanceof ke&&delete this.handlerMap[T.component.uuid]},t.prototype.handleEvent=function(T){if(T.uuid in this.handlerMap){var A=this.handlerMap[T.uuid];A&&A.callback&&"call"in A.callback&&A.callback(T.payload)}},t}(),Je=new Qe,$e=new Ze,tn=new Ke,en=function(A){function n(T){var E=A.call(this)||this;return E.loop=!1,E.volume=1,E.url=T,E}return o(n,A),r([et.readonly],n.prototype,"url",void 0),r([et.field],n.prototype,"loop",void 0),r([et.field],n.prototype,"loadingCompleteEventId",void 0),r([et.field],n.prototype,"volume",void 0),r([F("engine.AudioClip",T.CLASS_ID.AUDIO_CLIP)],n)}(et),nn=function(A){function n(T){var E=A.call(this)||this;if(E.audioClip=T,E.loop=!1,E.volume=1,E.playing=!1,E.pitch=1,E.playedAtTimestamp=Date.now(),!(T instanceof en))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return E.audioClipId=D(T),E}return o(n,A),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([et.readonly],n.prototype,"audioClipId",void 0),r([et.field],n.prototype,"loop",void 0),r([et.field],n.prototype,"volume",void 0),r([et.field],n.prototype,"playing",void 0),r([et.field],n.prototype,"pitch",void 0),r([et.field],n.prototype,"playedAtTimestamp",void 0),r([M("engine.AudioSource",T.CLASS_ID.AUDIO_SOURCE)],n)}(et),on=function(A){function n(T){var E=A.call(this)||this;return E.playing=!1,E.volume=1,E.url=T,E.playing=!0,E}return o(n,A),r([et.readonly],n.prototype,"url",void 0),r([et.field],n.prototype,"playing",void 0),r([et.field],n.prototype,"volume",void 0),r([M("engine.AudioStream",T.CLASS_ID.AUDIO_STREAM)],n)}(et);T.Gizmo=void 0,(Xe=T.Gizmo||(T.Gizmo={})).MOVE="MOVE",Xe.ROTATE="ROTATE",Xe.SCALE="SCALE",Xe.NONE="NONE";var rn,sn=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.type="gizmoEvent",T}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.gizmoEvent",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),an=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.position=!0,T.rotation=!0,T.scale=!0,T.cycle=!0,T.localReference=!1,T}return o(n,A),r([et.field],n.prototype,"position",void 0),r([et.field],n.prototype,"rotation",void 0),r([et.field],n.prototype,"scale",void 0),r([et.field],n.prototype,"cycle",void 0),r([et.field],n.prototype,"selectedGizmo",void 0),r([et.field],n.prototype,"localReference",void 0),r([M("engine.gizmos",T.CLASS_ID.GIZMOS)],n)}(et),ln=function(A){function n(T){var E=A.call(this,T)||this;return E.type="onFocus",tn.handlerMap[E.uuid]=E,E}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onFocus",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),un=function(A){function n(T){var E=A.call(this,T)||this;return E.type="onTextSubmit",tn.handlerMap[E.uuid]=E,E}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onTextSubmit",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),cn=function(A){function n(T){var E=A.call(this,T)||this;return E.type="onBlur",tn.handlerMap[E.uuid]=E,E}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onBlur",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),hn=function(A){function n(T){var E=A.call(this,T)||this;return E.type="onEnter",tn.handlerMap[E.uuid]=E,E}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onEnter",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),pn=function(A){function n(T){var E=A.call(this,T)||this;return E.type="onChange",tn.handlerMap[E.uuid]=E,E}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onChange",T.CLASS_ID.UUID_CALLBACK)],n)}(ke),dn=function(A){function n(T,E){var R=A.call(this,T)||this;return R.type="onClick",tn.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onClick",T.CLASS_ID.UUID_CALLBACK)],n)}(qe),fn=function(A){function n(T,E){var R=A.call(this,T)||this;return R.type="pointerDown",tn.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.pointerDown",T.CLASS_ID.UUID_CALLBACK)],n)}(qe),yn=function(A){function n(T,E){var R=A.call(this,T)||this;return R.type="pointerUp",tn.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,A),r([et.readonly],n.prototype,"type",void 0),r([M("engine.pointerUp",T.CLASS_ID.UUID_CALLBACK)],n)}(qe),vn=function(T){function e(A){var E=T.call(this)||this;return E.name=null,E.visible=!0,E.opacity=1,E.hAlign="center",E.vAlign="center",E.width="100px",E.height="50px",E.positionX="0px",E.positionY="0px",E.isPointerBlocker=!0,A&&(E._parent=A,E.data.parentComponent=D(A)),E}return o(e,T),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([et.field],e.prototype,"name",void 0),r([et.field],e.prototype,"visible",void 0),r([et.field],e.prototype,"opacity",void 0),r([et.field],e.prototype,"hAlign",void 0),r([et.field],e.prototype,"vAlign",void 0),r([et.uiValue],e.prototype,"width",void 0),r([et.uiValue],e.prototype,"height",void 0),r([et.uiValue],e.prototype,"positionX",void 0),r([et.uiValue],e.prototype,"positionY",void 0),r([et.field],e.prototype,"isPointerBlocker",void 0),e}(et),mn=function(A){function n(){return A.call(this,null)||this}return o(n,A),r([F("engine.shape",T.CLASS_ID.UI_FULLSCREEN_SHAPE)],n)}(vn),wn=function(A){function n(){return A.call(this,null)||this}return o(n,A),r([F("engine.shape",T.CLASS_ID.UI_WORLD_SPACE_SHAPE)],n)}(vn),bn=function(A){function n(){return A.call(this,null)||this}return o(n,A),r([F("engine.shape",T.CLASS_ID.UI_SCREEN_SPACE_SHAPE)],n)}(vn),xn=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.thickness=0,T.color=$t.Clear(),T.alignmentUsesSize=!0,T}return o(n,A),r([et.field],n.prototype,"thickness",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"alignmentUsesSize",void 0),r([F("engine.shape",T.CLASS_ID.UI_CONTAINER_RECT)],n)}(vn);T.UIStackOrientation=void 0,(rn=T.UIStackOrientation||(T.UIStackOrientation={}))[rn.VERTICAL=0]="VERTICAL",rn[rn.HORIZONTAL=1]="HORIZONTAL";var Tn=function(A){function n(){var E=null!==A&&A.apply(this,arguments)||this;return E.adaptWidth=!0,E.adaptHeight=!0,E.color=$t.Clear(),E.stackOrientation=T.UIStackOrientation.VERTICAL,E.spacing=0,E}return o(n,A),r([et.field],n.prototype,"adaptWidth",void 0),r([et.field],n.prototype,"adaptHeight",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"stackOrientation",void 0),r([et.field],n.prototype,"spacing",void 0),r([F("engine.shape",T.CLASS_ID.UI_CONTAINER_STACK)],n)}(vn),An=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.fontSize=10,T.fontWeight="normal",T.thickness=0,T.cornerRadius=0,T.color=$t.White(),T.background=$t.White(),T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T.shadowBlur=0,T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowColor=$t.Black(),T.text="button",T}return o(n,A),r([et.field],n.prototype,"fontSize",void 0),r([et.field],n.prototype,"fontWeight",void 0),r([et.field],n.prototype,"thickness",void 0),r([et.field],n.prototype,"cornerRadius",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"background",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"text",void 0),r([F("engine.shape",T.CLASS_ID.UI_BUTTON_SHAPE)],n)}(vn),Sn=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.outlineWidth=0,T.outlineColor=$t.White(),T.color=$t.White(),T.fontSize=10,T.fontAutoSize=!1,T.value="",T.lineSpacing=0,T.lineCount=0,T.adaptWidth=!1,T.adaptHeight=!1,T.textWrapping=!1,T.shadowBlur=0,T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowColor=$t.Black(),T.hTextAlign="left",T.vTextAlign="bottom",T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T}return o(n,A),r([et.field],n.prototype,"outlineWidth",void 0),r([et.field],n.prototype,"outlineColor",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"fontSize",void 0),r([et.field],n.prototype,"fontAutoSize",void 0),r([et.component],n.prototype,"font",void 0),r([et.field],n.prototype,"value",void 0),r([et.field],n.prototype,"lineSpacing",void 0),r([et.field],n.prototype,"lineCount",void 0),r([et.field],n.prototype,"adaptWidth",void 0),r([et.field],n.prototype,"adaptHeight",void 0),r([et.field],n.prototype,"textWrapping",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"hTextAlign",void 0),r([et.field],n.prototype,"vTextAlign",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([F("engine.shape",T.CLASS_ID.UI_TEXT_SHAPE)],n)}(vn),En=function(A){function n(T){var E=A.call(this,T)||this;return E.outlineWidth=0,E.outlineColor=$t.Black(),E.color=$t.Clear(),E.fontSize=10,E.value="",E.placeholder="",E.margin=10,E.hTextAlign="left",E.vTextAlign="bottom",E.focusedBackground=$t.Black(),E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=$t.White(),E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.onTextSubmit=null,E.onChanged=null,E.onFocus=null,E.onBlur=null,E.onTextChanged=new pn((function(T){var A=T.value,R=A.value,z=A.isSubmit,O=E.dirty;if(E.value=R,E.dirty=O,z&&E.onTextSubmit){var V={text:R};E.onTextSubmit.callback(V)}else if(!z&&E.onChanged){var U={value:R,pointerId:T.pointerId};E.onChanged.callback(U)}})),E}return o(n,A),r([et.field],n.prototype,"outlineWidth",void 0),r([et.field],n.prototype,"outlineColor",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"fontSize",void 0),r([et.component],n.prototype,"font",void 0),r([et.field],n.prototype,"value",void 0),r([et.field],n.prototype,"placeholder",void 0),r([et.field],n.prototype,"margin",void 0),r([et.field],n.prototype,"hTextAlign",void 0),r([et.field],n.prototype,"vTextAlign",void 0),r([et.field],n.prototype,"focusedBackground",void 0),r([et.field],n.prototype,"textWrapping",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([ke.uuidEvent],n.prototype,"onTextChanged",void 0),r([ke.uuidEvent],n.prototype,"onFocus",void 0),r([ke.uuidEvent],n.prototype,"onBlur",void 0),r([F("engine.shape",T.CLASS_ID.UI_INPUT_TEXT_SHAPE)],n)}(vn),Cn=function(A){function n(T,E){var R=A.call(this,T)||this;return R.sourceLeft=0,R.sourceTop=0,R.sourceWidth=1,R.sourceHeight=1,R.paddingTop=0,R.paddingRight=0,R.paddingBottom=0,R.paddingLeft=0,R.sizeInPixels=!0,R.onClick=null,R.source=E,R}return o(n,A),r([et.field],n.prototype,"sourceLeft",void 0),r([et.field],n.prototype,"sourceTop",void 0),r([et.field],n.prototype,"sourceWidth",void 0),r([et.field],n.prototype,"sourceHeight",void 0),r([et.component],n.prototype,"source",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([et.field],n.prototype,"sizeInPixels",void 0),r([ke.uuidEvent],n.prototype,"onClick",void 0),r([F("engine.shape",T.CLASS_ID.UI_IMAGE_SHAPE)],n)}(vn),In=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.valueX=0,T.valueY=0,T.backgroundColor=$t.Clear(),T.isHorizontal=!1,T.isVertical=!1,T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T.onChanged=null,T}return o(n,A),r([et.field],n.prototype,"valueX",void 0),r([et.field],n.prototype,"valueY",void 0),r([et.field],n.prototype,"backgroundColor",void 0),r([et.field],n.prototype,"isHorizontal",void 0),r([et.field],n.prototype,"isVertical",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([ke.uuidEvent],n.prototype,"onChanged",void 0),r([F("engine.shape",T.CLASS_ID.UI_SLIDER_SHAPE)],n)}(vn),Rn=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.useDummyModel=!1,T.talking=!1,T}var E;return o(n,A),E=n,n.Dummy=function(){var T=new E;return T.useDummyModel=!0,T},r([et.field],n.prototype,"id",void 0),r([et.field],n.prototype,"name",void 0),r([et.field],n.prototype,"expressionTriggerId",void 0),r([et.field],n.prototype,"expressionTriggerTimestamp",void 0),r([et.field],n.prototype,"bodyShape",void 0),r([et.field],n.prototype,"wearables",void 0),r([et.field],n.prototype,"skinColor",void 0),r([et.field],n.prototype,"hairColor",void 0),r([et.field],n.prototype,"eyeColor",void 0),r([et.field],n.prototype,"useDummyModel",void 0),r([et.field],n.prototype,"talking",void 0),E=r([M("engine.avatarShape",T.CLASS_ID.AVATAR_SHAPE)],n)}(et),_n=null,Pn=null,zn=null;function gn(){return zn||(zn=new ct),zn}var Bn=function(){function t(){var T=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Pn){(Pn=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(T){_n=T}));var T=gn();dcl.subscribe("comms"),dcl.onEvent((function(A){"comms"===A.type&&T.notifyObservers(A.data)}))}return Pn}().then((function(A){T.connected=!0,T.flush()}))}return t.prototype.on=function(T,A){return gn().add((function(E){try{var R=JSON.parse(E.message);R.message===T&&A(R.payload,E.sender)}catch(E){dcl.error("Error parsing comms message "+(E.message||""),E)}}))},t.prototype.sendRaw=function(T){this.messageQueue.push(T),this.connected&&this.flush()},t.prototype.emit=function(T,A){var E=JSON.stringify({message:T,payload:A});this.sendRaw(E),gn().notifyObservers({message:E,sender:"self"})},t.prototype.flush=function(){var T=this;if(0!==this.messageQueue.length&&this.connected&&_n&&!this.flushing){var A=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(_n.rpcHandle,"send",[A]).then((function(A){T.flushing=!1,T.flush()}),(function(A){T.flushing=!1,d("Error flushing MessageBus",A)}))}},t}(),Fn=new ot("scene");Fn.uuid="0";var On=new it(Fn);F.engine=On,"undefined"!=typeof dcl&&(On.addSystem(new zt(dcl),1/0),yt(dcl)),On.addSystem(tn),On.addSystem($e),On.addSystem(Je),T.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",T.Angle=Yt,T.AnimationState=ue,T.Animator=Pe,T.Arc2=Ft,T.Attachable=A,T.AudioClip=en,T.AudioSource=nn,T.AudioStream=on,T.AvatarModifierArea=ve,T.AvatarShape=Rn,T.Axis=Zt,T.BasicMaterial=Ne,T.BezierCurve=Jt,T.Billboard=ge,T.BoxShape=be,T.Camera=Ge,T.CircleShape=Te,T.Color3=ee,T.Color4=$t,T.Component=M,T.ComponentAdded=U,T.ComponentGroup=nt,T.ComponentRemoved=V,T.ConeShape=Se,T.Curve3=ne,T.CylinderShape=Ee,T.DEG2RAD=Dt,T.DisposableComponent=F,T.DisposableComponentCreated=K,T.DisposableComponentRemoved=J,T.DisposableComponentUpdated=$,T.Engine=it,T.Entity=ot,T.Epsilon=qt,T.EventConstructor=x,T.EventManager=z,T.Font=Be,T.Frustum=ie,T.GLTFShape=Ce,T.Gizmos=an,T.GlobalPointerDown=pe,T.GlobalPointerUp=de,T.Input=fe,T.Material=Me,T.MathTmp=Xt,T.Matrix=Ht,T.MessageBus=Bn,T.MultiObserver=ut,T.NFTShape=Re,T.OBJShape=ze,T.Observable=ct,T.ObservableComponent=et,T.Observer=Y,T.ObserverEventState=lt,T.OnAnimationEnd=Ve,T.OnBlur=cn,T.OnChanged=pn,T.OnClick=dn,T.OnEnter=hn,T.OnFocus=ln,T.OnGizmoEvent=sn,T.OnPointerDown=fn,T.OnPointerLock=De,T.OnPointerUUIDEvent=qe,T.OnPointerUp=yn,T.OnTextSubmit=un,T.OnUUIDEvent=ke,T.ParentChanged=H,T.Path2=re,T.Path3D=se,T.PhysicsCast=Ye,T.Plane=oe,T.PlaneShape=Ae,T.PointerEvent=dt,T.PointerEventComponent=Kt,T.PointerEventSystem=Ze,T.Quaternion=jt,T.RAD2DEG=Vt,T.RaycastEventSystem=Qe,T.RaycastResponse=pt,T.Scalar=Wt,T.Shape=we,T.Size=ae,T.SmartItem=We,T.SphereShape=xe,T.Subscription=te,T.TextShape=Oe,T.Texture=_e,T.ToGammaSpace=Nt,T.ToLinearSpace=kt,T.Transform=me,T.UIButton=An,T.UICanvas=bn,T.UIContainerRect=xn,T.UIContainerStack=Tn,T.UIFullScreen=mn,T.UIImage=Cn,T.UIInputText=En,T.UIScrollRect=In,T.UIShape=vn,T.UIText=Sn,T.UIValue=G,T.UIWorldSpace=wn,T.UUIDEvent=ht,T.UUIDEventSystem=Ke,T.Vector2=Qt,T.Vector3=Gt,T.Vector4=Ut,T.VideoClip=Ue,T.VideoTexture=je,T._initEventObservables=yt,T.buildArray=v,T.engine=On,T.error=d,T.executeTask=W,T.getComponentClassId=N,T.getComponentId=D,T.getComponentName=L,T.getMessageObserver=gn,T.isDisposableComponent=B,T.log=l,T.newId=f,T.onCameraModeChangedObservable=ft,T.onEnterScene=gt,T.onEnterSceneObservable=mt,T.onIdleStateChangedObservable=vt,T.onLeaveScene=bt,T.onLeaveSceneObservable=wt,T.onPlayerConnectedObservable=Ct,T.onPlayerDisconnectedObservable=It,T.onPlayerExpressionObservable=Tt,T.onPointerLockedStateChange=At,T.onProfileChanged=Et,T.onRealmChangedObservable=Rt,T.onSceneReadyObservable=xt,T.onVideoEvent=St,T.openExternalURL=function(T){"undefined"!=typeof dcl?dcl.openExternalUrl(T):d("ERROR: openExternalURL dcl is undefined")},T.openNFTDialog=function(T,A){if(void 0===A&&(A=null),"undefined"!=typeof dcl){var E=T.match(/ethereum:\/\/(.+)\/(.+)/);if(!E||E.length<3)return;dcl.openNFTDialog(E[1],E[2],A)}else d("ERROR: openNFTDialog dcl is undefined")},T.pointerEventSystem=$e,T.raycastEventSystem=Je,T.teleportTo=function(T){var A;A=[T],void 0===st&&"undefined"!=typeof dcl&&(st=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==st&&"undefined"!=typeof dcl&&st.then((function(T){dcl.callRpc(T.rpcHandle,"requestTeleport",A)}))},T.uuid=y,T.uuidEventSystem=tn,Object.defineProperty(T,"__esModule",{value:!0})}(this.self=this.self||{}),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(T,A){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(T,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(T[E]=A[E])})(T,A)};function i(T,A){function i(){this.constructor=T}n(T,A),T.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}function r(T,A,E,R){var z,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(T,A,E,R);else for(var U=T.length-1;U>=0;U--)(z=T[U])&&(V=(O<3?z(V):O>3?z(A,E,V):z(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}function o(T,A,E,R){return new(E||(E=Promise))((function(z,O){function a(T){try{u(R.next(T))}catch(T){O(T)}}function s(T){try{u(R.throw(T))}catch(T){O(T)}}function u(T){var A;T.done?z(T.value):(A=T.value,A instanceof E?A:new E((function(T){T(A)}))).then(a,s)}u((R=R.apply(T,A||[])).next())}))}function a(T,A){var E,R,z,O,V={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return O={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function s(O){return function(U){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(z=2&O[0]?R.return:O[0]?R.throw||((z=R.return)&&z.call(R),0):R.next)&&!(z=z.call(R,O[1])).done)return z;switch(R=0,z&&(O=[2&O[0],z.value]),O[0]){case 0:case 1:z=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((z=(z=V.trys).length>0&&z[z.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!z||O[1]>z[0]&&O[1]<z[3])){V.label=O[1];break}if(6===O[0]&&V.label<z[1]){V.label=z[1],z=O;break}if(z&&V.label<z[2]){V.label=z[2],V.ops.push(O);break}z[2]&&V.ops.pop(),V.trys.pop();continue}O=A.call(T,V)}catch(T){O=[6,T],R=0}finally{E=z=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,U])}}}function s(T){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&T[A],R=0;if(E)return E.call(T);if(T&&"number"==typeof T.length)return{next:function(){return T&&R>=T.length&&(T=void 0),{value:T&&T[R++],done:!T}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var E,R=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(T){this.createAndAddToEngine()._components.push(T)},e.prototype.addComponentType=function(T){var A,E;try{for(var R=s(this._components),z=R.next();!z.done;z=R.next())if(T==z.value)return}catch(T){A={error:T}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this._components.push(T),this._componentGroups.push(engine.getComponentGroup(T,Transform))},e.prototype.update=function(T){for(var A=0;A<this._components.length;A++)this.updateComponent(T,this._components[A],this._componentGroups[A])},e.prototype.updateComponent=function(T,A,E){E.entities.forEach((function(E){var R=E.getComponent(Transform),z=E.getComponent(A);z.update(T),z.assignValueToTransform(R),z.hasFinished()&&(E.removeComponent(z),null!=z.onFinishCallback&&z.onFinishCallback())}))},e._instance=null,e}();function h(A,E){switch(A){case T.InterpolationType.LINEAR:return E;case T.InterpolationType.EASEINQUAD:return function(T){return T*T}(E);case T.InterpolationType.EASEOUTQUAD:return function(T){return T*(2-T)}(E);case T.InterpolationType.EASEQUAD:return function(T){return T*T/(2*(T*T-T)+1)}(E);case T.InterpolationType.EASEINSINE:return function(T){return 1-Math.cos(T*Math.PI/2)}(E);case T.InterpolationType.EASEOUTSINE:return function(T){return Math.sin(T*Math.PI/2)}(E);case T.InterpolationType.EASESINE:return function(T){return-(Math.cos(Math.PI*T)-1)/2}(E);case T.InterpolationType.EASEINEXPO:return function(T){return 0===T?0:Math.pow(2,10*T-10)}(E);case T.InterpolationType.EASEOUTEXPO:return function(T){return 1===T?1:1-Math.pow(2,-10*T)}(E);case T.InterpolationType.EASEEXPO:return function(T){return 0===T?0:1===T?1:T<.5?Math.pow(2,20*T-10)/2:(2-Math.pow(2,-20*T+10))/2}(E);case T.InterpolationType.EASEINELASTIC:return function(T){var A=2*Math.PI/3;return 0===T?0:1===T?1:-Math.pow(2,10*T-10)*Math.sin((10*T-10.75)*A)}(E);case T.InterpolationType.EASEOUTELASTIC:return function(T){var A=2*Math.PI/3;return 0===T?0:1===T?1:Math.pow(2,-10*T)*Math.sin((10*T-.75)*A)+1}(E);case T.InterpolationType.EASEELASTIC:return function(T){var A=2*Math.PI/4.5;return 0===T?0:1===T?1:T<.5?-Math.pow(2,20*T-10)*Math.sin((20*T-11.125)*A)/2:Math.pow(2,-20*T+10)*Math.sin((20*T-11.125)*A)/2+1}(E);case T.InterpolationType.EASEINBOUNCE:return function(T){return 1-l(1-T)}(E);case T.InterpolationType.EASEOUTEBOUNCE:return function(T){return l(T)}(E);case T.InterpolationType.EASEBOUNCE:return function(T){return T<.5?(1-l(1-2*T))/2:(1+l(2*T-1))/2}(E);default:return E}}function l(T){var A=7.5625,E=2.75;return T<1/E?A*T*T:T<2/E?A*(T-=1.5/E)*T+.75:T<2.5/E?A*(T-=2.25/E)*T+.9375:A*(T-=2.625/E)*T+.984375}T.InterpolationType=void 0,(E=T.InterpolationType||(T.InterpolationType={}))[E.LINEAR=0]="LINEAR",E[E.EASEINQUAD=1]="EASEINQUAD",E[E.EASEOUTQUAD=2]="EASEOUTQUAD",E[E.EASEQUAD=3]="EASEQUAD",E.EASEINSINE="easeinsine",E.EASEOUTSINE="easeoutsine",E.EASESINE="easeinoutsine",E.EASEINEXPO="easeinexpo",E.EASEOUTEXPO="easeoutexpo",E.EASEEXPO="easeinoutexpo",E.EASEINELASTIC="easeinelastic",E.EASEOUTELASTIC="easeoutelastic",E.EASEELASTIC="easeinoutelastic",E.EASEINBOUNCE="easeinbounce",E.EASEOUTEBOUNCE="easeoutbounce",E.EASEBOUNCE="easeinoutbounce";var z,O=function(){function t(E,z,O,V,U){void 0===U&&(U=T.InterpolationType.LINEAR),this.start=E,this.end=z,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=U,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(T){T.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("moveTransformComponent")],t)}(),V=function(){function t(E,z,O,V,U){void 0===U&&(U=T.InterpolationType.LINEAR),this.start=E,this.end=z,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=U,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(T){T.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},A=r([Component("rotateTransformComponent")],t)}(),U=function(){function t(E,z,O,V,U){void 0===U&&(U=T.InterpolationType.LINEAR),this.start=E,this.end=z,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=U,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(T){T.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("scaleTransformComponent")],t)}(),H=function(){function e(A,E,z,O){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=A,this.onFinishCallback=z,this.onPointReachedCallback=O,A.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var V=0,U=[],H=0;H<A.length-1;H++){var G=Vector3.Distance(A[H],A[H+1]);V+=G,U.push(G)}for(H=0;H<U.length;H++)this.speed.push(1/(U[H]/V*E))}else this.normalizedTime=1,this.currentIndex=A.length-2;R.createAndAddToEngine().addComponentType(T)}var T;return T=e,e.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(T){T.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},T=r([Component("followPathComponent")],e)}(),G=function(){function e(A,E,z,O,V,U){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(A,z,!!V).getPoints(),this.onFinishCallback=U,this.turnToFaceNext=O||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var H=0,G=[],X=0;X<this.points.length-1;X++){var Q=Vector3.Distance(this.points[X],this.points[X+1]);H+=Q,G.push(Q)}for(X=0;X<G.length;X++)this.speed.push(1/(G[X]/H*E))}else this.normalizedTime=1,this.currentIndex=A.length-2;R.createAndAddToEngine().addComponentType(T)}var T;return T=e,e.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(T){T.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?T.lookAt(this.points[this.currentIndex+1]):T.lookAt(this.points[0]))},T=r([Component("followCurvedPathComponent")],e)}(),X=function(){function e(A,E){this.rotationVelocity=A,this.onFinishCallback=E,this.rotation=Quaternion.Identity,this.finished=!1,R.createAndAddToEngine().addComponentType(T)}var T;return T=e,e.prototype.update=function(T){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,T)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(T){T.rotation=T.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},T=r([Component("keepRotatingComponent")],e)}();T.ToggleState=void 0,(z=T.ToggleState||(T.ToggleState={}))[z.Off=0]="Off",z[z.On=1]="On";var Q=function(){function t(A,E){void 0===A&&(A=T.ToggleState.On),this.enabled=!0,this.state=T.ToggleState.Off,this.set(A),E&&this.setCallback(E)}return t.prototype.set=function(T){this.state=T,this.onValueChangedCallback&&this.onValueChangedCallback(T)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==T.ToggleState.On},t.prototype.setCallback=function(T){this.onValueChangedCallback=T},r([Component("toggle")],t)}(),Z=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(T){this.createAndAddToEngine()._components.push(T)},e.prototype.addComponentType=function(T){var A,E;try{for(var R=s(this._components),z=R.next();!z.done;z=R.next())if(T==z.value)return}catch(T){A={error:T}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this._components.push(T)},e.prototype.update=function(T){var A=this;this._components.forEach((function(E){A.updateComponent(T,E)}))},e.prototype.updateComponent=function(T,A){var E=engine.getEntitiesWithComponent(A);for(var R in E)if(E.hasOwnProperty(R)){var z=E[R],O=z.getComponent(A);O.elapsedTime+=T,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(z)}},e._instance=null,e}(),K=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(T),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(T){R.onTimeReachedCallback&&R.onTimeReachedCallback(),T.removeComponent(R)}}var T;return T=e,e.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=r([Component("timerDelay")],e)}(),J=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(T),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(T){R.onTimeReachedCallback&&R.onTimeReachedCallback(),T.removeComponent(R),engine.removeEntity(T)}}var T;return T=e,e.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=r([Component("timerExpireIn")],e)}(),$=function(){function e(A,E){var R=this;Z.createAndAddToEngine().addComponentType(T),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(){R.elapsedTime=0,R.onTimeReachedCallback&&R.onTimeReachedCallback()}}var T;return T=e,e.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=r([Component("timerInterval")],e)}();function I(T,A,E,R,z,O){var V=new Entity;V.addComponent(new Transform(O||{position:new Vector3(0,1.5,0)})),V.setParent(A);var U=new TextShape(T);return U.fontSize=z||3,U.color=R||Color3.Black(),V.addComponent(U),E&&V.addComponent(new Billboard),engine.addEntity(V),V}var et,nt,ot=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new rt(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(st)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(T){this._cameraTriggerWrapper.setShape(T)},e.prototype.update=function(){var T=this,A=this._componentGroup.entities;for(var E in A.forEach((function(A){T.shouldWrapTriggerEntity(A)&&T.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R),delete this._triggers[E])}},e.prototype.shouldWrapTriggerEntity=function(T){return null==this._triggers[T.uuid]||null==this._triggers[T.uuid]},e.prototype.wrapTriggerEntity=function(T){this._triggers[T.uuid]=new it(T)},e.removeTriggerFromSystem=function(T){for(var A,E=T.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(A=e._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&T.entity&&E[R].trigger.onTriggerExit(T.entity),E[R].disengageActiveCollision(T),T.disengageActiveCollision(E[R])},e.disengageCollision=function(T,A){T.disengageActiveCollision(A),A.disengageActiveCollision(T),T.trigger.onTriggerExit&&A.entity&&T.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&T.entity&&A.trigger.onTriggerExit(T.entity)},e.engageCollision=function(T,A){T.engageCollision(A),A.engageCollision(T),T.trigger.onTriggerEnter&&A.entity&&T.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&T.entity&&A.trigger.onTriggerEnter(T.entity)},e.prototype.checkCollisionAgainstCamera=function(T){var A=T.hasActiveCollision(this._cameraTriggerWrapper),E=e.areColliding(T,this._cameraTriggerWrapper);A&&!E?(T.disengageActiveCollision(this._cameraTriggerWrapper),T.trigger.onCameraExit&&T.trigger.onCameraExit()):!A&&E&&(T.engageCollision(this._cameraTriggerWrapper),T.trigger.onCameraEnter&&T.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(T){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=T.uuid&&this._triggers[A].trigger.enabled&&e.canTriggersCollide(T,this._triggers[A])){var E=T.hasActiveCollision(this._triggers[A]),R=e.areColliding(T,this._triggers[A]);E&&!R?e.disengageCollision(T,this._triggers[A]):!E&&R&&e.engageCollision(T,this._triggers[A])}},e.canTriggersCollide=function(T,A){return 0==T.trigger.triggeredByLayer||0!=(A.trigger.layer&T.trigger.triggeredByLayer)},e.areColliding=function(T,A){return T.getShape()instanceof P&&A.getShape()instanceof P?e.areCollidingAABB(T.getGlobalPosition(),T.getShape(),A.getGlobalPosition(),A.getShape()):T.getShape()instanceof k&&A.getShape()instanceof k?e.areCollidingSphere(T.getGlobalPosition(),T.getShape(),A.getGlobalPosition(),A.getShape()):T.getShape()instanceof P&&A.getShape()instanceof k?e.areCollidingAABBSphere(T.getGlobalPosition(),T.getShape(),A.getGlobalPosition(),A.getShape()):T.getShape()instanceof k&&A.getShape()instanceof P&&e.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),T.getGlobalPosition(),T.getShape())},e.areCollidingAABB=function(T,A,E,R){var z=e.getBoxShapeValues(T,A),O=e.getBoxShapeValues(E,R);return z.min.x<=O.max.x&&z.max.x>=O.min.x&&z.min.y<=O.max.y&&z.max.y>=O.min.y&&z.min.z<=O.max.z&&z.max.z>=O.min.z},e.areCollidingSphere=function(T,A,E,R){return Vector3.DistanceSquared(T.add(A.position),E.add(R.position))<A.radius*A.radius+R.radius*R.radius},e.areCollidingAABBSphere=function(T,A,E,R){var z=e.getBoxShapeValues(T,A),O=E.add(R.position),V=R.radius,U=0;return O.x<z.min.x&&(U+=(z.min.x-O.x)*(z.min.x-O.x)),O.x>z.max.x&&(U+=(O.x-z.max.x)*(O.x-z.max.x)),O.y<z.min.y&&(U+=(z.min.y-O.y)*(z.min.y-O.y)),O.y>z.max.y&&(U+=(O.y-z.max.y)*(O.y-z.max.y)),O.z<z.min.z&&(U+=(z.min.z-O.z)*(z.min.z-O.z)),O.z>z.max.z&&(U+=(O.z-z.max.z)*(O.z-z.max.z)),U<V*V},e.getBoxShapeValues=function(T,A){var E=T.add(A.position);return{center:E,min:E.subtract(A.size.scale(.5)),max:E.add(A.size.scale(.5))}},e._instance=null,e}(),it=function(){function e(T){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=T,T&&(this._trigger=T.getComponent(st),this._uuid=T.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var T=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&T.push(this._collidingWith[A]);return T},e.prototype.hasActiveCollision=function(T){return null!=this._collidingWith[T.uuid]&&null!=this._collidingWith[T.uuid]},e.prototype.disengageActiveCollision=function(T){delete this._collidingWith[T.uuid]},e.prototype.engageCollision=function(T){this._collidingWith[T.uuid]=T},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var T,E,R;return a(this,(function(z){switch(z.label){case 0:return[4,!A.isPreviewMode()];case 1:return z.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,T=new Transform,this._debugEntity.addComponent(T),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((E=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(E),T.scale=this.getShape().size),this.getShape()instanceof k&&((E=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(E),R=this.getShape().radius,T.scale=new Vector3(R,R,R))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(T){var A=T.hasComponent(Transform)?T.getComponent(Transform).position.clone():Vector3.Zero(),E=T.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(A.rotate(R))}return A},e._debugMaterial=null,e}(),rt=function(T){function t(A){var E=T.call(this)||this;return E._shape=A,E._uuid="cameraTrigger",E}return i(t,T),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(T){this._shape=T},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(T){return!1},t.prototype.disengageActiveCollision=function(T){},t.prototype.engageCollision=function(T){},t.prototype.isDebugging=function(){return!1},t}(it),st=function(){function e(T,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,ot.createAndAddToEngine(),this.shape=T,A&&(A.layer&&(this.layer=A.layer),A.triggeredByLayer&&(this.triggeredByLayer=A.triggeredByLayer),A.onTriggerEnter&&(this.onTriggerEnter=A.onTriggerEnter),A.onTriggerExit&&(this.onTriggerExit=A.onTriggerExit),A.onCameraEnter&&(this.onCameraEnter=A.onCameraEnter),A.onCameraExit&&(this.onCameraExit=A.onCameraExit),A.enableDebug&&(this._debugEnabled=A.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(T,A){void 0===T&&(T=Vector3.One().scale(2)),void 0===A&&(A=Vector3.Zero()),this.size=T,this.position=A},k=function(T,A){void 0===T&&(T=2),void 0===A&&(A=Vector3.Zero()),this.radius=T,this.position=A};T.ActionsSequenceSystem=function(){function e(T){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,T&&this.startSequence(T)}return e.prototype.startSequence=function(T){this.beginSequenceNode=T.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(T){this.onFinishCallback=T},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var T=this.currentSequenceNode;if(this.currentSequenceNode instanceof lt)do{T=T.currentInnerSequence}while(T instanceof lt);return T.action},e.prototype.update=function(T){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(T):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),et=T.ActionsSequenceSystem||(T.ActionsSequenceSystem={}),nt=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(T){if(null==this.currentSequenceNode)this.currentSequenceNode=new at,this.currentSequenceNode.action=T,this.beginSequenceNode=this.currentSequenceNode;else{var A=new at;A.action=T,this.currentSequenceNode=this.currentSequenceNode.then(A)}return this},e.prototype.if=function(T){var A=new ut(T);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.else=function(){var T=this.currentSequenceNode.getSequence();if(!(T instanceof ut))throw new Error("IF statement is needed to be called before ELSE statement.");T.closed=!0;var A=new ct(T);return this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.endIf=function(){var T=this.currentSequenceNode.getSequence();if(!(T instanceof ut||T instanceof ct))throw new Error("IF statement is needed to be called before ENDIF statement.");return T.closed=!0,this},e.prototype.while=function(T){var A=new ht(T);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this.whileNodeStack.push(A),this},e.prototype.endWhile=function(){var T=this.currentSequenceNode.getSequence();if(!(T instanceof ht))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return T.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new pt(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),et.SequenceBuilder=nt;var at=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(T){return this.next=T,T},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(T){this.action&&this.action.update(T)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),lt=function(T){function t(){var A=null!==T&&T.apply(this,arguments)||this;return A.currentInnerSequence=null,A.startingInnerSequence=null,A.closed=!1,A}return i(t,T),t.prototype.then=function(T){if(null==this.currentInnerSequence)this.currentInnerSequence=T,this.startingInnerSequence=T;else{if(this.closed)return this.next=T,T;this.currentInnerSequence=this.currentInnerSequence.then(T)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(T){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(T))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var T=this.currentInnerSequence.getSequence();if(T instanceof t&&!T.closed)return T}return this},t}(at),ut=function(T){function t(A){var E=T.call(this)||this;return E.result=!1,E.condition=A,E}return i(t,T),t.prototype.onStart=function(){this.result=this.condition(),this.result?T.prototype.onStart.call(this):this.currentInnerSequence=null},t}(lt),ct=function(T){function t(A){var E=T.call(this)||this;return E.ifSequence=null,E.ifSequence=A,E}return i(t,T),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?T.prototype.onStart.call(this):this.currentInnerSequence=null},t}(lt),ht=function(T){function t(A){var E=T.call(this)||this;return E.breakWhile=!1,E.condition=A,E}return i(t,T),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?T.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(T){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(T))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(lt),pt=function(T){function t(A){var E=T.call(this)||this;return E.whileNode=A,E}return i(t,T),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(at);T.Delay=K,T.ExpireIn=J,T.FollowCurvedPathComponent=G,T.FollowPathComponent=H,T.Interpolate=h,T.Interval=$,T.KeepRotatingComponent=X,T.MoveTransformComponent=O,T.RotateTransformComponent=V,T.ScaleTransformComponent=U,T.SequenceNode=at,T.ToggleComponent=Q,T.TransformSystem=R,T.TriggerBoxShape=P,T.TriggerComponent=st,T.TriggerSphereShape=k,T.TriggerSystem=ot,T.addLabel=I,T.addOneTimeTrigger=function(T,A,E){var R=!1,z=!1,O=new Entity;O.addComponent(new Transform({}));var V={};return A.layer&&(V.layer=A.layer),A.triggeredByLayer&&(V.triggeredByLayer=A.triggeredByLayer),A.onCameraEnter&&(V.onCameraEnter=function(){R||(R=!0,A.onCameraEnter()),!R&&A.onCameraEnter||!z&&A.onCameraExit||engine.removeEntity(O)}),A.onCameraExit&&(V.onCameraExit=function(){z||(z=!0,A.onCameraExit()),!R&&A.onCameraEnter||!z&&A.onCameraExit||engine.removeEntity(O)}),A.enableDebug&&(V.enableDebug=A.enableDebug),O.addComponent(new st(T,V)),E&&O.setParent(E),engine.addEntity(O),O},T.addTestCube=function(T,E,R,z,O,V,U){return o(this,void 0,void 0,(function(){var H,G,X;return a(this,(function(Q){switch(Q.label){case 0:return(H=!U)?[4,!A.isPreviewMode()]:[3,2];case 1:H=Q.sent(),Q.label=2;case 2:return H?[2]:((G=new Entity).addComponent(new Transform(T)),O?(G.addComponent(new SphereShape),G.getComponent(Transform).scale.setAll(.5)):G.addComponent(new BoxShape),engine.addEntity(G),G.addComponent(new OnPointerDown(E,{hoverText:R||"click",button:ActionButton.POINTER})),z&&((X=new Material).albedoColor=z,G.addComponent(X)),V&&(G.getComponent(BoxShape).withCollisions=!1),R&&I(R,G,!0),[2,G])}}))}))},T.clamp=function(T,A,E){var R=T;return T>E?R=E:T<A&&(R=A),R},T.getEntityWorldPosition=function e(T){var A=T.hasComponent(Transform)?T.getComponent(Transform).position.clone():Vector3.Zero(),E=T.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(A.rotate(R))}if("AvatarEntityReference"==E.uuid){var z=Camera.instance.rotation;return R=Quaternion.Euler(0,z.eulerAngles.y,0),Camera.instance.position.clone().add(A.rotate(R)).add(new Vector3(0,-.875,0))}return R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity,e(E).add(A.rotate(R))}return A},T.getEntityWorldRotation=function e(T){var A=T.hasComponent(Transform)?T.getComponent(Transform).rotation.clone():Quaternion.Zero(),E=T.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return A.multiply(R)}return"AvatarEntityReference"==E.uuid?(R=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),A.multiply(R)):(R=e(E),A.multiply(R))}return A},T.map=function(T,A,E,R,z){return(T-A)/(E-A)*(z-R)+R},T.sendRequest=function(T,A,E,R){return o(this,void 0,void 0,(function(){var z,O,V;return a(this,(function(U){switch(U.label){case 0:return U.trys.push([0,6,,7]),z={method:A||"GET"},E&&(z.headers=E),R&&(z.body=JSON.stringify(R)),[4,fetch(T,z)];case 1:O=U.sent(),U.label=2;case 2:return U.trys.push([2,4,,5]),[4,O.json()];case 3:return[2,U.sent()];case 4:return U.sent(),[2,O];case 5:return[3,7];case 6:return V=U.sent(),log("error fetching from ",T," : ",V),[3,7];case 7:return[2]}}))}))},T.setTimeout=function(T,A){var E=new Entity;return E.addComponent(new K(T,(function(){A(),engine.removeEntity(E)}))),engine.addEntity(E),E},Object.defineProperty(T,"__esModule",{value:!0})})),function(T,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/ui-scene-utils",["exports"],A):A((T="undefined"!=typeof globalThis?globalThis:T||self)["ui-utils"]={})}(this,(function(T){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(T,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,A){T.__proto__=A}||function(T,A){for(var E in A)Object.prototype.hasOwnProperty.call(A,E)&&(T[E]=A[E])})(T,A)};function i(T,A){function o(){this.constructor=T}e(T,A),T.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}var o=function(){return(o=Object.assign||function(T){for(var A,E=1,R=arguments.length;E<R;E++)for(var z in A=arguments[E])Object.prototype.hasOwnProperty.call(A,z)&&(T[z]=A[z]);return T}).apply(this,arguments)};function n(T,A){var E={};for(var R in T)Object.prototype.hasOwnProperty.call(T,R)&&A.indexOf(R)<0&&(E[R]=T[R]);if(null!=T&&"function"==typeof Object.getOwnPropertySymbols){var z=0;for(R=Object.getOwnPropertySymbols(T);z<R.length;z++)A.indexOf(R[z])<0&&Object.prototype.propertyIsEnumerable.call(T,R[z])&&(E[R[z]]=T[R[z]])}return E}function r(T){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&T[A],R=0;if(E)return E.call(T);if(T&&"number"==typeof T.length)return{next:function(){return T&&R>=T.length&&(T=void 0),{value:T&&T[R++],done:!T}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=function(){function t(A,E){var z=this;R.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){z.onTimeReachedCallback(),A.removeComponent(T)}}var T;return T=t,t.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=function(T,A,E,R){var z,O=arguments.length,V=O<3?A:null===R?R=Object.getOwnPropertyDescriptor(A,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(T,A,E,R);else for(var U=T.length-1;U>=0;U--)(z=T[U])&&(V=(O<3?z(V):O>3?z(A,E,V):z(A,E))||V);return O>3&&V&&Object.defineProperty(A,E,V),V}([Component("UItimerDelay")],t)}(),E=engine.getComponentGroup(A),R=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(T){var R,z;try{for(var O=r(E.entities),V=O.next();!V.done;V=O.next()){var U=V.value,H=U.getComponent(A);H.elapsedTime+=T,H.elapsedTime>=H.targetTime&&H.onTargetTimeReached(U)}}catch(T){R={error:T}}finally{try{V&&!V.done&&(z=O.return)&&z.call(O)}finally{if(R)throw R.error}}},t._instance=null,t}(),z=new UICanvas;z.visible=!0;var O=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),U=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),H=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),G=new UIText(z);G.vAlign="center",G.hAlign="center",G.hTextAlign="center",G.vTextAlign="center",G.font=O,G.fontSize=60,G.color=new Color4(0,0,0,1),G.visible=!1,G.positionY=80;var X=new UIImage(z,U);X.hAlign="center",X.vAlign="center",X.width=400,X.height=250,X.visible=!1;var Q,Z,K,J,$=function(T){function e(A,E,R,V,U,H,G){var X=T.call(this)||this;return X.canvas=z,X.valueAsNum=A,X.uiText=new UIText(z),X.fixedDigits=G||null,X.uiText.value=X.toFixedLengthString(A),X.uiText.hAlign="right",X.uiText.vAlign="bottom",X.uiText.positionX=E||0,X.uiText.positionY=R||0,X.uiText.fontSize=U||25,X.uiText.font=O,X.uiText.vTextAlign="center",X.uiText.hTextAlign="center",X.uiText.color=V||Color4.White(),X.uiText.outlineColor=Color4.Black(),X.uiText.outlineWidth=H?0:.1,X}return i(e,T),e.prototype.read=function(){return this.valueAsNum},e.prototype.increase=function(T){this.valueAsNum+=T||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.decrease=function(T){this.valueAsNum-=T||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.set=function(T){this.valueAsNum=T,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.toFixedLengthString=function(T){var A=T.toString();if(!this.fixedDigits)return A;for(var E=A.length-this.fixedDigits;E<0;)A="0".concat(A),E+=1;return E>0&&(A=T.toPrecision(this.fixedDigits)),A},e}(Entity);(Q=T.PromptStyles||(T.PromptStyles={})).LIGHT="light",Q.DARK="dark",Q.LIGHTLARGE="lightlarge",Q.DARKLARGE="darklarge",Q.LIGHTSLANTED="lightslanted",Q.DARKSLANTED="darkslanted",(Z=T.BarStyles||(T.BarStyles={})).ROUNDBLACK="roundblack",Z.ROUNDWHITE="roundwhite",Z.ROUNDSILVER="roundsilver",Z.ROUNDGOLD="roundgold",Z.SQUAREBLACK="squareblack",Z.SQUAREWHITE="squarewhite",Z.SQUARESILVER="squaresilver",Z.SQUAREGOLD="squaregold",(K=T.ButtonStyles||(T.ButtonStyles={})).E="e",K.F="f",K.DARK="dark",K.RED="red",K.ROUNDBLACK="roundblack",K.ROUNDWHITE="roundwhite",K.ROUNDSILVER="roundsilver",K.ROUNDGOLD="roundgold",K.SQUAREBLACK="squareblack",K.SQUAREWHITE="squarewhite",K.SQUARESILVER="squaresilver",K.SQUAREGOLD="squaregold",(J=T.SwitchStyles||(T.SwitchStyles={})).ROUNDGREEN="roundgreen",J.ROUNDRED="roundred",J.SQUAREGREEN="squaregreen",J.SQUARERED="squarered";var et={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},nt={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},ot={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},it={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},rt={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},st={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},at={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},lt={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},ut={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},ct={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},ht={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},pt={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567},dt={sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},ft={sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},vt={sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},mt={sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},gt={sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},wt={closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},bt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},xt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},Tt={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},At={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},St={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},Et={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},Ct={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},It={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168},Rt={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},_t={sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},Pt={sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},zt={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},Bt={sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},Ot={sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501};function S(T,A){T.sourceWidth=A.sourceWidth,T.sourceHeight=A.sourceHeight,T.sourceLeft=A.sourceLeft?A.sourceLeft:0,T.sourceTop=A.sourceTop?A.sourceTop:0}function C(T){var A=-10-4*T;return A>-65?A:-65}var Lt=function(A){function o(E,R,O,V,H,G,X){var Q=A.call(this)||this;if(Q.canvas=z,Q.valueAsNum=E>1?1:E,Q.fullWidth=G?128*G:128,Q.background=new UIImage(z,U),Q.background.width=G?128*G:128,Q.background.height=G?32*G:32,Q.background.hAlign="right",Q.background.vAlign="bottom",Q.background.positionX=R||0,Q.background.positionY=O||0,H)switch(H){case T.BarStyles.ROUNDBLACK:S(Q.background,rt);break;case T.BarStyles.ROUNDWHITE:S(Q.background,at);break;case T.BarStyles.ROUNDSILVER:S(Q.background,ut);break;case T.BarStyles.ROUNDGOLD:S(Q.background,ht);break;case T.BarStyles.SQUAREBLACK:S(Q.background,st);break;case T.BarStyles.SQUAREWHITE:S(Q.background,lt);break;case T.BarStyles.SQUARESILVER:S(Q.background,ct);break;case T.BarStyles.SQUAREGOLD:S(Q.background,pt)}else S(Q.background,ut);return Q.background.sourceWidth=128,Q.background.sourceHeight=32,Q.background.visible=!0,Q.bar=new UIContainerRect(Q.background),Q.bar.color=V||Color4.Red(),Q.bar.thickness=0,Q.bar.hAlign="left",Q.bar.vAlign="center",Q.bar.positionX=G?2.55*G:2.55,Q.bar.positionY=0,Q.bar.height=G?32*G-7.5*G:24.5,Q.bar.width=G?Q.fullWidth*Q.valueAsNum-5.1*G:Q.fullWidth*Q.valueAsNum-5.1,X&&Q.hide(),Q}return i(o,A),o.prototype.read=function(){return this.valueAsNum},o.prototype.increase=function(T){this.valueAsNum+=T||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.decrease=function(T){this.valueAsNum-=T||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.set=function(T){this.valueAsNum=T,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.hide=function(){this.background.visible=!1,this.bar.visible=!1},o.prototype.show=function(){this.background.visible=!0,this.bar.visible=!0},o}(Entity),Mt=function(T){function e(A,E,R,O,V,U){var H=T.call(this)||this;H.canvas=z;var G=new Texture(A);return H.image=new UIImage(z,G),H.image.hAlign="right",H.image.vAlign="bottom",H.image.positionX=E||0,H.image.positionY=R||0,H.image.width=O||64,H.image.height=V||64,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U&&U.sourceWidth?U.sourceWidth:O||64,H.image.sourceHeight=U&&U.sourceHeight?U.sourceHeight:V||64,H}return i(e,T),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(T){var E=this;if(this.image.visible=!0,T){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(T,(function(){E.hide()})))}},e}(Entity),Nt=function(T){function e(A,E,R,O,V,U){var H=T.call(this)||this;H.canvas=z;var G=new Texture(A);return H.image=new UIImage(z,G),H.image.hAlign="right",H.image.vAlign="bottom",H.image.positionX=E||0,H.image.positionY=R||0,H.image.width=O||32,H.image.height=V||32,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U?U.sourceWidth:O||32,H.image.sourceHeight=U?U.sourceHeight:V||32,H}return i(e,T),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(T){var E=this;if(this.image.visible=!0,T){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(T,(function(){E.hide()})))}},e}(Entity),kt=function(T){function e(A,E,R,O,V,U){var H=T.call(this)||this;H.canvas=z;var G=new Texture(A);return H.image=new UIImage(z,G),H.image.hAlign="right",H.image.vAlign="bottom",H.image.positionX=E||0,H.image.positionY=R||0,H.image.width=O||128,H.image.height=V||128,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U?U.sourceWidth:O||128,H.image.sourceHeight=U?U.sourceHeight:V||128,H}return i(e,T),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(T){var E=this;if(this.image.visible=!0,T){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(T,(function(){E.hide()})))}},e}(Entity),qt=function(T){function e(E,R,O,V,U,H,G,X){var Q=T.call(this)||this;Q.canvas=z;var Z=new Texture(E);if(Q.image=new UIImage(z,Z),Q.image.hAlign="center",Q.image.vAlign="center",Q.image.positionX=V||0,Q.image.positionY=U||0,Q.image.width=H||512,Q.image.height=G||512,Q.image.sourceLeft=X&&X.sourceLeft?X.sourceLeft:0,Q.image.sourceTop=X&&X.sourceTop?X.sourceTop:0,Q.image.sourceWidth=X?X.sourceWidth:H||512,Q.image.sourceHeight=X?X.sourceHeight:G||512,Q.image.visible=!O,-1!=R){var K=new Entity;engine.addEntity(K),K.addComponentOrReplace(new A(R||3,(function(){Q.hide()})))}return Q}return i(e,T),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(T){var E=this;if(this.image.visible=!0,T){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new A(T,(function(){E.hide()})))}},e}(Entity),Dt=function(T){function e(A,E,R,V){var G=T.call(this)||this;G.canvas=z,G.background=X,G.UIOpenTime=+Date.now(),G.onAccept=E||null;var Q=V?H:U;return X.source=Q,X.width=400,X.height=250,X.positionY=0,S(X,vt),X.visible=!0,G.closeIcon=new UIImage(X,Q),G.closeIcon.positionX=175,G.closeIcon.positionY=100,G.closeIcon.width=32,G.closeIcon.height=32,S(G.closeIcon,V?wt.closeW:wt.closeD),G.closeIcon.onClick=new OnClick((function(){G.close()})),G.text=new UIText(X),G.text.value=A,G.text.adaptWidth=!1,G.text.textWrapping=!0,G.text.width=380,G.text.hAlign="center",G.text.vAlign="top",G.text.positionX=0,G.text.positionY=-65,G.text.fontSize=24,G.text.font=O,G.text.vTextAlign="center",G.text.hTextAlign="center",G.text.color=V?Color4.White():Color4.Black(),G.button=new UIImage(X,Q),G.button.positionX=0,G.button.positionY=-60,G.button.width=174,G.button.height=46,S(G.button,et),G.icon=new UIImage(G.button,1==V?H:U),G.icon.width=26,G.icon.height=26,G.icon.hAlign="center",G.icon.vAlign="center",G.icon.isPointerBlocker=!1,S(G.icon,dt),G.icon.positionX=C(R?R.length:2),G.buttonLabel=new UIText(G.button),G.buttonLabel.value=R||"Ok",G.buttonLabel.hTextAlign="center",G.buttonLabel.vTextAlign="center",G.buttonLabel.positionX=30,G.buttonLabel.fontSize=18,G.buttonLabel.font=O,G.buttonLabel.color=Color4.White(),G.buttonLabel.isPointerBlocker=!1,G.button.onClick=new OnClick((function(){G.accept()})),G.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(T){G.button.visible&&+Date.now()-G.UIOpenTime>100&&G.accept()})),G}return i(e,T),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.close()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0},e}(Entity),Vt=function(T){function e(A,E,R,G,Q,Z,K){var J=T.call(this)||this;J.canvas=z,J.background=X,J.UIOpenTime=+Date.now(),J.onAccept=R,J.onReject=G||null;var $=K?H:U;return X.source=$,X.width=480,X.height=384,S(X,mt),X.visible=!0,J.closeIcon=new UIImage(X,$),J.closeIcon.positionX=215,J.closeIcon.positionY=164,J.closeIcon.width=32,J.closeIcon.height=32,S(J.closeIcon,K?wt.closeW:wt.closeD),J.closeIcon.onClick=new OnClick((function(){J.close()})),J.title=new UIText(X),J.title.value=A,J.title.adaptWidth=!1,J.title.textWrapping=!0,J.title.width=380,J.title.hAlign="center",J.title.vAlign="top",J.title.positionX=0,J.title.positionY=-20,J.title.font=V,J.title.fontSize=24,J.title.vTextAlign="center",J.title.hTextAlign="center",J.title.color=K?Color4.White():Color4.Black(),J.text=new UIText(X),J.text.value=E,J.text.adaptWidth=!1,J.text.textWrapping=!0,J.text.width=380,J.text.hAlign="center",J.text.vAlign="top",J.text.positionX=0,J.text.positionY=-145,J.text.fontSize=24,J.text.font=O,J.text.vTextAlign="center",J.text.hTextAlign="center",J.text.color=K?Color4.White():Color4.Black(),J.buttonE=new UIImage(X,$),J.buttonE.positionX=-100,J.buttonE.positionY=-120,J.buttonE.width=174,J.buttonE.height=46,S(J.buttonE,et),J.buttonEIcon=new UIImage(J.buttonE,1==K?H:U),J.buttonEIcon.width=26,J.buttonEIcon.height=26,J.buttonEIcon.hAlign="center",J.buttonEIcon.vAlign="center",J.buttonEIcon.isPointerBlocker=!1,S(J.buttonEIcon,dt),J.buttonEIcon.positionX=C(Q?Q.length:2),J.buttonELabel=new UIText(J.buttonE),J.buttonELabel.value=Q||"Ok",J.buttonELabel.hTextAlign="center",J.buttonELabel.vTextAlign="center",J.buttonELabel.positionX=30,J.buttonELabel.fontSize=18,J.buttonELabel.font=O,J.buttonELabel.color=Color4.White(),J.buttonELabel.isPointerBlocker=!1,J.buttonE.onClick=new OnClick((function(){J.accept()})),J.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(T){J.buttonE.visible&&+Date.now()-J.UIOpenTime>100&&J.accept()})),J.buttonF=new UIImage(X,$),J.buttonF.positionX=100,J.buttonF.positionY=-120,J.buttonF.width=174,J.buttonF.height=46,S(J.buttonF,nt),J.buttonFIcon=new UIImage(J.buttonF,1==K?H:U),J.buttonFIcon.width=26,J.buttonFIcon.height=26,J.buttonFIcon.hAlign="center",J.buttonFIcon.vAlign="center",J.buttonFIcon.isPointerBlocker=!1,S(J.buttonFIcon,ft),J.buttonFIcon.positionX=C(Z?Z.length:6),J.buttonFLabel=new UIText(J.buttonF),J.buttonFLabel.value=Z||"Cancel",J.buttonFLabel.hTextAlign="center",J.buttonFLabel.vTextAlign="center",J.buttonFLabel.positionX=30,J.buttonFLabel.fontSize=18,J.buttonFLabel.font=O,J.buttonFLabel.color=Color4.White(),J.buttonFLabel.isPointerBlocker=!1,J.buttonF.onClick=new OnClick((function(){J.reject()})),J.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(T){J.buttonF.visible&&+Date.now()-J.UIOpenTime>100&&J.reject()})),J}return i(e,T),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.title.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.close()},e.prototype.reject=function(){this.onReject&&this.onReject(),this.close()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.buttonEIcon.visible=!1,this.buttonFIcon.visible=!1},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.buttonE.visible=!0,this.buttonF.visible=!0,this.text.visible=!0,this.buttonELabel.visible=!0,this.buttonFLabel.visible=!0,this.buttonEIcon.visible=!0,this.buttonFIcon.visible=!0},e}(Entity),Wt=function(T){function e(A,E,R,G,Q){var Z=T.call(this)||this;Z.canvas=z,Z.background=X,Z.UIOpenTime=+Date.now(),Z.onAccept=E;var K=Q?H:U;X.source=K,X.width=400,X.height=250,S(X,vt),X.visible=!0,Z.text=new UIText(X),Z.text.value=A,Z.text.adaptWidth=!1,Z.text.textWrapping=!0,Z.text.width=320,Z.text.hAlign="center",Z.text.vAlign="top",Z.text.positionX=0,Z.text.positionY=-20,Z.text.fontSize=24,Z.text.font=V,Z.text.vTextAlign="center",Z.text.hTextAlign="center",Z.text.color=Q?Color4.White():Color4.Black(),Z.closeIcon=new UIImage(X,K),Z.closeIcon.positionX=175,Z.closeIcon.positionY=100,Z.closeIcon.width=32,Z.closeIcon.height=32,S(Z.closeIcon,Q?wt.closeW:wt.closeD),Z.closeIcon.onClick=new OnClick((function(){Z.hide()})),Z.button=new UIImage(X,K),Z.button.positionX=0,Z.button.positionY=-60,Z.button.width=174,Z.button.height=46,S(Z.button,et),Z.icon=new UIImage(Z.button,1==Q?H:U),Z.icon.width=26,Z.icon.height=26,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,S(Z.icon,dt),Z.icon.positionX=C(R?R.length:6),Z.buttonLabel=new UIText(Z.button),Z.buttonLabel.value=R||"Submit",Z.buttonLabel.hTextAlign="center",Z.buttonLabel.vTextAlign="center",Z.buttonLabel.positionX=30,Z.buttonLabel.fontSize=18,Z.buttonLabel.font=O,Z.buttonLabel.color=Color4.White(),Z.buttonLabel.isPointerBlocker=!1,Z.fillInBox=new UIInputText(X),Z.fillInBox.color=Color4.Black(),Z.fillInBox.font=O,Z.fillInBox.width=312,Z.fillInBox.height=46,Z.fillInBox.positionX=0,Z.fillInBox.positionY=15,Z.fillInBox.placeholder=G||"Fill in",Z.fillInBox.hTextAlign="center",Z.fillInBox.vTextAlign="center",Z.fillInBox.fontSize=22;var J="";return Z.fillInBox.onChanged=new OnChanged((function(T){J=T.value})),Z.fillInBox.onTextSubmit=new OnTextSubmit((function(T){Z.accept(J)})),Z.button.onClick=new OnClick((function(){Z.accept(J)})),Z.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(T){Z.button.visible&&+Date.now()-Z.UIOpenTime>100&&Z.accept(J)})),Z}return i(e,T),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.accept=function(T){this.onAccept(T),this.close()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,this.fillInBox.visible=!0},e}(Entity),Ut=function(A){function o(E,R,O,V){var G=A.call(this)||this;switch(G.elements=[],G.texture=U,G.darkTheme=!1,G.background=new UIImage(z,U),G.closeIcon=new UIImage(G.background,G.texture),G.UIOpenTime=0,G.canvas=z,G.UIOpenTime=+Date.now(),G.background=new UIImage(z,U),G.background.hAlign="center",G.background.vAlign="center",E||(E=T.PromptStyles.LIGHT),E){case T.PromptStyles.LIGHT:G.texture=U,S(G.background,vt),S(G.closeIcon,wt.closeD),G.closeIcon.positionX=R?R/2-25:175,G.closeIcon.positionY=O?O/2-25:145;break;case T.PromptStyles.DARK:G.texture=H,G.darkTheme=!0,S(G.background,vt),S(G.closeIcon,wt.closeW),G.closeIcon.positionX=R?R/2-25:175,G.closeIcon.positionY=O?O/2-25:145;break;case T.PromptStyles.LIGHTLARGE:G.texture=U,S(G.background,mt),S(G.closeIcon,wt.closeD),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:165;break;case T.PromptStyles.DARKLARGE:G.texture=H,G.darkTheme=!0,S(G.background,mt),S(G.closeIcon,wt.closeW),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:165;break;case T.PromptStyles.LIGHTSLANTED:G.texture=U,S(G.background,gt),S(G.closeIcon,wt.closeD),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:138;break;case T.PromptStyles.DARKSLANTED:G.texture=H,G.darkTheme=!0,S(G.background,gt),S(G.closeIcon,wt.closeW),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:138;break;default:G.texture=new Texture(E),G.closeIcon.visible=!1}return G.background.source=G.texture,G.background.width=R||G.background.sourceWidth,G.background.height=O||G.background.sourceHeight,G.background.visible=!0,G.closeIcon.width=32,G.closeIcon.height=32,G.closeIcon.source=G.texture,G.closeIcon.onClick=new OnClick((function(){G.hide()})),V&&G.hide(),G}return i(o,A),o.prototype.hide=function(){var T,A;this.background.visible=!1,this.closeIcon.visible=!1;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.hide()}catch(A){T={error:A}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(T)throw T.error}}},o.prototype.show=function(){var T,A;this.background.visible=!0,this.closeIcon.visible=!0;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.show()}catch(A){T={error:A}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(T)throw T.error}}},o.prototype.addText=function(T,A,E,R,z){var O=new Yt(this,T,A,E,this.darkTheme,R||void 0,z||void 0);return this.elements.push(O),O},o.prototype.addButton=function(T,A,E,R,z){var O=new Ht(this,this.texture,this.UIOpenTime,T,A,E,R,z||void 0);return this.elements.push(O),O},o.prototype.addCheckbox=function(T,A,E,R,z,O,V){var U=new jt(this,this.texture,this.darkTheme,T,A,E,R||void 0,z||void 0,O||void 0,V||void 0);return this.elements.push(U),U},o.prototype.addSwitch=function(T,A,E,R,z,O,V){var U=new Gt(this,this.texture,this.darkTheme,T,A,E,R||void 0,z||void 0,O||void 0,V||void 0);return this.elements.push(U),U},o.prototype.addIcon=function(T,A,E,R,z,O){var V=new Texture(T),U=new Xt(this,V,A,E,R||void 0,z||void 0,O||void 0);return this.elements.push(U),U},o.prototype.addTextBox=function(T,A,E,R){var z=new Qt(this,T,A,E||void 0,R||void 0);return this.elements.push(z),z},o}(Entity),Ht=function(A){function o(E,R,z,V,U,H,G,X){var Q=A.call(this)||this;if(Q.icon=null,Q.image=new UIImage(E.background,R),Q.image.positionX=U,Q.image.positionY=H,Q.image.width=174,Q.image.height=46,Q.label=new UIText(Q.image),X)switch(X){case T.ButtonStyles.E:S(Q.image,et),Q.label.positionX=25,Q.icon=new UIImage(Q.image,R),Q.icon.width=26,Q.icon.height=26,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,S(Q.icon,dt),Q.icon.positionX=C(V.length);break;case T.ButtonStyles.F:S(Q.image,nt),Q.label.positionX=25,Q.icon=new UIImage(Q.image,R),Q.icon.width=26,Q.icon.height=26,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,S(Q.icon,ft),Q.icon.positionX=C(V.length);break;case T.ButtonStyles.RED:S(Q.image,ot);break;case T.ButtonStyles.DARK:S(Q.image,it);break;case T.ButtonStyles.ROUNDBLACK:S(Q.image,rt);break;case T.ButtonStyles.ROUNDWHITE:S(Q.image,at);break;case T.ButtonStyles.ROUNDSILVER:S(Q.image,ut);break;case T.ButtonStyles.ROUNDGOLD:S(Q.image,ht);break;case T.ButtonStyles.SQUAREBLACK:S(Q.image,st);break;case T.ButtonStyles.SQUAREWHITE:S(Q.image,lt);break;case T.ButtonStyles.SQUARESILVER:S(Q.image,ct);break;case T.ButtonStyles.SQUAREGOLD:S(Q.image,pt);break;default:S(Q.image,ut)}else S(Q.image,ut);return Q.label.value=V,Q.label.hTextAlign="center",Q.label.vTextAlign="center",Q.label.fontSize=20,Q.label.font=O,Q.label.color=X==T.ButtonStyles.ROUNDWHITE||X==T.ButtonStyles.SQUAREWHITE?Color4.Black():Color4.White(),Q.label.isPointerBlocker=!1,Q.image.onClick=new OnClick((function(){G()})),X==T.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(T){Q.image.visible&&+Date.now()-z>100&&G()})):X==T.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(T){Q.image.visible&&+Date.now()-z>100&&G()})),Q}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1,this.icon&&(this.icon.visible=!1)},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0,this.icon&&(this.icon.visible=!0)},o}(Entity),jt=function(T){function e(A,E,R,z,V,U,H,G,X,Q){var Z=T.call(this)||this;return Z.checked=!!Q,Z.darkTheme=R,Z.large=X||!1,Z.image=new UIImage(A.background,E),Z.image.positionX=V,Z.image.positionY=U,Z.image.width=X?32:24,Z.image.height=X?32:24,0==Z.checked?Z.uncheck():Z.check(),Z.label=new UIText(Z.image),Z.label.positionX=X?40:30,Z.label.color=R?Color4.White():Color4.Black(),Z.label.value=z,Z.label.hTextAlign="left",Z.label.vTextAlign="center",Z.label.fontSize=20,Z.label.font=O,Z.label.isPointerBlocker=!1,Z.image.onClick=new OnClick((function(){0==Z.checked?Z.check():Z.uncheck(),Z.checked?H&&H():G&&G()})),Z}return i(e,T),e.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},e.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},e.prototype.uncheck=function(){this.checked=!1,this.darkTheme?this.large?S(this.image,St):S(this.image,bt):this.large?S(this.image,Ct):S(this.image,Tt)},e.prototype.check=function(){this.checked=!0,this.darkTheme?this.large?S(this.image,Et):S(this.image,xt):this.large?S(this.image,It):S(this.image,At)},e}(Entity),Gt=function(A){function o(E,R,z,V,U,H,G,X,Q,Z){var K=A.call(this)||this;return K.checked=!!Z,K.darkTheme=z,K.style=Q||T.SwitchStyles.ROUNDGREEN,K.image=new UIImage(E.background,R),K.image.positionX=U,K.image.positionY=H,K.image.width=64,K.image.height=32,0==K.checked?K.check():K.uncheck(),K.label=new UIText(K.image),K.label.positionX=80,K.label.color=z?Color4.White():Color4.Black(),K.label.value=V,K.label.hTextAlign="left",K.label.vTextAlign="center",K.label.fontSize=20,K.label.font=O,K.label.isPointerBlocker=!1,K.image.onClick=new OnClick((function(){0==K.checked?K.check():K.uncheck(),K.checked?G&&G():X&&X()})),K}return i(o,A),o.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},o.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},o.prototype.check=function(){switch(this.checked=!0,this.style){case T.SwitchStyles.ROUNDGREEN:S(this.image,Pt);break;case T.SwitchStyles.ROUNDRED:S(this.image,_t);break;case T.SwitchStyles.SQUAREGREEN:S(this.image,Ot);break;case T.SwitchStyles.SQUARERED:S(this.image,Bt)}},o.prototype.uncheck=function(){this.checked=!1,this.style==T.SwitchStyles.ROUNDGREEN||this.style==T.SwitchStyles.ROUNDRED?S(this.image,Rt):S(this.image,zt)},o}(Entity),Xt=function(T){function e(A,E,R,z,O,V,U){var H=T.call(this)||this;return H.image=new UIImage(A.background,E),H.image.positionX=R,H.image.positionY=z,H.image.width=O||128,H.image.height=V||128,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U&&U.sourceWidth?U.sourceWidth:O||128,H.image.sourceHeight=U&&U.sourceHeight?U.sourceHeight:V||128,H}return i(e,T),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity),Yt=function(T){function e(A,E,R,z,O,V,U){var H=T.call(this)||this;return H.text=new UIText(A.background),H.text.value=E,H.text.positionX=R||0,H.text.positionY=z||0,H.text.hTextAlign="center",H.text.color=V||(O?Color4.White():Color4.Black()),H.text.fontSize=U||15,H}return i(e,T),e.prototype.hide=function(){this.text.visible=!1},e.prototype.show=function(){this.text.visible=!0},e}(Entity),Qt=function(T){function e(A,E,R,z,V){var U=T.call(this)||this;return U.currentText="",U.fillInBox=new UIInputText(A.background),U.fillInBox.color=Color4.Black(),U.fillInBox.font=O,U.fillInBox.width=312,U.fillInBox.height=46,U.fillInBox.positionX=E,U.fillInBox.positionY=R,U.fillInBox.placeholder=z||"Fill in",U.fillInBox.hTextAlign="center",U.fillInBox.vTextAlign="center",U.fillInBox.fontSize=22,U.fillInBox.onChanged=new OnChanged((function(T){U.fillInBox&&!U.fillInBox.visible||(U.currentText=T.value,V&&V(U.currentText))})),U.fillInBox.onTextSubmit=new OnTextSubmit((function(T){U.fillInBox&&!U.fillInBox.visible||(U.currentText=T.text,V&&V(U.currentText))})),U}return i(e,T),e.prototype.hide=function(){this.fillInBox.visible=!1},e.prototype.show=function(){this.fillInBox.visible=!0},e}(Entity),Zt=function(T){function e(A,E,R,V,U,H){var G=T.call(this)||this;return G.canvas=z,G.uiText=new UIText(z),G.uiText.value=A,G.uiText.hAlign="right",G.uiText.vAlign="bottom",G.uiText.positionX=E||0,G.uiText.positionY=R||0,G.uiText.fontSize=U||25,G.uiText.font=O,G.uiText.vTextAlign="center",G.uiText.hTextAlign="center",G.uiText.color=V||Color4.White(),G.uiText.outlineColor=Color4.Black(),G.uiText.outlineWidth=H?0:.1,G}return i(e,T),e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.set=function(T){this.uiText.value=T,this.uiText.visible=!0},e}(Entity),Jt=function(T){function e(E,R,O,V){var H=T.call(this)||this;if(H.canvas=z,H.image=new UIImage(z,U),H.image.hAlign="center",H.image.vAlign="center",H.image.positionX=R||0,H.image.positionY=O?O+80:80,H.image.width=V?48*V:48,H.image.height=V?64*V:64,S(H.image,wt.TimerLarge),E&&0!=E){var G=new Entity;engine.addEntity(G),G.addComponentOrReplace(new A(E||3,(function(){H.hide()})))}return H}return i(e,T),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity);function q(T){return T&&"object"==typeof T&&!Array.isArray(T)}function j(T,A){var E=o({},T);return q(T)&&q(A)&&Object.keys(A).forEach((function(R){var z,O;q(A[R])?R in T?E[R]=j(T[R],A[R]):E=o(o({},E),((z={})[R]=A[R],z)):E=o(o({},E),((O={})[R]=A[R],O))})),E}var $t=function(){function t(T,A){this.shape=T,A&&this.setProperties(A)}return t.prototype.setProperties=function(T){var A,E;try{for(var R=r(Object.keys(T)),z=R.next();!z.done;z=R.next()){var O=z.value;this.shape[O]=T[O]}}catch(T){A={error:T}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},t.prototype.getProperty=function(T){return this.shape[T]},t}(),ee=function(T){function e(A,E){var R,z,O,V,U=T.call(this,new UIInputText(A),o(o({},E),{placeholder:null!==(R=null==E?void 0:E.placeholder)&&void 0!==R?R:null==E?void 0:E.value,placeholderColor:null!==(z=null==E?void 0:E.placeholderColor)&&void 0!==z?z:null==E?void 0:E.color,onFocus:new OnFocus((function(){var T;U.isInputFocused=!0,null===(T=null==E?void 0:E.onFocus)||void 0===T||T.call(E)})),onBlur:new OnBlur((function(){var T,A;U.isInputFocused=!1,""===U.inputValue&&void 0!==U.placeholder?(U.setInputValue(U.placeholder),null===(T=null==E?void 0:E.onBlur)||void 0===T||T.call(E,!0)):null===(A=null==E?void 0:E.onBlur)||void 0===A||A.call(E,!1)})),onChanged:new OnChanged((function(T){var A,R=T.value;if(U.shape.visible)if(U.inputValue=R,R===U.placeholder)U.shape.placeholderColor=U.placeholderColor;else if(""===R&&(U.shape.placeholderColor=U.color,U.shape.placeholder=""),U.isInputFocused||""===R){var z=null!==(A=null==E?void 0:E.waitTime)&&void 0!==A?A:e.DEFAULT_WAIT_TIME;setTimeout((function(){var T;U.inputValue===R&&(null===(T=null==E?void 0:E.onChanged)||void 0===T||T.call(E,R))}),z)}})),onTextSubmit:new OnTextSubmit((function(T){var A=T.text,R=A.substr(0,A.length-1),z=null==E?void 0:E.onTextSubmit;z?z(R):setTimeout((function(){return U.shape.placeholder=R}),0)}))}))||this;return U.inputValue="",U.isInputFocused=!1,U.placeholder=U.shape.placeholder,U.color=U.shape.color,U.placeholderColor=U.shape.placeholderColor,U.inputValue=null!==(O=null==E?void 0:E.value)&&void 0!==O?O:null!==(V=null==E?void 0:E.placeholder)&&void 0!==V?V:"",U.isInputFocused=!1,U}return i(e,T),e.prototype.getValue=function(){return this.inputValue},e.prototype.isFocused=function(){return this.isInputFocused},e.prototype.setInputValue=function(T){var A=this.isInputFocused;this.isInputFocused=!1,this.shape.placeholder="",this.inputValue=this.shape.placeholder=T,this.isInputFocused=A},e.prototype.reset=function(){this.setInputValue(this.placeholder)},e.prototype.hide=function(){this.setProperties({visible:!1})},e.prototype.show=function(){this.setProperties({visible:!0}),this.setInputValue(this.inputValue)},e.DEFAULT_WAIT_TIME=650,e}($t),ne=function(T){function e(A,E){var R=T.call(this,new UIContainerRect(A),o({isPointerBlocker:!0},E))||this,z=new UIImage(R.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));return z.width="100%",z.height="100%",z.sourceWidth=1,z.sourceHeight=1,z.isPointerBlocker=!0,R.image=z,(null==E?void 0:E.onClick)&&R.setOnClick(E.onClick),R}return i(e,T),e.prototype.performClick=function(){var T;null===(T=this.image.onClick)||void 0===T||T.callback({})},e.prototype.setOnClick=function(T){this.image.onClick=new OnClick(T)},e.prototype.clearOnClick=function(){this.image.onClick=null},e}($t),oe=function(T){function e(A,E){var R=T.call(this,new UIContainerRect(A),o({width:"100%",vAlign:"top",visible:!1},E))||this;R.config=o(o({},e.DEFAULTS),E);var z=new ne(R.shape,{width:"100%",height:"100%",color:Color4.Clear()});R.clickableContainer=z;var O=new UIImage(z.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));O.width=O.height=R.config.imageSize,O.hAlign="left",O.positionX=10,O.vAlign="center",R.image=O;var V=new UIText(z.shape);V.vAlign="top",V.hAlign="left",V.vTextAlign="top",V.fontSize=R.config.topFontSize,V.color=R.config.topTextColor,V.positionX=55,V.positionY=-10,V.isPointerBlocker=!1,R.topLeftText=V;var U=new UIText(z.shape);U.vAlign="top",U.hAlign="right",U.vTextAlign="top",U.hTextAlign="right",U.fontSize=V.fontSize,U.color=V.color,U.isPointerBlocker=!1,U.positionX=-10,U.positionY=V.positionY,R.topRightText=U;var H=new UIText(z.shape);H.vAlign="bottom",H.hAlign="left",H.vTextAlign="bottom",H.fontSize=R.config.bottomFontSize,H.color=R.config.bottomTextColor,H.positionX=V.positionX,H.positionY=10,H.isPointerBlocker=!1,R.bottomLeftText=H;var G=new UIText(z.shape);return G.vAlign="bottom",G.hAlign="right",G.vTextAlign="bottom",G.hTextAlign="right",G.fontSize=H.fontSize,G.color=H.color,G.isPointerBlocker=!1,G.positionX=U.positionX,G.positionY=H.positionY,R.bottomRightText=G,R}return i(e,T),e.prototype.setOption=function(T,A){this.image.visible=!1,this.topRightText.visible=!1,this.bottomLeftText.visible=!1,this.bottomRightText.visible=!1,T.image?(this.image.source=new Texture(T.image.src),this.image.sourceWidth=T.image.sourceWidth,this.image.sourceHeight=T.image.sourceHeight,this.image.visible=!0,this.topLeftText.positionX=this.config.imageSize+20):this.topLeftText.positionX=10,"string"==typeof T.visualText?(this.topLeftText.value=T.visualText,this.topLeftText.vAlign=this.topLeftText.vTextAlign="center",this.topLeftText.positionY=0):"text"in T.visualText?(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=T.visualText.text,this.bottomLeftText.value=T.visualText.subText,this.bottomLeftText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX):"bottomLeft"in T.visualText&&(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=T.visualText.topLeft,this.topRightText.value=T.visualText.topRight,this.bottomLeftText.value=T.visualText.bottomLeft,this.bottomRightText.value=T.visualText.bottomRight,this.topRightText.visible=!0,this.bottomLeftText.visible=!0,this.bottomRightText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX),A?this.clickableContainer.setOnClick(A):this.clickableContainer.clearOnClick()},e.prototype.setProperties=function(A){T.prototype.setProperties.call(this,A)},e.prototype.getProperty=function(A){return T.prototype.getProperty.call(this,A)},e.prototype.performClick=function(){this.clickableContainer.performClick()},e.DEFAULTS={topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},e}($t),ie=function(T){function e(A,E,R,z){var O=T.call(this,new UIContainerRect(A),o({},R))||this;O.onSuccessfulSelection=z,O.uiOptions=[],O.options={},R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var V=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=j(e.DEFAULTS,V),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor}),O.setItems(E.items,E.dropdownDefaultItemIds);var H=new UIContainerRect(O.shape);H.color=O.config.backgroundColor,H.width=O.config.width-2*O.config.borderSize,H.height=O.config.initialHeight-2*O.config.borderSize,O.insideContainer=H;var G=new ee(H,{vAlign:"top",hTextAlign:"left",vTextAlign:"center",width:"92%",fontSize:O.config.search.fontSize,placeholder:O.config.search.placeholder.defaultText,placeholderColor:O.config.search.placeholder.textColor,color:O.config.search.textColor,focusedBackground:Color4.Clear(),background:Color4.Clear(),height:.95*O.config.initialHeight,onBlur:function(){return O.close()},onTextSubmit:function(){O.uiOptions[0].getProperty("visible")?O.uiOptions[0].performClick():O.close()},onChanged:function(T){if(O.hideAllOptions(),T===O.config.search.placeholder.defaultText||""===T)O.showDefaultOptions();else{var A=T.toLowerCase(),E=[];for(var R in O.options){var z=O.options[R];if(z.searchBy.toLowerCase().indexOf(A)>=0&&(E.push(z),E.length===O.config.options.maxVisibleOptions))break}E.length>0?O.showOptions(E):O.showErrorMessage("Sorry, we can't find \""+T+'"')}}});O.inputText=G;for(var X=0;X<O.config.options.maxVisibleOptions;X++){var Q=new oe(H,o(o({},O.config.options),{height:O.config.initialHeight,positionY:-O.config.initialHeight-O.config.initialHeight*X,color:X%2==0?O.config.options.oddBackgroundColor:H.color}));O.uiOptions.push(Q)}var Z=new UIImage(H,U);Z.onClick=new OnClick((function(){return O.close()})),Z.sourceTop=305,Z.sourceLeft=985,Z.sourceWidth=Z.sourceHeight=35,Z.width=Z.height=18,Z.hAlign="right",Z.vAlign="top",Z.positionX=-12,Z.positionY=-12,Z.visible=Z.isPointerBlocker=!0;var K=new UIText(H);return K.height=20,K.visible=!1,K.width="92%",K.hTextAlign="center",K.vAlign="bottom",K.positionY=20,K.fontSize=O.config.errorMessage.fontSize,K.color=O.config.errorMessage.textColor,O.errorMessage=K,O}return i(e,T),e.prototype.open=function(){this.setProperties({visible:!0}),this.showDefaultOptions()},e.prototype.close=function(){this.setProperties({visible:!1}),this.inputText.reset()},e.prototype.setItems=function(T,A){this.options=T.reduce((function(T,A){var E;return A.searchBy=null!==(E=A.searchBy)&&void 0!==E?E:"string"==typeof A.visualText?A.visualText:"text"in A.visualText?A.visualText.text:A.visualText.topLeft,T[A.id]=A,T}),{}),A?this.setDropdownDefaults(A):this.defaultOptions=A,this.hideAllOptions()},e.prototype.setDropdownDefaults=function(T){var A,E;try{for(var R=r(T),z=R.next();!z.done;z=R.next()){var O=z.value;if(!(O in this.options))return void error("Couldn't find an option with id '"+O+"'. Will not set new defaults")}}catch(T){A={error:T}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}this.defaultOptions=T},e.prototype.showDefaultOptions=function(){var T,A=this;if(this.defaultOptions)T=this.defaultOptions.map((function(T){return A.options[T]})).slice(0,this.config.options.maxVisibleOptions);else for(var E in T=[],this.options)if(T.push(this.options[E]),T.length===this.config.options.maxVisibleOptions)break;this.showOptions(T)},e.prototype.showOptions=function(T){var A=this;this.resizeHeight(this.config.initialHeight*T.length+2*this.config.borderSize),T.forEach((function(T,E){var R=A.uiOptions[E];R.setOption(T,(function(){A.onSuccessfulSelection(T),A.setProperties({visible:!1})})),R.setProperties({visible:!0})})),this.errorMessage.visible=!1},e.prototype.hideAllOptions=function(){this.uiOptions.forEach((function(T){return T.setProperties({visible:!1})}))},e.prototype.showErrorMessage=function(T){this.errorMessage.visible=!0,this.errorMessage.value=T,this.resizeHeight(60)},e.prototype.resizeHeight=function(T){this.setProperties({height:this.config.initialHeight+T}),this.insideContainer.height=this.config.initialHeight+T-2*this.config.borderSize},e.DEFAULTS={borderColor:Color4.FromInts(232,236,253,255),backgroundColor:Color4.White(),borderSize:2,width:300,initialHeight:60,search:{fontSize:16,textColor:Color4.FromInts(24,26,70,255),placeholder:{defaultText:"Click to search",textColor:Color4.FromInts(118,120,181,200)}},options:{maxVisibleOptions:5,oddBackgroundColor:Color4.FromInts(246,246,255,255),topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},errorMessage:{fontSize:13,textColor:Color4.FromInts(125,127,157,255)}},e}($t),re=function(T){function e(A,E,R,z){var O=T.call(this,new UIContainerRect(A),o({},R))||this;O.onSuccessfulSelection=z,R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var V=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=j(ie.DEFAULTS,V),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor});var U=new ne(O.shape,{color:O.config.backgroundColor,width:O.config.width-2*O.config.borderSize,height:O.config.initialHeight-2*O.config.borderSize,onClick:function(){return O.uiSearchPrompt.open()}}),H=new oe(U.shape,o(o({},O.config.options),{height:O.config.initialHeight,color:Color4.Clear(),width:O.config.width-2*O.config.borderSize-20,visible:!0,hAlign:"left",isPointerBlocker:!1})),G=new UIText(U.shape);if(G.value="Click to select an option",G.fontSize=O.config.search.fontSize,G.color=O.config.search.placeholder.textColor,G.vTextAlign=G.hTextAlign="center",G.positionX=-O.config.borderSize-10,G.isPointerBlocker=!1,G.opacity=G.color.a,O.initialText=G,null==E?void 0:E.initialItemId){var X=E.items.filter((function(T){return T.id===E.initialItemId}))[0];X&&(H.setOption(X),O.initialText.visible=!1)}var Q=new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAN5AAADeQELGyzWAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlQTFRF////AAAAAAAAflGpXQAAAAJ0Uk5TAICbK04YAAAAeklEQVQ4je3PsRXEMAgE0VFCEapG9agaiiDRVXkJxlpq8IYT/AfwTbZ/ssPUEJgGZ2hYDTmgSIAiDoqsdskBRQIUcVBktXdO/jeVuBDPMBpRyEMUEhVMiUKKSOQlEokrmBKJXARsJWAqAaYEjEbAVgJmtGDewmjEt9wfISOqAUzY2sAAAAAASUVORK5CYII="),Z=new UIImage(U.shape,Q);return Z.sourceWidth=Z.sourceHeight=64,Z.height=15,Z.width=12,Z.hAlign="right",Z.vAlign="center",Z.positionX=-10,Z.visible=!0,Z.isPointerBlocker=!1,O.uiSearchPrompt=new ie(O.shape,E,o(o({},R),{visible:!1,vAlign:"top",initialHeight:O.config.initialHeight-2*O.config.borderSize}),(function(T){H.setOption(T),O.initialText.visible=!1,O.onSuccessfulSelection(T)})),O}return i(e,T),e.prototype.open=function(){this.setProperties({visible:!0})},e.prototype.close=function(){this.setProperties({visible:!1})},e.prototype.setSearchItems=function(T,A){this.uiSearchPrompt.setItems(T,A)},e.prototype.setSearchDropdownDefaults=function(T){this.uiSearchPrompt.setDropdownDefaults(T)},e}($t);T.CenterImage=qt,T.CornerLabel=Zt,T.CustomPrompt=Ut,T.CustomPromptButton=Ht,T.CustomPromptCheckBox=jt,T.CustomPromptIcon=Xt,T.CustomPromptSwitch=Gt,T.CustomPromptText=Yt,T.CustomPromptTextBox=Qt,T.FillInPrompt=Wt,T.LargeIcon=kt,T.LoadingIcon=Jt,T.MediumIcon=Mt,T.OkPrompt=Dt,T.OptionPrompt=Vt,T.SFFont=O,T.SFHeavyFont=V,T.SmallIcon=Nt,T.UIBar=Lt,T.UICounter=$,T.UISearchPrompt=ie,T.UISelectBox=re,T.canvas=z,T.darkTheme=H,T.displayAnnouncement=function(T,E,R,z,O){G.visible=!0,G.value=T,G.color=R||Color4.Yellow(),G.fontSize=z||50,G.font=V,G.outlineColor=Color4.Black(),G.outlineWidth=O?0:.1,G.adaptWidth=!1,G.textWrapping=!0,G.width=900;var U=new Entity;engine.addEntity(U),-1!=E&&U.addComponentOrReplace(new A(E||3,(function(){G.visible=!1})))},T.hideAnnouncements=function(){G.visible=!1},T.lightTheme=U,Object.defineProperty(T,"__esModule",{value:!0})}));var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(T){for(var A,E=1,R=arguments.length;E<R;E++)for(var z in A=arguments[E])Object.prototype.hasOwnProperty.call(A,z)&&(T[z]=A[z]);return T},__assign.apply(this,arguments)},__values=this&&this.__values||function(T){var A="function"==typeof Symbol&&Symbol.iterator,E=A&&T[A],R=0;if(E)return E.call(T);if(T&&"number"==typeof T.length)return{next:function(){return T&&R>=T.length&&(T=void 0),{value:T&&T[R++],done:!T}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(T){var A;"object"==typeof exports&&"undefined"!=typeof module?module.exports=T():("undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self),A.CANNON=T())}((function(){return function e(T,A,E){function d(z,O){if(!A[z]){if(!T[z]){var V="function"==typeof require&&require;if(!O&&V)return V(z,!0);if(R)return R(z,!0);throw new Error("Cannot find module '"+z+"'")}var U=A[z]={exports:{}};T[z][0].call(U.exports,(function(A){return d(T[z][1][A]||A)}),U,U.exports,e,T,A,E)}return A[z].exports}for(var R="function"==typeof require&&require,z=0;z<E.length;z++)d(E[z]);return d}({1:[function(T,A){A.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(T,A){A.exports={version:T("../package.json").version,AABB:T("./collision/AABB"),ArrayCollisionMatrix:T("./collision/ArrayCollisionMatrix"),Body:T("./objects/Body"),Box:T("./shapes/Box"),Broadphase:T("./collision/Broadphase"),Constraint:T("./constraints/Constraint"),ContactEquation:T("./equations/ContactEquation"),Narrowphase:T("./world/Narrowphase"),ConeTwistConstraint:T("./constraints/ConeTwistConstraint"),ContactMaterial:T("./material/ContactMaterial"),ConvexPolyhedron:T("./shapes/ConvexPolyhedron"),Cylinder:T("./shapes/Cylinder"),DistanceConstraint:T("./constraints/DistanceConstraint"),Equation:T("./equations/Equation"),EventTarget:T("./utils/EventTarget"),FrictionEquation:T("./equations/FrictionEquation"),GSSolver:T("./solver/GSSolver"),GridBroadphase:T("./collision/GridBroadphase"),Heightfield:T("./shapes/Heightfield"),HingeConstraint:T("./constraints/HingeConstraint"),LockConstraint:T("./constraints/LockConstraint"),Mat3:T("./math/Mat3"),Material:T("./material/Material"),NaiveBroadphase:T("./collision/NaiveBroadphase"),ObjectCollisionMatrix:T("./collision/ObjectCollisionMatrix"),Pool:T("./utils/Pool"),Particle:T("./shapes/Particle"),Plane:T("./shapes/Plane"),PointToPointConstraint:T("./constraints/PointToPointConstraint"),Quaternion:T("./math/Quaternion"),Ray:T("./collision/Ray"),RaycastVehicle:T("./objects/RaycastVehicle"),RaycastResult:T("./collision/RaycastResult"),RigidVehicle:T("./objects/RigidVehicle"),RotationalEquation:T("./equations/RotationalEquation"),RotationalMotorEquation:T("./equations/RotationalMotorEquation"),SAPBroadphase:T("./collision/SAPBroadphase"),SPHSystem:T("./objects/SPHSystem"),Shape:T("./shapes/Shape"),Solver:T("./solver/Solver"),Sphere:T("./shapes/Sphere"),SplitSolver:T("./solver/SplitSolver"),Spring:T("./objects/Spring"),Trimesh:T("./shapes/Trimesh"),Vec3:T("./math/Vec3"),Vec3Pool:T("./utils/Vec3Pool"),World:T("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(T,A){function n(T){T=T||{},this.lowerBound=new E,T.lowerBound&&this.lowerBound.copy(T.lowerBound),this.upperBound=new E,T.upperBound&&this.upperBound.copy(T.upperBound)}var E=T("../math/Vec3");T("../utils/Utils"),A.exports=n;var R=new E;n.prototype.setFromPoints=function(T,A,E,z){var O=this.lowerBound,V=this.upperBound,U=E;O.copy(T[0]),U&&U.vmult(O,O),V.copy(O);for(var H=1;H<T.length;H++){var G=T[H];U&&(U.vmult(G,R),G=R),G.x>V.x&&(V.x=G.x),G.x<O.x&&(O.x=G.x),G.y>V.y&&(V.y=G.y),G.y<O.y&&(O.y=G.y),G.z>V.z&&(V.z=G.z),G.z<O.z&&(O.z=G.z)}return A&&(A.vadd(O,O),A.vadd(V,V)),z&&(O.x-=z,O.y-=z,O.z-=z,V.x+=z,V.y+=z,V.z+=z),this},n.prototype.copy=function(T){return this.lowerBound.copy(T.lowerBound),this.upperBound.copy(T.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(T){var A=T.lowerBound.x;this.lowerBound.x>A&&(this.lowerBound.x=A);var E=T.upperBound.x;this.upperBound.x<E&&(this.upperBound.x=E),A=T.lowerBound.y,this.lowerBound.y>A&&(this.lowerBound.y=A),E=T.upperBound.y,this.upperBound.y<E&&(this.upperBound.y=E),A=T.lowerBound.z,this.lowerBound.z>A&&(this.lowerBound.z=A),E=T.upperBound.z,this.upperBound.z<E&&(this.upperBound.z=E)},n.prototype.overlaps=function(T){var A=this.lowerBound,E=this.upperBound,R=T.lowerBound,z=T.upperBound;return(R.x<=E.x&&E.x<=z.x||A.x<=z.x&&z.x<=E.x)&&(R.y<=E.y&&E.y<=z.y||A.y<=z.y&&z.y<=E.y)&&(R.z<=E.z&&E.z<=z.z||A.z<=z.z&&z.z<=E.z)},n.prototype.contains=function(T){var A=this.lowerBound,E=this.upperBound,R=T.lowerBound,z=T.upperBound;return A.x<=R.x&&E.x>=z.x&&A.y<=R.y&&E.y>=z.y&&A.z<=R.z&&E.z>=z.z},n.prototype.getCorners=function(T,A,E,R,z,O,V,U){var H=this.lowerBound,G=this.upperBound;T.copy(H),A.set(G.x,H.y,H.z),E.set(G.x,G.y,H.z),R.set(H.x,G.y,G.z),z.set(G.x,H.y,H.z),O.set(H.x,G.y,H.z),V.set(H.x,H.y,G.z),U.copy(G)};var z=[new E,new E,new E,new E,new E,new E,new E,new E];n.prototype.toLocalFrame=function(T,A){var E=z,R=E[0],O=E[1],V=E[2],U=E[3],H=E[4],G=E[5],X=E[6],Q=E[7];this.getCorners(R,O,V,U,H,G,X,Q);for(var Z=0;8!==Z;Z++){var K=E[Z];T.pointToLocal(K,K)}return A.setFromPoints(E)},n.prototype.toWorldFrame=function(T,A){var E=z,R=E[0],O=E[1],V=E[2],U=E[3],H=E[4],G=E[5],X=E[6],Q=E[7];this.getCorners(R,O,V,U,H,G,X,Q);for(var Z=0;8!==Z;Z++){var K=E[Z];T.pointToWorld(K,K)}return A.setFromPoints(E)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(T,A){function n(){this.matrix=[]}A.exports=n,n.prototype.get=function(T,A){if(T=T.index,(A=A.index)>T){var E=A;A=T,T=E}return this.matrix[(T*(T+1)>>1)+A-1]},n.prototype.set=function(T,A,E){if(T=T.index,(A=A.index)>T){var R=A;A=T,T=R}this.matrix[(T*(T+1)>>1)+A-1]=E?1:0},n.prototype.reset=function(){for(var T=0,A=this.matrix.length;T!==A;T++)this.matrix[T]=0},n.prototype.setNumObjects=function(T){this.matrix.length=T*(T-1)>>1}},{}],5:[function(T,A){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var E=T("../objects/Body"),R=T("../math/Vec3"),z=T("../math/Quaternion");T("../shapes/Shape"),T("../shapes/Plane"),A.exports=n,n.prototype.collisionPairs=function(){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var O=E.STATIC|E.KINEMATIC;n.prototype.needBroadphaseCollision=function(T,A){return 0!=(T.collisionFilterGroup&A.collisionFilterMask)&&0!=(A.collisionFilterGroup&T.collisionFilterMask)&&(0==(T.type&O)&&T.sleepState!==E.SLEEPING||0==(A.type&O)&&A.sleepState!==E.SLEEPING)},n.prototype.intersectionTest=function(T,A,E,R){this.useBoundingBoxes?this.doBoundingBoxBroadphase(T,A,E,R):this.doBoundingSphereBroadphase(T,A,E,R)};var V=new R;new R,new z,new R,n.prototype.doBoundingSphereBroadphase=function(T,A,E,R){var z=V;A.position.vsub(T.position,z),Math.pow(T.boundingRadius+A.boundingRadius,2)>z.norm2()&&(E.push(T),R.push(A))},n.prototype.doBoundingBoxBroadphase=function(T,A,E,R){T.aabbNeedsUpdate&&T.computeAABB(),A.aabbNeedsUpdate&&A.computeAABB(),T.aabb.overlaps(A.aabb)&&(E.push(T),R.push(A))};var U={keys:[]},H=[],G=[];n.prototype.makePairsUnique=function(T,A){for(var E=U,R=H,z=G,O=T.length,V=0;V!==O;V++)R[V]=T[V],z[V]=A[V];for(T.length=0,A.length=0,V=0;V!==O;V++){var X=R[V].id,Q=z[V].id;E[Z=Q>X?X+","+Q:Q+","+X]=V,E.keys.push(Z)}for(V=0;V!==E.keys.length;V++){var Z=E.keys.pop(),K=E[Z];T.push(R[K]),A.push(z[K]),delete E[Z]}},n.prototype.setWorld=function(){};var X=new R;n.boundingSphereCheck=function(T,A){var E=X;return T.position.vsub(A.position,E),Math.pow(T.shape.boundingSphereRadius+A.shape.boundingSphereRadius,2)>E.norm2()},n.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(T,A){function n(T,A,z,O,V){E.apply(this),this.nx=z||10,this.ny=O||10,this.nz=V||10,this.aabbMin=T||new R(100,100,100),this.aabbMax=A||new R(-100,-100,-100);var U=this.nx*this.ny*this.nz;if(0>=U)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=U,this.binLengths.length=U;for(var H=0;U>H;H++)this.bins[H]=[],this.binLengths[H]=0}A.exports=n;var E=T("./Broadphase"),R=T("../math/Vec3"),z=T("../shapes/Shape");n.prototype=new E,n.prototype.constructor=n;var O=new R;new R,n.prototype.collisionPairs=function(T,A,E){function o(T,A,E,R,z,O,V){var U=(T-ot)*st|0,H=(A-it)*at|0,$=(E-rt)*lt|0,et=xt((R-ot)*st),nt=xt((z-it)*at),ut=xt((O-rt)*lt);0>U?U=0:U>=G&&(U=G-1),0>H?H=0:H>=X&&(H=X-1),0>$?$=0:$>=Q&&($=Q-1),0>et?et=0:et>=G&&(et=G-1),0>nt?nt=0:nt>=X&&(nt=X-1),0>ut?ut=0:ut>=Q&&(ut=Q-1),H*=K,$*=J,et*=Z,nt*=K,ut*=J;for(var ct=U*=Z;et>=ct;ct+=Z)for(var ht=H;nt>=ht;ht+=K)for(var pt=$;ut>=pt;pt+=J){var dt=ct+ht+pt;mt[dt][gt[dt]++]=V}}for(var R=T.numObjects(),V=T.bodies,U=this.aabbMax,H=this.aabbMin,G=this.nx,X=this.ny,Q=this.nz,Z=X*Q,K=Q,J=1,$=U.x,et=U.y,nt=U.z,ot=H.x,it=H.y,rt=H.z,st=G/($-ot),at=X/(et-it),lt=Q/(nt-rt),ut=($-ot)/G,ct=(et-it)/X,ht=(nt-rt)/Q,pt=.5*Math.sqrt(ut*ut+ct*ct+ht*ht),dt=z.types,ft=dt.SPHERE,vt=dt.PLANE,mt=(dt.BOX,dt.COMPOUND,dt.CONVEXPOLYHEDRON,this.bins),gt=this.binLengths,wt=this.bins.length,bt=0;bt!==wt;bt++)gt[bt]=0;var xt=Math.ceil;for(H=Math.min,U=Math.max,bt=0;bt!==R;bt++){var Tt=(Wt=V[bt]).shape;switch(Tt.type){case ft:var At=Wt.position.x,St=Wt.position.y,Et=Wt.position.z,Ct=Tt.radius;o(At-Ct,St-Ct,Et-Ct,At+Ct,St+Ct,Et+Ct,Wt);break;case vt:Tt.worldNormalNeedsUpdate&&Tt.computeWorldNormal(Wt.quaternion);var It=Tt.worldNormal,Rt=ot+.5*ut-Wt.position.x,_t=it+.5*ct-Wt.position.y,Pt=rt+.5*ht-Wt.position.z,zt=O;zt.set(Rt,_t,Pt);for(var Bt=0,Ot=0;Bt!==G;Bt++,Ot+=Z,zt.y=_t,zt.x+=ut)for(var Lt=0,Mt=0;Lt!==X;Lt++,Mt+=K,zt.z=Pt,zt.y+=ct)for(var Nt=0,kt=0;Nt!==Q;Nt++,kt+=J,zt.z+=ht)if(zt.dot(It)<pt){var qt=Ot+Mt+kt;mt[qt][gt[qt]++]=Wt}break;default:Wt.aabbNeedsUpdate&&Wt.computeAABB(),o(Wt.aabb.lowerBound.x,Wt.aabb.lowerBound.y,Wt.aabb.lowerBound.z,Wt.aabb.upperBound.x,Wt.aabb.upperBound.y,Wt.aabb.upperBound.z,Wt)}}for(bt=0;bt!==wt;bt++){var Dt=gt[bt];if(Dt>1){var Vt=mt[bt];for(Bt=0;Bt!==Dt;Bt++){var Wt=Vt[Bt];for(Lt=0;Lt!==Bt;Lt++){var Ut=Vt[Lt];this.needBroadphaseCollision(Wt,Ut)&&this.intersectionTest(Wt,Ut,A,E)}}}}this.makePairsUnique(A,E)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(T,A){function n(){E.apply(this)}A.exports=n;var E=T("./Broadphase"),R=T("./AABB");n.prototype=new E,n.prototype.constructor=n,n.prototype.collisionPairs=function(T,A,E){var R,z,O,V,U=T.bodies,H=U.length;for(R=0;R!==H;R++)for(z=0;z!==R;z++)O=U[R],V=U[z],this.needBroadphaseCollision(O,V)&&this.intersectionTest(O,V,A,E)},new R,n.prototype.aabbQuery=function(T,A,E){E=E||[];for(var R=0;R<T.bodies.length;R++){var z=T.bodies[R];z.aabbNeedsUpdate&&z.computeAABB(),z.aabb.overlaps(A)&&E.push(z)}return E}},{"./AABB":3,"./Broadphase":5}],8:[function(T,A){function n(){this.matrix={}}A.exports=n,n.prototype.get=function(T,A){if(T=T.id,(A=A.id)>T){var E=A;A=T,T=E}return T+"-"+A in this.matrix},n.prototype.set=function(T,A,E){if(T=T.id,(A=A.id)>T){var R=A;A=T,T=R}E?this.matrix[T+"-"+A]=!0:delete this.matrix[T+"-"+A]},n.prototype.reset=function(){this.matrix={}},n.prototype.setNumObjects=function(){}},{}],9:[function(T,A){function n(T,A){this.from=T?T.clone():new E,this.to=A?A.clone():new E,this._direction=new E,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new O,this.hasHit=!1,this.callback=function(){}}function o(T,A,E,R){R.vsub(A,mt),E.vsub(A,X),T.vsub(A,Q);var z,O,V=mt.dot(mt),U=mt.dot(X),H=mt.dot(Q),G=X.dot(X),Z=X.dot(Q);return(z=G*H-U*Z)>=0&&(O=V*Z-U*H)>=0&&V*G-U*U>z+O}A.exports=n;var E=T("../math/Vec3"),R=T("../math/Quaternion"),z=T("../math/Transform"),O=(T("../shapes/ConvexPolyhedron"),T("../shapes/Box"),T("../collision/RaycastResult")),V=T("../shapes/Shape"),U=T("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var H=new U,G=[];n.prototype.intersectWorld=function(T,A){return this.mode=A.mode||n.ANY,this.result=A.result||new O,this.skipBackfaces=!!A.skipBackfaces,this.collisionFilterMask=void 0!==A.collisionFilterMask?A.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==A.collisionFilterGroup?A.collisionFilterGroup:-1,A.from&&this.from.copy(A.from),A.to&&this.to.copy(A.to),this.callback=A.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(H),G.length=0,T.broadphase.aabbQuery(T,H,G),this.intersectBodies(G),this.hasHit};var X=new E,Q=new E;n.pointInTriangle=o;var Z=new E,K=new R;n.prototype.intersectBody=function(T,A){A&&(this.result=A,this._updateDirection());var E=this.checkCollisionResponse;if((!E||T.collisionResponse)&&0!=(this.collisionFilterGroup&T.collisionFilterMask)&&0!=(T.collisionFilterGroup&this.collisionFilterMask))for(var R=Z,z=K,O=0,V=T.shapes.length;V>O;O++){var U=T.shapes[O];if((!E||U.collisionResponse)&&(T.quaternion.mult(T.shapeOrientations[O],z),T.quaternion.vmult(T.shapeOffsets[O],R),R.vadd(T.position,R),this.intersectShape(U,z,R,T),this.result._shouldStop))break}},n.prototype.intersectBodies=function(T,A){A&&(this.result=A,this._updateDirection());for(var E=0,R=T.length;!this.result._shouldStop&&R>E;E++)this.intersectBody(T[E])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(T,A,E,R){var z=function(T,A,E){E.vsub(T,mt);var R=mt.dot(A);return A.mult(R,gt),gt.vadd(T,gt),E.distanceTo(gt)}(this.from,this._direction,E);if(!(z>T.boundingSphereRadius)){var O=this[T.type];O&&O.call(this,T,A,E,R)}};var J=(new E,new E,new E),$=new E,et=new E,nt=new E;new E,new O,n.prototype.intersectBox=function(T,A,E,R){return this.intersectConvex(T.convexPolyhedronRepresentation,A,E,R)},n.prototype[V.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(T,A,R,z){var O=this.from,V=this.to,U=this._direction,H=new E(0,0,1);A.vmult(H,H);var G=new E;O.vsub(R,G);var X=G.dot(H);if(V.vsub(R,G),!(X*G.dot(H)>0||O.distanceTo(V)<X)){var Q=H.dot(U);if(!(Math.abs(Q)<this.precision)){var Z=new E,K=new E,J=new E;O.vsub(R,Z);var $=-H.dot(Z)/Q;U.scale($,K),O.vadd(K,J),this.reportIntersection(H,J,T,z,-1)}}},n.prototype[V.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(T){var A=this.to,E=this.from;T.lowerBound.x=Math.min(A.x,E.x),T.lowerBound.y=Math.min(A.y,E.y),T.lowerBound.z=Math.min(A.z,E.z),T.upperBound.x=Math.max(A.x,E.x),T.upperBound.y=Math.max(A.y,E.y),T.upperBound.z=Math.max(A.z,E.z)};var ot={faceList:[0]};n.prototype.intersectHeightfield=function(T,A,R,O){var V=(T.data,T.elementSize,new E),U=new n(this.from,this.to);z.pointToLocalFrame(R,A,U.from,U.from),z.pointToLocalFrame(R,A,U.to,U.to);var H=[],G=null,X=null,Q=null,Z=null,K=T.getIndexOfPosition(U.from.x,U.from.y,H,!1);if(K&&(G=H[0],X=H[1],Q=H[0],Z=H[1]),(K=T.getIndexOfPosition(U.to.x,U.to.y,H,!1))&&((null===G||H[0]<G)&&(G=H[0]),(null===Q||H[0]>Q)&&(Q=H[0]),(null===X||H[1]<X)&&(X=H[1]),(null===Z||H[1]>Z)&&(Z=H[1])),null!==G){T.getRectMinMax(G,X,Q,Z,[]);for(var J=G;Q>=J;J++)for(var $=X;Z>=$;$++){if(this.result._shouldStop)return;if(T.getConvexTrianglePillar(J,$,!1),z.pointToWorldFrame(R,A,T.pillarOffset,V),this.intersectConvex(T.pillarConvex,A,V,O,ot),this.result._shouldStop)return;T.getConvexTrianglePillar(J,$,!0),z.pointToWorldFrame(R,A,T.pillarOffset,V),this.intersectConvex(T.pillarConvex,A,V,O,ot)}}},n.prototype[V.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var it=new E,rt=new E;n.prototype.intersectSphere=function(T,A,E,R){var z=this.from,O=this.to,V=T.radius,U=Math.pow(O.x-z.x,2)+Math.pow(O.y-z.y,2)+Math.pow(O.z-z.z,2),H=2*((O.x-z.x)*(z.x-E.x)+(O.y-z.y)*(z.y-E.y)+(O.z-z.z)*(z.z-E.z)),G=Math.pow(z.x-E.x,2)+Math.pow(z.y-E.y,2)+Math.pow(z.z-E.z,2)-Math.pow(V,2),X=Math.pow(H,2)-4*U*G,Q=it,Z=rt;if(!(0>X))if(0===X)z.lerp(O,X,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,T,R,-1);else{var K=(-H-Math.sqrt(X))/(2*U),J=(-H+Math.sqrt(X))/(2*U);if(K>=0&&1>=K&&(z.lerp(O,K,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,T,R,-1)),this.result._shouldStop)return;J>=0&&1>=J&&(z.lerp(O,J,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,T,R,-1))}},n.prototype[V.types.SPHERE]=n.prototype.intersectSphere;var st=new E,at=(new E,new E,new E);n.prototype.intersectConvex=function(T,A,E,R,z){for(var O=st,V=at,U=z&&z.faceList||null,H=T.faces,G=T.vertices,X=T.faceNormals,Q=this._direction,Z=this.from,K=this.to,ot=Z.distanceTo(K),it=U?U.length:H.length,rt=this.result,lt=0;!rt._shouldStop&&it>lt;lt++){var ut=U?U[lt]:lt,ct=H[ut],ht=X[ut],pt=A,dt=E;V.copy(G[ct[0]]),pt.vmult(V,V),V.vadd(dt,V),V.vsub(Z,V),pt.vmult(ht,O);var ft=Q.dot(O);if(!(Math.abs(ft)<this.precision)){var vt=O.dot(V)/ft;if(!(0>vt)){Q.mult(vt,J),J.vadd(Z,J),$.copy(G[ct[0]]),pt.vmult($,$),dt.vadd($,$);for(var mt=1;!rt._shouldStop&&mt<ct.length-1;mt++){et.copy(G[ct[mt]]),nt.copy(G[ct[mt+1]]),pt.vmult(et,et),pt.vmult(nt,nt),dt.vadd(et,et),dt.vadd(nt,nt);var gt=J.distanceTo(Z);!o(J,$,et,nt)&&!o(J,et,$,nt)||gt>ot||this.reportIntersection(O,J,T,R,ut)}}}}},n.prototype[V.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var lt=new E,ut=new E,ct=new E,ht=new E,pt=new E,dt=new E,ft=(new U,[]),vt=new z;n.prototype.intersectTrimesh=function(T,A,E,R,O){var V=lt,U=ft,H=vt,G=at,X=ut,Q=ct,Z=ht,K=dt,ot=pt,it=(O&&O.faceList,T.indices),rt=(T.vertices,T.faceNormals,this.from),st=this.to,mt=this._direction;H.position.copy(E),H.quaternion.copy(A),z.vectorToLocalFrame(E,A,mt,X),z.pointToLocalFrame(E,A,rt,Q),z.pointToLocalFrame(E,A,st,Z);var gt=Q.distanceSquared(Z);T.tree.rayQuery(this,H,U);for(var wt=0,bt=U.length;!this.result._shouldStop&&wt!==bt;wt++){var xt=U[wt];T.getNormal(xt,V),T.getVertex(it[3*xt],$),$.vsub(Q,G);var Tt=X.dot(V),At=V.dot(G)/Tt;if(!(0>At)){X.scale(At,J),J.vadd(Q,J),T.getVertex(it[3*xt+1],et),T.getVertex(it[3*xt+2],nt);var St=J.distanceSquared(Q);!o(J,et,$,nt)&&!o(J,$,et,nt)||St>gt||(z.vectorToWorldFrame(A,V,ot),z.pointToWorldFrame(E,A,J,K),this.reportIntersection(ot,K,T,R,xt))}}U.length=0},n.prototype[V.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(T,A,E,R,z){var O=this.from,V=this.to,U=O.distanceTo(A),H=this.result;if(!(this.skipBackfaces&&T.dot(this._direction)>0))switch(H.hitFaceIndex=void 0!==z?z:-1,this.mode){case n.ALL:this.hasHit=!0,H.set(O,V,T,A,E,R,U),H.hasHit=!0,this.callback(H);break;case n.CLOSEST:(U<H.distance||!H.hasHit)&&(this.hasHit=!0,H.hasHit=!0,H.set(O,V,T,A,E,R,U));break;case n.ANY:this.hasHit=!0,H.hasHit=!0,H.set(O,V,T,A,E,R,U),H._shouldStop=!0}};var mt=new E,gt=new E},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(T,A){function n(){this.rayFromWorld=new E,this.rayToWorld=new E,this.hitNormalWorld=new E,this.hitPointWorld=new E,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var E=T("../math/Vec3");A.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(T,A,E,R,z,O,V){this.rayFromWorld.copy(T),this.rayToWorld.copy(A),this.hitNormalWorld.copy(E),this.hitPointWorld.copy(R),this.shape=z,this.body=O,this.distance=V}},{"../math/Vec3":30}],11:[function(T,A){function n(T){E.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var A=this.axisList;this._addBodyHandler=function(T){A.push(T.body)},this._removeBodyHandler=function(T){var E=A.indexOf(T.body);-1!==E&&A.splice(E,1)},T&&this.setWorld(T)}var E=(T("../shapes/Shape"),T("../collision/Broadphase"));A.exports=n,n.prototype=new E,n.prototype.setWorld=function(T){this.axisList.length=0;for(var A=0;A<T.bodies.length;A++)this.axisList.push(T.bodies[A]);T.removeEventListener("addBody",this._addBodyHandler),T.removeEventListener("removeBody",this._removeBodyHandler),T.addEventListener("addBody",this._addBodyHandler),T.addEventListener("removeBody",this._removeBodyHandler),this.world=T,this.dirty=!0},n.insertionSortX=function(T){for(var A=1,E=T.length;E>A;A++){for(var R=T[A],z=A-1;z>=0&&!(T[z].aabb.lowerBound.x<=R.aabb.lowerBound.x);z--)T[z+1]=T[z];T[z+1]=R}return T},n.insertionSortY=function(T){for(var A=1,E=T.length;E>A;A++){for(var R=T[A],z=A-1;z>=0&&!(T[z].aabb.lowerBound.y<=R.aabb.lowerBound.y);z--)T[z+1]=T[z];T[z+1]=R}return T},n.insertionSortZ=function(T){for(var A=1,E=T.length;E>A;A++){for(var R=T[A],z=A-1;z>=0&&!(T[z].aabb.lowerBound.z<=R.aabb.lowerBound.z);z--)T[z+1]=T[z];T[z+1]=R}return T},n.prototype.collisionPairs=function(T,A,E){var R,z,O=this.axisList,V=O.length,U=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),R=0;R!==V;R++){var H=O[R];for(z=R+1;V>z;z++){var G=O[z];if(this.needBroadphaseCollision(H,G)){if(!n.checkBounds(H,G,U))break;this.intersectionTest(H,G,A,E)}}}},n.prototype.sortList=function(){for(var T=this.axisList,A=this.axisIndex,E=T.length,R=0;R!==E;R++){var z=T[R];z.aabbNeedsUpdate&&z.computeAABB()}0===A?n.insertionSortX(T):1===A?n.insertionSortY(T):2===A&&n.insertionSortZ(T)},n.checkBounds=function(T,A,E){var R,z;return 0===E?(R=T.position.x,z=A.position.x):1===E?(R=T.position.y,z=A.position.y):2===E&&(R=T.position.z,z=A.position.z),R+T.boundingRadius>z-A.boundingRadius},n.prototype.autoDetectAxis=function(){for(var T=0,A=0,E=0,R=0,z=0,O=0,V=this.axisList,U=V.length,H=1/U,G=0;G!==U;G++){var X=V[G],Q=X.position.x;T+=Q,A+=Q*Q;var Z=X.position.y;E+=Z,R+=Z*Z;var K=X.position.z;z+=K,O+=K*K}var J=A-T*T*H,$=R-E*E*H,et=O-z*z*H;this.axisIndex=J>$?J>et?0:2:$>et?1:2},n.prototype.aabbQuery=function(T,A,E){E=E||[],this.dirty&&(this.sortList(),this.dirty=!1);var R=this.axisIndex,z="x";1===R&&(z="y"),2===R&&(z="z");for(var O=this.axisList,V=(A.lowerBound[z],A.upperBound[z],0);V<O.length;V++){var U=O[V];U.aabbNeedsUpdate&&U.computeAABB(),U.aabb.overlaps(A)&&E.push(U)}return E}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(T,A){function n(T,A,V){var U=void 0!==(V=V||{}).maxForce?V.maxForce:1e6,H=V.pivotA?V.pivotA.clone():new O,G=V.pivotB?V.pivotB.clone():new O;this.axisA=V.axisA?V.axisA.clone():new O,this.axisB=V.axisB?V.axisB.clone():new O,E.call(this,T,H,A,G,U),this.collideConnected=!!V.collideConnected,this.angle=void 0!==V.angle?V.angle:0;var X=this.coneEquation=new R(T,A,V),Q=this.twistEquation=new z(T,A,V);this.twistAngle=void 0!==V.twistAngle?V.twistAngle:0,X.maxForce=0,X.minForce=-U,Q.maxForce=0,Q.minForce=-U,this.equations.push(X,Q)}A.exports=n;var E=(T("./Constraint"),T("./PointToPointConstraint")),R=T("../equations/ConeEquation"),z=T("../equations/RotationalEquation"),O=(T("../equations/ContactEquation"),T("../math/Vec3"));n.prototype=new E,n.constructor=n,new O,new O,n.prototype.update=function(){var T=this.bodyA,A=this.bodyB,R=this.coneEquation,z=this.twistEquation;E.prototype.update.call(this),T.vectorToWorldFrame(this.axisA,R.axisA),A.vectorToWorldFrame(this.axisB,R.axisB),this.axisA.tangents(z.axisA,z.axisA),T.vectorToWorldFrame(z.axisA,z.axisA),this.axisB.tangents(z.axisB,z.axisB),A.vectorToWorldFrame(z.axisB,z.axisB),R.angle=this.angle,z.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(T,A){function n(T,A,R){R=E.defaults(R,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=T,this.bodyB=A,this.id=n.idCounter++,this.collideConnected=R.collideConnected,R.wakeUpBodies&&(T&&T.wakeUp(),A&&A.wakeUp())}A.exports=n;var E=T("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var T=this.equations,A=0;A<T.length;A++)T[A].enabled=!0},n.prototype.disable=function(){for(var T=this.equations,A=0;A<T.length;A++)T[A].enabled=!1},n.idCounter=0},{"../utils/Utils":53}],14:[function(T,A){function n(T,A,z,O){E.call(this,T,A),void 0===z&&(z=T.position.distanceTo(A.position)),void 0===O&&(O=1e6),this.distance=z;var V=this.distanceEquation=new R(T,A);this.equations.push(V),V.minForce=-O,V.maxForce=O}A.exports=n;var E=T("./Constraint"),R=T("../equations/ContactEquation");n.prototype=new E,n.prototype.update=function(){var T=this.bodyA,A=this.bodyB,E=this.distanceEquation,R=.5*this.distance,z=E.ni;A.position.vsub(T.position,z),z.normalize(),z.mult(R,E.ri),z.mult(-R,E.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(T,A){function n(T,A,V){var U=void 0!==(V=V||{}).maxForce?V.maxForce:1e6,H=V.pivotA?V.pivotA.clone():new O,G=V.pivotB?V.pivotB.clone():new O;E.call(this,T,H,A,G,U),(this.axisA=V.axisA?V.axisA.clone():new O(1,0,0)).normalize(),(this.axisB=V.axisB?V.axisB.clone():new O(1,0,0)).normalize();var X=this.rotationalEquation1=new R(T,A,V),Q=this.rotationalEquation2=new R(T,A,V),Z=this.motorEquation=new z(T,A,U);Z.enabled=!1,this.equations.push(X,Q,Z)}A.exports=n;var E=(T("./Constraint"),T("./PointToPointConstraint")),R=T("../equations/RotationalEquation"),z=T("../equations/RotationalMotorEquation"),O=(T("../equations/ContactEquation"),T("../math/Vec3"));n.prototype=new E,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(T){this.motorEquation.targetVelocity=T},n.prototype.setMotorMaxForce=function(T){this.motorEquation.maxForce=T,this.motorEquation.minForce=-T};var V=new O,U=new O;n.prototype.update=function(){var T=this.bodyA,A=this.bodyB,R=this.motorEquation,z=this.rotationalEquation1,O=this.rotationalEquation2,H=V,G=U,X=this.axisA,Q=this.axisB;E.prototype.update.call(this),T.quaternion.vmult(X,H),A.quaternion.vmult(Q,G),H.tangents(z.axisA,O.axisA),z.axisB.copy(G),O.axisB.copy(G),this.motorEquation.enabled&&(T.quaternion.vmult(this.axisA,R.axisA),A.quaternion.vmult(this.axisB,R.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(T,A){function n(T,A,O){var V=void 0!==(O=O||{}).maxForce?O.maxForce:1e6,U=new z,H=new z,G=new z;T.position.vadd(A.position,G),G.scale(.5,G),A.pointToLocalFrame(G,H),T.pointToLocalFrame(G,U),E.call(this,T,U,A,H,V);var X=this.rotationalEquation1=new R(T,A,O),Q=this.rotationalEquation2=new R(T,A,O),Z=this.rotationalEquation3=new R(T,A,O);this.equations.push(X,Q,Z)}A.exports=n;var E=(T("./Constraint"),T("./PointToPointConstraint")),R=T("../equations/RotationalEquation"),z=(T("../equations/RotationalMotorEquation"),T("../equations/ContactEquation"),T("../math/Vec3"));n.prototype=new E,n.constructor=n,new z,new z,n.prototype.update=function(){var T=this.bodyA,A=this.bodyB,R=(this.motorEquation,this.rotationalEquation1),O=this.rotationalEquation2,V=this.rotationalEquation3;E.prototype.update.call(this),T.vectorToWorldFrame(z.UNIT_X,R.axisA),A.vectorToWorldFrame(z.UNIT_Y,R.axisB),T.vectorToWorldFrame(z.UNIT_Y,O.axisA),A.vectorToWorldFrame(z.UNIT_Z,O.axisB),T.vectorToWorldFrame(z.UNIT_Z,V.axisA),A.vectorToWorldFrame(z.UNIT_X,V.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(T,A){function n(T,A,O,V,U){E.call(this,T,O),U=void 0!==U?U:1e6,this.pivotA=A?A.clone():new z,this.pivotB=V?V.clone():new z;var H=this.equationX=new R(T,O),G=this.equationY=new R(T,O),X=this.equationZ=new R(T,O);this.equations.push(H,G,X),H.minForce=G.minForce=X.minForce=-U,H.maxForce=G.maxForce=X.maxForce=U,H.ni.set(1,0,0),G.ni.set(0,1,0),X.ni.set(0,0,1)}A.exports=n;var E=T("./Constraint"),R=T("../equations/ContactEquation"),z=T("../math/Vec3");n.prototype=new E,n.prototype.update=function(){var T=this.bodyA,A=this.bodyB,E=this.equationX,R=this.equationY,z=this.equationZ;T.quaternion.vmult(this.pivotA,E.ri),A.quaternion.vmult(this.pivotB,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),z.ri.copy(E.ri),z.rj.copy(E.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(T,A){function n(T,A,z){var O=void 0!==(z=z||{}).maxForce?z.maxForce:1e6;R.call(this,T,A,-O,O),this.axisA=z.axisA?z.axisA.clone():new E(1,0,0),this.axisB=z.axisB?z.axisB.clone():new E(0,1,0),this.angle=void 0!==z.angle?z.angle:0}A.exports=n;var E=T("../math/Vec3"),R=(T("../math/Mat3"),T("./Equation"));n.prototype=new R,n.prototype.constructor=n;var z=new E,O=new E;n.prototype.computeB=function(T){var A=this.a,E=this.b,R=this.axisA,V=this.axisB,U=z,H=O,G=this.jacobianElementA,X=this.jacobianElementB;return R.cross(V,U),V.cross(R,H),G.rotational.copy(H),X.rotational.copy(U),-(Math.cos(this.angle)-R.dot(V))*A-this.computeGW()*E-T*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(T,A){function n(T,A,z){z=void 0!==z?z:1e6,E.call(this,T,A,0,z),this.restitution=0,this.ri=new R,this.rj=new R,this.ni=new R}A.exports=n;var E=T("./Equation"),R=T("../math/Vec3");T("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var z=new R,O=new R,V=new R;n.prototype.computeB=function(T){var A=this.a,E=this.b,R=this.bi,U=this.bj,H=this.ri,G=this.rj,X=z,Q=O,Z=R.velocity,K=R.angularVelocity,J=(R.force,R.torque,U.velocity),$=U.angularVelocity,et=(U.force,U.torque,V),nt=this.jacobianElementA,ot=this.jacobianElementB,it=this.ni;H.cross(it,X),G.cross(it,Q),it.negate(nt.spatial),X.negate(nt.rotational),ot.spatial.copy(it),ot.rotational.copy(Q),et.copy(U.position),et.vadd(G,et),et.vsub(R.position,et),et.vsub(H,et);var rt=it.dot(et),st=this.restitution+1;return-rt*A-(st*J.dot(it)-st*Z.dot(it)+$.dot(Q)-K.dot(X))*E-T*this.computeGiMf()};var U=new R,H=new R,G=new R,X=new R,Q=new R;n.prototype.getImpactVelocityAlongNormal=function(){var T=U,A=H,E=G,R=X,z=Q;return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,R),this.bi.getVelocityAtWorldPoint(E,T),this.bj.getVelocityAtWorldPoint(R,A),T.vsub(A,z),this.ni.dot(z)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(T,A){function n(T,A,R,z){this.id=n.id++,this.minForce=void 0===R?-1e6:R,this.maxForce=void 0===z?1e6:z,this.bi=T,this.bj=A,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new E,this.jacobianElementB=new E,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}A.exports=n;var E=T("../math/JacobianElement"),R=T("../math/Vec3");n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(T,A,E){var R=A,z=T,O=E;this.a=4/(O*(1+4*R)),this.b=4*R/(1+4*R),this.eps=4/(O*O*z*(1+4*R))},n.prototype.computeB=function(T,A,E){var R=this.computeGW();return-this.computeGq()*T-R*A-this.computeGiMf()*E},n.prototype.computeGq=function(){var T=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,z=E.position,O=R.position;return T.spatial.dot(z)+A.spatial.dot(O)};var z=new R;n.prototype.computeGW=function(){var T=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,O=E.velocity,V=R.velocity,U=E.angularVelocity||z,H=R.angularVelocity||z;return T.multiplyVectors(O,U)+A.multiplyVectors(V,H)},n.prototype.computeGWlambda=function(){var T=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,O=E.vlambda,V=R.vlambda,U=E.wlambda||z,H=R.wlambda||z;return T.multiplyVectors(O,U)+A.multiplyVectors(V,H)};var O=new R,V=new R,U=new R,H=new R;n.prototype.computeGiMf=function(){var T=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,z=E.force,G=E.torque,X=R.force,Q=R.torque,Z=E.invMassSolve,K=R.invMassSolve;return E.invInertiaWorldSolve?E.invInertiaWorldSolve.vmult(G,U):U.set(0,0,0),R.invInertiaWorldSolve?R.invInertiaWorldSolve.vmult(Q,H):H.set(0,0,0),z.mult(Z,O),X.mult(K,V),T.multiplyVectors(O,U)+A.multiplyVectors(V,H)};var G=new R;n.prototype.computeGiMGt=function(){var T=this.jacobianElementA,A=this.jacobianElementB,E=this.bi,R=this.bj,z=E.invMassSolve,O=R.invMassSolve,V=E.invInertiaWorldSolve,U=R.invInertiaWorldSolve,H=z+O;return V&&(V.vmult(T.rotational,G),H+=G.dot(T.rotational)),U&&(U.vmult(A.rotational,G),H+=G.dot(A.rotational)),H};var X=new R;new R,new R,new R,new R,new R,n.prototype.addToWlambda=function(T){var A=this.jacobianElementA,E=this.jacobianElementB,R=this.bi,z=this.bj,O=X;A.spatial.mult(R.invMassSolve*T,O),R.vlambda.vadd(O,R.vlambda),E.spatial.mult(z.invMassSolve*T,O),z.vlambda.vadd(O,z.vlambda),R.invInertiaWorldSolve&&(R.invInertiaWorldSolve.vmult(A.rotational,O),O.mult(T,O),R.wlambda.vadd(O,R.wlambda)),z.invInertiaWorldSolve&&(z.invInertiaWorldSolve.vmult(E.rotational,O),O.mult(T,O),z.wlambda.vadd(O,z.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(T,A){function n(T,A,z){E.call(this,T,A,-z,z),this.ri=new R,this.rj=new R,this.t=new R}A.exports=n;var E=T("./Equation"),R=T("../math/Vec3");T("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var z=new R,O=new R;n.prototype.computeB=function(T){var A=(this.a,this.b),E=(this.bi,this.bj,this.ri),R=this.rj,V=z,U=O,H=this.t;E.cross(H,V),R.cross(H,U);var G=this.jacobianElementA,X=this.jacobianElementB;return H.negate(G.spatial),V.negate(G.rotational),X.spatial.copy(H),X.rotational.copy(U),-this.computeGW()*A-T*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(T,A){function n(T,A,z){var O=void 0!==(z=z||{}).maxForce?z.maxForce:1e6;R.call(this,T,A,-O,O),this.axisA=z.axisA?z.axisA.clone():new E(1,0,0),this.axisB=z.axisB?z.axisB.clone():new E(0,1,0),this.maxAngle=Math.PI/2}A.exports=n;var E=T("../math/Vec3"),R=(T("../math/Mat3"),T("./Equation"));n.prototype=new R,n.prototype.constructor=n;var z=new E,O=new E;n.prototype.computeB=function(T){var A=this.a,E=this.b,R=this.axisA,V=this.axisB,U=z,H=O,G=this.jacobianElementA,X=this.jacobianElementB;return R.cross(V,U),V.cross(R,H),G.rotational.copy(H),X.rotational.copy(U),-(Math.cos(this.maxAngle)-R.dot(V))*A-this.computeGW()*E-T*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(T,A){function n(T,A,z){z=void 0!==z?z:1e6,R.call(this,T,A,-z,z),this.axisA=new E,this.axisB=new E,this.targetVelocity=0}A.exports=n;var E=T("../math/Vec3"),R=(T("../math/Mat3"),T("./Equation"));n.prototype=new R,n.prototype.constructor=n,n.prototype.computeB=function(T){var A=(this.a,this.b),E=(this.bi,this.bj,this.axisA),R=this.axisB,z=this.jacobianElementA,O=this.jacobianElementB;return z.rotational.copy(E),R.negate(O.rotational),-(this.computeGW()-this.targetVelocity)*A-T*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(T,A){function n(T,A,R){R=E.defaults(R,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[T,A],this.friction=R.friction,this.restitution=R.restitution,this.contactEquationStiffness=R.contactEquationStiffness,this.contactEquationRelaxation=R.contactEquationRelaxation,this.frictionEquationStiffness=R.frictionEquationStiffness,this.frictionEquationRelaxation=R.frictionEquationRelaxation}var E=T("../utils/Utils");A.exports=n,n.idCounter=0},{"../utils/Utils":53}],25:[function(T,A){function n(T){var A="";"string"==typeof(T=T||{})?(A=T,T={}):"object"==typeof T&&(A=""),this.name=A,this.id=n.idCounter++,this.friction=void 0!==T.friction?T.friction:-1,this.restitution=void 0!==T.restitution?T.restitution:-1}A.exports=n,n.idCounter=0},{}],26:[function(T,A){function n(){this.spatial=new E,this.rotational=new E}A.exports=n;var E=T("./Vec3");n.prototype.multiplyElement=function(T){return T.spatial.dot(this.spatial)+T.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(T,A){return T.dot(this.spatial)+A.dot(this.rotational)}},{"./Vec3":30}],27:[function(T,A){function n(T){this.elements=T||[0,0,0,0,0,0,0,0,0]}A.exports=n;var E=T("./Vec3");n.prototype.identity=function(){var T=this.elements;T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=1,T[5]=0,T[6]=0,T[7]=0,T[8]=1},n.prototype.setZero=function(){var T=this.elements;T[0]=0,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=0,T[6]=0,T[7]=0,T[8]=0},n.prototype.setTrace=function(T){var A=this.elements;A[0]=T.x,A[4]=T.y,A[8]=T.z},n.prototype.getTrace=function(T){T=T||new E;var A=this.elements;T.x=A[0],T.y=A[4],T.z=A[8]},n.prototype.vmult=function(T,A){A=A||new E;var R=this.elements,z=T.x,O=T.y,V=T.z;return A.x=R[0]*z+R[1]*O+R[2]*V,A.y=R[3]*z+R[4]*O+R[5]*V,A.z=R[6]*z+R[7]*O+R[8]*V,A},n.prototype.smult=function(T){for(var A=0;A<this.elements.length;A++)this.elements[A]*=T},n.prototype.mmult=function(T,A){for(var E=A||new n,R=0;3>R;R++)for(var z=0;3>z;z++){for(var O=0,V=0;3>V;V++)O+=T.elements[R+3*V]*this.elements[V+3*z];E.elements[R+3*z]=O}return E},n.prototype.scale=function(T,A){A=A||new n;for(var E=this.elements,R=A.elements,z=0;3!==z;z++)R[3*z+0]=T.x*E[3*z+0],R[3*z+1]=T.y*E[3*z+1],R[3*z+2]=T.z*E[3*z+2];return A},n.prototype.solve=function(T,A){A=A||new E;for(var R=[],z=0;12>z;z++)R.push(0);var O;for(z=0;3>z;z++)for(O=0;3>O;O++)R[z+4*O]=this.elements[z+3*O];R[3]=T.x,R[7]=T.y,R[11]=T.z;var V,U,H=3,G=H;do{if(0===R[(z=G-H)+4*z])for(O=z+1;G>O;O++)if(0!==R[z+4*O]){V=4;do{R[(U=4-V)+4*z]+=R[U+4*O]}while(--V);break}if(0!==R[z+4*z])for(O=z+1;G>O;O++){var X=R[z+4*O]/R[z+4*z];V=4;do{R[(U=4-V)+4*O]=z>=U?0:R[U+4*O]-R[U+4*z]*X}while(--V)}}while(--H);if(A.z=R[11]/R[10],A.y=(R[7]-R[6]*A.z)/R[5],A.x=(R[3]-R[2]*A.z-R[1]*A.y)/R[0],isNaN(A.x)||isNaN(A.y)||isNaN(A.z)||1/0===A.x||1/0===A.y||1/0===A.z)throw"Could not solve equation! Got x=["+A.toString()+"], b=["+T.toString()+"], A=["+this.toString()+"]";return A},n.prototype.e=function(T,A,E){return void 0===E?this.elements[A+3*T]:void(this.elements[A+3*T]=E)},n.prototype.copy=function(T){for(var A=0;A<T.elements.length;A++)this.elements[A]=T.elements[A];return this},n.prototype.toString=function(){for(var T="",A=0;9>A;A++)T+=this.elements[A]+",";return T},n.prototype.reverse=function(T){T=T||new n;for(var A=[],E=0;18>E;E++)A.push(0);var R;for(E=0;3>E;E++)for(R=0;3>R;R++)A[E+6*R]=this.elements[E+3*R];A[3]=1,A[9]=0,A[15]=0,A[4]=0,A[10]=1,A[16]=0,A[5]=0,A[11]=0,A[17]=1;var z,O,V=3,U=V;do{if(0===A[(E=U-V)+6*E])for(R=E+1;U>R;R++)if(0!==A[E+6*R]){z=6;do{A[(O=6-z)+6*E]+=A[O+6*R]}while(--z);break}if(0!==A[E+6*E])for(R=E+1;U>R;R++){var H=A[E+6*R]/A[E+6*E];z=6;do{A[(O=6-z)+6*R]=E>=O?0:A[O+6*R]-A[O+6*E]*H}while(--z)}}while(--V);E=2;do{R=E-1;do{H=A[E+6*R]/A[E+6*E],z=6;do{A[(O=6-z)+6*R]=A[O+6*R]-A[O+6*E]*H}while(--z)}while(R--)}while(--E);E=2;do{H=1/A[E+6*E],z=6;do{A[(O=6-z)+6*E]=A[O+6*E]*H}while(--z)}while(E--);E=2;do{R=2;do{if(O=A[3+R+6*E],isNaN(O)||1/0===O)throw"Could not reverse! A=["+this.toString()+"]";T.e(E,R,O)}while(R--)}while(E--);return T},n.prototype.setRotationFromQuaternion=function(T){var A=T.x,E=T.y,R=T.z,z=T.w,O=A+A,V=E+E,U=R+R,H=A*O,G=A*V,X=A*U,Q=E*V,Z=E*U,K=R*U,J=z*O,$=z*V,et=z*U,nt=this.elements;return nt[0]=1-(Q+K),nt[1]=G-et,nt[2]=X+$,nt[3]=G+et,nt[4]=1-(H+K),nt[5]=Z-J,nt[6]=X-$,nt[7]=Z+J,nt[8]=1-(H+Q),this},n.prototype.transpose=function(T){for(var A=(T=T||new n).elements,E=this.elements,R=0;3!==R;R++)for(var z=0;3!==z;z++)A[3*R+z]=E[3*z+R];return T}},{"./Vec3":30}],28:[function(T,A){function n(T,A,E,R){this.x=void 0!==T?T:0,this.y=void 0!==A?A:0,this.z=void 0!==E?E:0,this.w=void 0!==R?R:1}A.exports=n;var E=T("./Vec3");n.prototype.set=function(T,A,E,R){this.x=T,this.y=A,this.z=E,this.w=R},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(T,A){var E=Math.sin(.5*A);this.x=T.x*E,this.y=T.y*E,this.z=T.z*E,this.w=Math.cos(.5*A)},n.prototype.toAxisAngle=function(T){T=T||new E,this.normalize();var A=2*Math.acos(this.w),R=Math.sqrt(1-this.w*this.w);return.001>R?(T.x=this.x,T.y=this.y,T.z=this.z):(T.x=this.x/R,T.y=this.y/R,T.z=this.z/R),[T,A]};var R=new E,z=new E;n.prototype.setFromVectors=function(T,A){if(T.isAntiparallelTo(A)){var E=R,O=z;T.tangents(E,O),this.setFromAxisAngle(E,Math.PI)}else{var V=T.cross(A);this.x=V.x,this.y=V.y,this.z=V.z,this.w=Math.sqrt(Math.pow(T.norm(),2)*Math.pow(A.norm(),2))+T.dot(A),this.normalize()}};var O=new E,V=new E,U=new E;n.prototype.mult=function(T,A){A=A||new n;var E=this.w,R=O,z=V,H=U;return R.set(this.x,this.y,this.z),z.set(T.x,T.y,T.z),A.w=E*T.w-R.dot(z),R.cross(z,H),A.x=E*z.x+T.w*R.x+H.x,A.y=E*z.y+T.w*R.y+H.y,A.z=E*z.z+T.w*R.z+H.z,A},n.prototype.inverse=function(T){var A=this.x,E=this.y,R=this.z,z=this.w;T=T||new n,this.conjugate(T);var O=1/(A*A+E*E+R*R+z*z);return T.x*=O,T.y*=O,T.z*=O,T.w*=O,T},n.prototype.conjugate=function(T){return(T=T||new n).x=-this.x,T.y=-this.y,T.z=-this.z,T.w=this.w,T},n.prototype.normalize=function(){var T=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===T?(this.x=0,this.y=0,this.z=0,this.w=0):(T=1/T,this.x*=T,this.y*=T,this.z*=T,this.w*=T)},n.prototype.normalizeFast=function(){var T=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===T?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=T,this.y*=T,this.z*=T,this.w*=T)},n.prototype.vmult=function(T,A){A=A||new E;var R=T.x,z=T.y,O=T.z,V=this.x,U=this.y,H=this.z,G=this.w,X=G*R+U*O-H*z,Q=G*z+H*R-V*O,Z=G*O+V*z-U*R,K=-V*R-U*z-H*O;return A.x=X*G+K*-V+Q*-H-Z*-U,A.y=Q*G+K*-U+Z*-V-X*-H,A.z=Z*G+K*-H+X*-U-Q*-V,A},n.prototype.copy=function(T){return this.x=T.x,this.y=T.y,this.z=T.z,this.w=T.w,this},n.prototype.toEuler=function(T,A){A=A||"YZX";var E,R,z,O=this.x,V=this.y,U=this.z,H=this.w;if("YZX"!==A)throw new Error("Euler order "+A+" not supported yet.");var G=O*V+U*H;if(G>.499&&(E=2*Math.atan2(O,H),R=Math.PI/2,z=0),-.499>G&&(E=-2*Math.atan2(O,H),R=-Math.PI/2,z=0),isNaN(E)){var X=O*O,Q=V*V,Z=U*U;E=Math.atan2(2*V*H-2*O*U,1-2*Q-2*Z),R=Math.asin(2*G),z=Math.atan2(2*O*H-2*V*U,1-2*X-2*Z)}T.y=E,T.z=R,T.x=z},n.prototype.setFromEuler=function(T,A,E,R){R=R||"XYZ";var z=Math.cos(T/2),O=Math.cos(A/2),V=Math.cos(E/2),U=Math.sin(T/2),H=Math.sin(A/2),G=Math.sin(E/2);return"XYZ"===R?(this.x=U*O*V+z*H*G,this.y=z*H*V-U*O*G,this.z=z*O*G+U*H*V,this.w=z*O*V-U*H*G):"YXZ"===R?(this.x=U*O*V+z*H*G,this.y=z*H*V-U*O*G,this.z=z*O*G-U*H*V,this.w=z*O*V+U*H*G):"ZXY"===R?(this.x=U*O*V-z*H*G,this.y=z*H*V+U*O*G,this.z=z*O*G+U*H*V,this.w=z*O*V-U*H*G):"ZYX"===R?(this.x=U*O*V-z*H*G,this.y=z*H*V+U*O*G,this.z=z*O*G-U*H*V,this.w=z*O*V+U*H*G):"YZX"===R?(this.x=U*O*V+z*H*G,this.y=z*H*V+U*O*G,this.z=z*O*G-U*H*V,this.w=z*O*V-U*H*G):"XZY"===R&&(this.x=U*O*V-z*H*G,this.y=z*H*V-U*O*G,this.z=z*O*G+U*H*V,this.w=z*O*V+U*H*G),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(T,A){function n(T){T=T||{},this.position=new E,T.position&&this.position.copy(T.position),this.quaternion=new R,T.quaternion&&this.quaternion.copy(T.quaternion)}var E=T("./Vec3"),R=T("./Quaternion");A.exports=n;var z=new R;n.pointToLocalFrame=function(T,A,R,O){return O=O||new E,R.vsub(T,O),A.conjugate(z),z.vmult(O,O),O},n.prototype.pointToLocal=function(T,A){return n.pointToLocalFrame(this.position,this.quaternion,T,A)},n.pointToWorldFrame=function(T,A,R,z){return z=z||new E,A.vmult(R,z),z.vadd(T,z),z},n.prototype.pointToWorld=function(T,A){return n.pointToWorldFrame(this.position,this.quaternion,T,A)},n.prototype.vectorToWorldFrame=function(T,A){return A=A||new E,this.quaternion.vmult(T,A),A},n.vectorToWorldFrame=function(T,A,E){return T.vmult(A,E),E},n.vectorToLocalFrame=function(T,A,R,z){return z=z||new E,A.w*=-1,A.vmult(R,z),A.w*=-1,z}},{"./Quaternion":28,"./Vec3":30}],30:[function(T,A){function n(T,A,E){this.x=T||0,this.y=A||0,this.z=E||0}A.exports=n;var E=T("./Mat3");n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(T,A){var E=T.x,R=T.y,z=T.z,O=this.x,V=this.y,U=this.z;return(A=A||new n).x=V*z-U*R,A.y=U*E-O*z,A.z=O*R-V*E,A},n.prototype.set=function(T,A,E){return this.x=T,this.y=A,this.z=E,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(T,A){return A?(A.x=T.x+this.x,A.y=T.y+this.y,void(A.z=T.z+this.z)):new n(this.x+T.x,this.y+T.y,this.z+T.z)},n.prototype.vsub=function(T,A){return A?(A.x=this.x-T.x,A.y=this.y-T.y,void(A.z=this.z-T.z)):new n(this.x-T.x,this.y-T.y,this.z-T.z)},n.prototype.crossmat=function(){return new E([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var T=this.x,A=this.y,E=this.z,R=Math.sqrt(T*T+A*A+E*E);if(R>0){var z=1/R;this.x*=z,this.y*=z,this.z*=z}else this.x=0,this.y=0,this.z=0;return R},n.prototype.unit=function(T){T=T||new n;var A=this.x,E=this.y,R=this.z,z=Math.sqrt(A*A+E*E+R*R);return z>0?(z=1/z,T.x=A*z,T.y=E*z,T.z=R*z):(T.x=1,T.y=0,T.z=0),T},n.prototype.norm=function(){var T=this.x,A=this.y,E=this.z;return Math.sqrt(T*T+A*A+E*E)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(T){var A=this.x,E=this.y,R=this.z,z=T.x,O=T.y,V=T.z;return Math.sqrt((z-A)*(z-A)+(O-E)*(O-E)+(V-R)*(V-R))},n.prototype.distanceSquared=function(T){var A=this.x,E=this.y,R=this.z,z=T.x,O=T.y,V=T.z;return(z-A)*(z-A)+(O-E)*(O-E)+(V-R)*(V-R)},n.prototype.mult=function(T,A){A=A||new n;var E=this.x,R=this.y,z=this.z;return A.x=T*E,A.y=T*R,A.z=T*z,A},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(T){return this.x*T.x+this.y*T.y+this.z*T.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(T){return(T=T||new n).x=-this.x,T.y=-this.y,T.z=-this.z,T};var R=new n,z=new n;n.prototype.tangents=function(T,A){var E=this.norm();if(E>0){var O=R,V=1/E;O.set(this.x*V,this.y*V,this.z*V);var U=z;Math.abs(O.x)<.9?(U.set(1,0,0),O.cross(U,T)):(U.set(0,1,0),O.cross(U,T)),O.cross(T,A)}else T.set(1,0,0),A.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(T){return this.x=T.x,this.y=T.y,this.z=T.z,this},n.prototype.lerp=function(T,A,E){var R=this.x,z=this.y,O=this.z;E.x=R+(T.x-R)*A,E.y=z+(T.y-z)*A,E.z=O+(T.z-O)*A},n.prototype.almostEquals=function(T,A){return void 0===A&&(A=1e-6),!(Math.abs(this.x-T.x)>A||Math.abs(this.y-T.y)>A||Math.abs(this.z-T.z)>A)},n.prototype.almostZero=function(T){return void 0===T&&(T=1e-6),!(Math.abs(this.x)>T||Math.abs(this.y)>T||Math.abs(this.z)>T)};var O=new n;n.prototype.isAntiparallelTo=function(T,A){return this.negate(O),O.almostEquals(T,A)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(T,A){function n(T){T=T||{},E.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new R,this.collisionFilterGroup="number"==typeof T.collisionFilterGroup?T.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof T.collisionFilterMask?T.collisionFilterMask:1,this.collisionResponse=!0,this.position=new R,T.position&&this.position.copy(T.position),this.previousPosition=new R,this.initPosition=new R,this.velocity=new R,T.velocity&&this.velocity.copy(T.velocity),this.initVelocity=new R,this.force=new R;var A="number"==typeof T.mass?T.mass:0;this.mass=A,this.invMass=A>0?1/A:0,this.material=T.material||null,this.linearDamping="number"==typeof T.linearDamping?T.linearDamping:.01,this.type=0>=A?n.STATIC:n.DYNAMIC,typeof T.type==typeof n.STATIC&&(this.type=T.type),this.allowSleep=void 0===T.allowSleep||T.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==T.sleepSpeedLimit?T.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==T.sleepTimeLimit?T.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new R,this.quaternion=new O,T.quaternion&&this.quaternion.copy(T.quaternion),this.initQuaternion=new O,this.angularVelocity=new R,T.angularVelocity&&this.angularVelocity.copy(T.angularVelocity),this.initAngularVelocity=new R,this.interpolatedPosition=new R,this.interpolatedQuaternion=new O,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new R,this.invInertia=new R,this.invInertiaWorld=new z,this.invMassSolve=0,this.invInertiaSolve=new R,this.invInertiaWorldSolve=new z,this.fixedRotation=void 0!==T.fixedRotation&&T.fixedRotation,this.angularDamping=void 0!==T.angularDamping?T.angularDamping:.01,this.aabb=new V,this.aabbNeedsUpdate=!0,this.wlambda=new R,T.shape&&this.addShape(T.shape),this.updateMassProperties()}A.exports=n;var E=T("../utils/EventTarget"),R=(T("../shapes/Shape"),T("../math/Vec3")),z=T("../math/Mat3"),O=T("../math/Quaternion"),V=(T("../material/Material"),T("../collision/AABB")),U=T("../shapes/Box");n.prototype=new E,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var T=this.sleepState;this.sleepState=0,T===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(T){if(this.allowSleep){var A=this.sleepState,E=this.velocity.norm2()+this.angularVelocity.norm2(),R=Math.pow(this.sleepSpeedLimit,2);A===n.AWAKE&&R>E?(this.sleepState=n.SLEEPY,this.timeLastSleepy=T,this.dispatchEvent(n.sleepyEvent)):A===n.SLEEPY&&E>R?this.wakeUp():A===n.SLEEPY&&T-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(T,A){return A=A||new R,T.vsub(this.position,A),this.quaternion.conjugate().vmult(A,A),A},n.prototype.vectorToLocalFrame=function(T,A){return A=A||new R,this.quaternion.conjugate().vmult(T,A),A},n.prototype.pointToWorldFrame=function(T,A){return A=A||new R,this.quaternion.vmult(T,A),A.vadd(this.position,A),A},n.prototype.vectorToWorldFrame=function(T,A){return A=A||new R,this.quaternion.vmult(T,A),A};var H=new R,G=new O;n.prototype.addShape=function(T,A,E){var z=new R,V=new O;return A&&z.copy(A),E&&V.copy(E),this.shapes.push(T),this.shapeOffsets.push(z),this.shapeOrientations.push(V),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var T=this.shapes,A=this.shapeOffsets,E=T.length,R=0,z=0;z!==E;z++){var O=T[z];O.updateBoundingSphereRadius();var V=A[z].norm(),U=O.boundingSphereRadius;V+U>R&&(R=V+U)}this.boundingRadius=R};var X=new V;n.prototype.computeAABB=function(){for(var T=this.shapes,A=this.shapeOffsets,E=this.shapeOrientations,R=T.length,z=H,O=G,V=this.quaternion,U=this.aabb,Q=X,Z=0;Z!==R;Z++){var K=T[Z];E[Z].mult(V,O),O.vmult(A[Z],z),z.vadd(this.position,z),K.calculateWorldAABB(z,O,Q.lowerBound,Q.upperBound),0===Z?U.copy(Q):U.extend(Q)}this.aabbNeedsUpdate=!1};var Q=new z,Z=new z;new z,n.prototype.updateInertiaWorld=function(T){var A=this.invInertia;if(A.x!==A.y||A.y!==A.z||T){var E=Q,R=Z;E.setRotationFromQuaternion(this.quaternion),E.transpose(R),E.scale(A,E),E.mmult(R,this.invInertiaWorld)}};var K=new R,J=new R;n.prototype.applyForce=function(T,A){if(this.type===n.DYNAMIC){var E=K;A.vsub(this.position,E);var R=J;E.cross(T,R),this.force.vadd(T,this.force),this.torque.vadd(R,this.torque)}};var $=new R,et=new R;n.prototype.applyLocalForce=function(T,A){if(this.type===n.DYNAMIC){var E=$,R=et;this.vectorToWorldFrame(T,E),this.pointToWorldFrame(A,R),this.applyForce(E,R)}};var nt=new R,ot=new R,it=new R;n.prototype.applyImpulse=function(T,A){if(this.type===n.DYNAMIC){var E=nt;A.vsub(this.position,E);var R=ot;R.copy(T),R.mult(this.invMass,R),this.velocity.vadd(R,this.velocity);var z=it;E.cross(T,z),this.invInertiaWorld.vmult(z,z),this.angularVelocity.vadd(z,this.angularVelocity)}};var rt=new R,st=new R;n.prototype.applyLocalImpulse=function(T,A){if(this.type===n.DYNAMIC){var E=rt,R=st;this.vectorToWorldFrame(T,E),this.pointToWorldFrame(A,R),this.applyImpulse(E,R)}};var at=new R;n.prototype.updateMassProperties=function(){var T=at;this.invMass=this.mass>0?1/this.mass:0;var A=this.inertia,E=this.fixedRotation;this.computeAABB(),T.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),U.calculateInertia(T,this.mass,A),this.invInertia.set(A.x>0&&!E?1/A.x:0,A.y>0&&!E?1/A.y:0,A.z>0&&!E?1/A.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(T,A){var E=new R;return T.vsub(this.position,E),this.angularVelocity.cross(E,A),this.velocity.vadd(A,A),A}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(T,A){function n(T){this.chassisBody=T.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==T.indexRightAxis?T.indexRightAxis:1,this.indexForwardAxis=void 0!==T.indexForwardAxis?T.indexForwardAxis:0,this.indexUpAxis=void 0!==T.indexUpAxis?T.indexUpAxis:2}function o(T,A,E,R,z){var O=0,V=E,U=$,H=et,G=nt;return T.getVelocityAtWorldPoint(V,U),A.getVelocityAtWorldPoint(V,H),U.vsub(H,G),(O=-R.dot(G)*(1/(d(T,E,R)+d(A,E,R))))>z&&(O=z),-z>O&&(O=-z),O}function d(T,A,E){var R=ot,z=it,O=rt,V=st;return A.vsub(T.position,R),R.cross(E,z),T.invInertiaWorld.vmult(z,V),V.cross(R,O),T.invMass+E.dot(O)}function i(T,A,E,R,z,O){if(z.norm2()>1.1)return 0;var V=at,U=lt,H=ut;return T.getVelocityAtWorldPoint(A,V),E.getVelocityAtWorldPoint(R,U),V.vsub(U,H),-.2*z.dot(H)*(1/(T.invMass+E.invMass))}var E=(T("./Body"),T("../math/Vec3")),R=T("../math/Quaternion"),z=(T("../collision/RaycastResult"),T("../collision/Ray")),O=T("../objects/WheelInfo");A.exports=n;var V=(new E,new E,new E,new E),U=new E,H=new E;new z,n.prototype.addWheel=function(T){var A=new O(T=T||{}),E=this.wheelInfos.length;return this.wheelInfos.push(A),E},n.prototype.setSteeringValue=function(T,A){this.wheelInfos[A].steering=T},new E,n.prototype.applyEngineForce=function(T,A){this.wheelInfos[A].engineForce=T},n.prototype.setBrake=function(T,A){this.wheelInfos[A].brake=T},n.prototype.addToWorld=function(T){this.constraints,T.add(this.chassisBody);var A=this;this.preStepCallback=function(){A.updateVehicle(T.dt)},T.addEventListener("preStep",this.preStepCallback),this.world=T},n.prototype.getVehicleAxisWorld=function(T,A){A.set(0===T?1:0,1===T?1:0,2===T?1:0),this.chassisBody.vectorToWorldFrame(A,A)},n.prototype.updateVehicle=function(T){for(var A=this.wheelInfos,R=A.length,z=this.chassisBody,O=0;R>O;O++)this.updateWheelTransform(O);this.currentVehicleSpeedKmHour=3.6*z.velocity.norm();var V=new E;for(this.getVehicleAxisWorld(this.indexForwardAxis,V),V.dot(z.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),O=0;R>O;O++)this.castRay(A[O]);this.updateSuspension(T);var U=new E,H=new E;for(O=0;R>O;O++){var G=(K=A[O]).suspensionForce;G>K.maxSuspensionForce&&(G=K.maxSuspensionForce),K.raycastResult.hitNormalWorld.scale(G*T,U),K.raycastResult.hitPointWorld.vsub(z.position,H),z.applyImpulse(U,K.raycastResult.hitPointWorld)}this.updateFriction(T);var X=new E,Q=new E,Z=new E;for(O=0;R>O;O++){var K=A[O];z.getVelocityAtWorldPoint(K.chassisConnectionPointWorld,Z);var J=1;if(1===this.indexUpAxis&&(J=-1),K.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,Q);var $=Q.dot(K.raycastResult.hitNormalWorld);K.raycastResult.hitNormalWorld.scale($,X),Q.vsub(X,Q);var et=Q.dot(Z);K.deltaRotation=J*et*T/K.radius}!K.sliding&&K.isInContact||0===K.engineForce||!K.useCustomSlidingRotationalSpeed||(K.deltaRotation=(K.engineForce>0?1:-1)*K.customSlidingRotationalSpeed*T),Math.abs(K.brake)>Math.abs(K.engineForce)&&(K.deltaRotation=0),K.rotation+=K.deltaRotation,K.deltaRotation*=.99}},n.prototype.updateSuspension=function(){for(var T=this.chassisBody.mass,A=this.wheelInfos,E=A.length,R=0;E>R;R++){var z=A[R];if(z.isInContact){var O,V=z.suspensionRestLength-z.suspensionLength;O=z.suspensionStiffness*V*z.clippedInvContactDotSuspension;var U=z.suspensionRelativeVelocity;O-=(0>U?z.dampingCompression:z.dampingRelaxation)*U,z.suspensionForce=O*T,z.suspensionForce<0&&(z.suspensionForce=0)}else z.suspensionForce=0}},n.prototype.removeFromWorld=function(T){this.constraints,T.remove(this.chassisBody),T.removeEventListener("preStep",this.preStepCallback),this.world=null};var G=new E,X=new E;n.prototype.castRay=function(T){var A=G,R=X;this.updateWheelTransformWorld(T);var z=this.chassisBody,O=-1,V=T.suspensionRestLength+T.radius;T.directionWorld.scale(V,A);var U=T.chassisConnectionPointWorld;U.vadd(A,R);var H=T.raycastResult;H.reset();var Q=z.collisionResponse;z.collisionResponse=!1,this.world.rayTest(U,R,H),z.collisionResponse=Q;var Z=H.body;if(T.raycastResult.groundObject=0,Z){O=H.distance,T.raycastResult.hitNormalWorld=H.hitNormalWorld,T.isInContact=!0;var K=H.distance;T.suspensionLength=K-T.radius;var J=T.suspensionRestLength-T.maxSuspensionTravel,$=T.suspensionRestLength+T.maxSuspensionTravel;T.suspensionLength<J&&(T.suspensionLength=J),T.suspensionLength>$&&(T.suspensionLength=$,T.raycastResult.reset());var et=T.raycastResult.hitNormalWorld.dot(T.directionWorld),nt=new E;z.getVelocityAtWorldPoint(T.raycastResult.hitPointWorld,nt);var ot=T.raycastResult.hitNormalWorld.dot(nt);if(et>=-.1)T.suspensionRelativeVelocity=0,T.clippedInvContactDotSuspension=10;else{var it=-1/et;T.suspensionRelativeVelocity=ot*it,T.clippedInvContactDotSuspension=it}}else T.suspensionLength=T.suspensionRestLength+0*T.maxSuspensionTravel,T.suspensionRelativeVelocity=0,T.directionWorld.scale(-1,T.raycastResult.hitNormalWorld),T.clippedInvContactDotSuspension=1;return O},n.prototype.updateWheelTransformWorld=function(T){T.isInContact=!1;var A=this.chassisBody;A.pointToWorldFrame(T.chassisConnectionPointLocal,T.chassisConnectionPointWorld),A.vectorToWorldFrame(T.directionLocal,T.directionWorld),A.vectorToWorldFrame(T.axleLocal,T.axleWorld)},n.prototype.updateWheelTransform=function(T){var A=V,E=U,z=H,O=this.wheelInfos[T];this.updateWheelTransformWorld(O),O.directionLocal.scale(-1,A),E.copy(O.axleLocal),A.cross(E,z),z.normalize(),E.normalize();var G=O.steering,X=new R;X.setFromAxisAngle(A,G);var Q=new R;Q.setFromAxisAngle(E,O.rotation);var Z=O.worldTransform.quaternion;this.chassisBody.quaternion.mult(X,Z),Z.mult(Q,Z),Z.normalize();var K=O.worldTransform.position;K.copy(O.directionWorld),K.scale(O.suspensionLength,K),K.vadd(O.chassisConnectionPointWorld,K)};var Q=[new E(1,0,0),new E(0,1,0),new E(0,0,1)];n.prototype.getWheelTransformWorld=function(T){return this.wheelInfos[T].worldTransform};var Z=new E,K=[],J=[];n.prototype.updateFriction=function(T){for(var A=Z,R=this.wheelInfos,z=R.length,O=this.chassisBody,V=J,U=K,H=0;z>H;H++)et=(ct=R[H]).raycastResult.body,ct.sideImpulse=0,ct.forwardImpulse=0,V[H]||(V[H]=new E),U[H]||(U[H]=new E);for(H=0;z>H;H++)if(et=(ct=R[H]).raycastResult.body){var G=U[H];this.getWheelTransformWorld(H).vectorToWorldFrame(Q[this.indexRightAxis],G);var X=ct.raycastResult.hitNormalWorld,$=G.dot(X);X.scale($,A),G.vsub(A,G),G.normalize(),X.cross(G,V[H]),V[H].normalize(),ct.sideImpulse=i(O,ct.raycastResult.hitPointWorld,et,ct.raycastResult.hitPointWorld,G),ct.sideImpulse*=1}for(this.sliding=!1,H=0;z>H;H++){var et=(ct=R[H]).raycastResult.body,nt=0;if(ct.slipInfo=1,et){var ot=ct.brake?ct.brake:0;nt=o(O,et,ct.raycastResult.hitPointWorld,V[H],ot);var it=ot/(nt+=ct.engineForce*T);ct.slipInfo*=it}if(ct.forwardImpulse=0,ct.skidInfo=1,et){ct.skidInfo=1;var rt=ct.suspensionForce*T*ct.frictionSlip,st=rt*rt;ct.forwardImpulse=nt;var at=.5*ct.forwardImpulse,lt=1*ct.sideImpulse,ut=at*at+lt*lt;ct.sliding=!1,ut>st&&(this.sliding=!0,ct.sliding=!0,it=rt/Math.sqrt(ut),ct.skidInfo*=it)}}if(this.sliding)for(H=0;z>H;H++)0!==(ct=R[H]).sideImpulse&&ct.skidInfo<1&&(ct.forwardImpulse*=ct.skidInfo,ct.sideImpulse*=ct.skidInfo);for(H=0;z>H;H++){var ct=R[H],ht=new E;if(ht.copy(ct.raycastResult.hitPointWorld),0!==ct.forwardImpulse){var pt=new E;V[H].scale(ct.forwardImpulse,pt),O.applyImpulse(pt,ht)}if(0!==ct.sideImpulse){et=ct.raycastResult.body;var dt=new E;dt.copy(ct.raycastResult.hitPointWorld);var ft=new E;U[H].scale(ct.sideImpulse,ft),O.pointToLocalFrame(ht,ht),ht["xyz"[this.indexUpAxis]]*=ct.rollInfluence,O.pointToWorldFrame(ht,ht),O.applyImpulse(ft,ht),ft.scale(-1,ft),et.applyImpulse(ft,dt)}}};var $=new E,et=new E,nt=new E,ot=new E,it=new E,rt=new E,st=new E,at=new E,lt=new E,ut=new E},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(T,A){function n(T){if(this.wheelBodies=[],this.coordinateSystem=void 0===T.coordinateSystem?new O(1,2,3):T.coordinateSystem.clone(),this.chassisBody=T.chassisBody,!this.chassisBody){var A=new z(new O(5,2,.5));this.chassisBody=new E(1,A)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var E=T("./Body"),R=T("../shapes/Sphere"),z=T("../shapes/Box"),O=T("../math/Vec3"),V=T("../constraints/HingeConstraint");A.exports=n,n.prototype.addWheel=function(T){var A=(T=T||{}).body;A||(A=new E(1,new R(1.2))),this.wheelBodies.push(A),this.wheelForces.push(0);var z=(new O,void 0!==T.position?T.position.clone():new O),U=new O;this.chassisBody.pointToWorldFrame(z,U),A.position.set(U.x,U.y,U.z);var H=void 0!==T.axis?T.axis.clone():new O(0,1,0);this.wheelAxes.push(H);var G=new V(this.chassisBody,A,{pivotA:z,axisA:H,pivotB:O.ZERO,axisB:H,collideConnected:!1});return this.constraints.push(G),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(T,A){var E=this.wheelAxes[A],R=Math.cos(T),z=Math.sin(T),O=E.x,V=E.y;this.constraints[A].axisA.set(R*O-z*V,z*O+R*V,0)},n.prototype.setMotorSpeed=function(T,A){var E=this.constraints[A];E.enableMotor(),E.motorTargetVelocity=T},n.prototype.disableMotor=function(T){this.constraints[T].disableMotor()};var U=new O;n.prototype.setWheelForce=function(T,A){this.wheelForces[A]=T},n.prototype.applyWheelForce=function(T,A){var E=this.wheelAxes[A],R=this.wheelBodies[A],z=R.torque;E.scale(T,U),R.vectorToWorldFrame(U,U),z.vadd(U,z)},n.prototype.addToWorld=function(T){for(var A=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)T.add(E[R]);for(R=0;R<A.length;R++)T.addConstraint(A[R]);T.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var T=this.wheelForces,A=0;A<T.length;A++)this.applyWheelForce(T[A],A)},n.prototype.removeFromWorld=function(T){for(var A=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)T.remove(E[R]);for(R=0;R<A.length;R++)T.removeConstraint(A[R])};var H=new O;n.prototype.getWheelSpeed=function(T){var A=this.wheelAxes[T],E=this.wheelBodies[T].angularVelocity;return this.chassisBody.vectorToWorldFrame(A,H),E.dot(H)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(T,A){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}A.exports=n;var E=(T("../shapes/Shape"),T("../math/Vec3"));T("../math/Quaternion"),T("../shapes/Particle"),T("../objects/Body"),T("../material/Material"),n.prototype.add=function(T){this.particles.push(T),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(T){var A=this.particles.indexOf(T);-1!==A&&(this.particles.splice(A,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var R=new E;n.prototype.getNeighbors=function(T,A){for(var E=this.particles.length,z=T.id,O=this.smoothingRadius*this.smoothingRadius,V=R,U=0;U!==E;U++){var H=this.particles[U];H.position.vsub(T.position,V),z!==H.id&&V.norm2()<O&&A.push(H)}};var z=new E,O=new E,V=new E,U=new E,H=new E,G=new E;n.prototype.update=function(){for(var T=this.particles.length,A=z,E=this.speedOfSound,R=this.eps,X=0;X!==T;X++){var Q=this.particles[X];(ut=this.neighbors[X]).length=0,this.getNeighbors(Q,ut),ut.push(this.particles[X]);for(var Z=ut.length,K=0,J=0;J!==Z;J++){Q.position.vsub(ut[J].position,A);var $=A.norm(),et=this.w($);K+=ut[J].mass*et}this.densities[X]=K,this.pressures[X]=E*E*(this.densities[X]-this.density)}var nt=O,ot=V,it=U,rt=H,st=G;for(X=0;X!==T;X++){var at,lt,ut,ct=this.particles[X];for(nt.set(0,0,0),ot.set(0,0,0),Z=(ut=this.neighbors[X]).length,J=0;J!==Z;J++){var ht=ut[J];ct.position.vsub(ht.position,rt);var pt=rt.norm();at=-ht.mass*(this.pressures[X]/(this.densities[X]*this.densities[X]+R)+this.pressures[J]/(this.densities[J]*this.densities[J]+R)),this.gradw(rt,it),it.mult(at,it),nt.vadd(it,nt),ht.velocity.vsub(ct.velocity,st),st.mult(1/(1e-4+this.densities[X]*this.densities[J])*this.viscosity*ht.mass,st),lt=this.nablaw(pt),st.mult(lt,st),ot.vadd(st,ot)}ot.mult(ct.mass,ot),nt.mult(ct.mass,nt),ct.force.vadd(ot,ct.force),ct.force.vadd(nt,ct.force)}},n.prototype.w=function(T){var A=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(A,9))*Math.pow(A*A-T*T,3)},n.prototype.gradw=function(T,A){var E=T.norm(),R=this.smoothingRadius;T.mult(945/(32*Math.PI*Math.pow(R,9))*Math.pow(R*R-E*E,2),A)},n.prototype.nablaw=function(T){var A=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(A,9))*(A*A-T*T)*(7*T*T-3*A*A)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(T,A){function n(T,A,R){R=R||{},this.restLength="number"==typeof R.restLength?R.restLength:1,this.stiffness=R.stiffness||100,this.damping=R.damping||1,this.bodyA=T,this.bodyB=A,this.localAnchorA=new E,this.localAnchorB=new E,R.localAnchorA&&this.localAnchorA.copy(R.localAnchorA),R.localAnchorB&&this.localAnchorB.copy(R.localAnchorB),R.worldAnchorA&&this.setWorldAnchorA(R.worldAnchorA),R.worldAnchorB&&this.setWorldAnchorB(R.worldAnchorB)}var E=T("../math/Vec3");A.exports=n,n.prototype.setWorldAnchorA=function(T){this.bodyA.pointToLocalFrame(T,this.localAnchorA)},n.prototype.setWorldAnchorB=function(T){this.bodyB.pointToLocalFrame(T,this.localAnchorB)},n.prototype.getWorldAnchorA=function(T){this.bodyA.pointToWorldFrame(this.localAnchorA,T)},n.prototype.getWorldAnchorB=function(T){this.bodyB.pointToWorldFrame(this.localAnchorB,T)};var R=new E,z=new E,O=new E,V=new E,U=new E,H=new E,G=new E,X=new E,Q=new E,Z=new E,K=new E;n.prototype.applyForce=function(){var T=this.stiffness,A=this.damping,E=this.restLength,J=this.bodyA,$=this.bodyB,et=R,nt=z,ot=O,it=V,rt=K,st=U,at=H,lt=G,ut=X,ct=Q,ht=Z;this.getWorldAnchorA(st),this.getWorldAnchorB(at),st.vsub(J.position,lt),at.vsub($.position,ut),at.vsub(st,et);var pt=et.norm();nt.copy(et),nt.normalize(),$.velocity.vsub(J.velocity,ot),$.angularVelocity.cross(ut,rt),ot.vadd(rt,ot),J.angularVelocity.cross(lt,rt),ot.vsub(rt,ot),nt.mult(-T*(pt-E)-A*ot.dot(nt),it),J.force.vsub(it,J.force),$.force.vadd(it,$.force),lt.cross(it,ct),ut.cross(it,ht),J.torque.vsub(ct,J.torque),$.torque.vadd(ht,$.torque)}},{"../math/Vec3":30}],36:[function(T,A){function n(T){T=O.defaults(T,{chassisConnectionPointLocal:new E,chassisConnectionPointWorld:new E,directionLocal:new E,directionWorld:new E,axleLocal:new E,axleWorld:new E,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=T.maxSuspensionTravel,this.customSlidingRotationalSpeed=T.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=T.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=T.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=T.chassisConnectionPointWorld.clone(),this.directionLocal=T.directionLocal.clone(),this.directionWorld=T.directionWorld.clone(),this.axleLocal=T.axleLocal.clone(),this.axleWorld=T.axleWorld.clone(),this.suspensionRestLength=T.suspensionRestLength,this.suspensionMaxLength=T.suspensionMaxLength,this.radius=T.radius,this.suspensionStiffness=T.suspensionStiffness,this.dampingCompression=T.dampingCompression,this.dampingRelaxation=T.dampingRelaxation,this.frictionSlip=T.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=T.rollInfluence,this.maxSuspensionForce=T.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=T.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new z,this.worldTransform=new R,this.isInContact=!1}var E=T("../math/Vec3"),R=T("../math/Transform"),z=T("../collision/RaycastResult"),O=T("../utils/Utils");A.exports=n;var V=new E,U=new E;V=new E,n.prototype.updateWheel=function(T){var A=this.raycastResult;if(this.isInContact){var E=A.hitNormalWorld.dot(A.directionWorld);A.hitPointWorld.vsub(T.position,U),T.getVelocityAtWorldPoint(U,V);var R=A.hitNormalWorld.dot(V);if(E>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var z=-1/E;this.suspensionRelativeVelocity=R*z,this.clippedInvContactDotSuspension=z}}else A.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,A.directionWorld.scale(-1,A.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(T,A){function n(T){E.call(this),this.type=E.types.BOX,this.halfExtents=T,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3"),z=T("./ConvexPolyhedron");n.prototype=new E,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var T=this.halfExtents.x,A=this.halfExtents.y,E=this.halfExtents.z,O=R,V=[new O(-T,-A,-E),new O(T,-A,-E),new O(T,A,-E),new O(-T,A,-E),new O(-T,-A,E),new O(T,-A,E),new O(T,A,E),new O(-T,A,E)],U=(new O(0,0,1),new O(0,1,0),new O(1,0,0),new z(V,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=U,U.material=this.material},n.prototype.calculateLocalInertia=function(T,A){return A=A||new R,n.calculateInertia(this.halfExtents,T,A),A},n.calculateInertia=function(T,A,E){var R=T;E.x=1/12*A*(2*R.y*2*R.y+2*R.z*2*R.z),E.y=1/12*A*(2*R.x*2*R.x+2*R.z*2*R.z),E.z=1/12*A*(2*R.y*2*R.y+2*R.x*2*R.x)},n.prototype.getSideNormals=function(T,A){var E=T,R=this.halfExtents;if(E[0].set(R.x,0,0),E[1].set(0,R.y,0),E[2].set(0,0,R.z),E[3].set(-R.x,0,0),E[4].set(0,-R.y,0),E[5].set(0,0,-R.z),void 0!==A)for(var z=0;z!==E.length;z++)A.vmult(E[z],E[z]);return E},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var O=new R;new R,n.prototype.forEachWorldCorner=function(T,A,E){for(var R=this.halfExtents,z=[[R.x,R.y,R.z],[-R.x,R.y,R.z],[-R.x,-R.y,R.z],[-R.x,-R.y,-R.z],[R.x,-R.y,-R.z],[R.x,R.y,-R.z],[-R.x,R.y,-R.z],[R.x,-R.y,R.z]],V=0;V<z.length;V++)O.set(z[V][0],z[V][1],z[V][2]),A.vmult(O,O),T.vadd(O,O),E(O.x,O.y,O.z)};var V=[new R,new R,new R,new R,new R,new R,new R,new R];n.prototype.calculateWorldAABB=function(T,A,E,R){var z=this.halfExtents;V[0].set(z.x,z.y,z.z),V[1].set(-z.x,z.y,z.z),V[2].set(-z.x,-z.y,z.z),V[3].set(-z.x,-z.y,-z.z),V[4].set(z.x,-z.y,-z.z),V[5].set(z.x,z.y,-z.z),V[6].set(-z.x,z.y,-z.z),V[7].set(z.x,-z.y,z.z);var O=V[0];A.vmult(O,O),T.vadd(O,O),R.copy(O),E.copy(O);for(var U=1;8>U;U++){O=V[U],A.vmult(O,O),T.vadd(O,O);var H=O.x,G=O.y,X=O.z;H>R.x&&(R.x=H),G>R.y&&(R.y=G),X>R.z&&(R.z=X),H<E.x&&(E.x=H),G<E.y&&(E.y=G),X<E.z&&(E.z=X)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(T,A){function n(T,A,R){E.call(this),this.type=E.types.CONVEXPOLYHEDRON,this.vertices=T||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=A||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=R?R.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3"),z=(T("../math/Quaternion"),T("../math/Transform"));n.prototype=new E,n.prototype.constructor=n;var O=new R;n.prototype.computeEdges=function(){var T=this.faces,A=this.vertices,E=(A.length,this.uniqueEdges);E.length=0;for(var R=O,z=0;z!==T.length;z++)for(var V=T[z],U=V.length,H=0;H!==U;H++){var G=(H+1)%U;A[V[H]].vsub(A[V[G]],R),R.normalize();for(var X=!1,Q=0;Q!==E.length;Q++)if(E[Q].almostEquals(R)||E[Q].almostEquals(R)){X=!0;break}X||E.push(R.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var T=0;T<this.faces.length;T++){for(var A=0;A<this.faces[T].length;A++)if(!this.vertices[this.faces[T][A]])throw new Error("Vertex "+this.faces[T][A]+" not found!");var E=this.faceNormals[T]||new R;this.getFaceNormal(T,E),E.negate(E),this.faceNormals[T]=E;var z=this.vertices[this.faces[T][0]];if(E.dot(z)<0)for(console.error(".faceNormals["+T+"] = Vec3("+E.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),A=0;A<this.faces[T].length;A++)console.warn(".vertices["+this.faces[T][A]+"] = Vec3("+this.vertices[this.faces[T][A]].toString()+")")}};var V=new R,U=new R;n.computeNormal=function(T,A,E,R){A.vsub(T,U),E.vsub(A,V),V.cross(U,R),R.isZero()||R.normalize()},n.prototype.getFaceNormal=function(T,A){var E=this.faces[T],R=this.vertices[E[0]],z=this.vertices[E[1]],O=this.vertices[E[2]];return n.computeNormal(R,z,O,A)};var H=new R;n.prototype.clipAgainstHull=function(T,A,E,z,O,V,U,G,X){for(var Q=H,Z=-1,K=-Number.MAX_VALUE,J=0;J<E.faces.length;J++){Q.copy(E.faceNormals[J]),O.vmult(Q,Q);var $=Q.dot(V);$>K&&(K=$,Z=J)}for(var et=[],nt=E.faces[Z],ot=nt.length,it=0;ot>it;it++){var rt=E.vertices[nt[it]],st=new R;st.copy(rt),O.vmult(st,st),z.vadd(st,st),et.push(st)}Z>=0&&this.clipFaceAgainstHull(V,T,A,et,U,G,X)};var G=new R,X=new R,Q=new R,Z=new R,K=new R,J=new R;n.prototype.findSeparatingAxis=function(T,A,E,R,z,O,V,U){var H=G,$=X,et=Q,nt=Z,ot=K,it=J,rt=Number.MAX_VALUE,st=this;if(st.uniqueAxes)for(var at=0;at!==st.uniqueAxes.length;at++){if(E.vmult(st.uniqueAxes[at],H),!1===(ht=st.testSepAxis(H,T,A,E,R,z)))return!1;rt>ht&&(rt=ht,O.copy(H))}else{var lt=V?V.length:st.faces.length;for(at=0;lt>at;at++){var ut=V?V[at]:at;if(H.copy(st.faceNormals[ut]),E.vmult(H,H),!1===(ht=st.testSepAxis(H,T,A,E,R,z)))return!1;rt>ht&&(rt=ht,O.copy(H))}}if(T.uniqueAxes)for(at=0;at!==T.uniqueAxes.length;at++){if(z.vmult(T.uniqueAxes[at],$),!1===(ht=st.testSepAxis($,T,A,E,R,z)))return!1;rt>ht&&(rt=ht,O.copy($))}else{var ct=U?U.length:T.faces.length;for(at=0;ct>at;at++){var ht;if(ut=U?U[at]:at,$.copy(T.faceNormals[ut]),z.vmult($,$),!1===(ht=st.testSepAxis($,T,A,E,R,z)))return!1;rt>ht&&(rt=ht,O.copy($))}}for(var pt=0;pt!==st.uniqueEdges.length;pt++){E.vmult(st.uniqueEdges[pt],nt);for(var dt=0;dt!==T.uniqueEdges.length;dt++)if(z.vmult(T.uniqueEdges[dt],ot),nt.cross(ot,it),!it.almostZero()){it.normalize();var ft=st.testSepAxis(it,T,A,E,R,z);if(!1===ft)return!1;rt>ft&&(rt=ft,O.copy(it))}}return R.vsub(A,et),et.dot(O)>0&&O.negate(O),!0};var $=[],et=[];n.prototype.testSepAxis=function(T,A,E,R,z,O){n.project(this,T,E,R,$),n.project(A,T,z,O,et);var V=$[0],U=$[1],H=et[0],G=et[1];if(G>V||U>H)return!1;var X=V-G,Q=H-U;return Q>X?X:Q};var nt=new R,ot=new R;n.prototype.calculateLocalInertia=function(T,A){this.computeLocalAABB(nt,ot);var E=ot.x-nt.x,R=ot.y-nt.y,z=ot.z-nt.z;A.x=1/12*T*(2*R*2*R+2*z*2*z),A.y=1/12*T*(2*E*2*E+2*z*2*z),A.z=1/12*T*(2*R*2*R+2*E*2*E)},n.prototype.getPlaneConstantOfFace=function(T){var A=this.faces[T],E=this.faceNormals[T],R=this.vertices[A[0]];return-E.dot(R)};var it=new R,rt=new R,st=new R,at=new R,lt=new R,ut=new R,ct=new R,ht=new R;n.prototype.clipFaceAgainstHull=function(T,A,E,R,z,O,V){for(var U=it,H=rt,G=st,X=at,Q=lt,Z=ut,K=ct,J=ht,$=this,et=R,nt=[],ot=-1,pt=Number.MAX_VALUE,dt=0;dt<$.faces.length;dt++){U.copy($.faceNormals[dt]),E.vmult(U,U);var ft=U.dot(T);pt>ft&&(pt=ft,ot=dt)}if(!(0>ot)){var vt=$.faces[ot];vt.connectedFaces=[];for(var mt=0;mt<$.faces.length;mt++)for(var gt=0;gt<$.faces[mt].length;gt++)-1!==vt.indexOf($.faces[mt][gt])&&mt!==ot&&-1===vt.connectedFaces.indexOf(mt)&&vt.connectedFaces.push(mt);for(var wt=(et.length,vt.length),bt=0;wt>bt;bt++){var xt=$.vertices[vt[bt]],Tt=$.vertices[vt[(bt+1)%wt]];xt.vsub(Tt,H),G.copy(H),E.vmult(G,G),A.vadd(G,G),X.copy(this.faceNormals[ot]),E.vmult(X,X),A.vadd(X,X),G.cross(X,Q),Q.negate(Q),Z.copy(xt),E.vmult(Z,Z),A.vadd(Z,Z);var At=(Z.dot(Q),vt.connectedFaces[bt]);K.copy(this.faceNormals[At]);var St=this.getPlaneConstantOfFace(At);J.copy(K),E.vmult(J,J);var Et=St-J.dot(A);for(this.clipFaceAgainstPlane(et,nt,J,Et);et.length;)et.shift();for(;nt.length;)et.push(nt.shift())}for(K.copy(this.faceNormals[ot]),St=this.getPlaneConstantOfFace(ot),J.copy(K),E.vmult(J,J),Et=St-J.dot(A),mt=0;mt<et.length;mt++){var Ct=J.dot(et[mt])+Et;if(z>=Ct&&(console.log("clamped: depth="+Ct+" to minDist="+z),Ct=z),O>=Ct){var It=et[mt];if(0>=Ct){var Rt={point:It,normal:J,depth:Ct};V.push(Rt)}}}}},n.prototype.clipFaceAgainstPlane=function(T,A,E,z){var O,V,U=T.length;if(2>U)return A;var H=T[T.length-1],G=T[0];O=E.dot(H)+z;for(var X=0;U>X;X++){if(G=T[X],V=E.dot(G)+z,0>O)if(0>V)(Q=new R).copy(G),A.push(Q);else{var Q=new R;H.lerp(G,O/(O-V),Q),A.push(Q)}else 0>V&&(Q=new R,H.lerp(G,O/(O-V),Q),A.push(Q),A.push(G));H=G,O=V}return A},n.prototype.computeWorldVertices=function(T,A){for(var E=this.vertices.length;this.worldVertices.length<E;)this.worldVertices.push(new R);for(var z=this.vertices,O=this.worldVertices,V=0;V!==E;V++)A.vmult(z[V],O[V]),T.vadd(O[V],O[V]);this.worldVerticesNeedsUpdate=!1},new R,n.prototype.computeLocalAABB=function(T,A){var E=this.vertices.length,R=this.vertices;T.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var z=0;E>z;z++){var O=R[z];O.x<T.x?T.x=O.x:O.x>A.x&&(A.x=O.x),O.y<T.y?T.y=O.y:O.y>A.y&&(A.y=O.y),O.z<T.z?T.z=O.z:O.z>A.z&&(A.z=O.z)}},n.prototype.computeWorldFaceNormals=function(T){for(var A=this.faceNormals.length;this.worldFaceNormals.length<A;)this.worldFaceNormals.push(new R);for(var E=this.faceNormals,z=this.worldFaceNormals,O=0;O!==A;O++)T.vmult(E[O],z[O]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var T=0,A=this.vertices,E=0,R=A.length;E!==R;E++){var z=A[E].norm2();z>T&&(T=z)}this.boundingSphereRadius=Math.sqrt(T)};var pt=new R;n.prototype.calculateWorldAABB=function(T,A,E,R){for(var z,O,V,U,H,G,X=this.vertices.length,Q=this.vertices,Z=0;X>Z;Z++){pt.copy(Q[Z]),A.vmult(pt,pt),T.vadd(pt,pt);var K=pt;K.x<z||void 0===z?z=K.x:(K.x>U||void 0===U)&&(U=K.x),K.y<O||void 0===O?O=K.y:(K.y>H||void 0===H)&&(H=K.y),K.z<V||void 0===V?V=K.z:(K.z>G||void 0===G)&&(G=K.z)}E.set(z,O,V),R.set(U,H,G)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(T){T=T||new R;for(var A=this.vertices.length,E=this.vertices,z=0;A>z;z++)T.vadd(E[z],T);return T.mult(1/A,T),T},n.prototype.transformAllPoints=function(T,A){var E=this.vertices.length,R=this.vertices;if(A){for(var z=0;E>z;z++){var O=R[z];A.vmult(O,O)}for(z=0;z<this.faceNormals.length;z++)O=this.faceNormals[z],A.vmult(O,O)}if(T)for(z=0;E>z;z++)(O=R[z]).vadd(T,O)};var dt=new R,ft=new R,vt=new R;n.prototype.pointIsInside=function(T){var A=this.vertices.length,E=this.vertices,R=this.faces,z=this.faceNormals,O=this.faces.length,V=dt;this.getAveragePointLocal(V);for(var U=0;O>U;U++){this.faces[U].length,A=z[U];var H=E[R[U][0]],G=ft;T.vsub(H,G);var X=A.dot(G),Q=vt;V.vsub(H,Q);var Z=A.dot(Q);if(0>X&&Z>0||X>0&&0>Z)return!1}return-1};var mt=(new R,new R),gt=new R;n.project=function(T,A,E,R,O){var V=T.vertices.length,U=mt,H=0,G=0,X=gt,Q=T.vertices;X.setZero(),z.vectorToLocalFrame(E,R,A,U),z.pointToLocalFrame(E,R,X,X);var Z=X.dot(U);G=H=Q[0].dot(U);for(var K=1;V>K;K++){var J=Q[K].dot(U);J>H&&(H=J),G>J&&(G=J)}if((G-=Z)>(H-=Z)){var $=G;G=H,H=$}O[0]=H,O[1]=G}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(T,A){function n(T,A,O,V){var U=V,H=[],G=[],X=[],Q=[],Z=[],K=Math.cos,J=Math.sin;H.push(new R(A*K(0),A*J(0),.5*-O)),Q.push(0),H.push(new R(T*K(0),T*J(0),.5*O)),Z.push(1);for(var $=0;U>$;$++){var et=2*Math.PI/U*($+1),nt=2*Math.PI/U*($+.5);U-1>$?(H.push(new R(A*K(et),A*J(et),.5*-O)),Q.push(2*$+2),H.push(new R(T*K(et),T*J(et),.5*O)),Z.push(2*$+3),X.push([2*$+2,2*$+3,2*$+1,2*$])):X.push([0,1,2*$+1,2*$]),(U%2==1||U/2>$)&&G.push(new R(K(nt),J(nt),0))}X.push(Z),G.push(new R(0,0,1));var ot=[];for($=0;$<Q.length;$++)ot.push(Q[Q.length-$-1]);X.push(ot),this.type=E.types.CONVEXPOLYHEDRON,z.call(this,H,X,G)}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3"),z=(T("../math/Quaternion"),T("./ConvexPolyhedron"));n.prototype=new z},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(T,A){function n(T,A){A=O.defaults(A,{maxValue:null,minValue:null,elementSize:1}),this.data=T,this.maxValue=A.maxValue,this.minValue=A.minValue,this.elementSize=A.elementSize,null===A.minValue&&this.updateMinValue(),null===A.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,E.call(this),this.pillarConvex=new R,this.pillarOffset=new z,this.type=E.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var E=T("./Shape"),R=T("./ConvexPolyhedron"),z=T("../math/Vec3"),O=T("../utils/Utils");A.exports=n,n.prototype=new E,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var T=this.data,A=T[0][0],E=0;E!==T.length;E++)for(var R=0;R!==T[E].length;R++){var z=T[E][R];A>z&&(A=z)}this.minValue=A},n.prototype.updateMaxValue=function(){for(var T=this.data,A=T[0][0],E=0;E!==T.length;E++)for(var R=0;R!==T[E].length;R++){var z=T[E][R];z>A&&(A=z)}this.maxValue=A},n.prototype.setHeightValueAtIndex=function(T,A,E){this.data[T][A]=E,this.clearCachedConvexTrianglePillar(T,A,!1),T>0&&(this.clearCachedConvexTrianglePillar(T-1,A,!0),this.clearCachedConvexTrianglePillar(T-1,A,!1)),A>0&&(this.clearCachedConvexTrianglePillar(T,A-1,!0),this.clearCachedConvexTrianglePillar(T,A-1,!1)),A>0&&T>0&&this.clearCachedConvexTrianglePillar(T-1,A-1,!0)},n.prototype.getRectMinMax=function(T,A,E,R,z){z=z||[];for(var O=this.data,V=this.minValue,U=T;E>=U;U++)for(var H=A;R>=H;H++){var G=O[U][H];G>V&&(V=G)}z[0]=this.minValue,z[1]=V},n.prototype.getIndexOfPosition=function(T,A,E,R){var z=this.elementSize,O=this.data,V=Math.floor(T/z),U=Math.floor(A/z);return E[0]=V,E[1]=U,R&&(0>V&&(V=0),0>U&&(U=0),V>=O.length-1&&(V=O.length-1),U>=O[0].length-1&&(U=O[0].length-1)),!(0>V||0>U||V>=O.length-1||U>=O[0].length-1)},n.prototype.getHeightAt=function(T,A,E){var R=[];this.getIndexOfPosition(T,A,R,E);var z=[];return this.getRectMinMax(R[0],R[1]+1,R[0],R[1]+1,z),(z[0]+z[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(T,A,E){return T+"_"+A+"_"+(E?1:0)},n.prototype.getCachedConvexTrianglePillar=function(T,A,E){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(T,A,E)]},n.prototype.setCachedConvexTrianglePillar=function(T,A,E,R,z){this._cachedPillars[this.getCacheConvexTrianglePillarKey(T,A,E)]={convex:R,offset:z}},n.prototype.clearCachedConvexTrianglePillar=function(T,A,E){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(T,A,E)]},n.prototype.getConvexTrianglePillar=function(T,A,E){var O=this.pillarConvex,V=this.pillarOffset;if(this.cacheEnabled){if(U=this.getCachedConvexTrianglePillar(T,A,E))return this.pillarConvex=U.convex,void(this.pillarOffset=U.offset);O=new R,V=new z,this.pillarConvex=O,this.pillarOffset=V}var U=this.data,H=this.elementSize,G=O.faces;O.vertices.length=6;for(var X=0;6>X;X++)O.vertices[X]||(O.vertices[X]=new z);for(G.length=5,X=0;5>X;X++)G[X]||(G[X]=[]);var Q=O.vertices,Z=(Math.min(U[T][A],U[T+1][A],U[T][A+1],U[T+1][A+1])-this.minValue)/2+this.minValue;E?(V.set((T+.75)*H,(A+.75)*H,Z),Q[0].set(.25*H,.25*H,U[T+1][A+1]-Z),Q[1].set(-.75*H,.25*H,U[T][A+1]-Z),Q[2].set(.25*H,-.75*H,U[T+1][A]-Z),Q[3].set(.25*H,.25*H,-Z-1),Q[4].set(-.75*H,.25*H,-Z-1),Q[5].set(.25*H,-.75*H,-Z-1),G[0][0]=0,G[0][1]=1,G[0][2]=2,G[1][0]=5,G[1][1]=4,G[1][2]=3,G[2][0]=2,G[2][1]=5,G[2][2]=3,G[2][3]=0,G[3][0]=3,G[3][1]=4,G[3][2]=1,G[3][3]=0,G[4][0]=1,G[4][1]=4,G[4][2]=5,G[4][3]=2):(V.set((T+.25)*H,(A+.25)*H,Z),Q[0].set(-.25*H,-.25*H,U[T][A]-Z),Q[1].set(.75*H,-.25*H,U[T+1][A]-Z),Q[2].set(-.25*H,.75*H,U[T][A+1]-Z),Q[3].set(-.25*H,-.25*H,-Z-1),Q[4].set(.75*H,-.25*H,-Z-1),Q[5].set(-.25*H,.75*H,-Z-1),G[0][0]=0,G[0][1]=1,G[0][2]=2,G[1][0]=5,G[1][1]=4,G[1][2]=3,G[2][0]=0,G[2][1]=2,G[2][2]=5,G[2][3]=3,G[3][0]=1,G[3][1]=0,G[3][2]=3,G[3][3]=4,G[4][0]=4,G[4][1]=5,G[4][2]=2,G[4][3]=1),O.computeNormals(),O.computeEdges(),O.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(T,A,E,O,V)},n.prototype.calculateLocalInertia=function(T,A){return(A=A||new z).set(0,0,0),A},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(T,A,E,R){E.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var T=this.data,A=this.elementSize;this.boundingSphereRadius=new z(T.length*A,T[0].length*A,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(T,A){function n(){E.call(this),this.type=E.types.PARTICLE}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(T,A){return(A=A||new R).set(0,0,0),A},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(T,A,E,R){E.copy(T),R.copy(T)}},{"../math/Vec3":30,"./Shape":43}],42:[function(T,A){function n(){E.call(this),this.type=E.types.PLANE,this.worldNormal=new R,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(T){var A=this.worldNormal;A.set(0,0,1),T.vmult(A,A),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(T,A){return A||new R},n.prototype.volume=function(){return Number.MAX_VALUE};var z=new R;n.prototype.calculateWorldAABB=function(T,A,E,R){z.set(0,0,1),A.vmult(z,z);var O=Number.MAX_VALUE;E.set(-O,-O,-O),R.set(O,O,O),1===z.x&&(R.x=T.x),1===z.y&&(R.y=T.y),1===z.z&&(R.z=T.z),-1===z.x&&(E.x=T.x),-1===z.y&&(E.y=T.y),-1===z.z&&(E.z=T.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(T,A){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}A.exports=n;var n=T("./Shape");T("../math/Vec3"),T("../math/Quaternion"),T("../material/Material"),n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(T,A){function n(T){if(E.call(this),this.radius=void 0!==T?Number(T):1,this.type=E.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(T,A){A=A||new R;var E=2*T*this.radius*this.radius/5;return A.x=E,A.y=E,A.z=E,A},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(T,A,E,R){for(var z=this.radius,O=["x","y","z"],V=0;V<O.length;V++){var U=O[V];E[U]=T[U]-z,R[U]=T[U]+z}}},{"../math/Vec3":30,"./Shape":43}],45:[function(T,A){function n(T,A){E.call(this),this.type=E.types.TRIMESH,this.vertices=new Float32Array(T),this.indices=new Int16Array(A),this.normals=new Float32Array(A.length),this.aabb=new O,this.edges=null,this.scale=new R(1,1,1),this.tree=new V,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}A.exports=n;var E=T("./Shape"),R=T("../math/Vec3"),z=(T("../math/Quaternion"),T("../math/Transform")),O=T("../collision/AABB"),V=T("../utils/Octree");n.prototype=new E,n.prototype.constructor=n;var U=new R;n.prototype.updateTree=function(){var T=this.tree;T.reset(),T.aabb.copy(this.aabb);var A=this.scale;T.aabb.lowerBound.x*=1/A.x,T.aabb.lowerBound.y*=1/A.y,T.aabb.lowerBound.z*=1/A.z,T.aabb.upperBound.x*=1/A.x,T.aabb.upperBound.y*=1/A.y,T.aabb.upperBound.z*=1/A.z;for(var E=new O,z=new R,V=new R,U=new R,H=[z,V,U],G=0;G<this.indices.length/3;G++){var X=3*G;this._getUnscaledVertex(this.indices[X],z),this._getUnscaledVertex(this.indices[X+1],V),this._getUnscaledVertex(this.indices[X+2],U),E.setFromPoints(H),T.insert(E,G)}T.removeEmptyNodes()};var H=new O;n.prototype.getTrianglesInAABB=function(T,A){H.copy(T);var E=this.scale,R=E.x,z=E.y,O=E.z,V=H.lowerBound,U=H.upperBound;return V.x/=R,V.y/=z,V.z/=O,U.x/=R,U.y/=z,U.z/=O,this.tree.aabbQuery(H,A)},n.prototype.setScale=function(T){var A=this.scale.x===this.scale.y===this.scale.z,E=T.x===T.y===T.z;A&&E||this.updateNormals(),this.scale.copy(T),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var T=U,A=this.normals,E=0;E<this.indices.length/3;E++){var R=3*E,z=this.indices[R],O=this.indices[R+1],V=this.indices[R+2];this.getVertex(z,K),this.getVertex(O,J),this.getVertex(V,$),n.computeNormal(J,K,$,T),A[R]=T.x,A[R+1]=T.y,A[R+2]=T.z}},n.prototype.updateEdges=function(){for(var T={},f=function(){T[z>R?R+"_"+z:z+"_"+R]=!0},A=0;A<this.indices.length/3;A++){var E=3*A,R=this.indices[E],z=this.indices[E+1];this.indices[E+2],f(),f(),f()}var O=Object.keys(T);for(this.edges=new Int16Array(2*O.length),A=0;A<O.length;A++){var V=O[A].split("_");this.edges[2*A]=parseInt(V[0],10),this.edges[2*A+1]=parseInt(V[1],10)}},n.prototype.getEdgeVertex=function(T,A,E){var R=this.edges[2*T+(A?1:0)];this.getVertex(R,E)};var G=new R,X=new R;n.prototype.getEdgeVector=function(T,A){var E=G,R=X;this.getEdgeVertex(T,0,E),this.getEdgeVertex(T,1,R),R.vsub(E,A)};var Q=new R,Z=new R;n.computeNormal=function(T,A,E,R){A.vsub(T,Z),E.vsub(A,Q),Q.cross(Z,R),R.isZero()||R.normalize()};var K=new R,J=new R,$=new R;n.prototype.getVertex=function(T,A){var E=this.scale;return this._getUnscaledVertex(T,A),A.x*=E.x,A.y*=E.y,A.z*=E.z,A},n.prototype._getUnscaledVertex=function(T,A){var E=3*T,R=this.vertices;return A.set(R[E],R[E+1],R[E+2])},n.prototype.getWorldVertex=function(T,A,E,R){return this.getVertex(T,R),z.pointToWorldFrame(A,E,R,R),R},n.prototype.getTriangleVertices=function(T,A,E,R){var z=3*T;this.getVertex(this.indices[z],A),this.getVertex(this.indices[z+1],E),this.getVertex(this.indices[z+2],R)},n.prototype.getNormal=function(T,A){var E=3*T;return A.set(this.normals[E],this.normals[E+1],this.normals[E+2])};var et=new O;n.prototype.calculateLocalInertia=function(T,A){this.computeLocalAABB(et);var E=et.upperBound.x-et.lowerBound.x,R=et.upperBound.y-et.lowerBound.y,z=et.upperBound.z-et.lowerBound.z;return A.set(1/12*T*(2*R*2*R+2*z*2*z),1/12*T*(2*E*2*E+2*z*2*z),1/12*T*(2*R*2*R+2*E*2*E))};var nt=new R;n.prototype.computeLocalAABB=function(T){var A=T.lowerBound,E=T.upperBound,R=this.vertices.length,z=(this.vertices,nt);this.getVertex(0,z),A.copy(z),E.copy(z);for(var O=0;O!==R;O++)this.getVertex(O,z),z.x<A.x?A.x=z.x:z.x>E.x&&(E.x=z.x),z.y<A.y?A.y=z.y:z.y>E.y&&(E.y=z.y),z.z<A.z?A.z=z.z:z.z>E.z&&(E.z=z.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var T=0,A=this.vertices,E=new R,z=0,O=A.length/3;z!==O;z++){this.getVertex(z,E);var V=E.norm2();V>T&&(T=V)}this.boundingSphereRadius=Math.sqrt(T)};var ot=(new R,new z),it=new O;n.prototype.calculateWorldAABB=function(T,A,E,R){var z=ot,O=it;z.position=T,z.quaternion=A,this.aabb.toWorldFrame(z,O),E.copy(O.lowerBound),R.copy(O.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(T,A,E,R,z){T=T||1,A=A||.5,E=E||8,R=R||6,z=z||2*Math.PI;for(var O=[],V=[],U=0;E>=U;U++)for(var H=0;R>=H;H++){var G=H/R*z,X=U/E*Math.PI*2,Q=(T+A*Math.cos(X))*Math.cos(G),Z=(T+A*Math.cos(X))*Math.sin(G),K=A*Math.sin(X);O.push(Q,Z,K)}for(U=1;E>=U;U++)for(H=1;R>=H;H++){var J=(R+1)*U+H-1,$=(R+1)*(U-1)+H-1,et=(R+1)*(U-1)+H,nt=(R+1)*U+H;V.push(J,$,nt),V.push($,et,nt)}return new n(O,V)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(T,A){function n(){E.call(this),this.iterations=10,this.tolerance=1e-7}A.exports=n;var E=(T("../math/Vec3"),T("../math/Quaternion"),T("./Solver"));n.prototype=new E;var R=[],z=[],O=[];n.prototype.solve=function(T,A){var E,V,U,H,G,X=0,Q=this.iterations,Z=this.tolerance*this.tolerance,K=this.equations,J=K.length,$=A.bodies,et=$.length,nt=T;if(0!==J)for(var ot=0;ot!==et;ot++)$[ot].updateSolveMassProperties();var it=z,rt=O,st=R;for(it.length=J,rt.length=J,st.length=J,ot=0;ot!==J;ot++){var at=K[ot];st[ot]=0,rt[ot]=at.computeB(nt),it[ot]=1/at.computeC()}if(0!==J){for(ot=0;ot!==et;ot++){var lt=(ht=$[ot]).vlambda,ut=ht.wlambda;lt.set(0,0,0),ut&&ut.set(0,0,0)}for(X=0;X!==Q;X++){H=0;for(var ct=0;ct!==J;ct++)at=K[ct],E=rt[ct],V=it[ct],(G=st[ct])+(U=V*(E-at.computeGWlambda()-at.eps*G))<at.minForce?U=at.minForce-G:G+U>at.maxForce&&(U=at.maxForce-G),st[ct]+=U,H+=U>0?U:-U,at.addToWlambda(U);if(Z>H*H)break}for(ot=0;ot!==et;ot++){var ht,pt=(ht=$[ot]).velocity,dt=ht.angularVelocity;pt.vadd(ht.vlambda,pt),dt&&dt.vadd(ht.wlambda,dt)}}return X}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(T,A){function n(){this.equations=[]}A.exports=n,n.prototype.solve=function(){return 0},n.prototype.addEquation=function(T){T.enabled&&this.equations.push(T)},n.prototype.removeEquation=function(T){var A=this.equations,E=A.indexOf(T);-1!==E&&A.splice(E,1)},n.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(T,A){function n(T){for(E.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=T,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function o(T){for(var A=T.length,E=0;E!==A;E++){var R=T[E];if(!(R.visited||R.body.type&U))return R}return!1}function d(T,A,E,R){for(H.push(T),T.visited=!0,A(T,E,R);H.length;)for(var z,O=H.pop();z=o(O.children);)z.visited=!0,A(z,E,R),H.push(z)}function i(T,A,E){A.push(T.body);for(var R=T.eqs.length,z=0;z!==R;z++){var O=T.eqs[z];-1===E.indexOf(O)&&E.push(O)}}function t(T,A){return A.id-T.id}A.exports=n;var E=(T("../math/Vec3"),T("../math/Quaternion"),T("./Solver")),R=T("../objects/Body");n.prototype=new E;var z=[],O=[],V={bodies:[]},U=R.STATIC,H=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(T,A){for(var E=z,R=this.nodePool,U=A.bodies,H=this.equations,G=H.length,X=U.length,Q=this.subsolver;R.length<X;)R.push(this.createNode());E.length=X;for(var Z=0;X>Z;Z++)E[Z]=R[Z];for(Z=0;Z!==X;Z++){var K=E[Z];K.body=U[Z],K.children.length=0,K.eqs.length=0,K.visited=!1}for(var J=0;J!==G;J++){var $=H[J],et=(Z=U.indexOf($.bi),U.indexOf($.bj)),nt=E[Z],ot=E[et];nt.children.push(ot),nt.eqs.push($),ot.children.push(nt),ot.eqs.push($)}var it,rt=0,st=O;Q.tolerance=this.tolerance,Q.iterations=this.iterations;for(var at=V;it=o(E);){st.length=0,at.bodies.length=0,d(it,i,at.bodies,st);var lt=st.length;for(st=st.sort(t),Z=0;Z!==lt;Z++)Q.addEquation(st[Z]);Q.solve(T,at),Q.removeAllEquations(),rt++}return rt}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(T,A){var n=function(){};A.exports=n,n.prototype={constructor:n,addEventListener:function(T,A){void 0===this._listeners&&(this._listeners={});var E=this._listeners;return void 0===E[T]&&(E[T]=[]),-1===E[T].indexOf(A)&&E[T].push(A),this},hasEventListener:function(T,A){if(void 0===this._listeners)return!1;var E=this._listeners;return void 0!==E[T]&&-1!==E[T].indexOf(A)},removeEventListener:function(T,A){if(void 0===this._listeners)return this;var E=this._listeners;if(void 0===E[T])return this;var R=E[T].indexOf(A);return-1!==R&&E[T].splice(R,1),this},dispatchEvent:function(T){if(void 0===this._listeners)return this;var A=this._listeners[T.type];if(void 0!==A){T.target=this;for(var E=0,R=A.length;R>E;E++)A[E].call(this,T)}return this}}},{}],50:[function(T,A){function n(T){T=T||{},this.root=T.root||null,this.aabb=T.aabb?T.aabb.clone():new E,this.data=[],this.children=[]}function o(T,A){(A=A||{}).root=null,A.aabb=T,n.call(this,A),this.maxDepth=void 0!==A.maxDepth?A.maxDepth:8}var E=T("../collision/AABB"),R=T("../math/Vec3");A.exports=o,o.prototype=new n,n.prototype.reset=function(){this.children.length=this.data.length=0},n.prototype.insert=function(T,A,E){var R=this.data;if(E=E||0,!this.aabb.contains(T))return!1;var z=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var O=!1;z.length||(this.subdivide(),O=!0);for(var V=0;8!==V;V++)if(z[V].insert(T,A,E+1))return!0;O&&(z.length=0)}return R.push(A),!0};var z=new R;n.prototype.subdivide=function(){var T=this.aabb,A=T.lowerBound,O=T.upperBound,V=this.children;V.push(new n({aabb:new E({lowerBound:new R(0,0,0)})}),new n({aabb:new E({lowerBound:new R(1,0,0)})}),new n({aabb:new E({lowerBound:new R(1,1,0)})}),new n({aabb:new E({lowerBound:new R(1,1,1)})}),new n({aabb:new E({lowerBound:new R(0,1,1)})}),new n({aabb:new E({lowerBound:new R(0,0,1)})}),new n({aabb:new E({lowerBound:new R(1,0,1)})}),new n({aabb:new E({lowerBound:new R(0,1,0)})})),O.vsub(A,z),z.scale(.5,z);for(var U=this.root||this,H=0;8!==H;H++){var G=V[H];G.root=U;var X=G.aabb.lowerBound;X.x*=z.x,X.y*=z.y,X.z*=z.z,X.vadd(A,X),X.vadd(z,G.aabb.upperBound)}},n.prototype.aabbQuery=function(T,A){for(var E=(this.data,this.children,[this]);E.length;){var R=E.pop();R.aabb.overlaps(T)&&Array.prototype.push.apply(A,R.data),Array.prototype.push.apply(E,R.children)}return A};var O=new E;n.prototype.rayQuery=function(T,A,E){return T.getAABB(O),O.toLocalFrame(A,O),this.aabbQuery(O,E),E},n.prototype.removeEmptyNodes=function(){for(var T=[this];T.length;){for(var A=T.pop(),E=A.children.length-1;E>=0;E--)A.children[E].data.length||A.children.splice(E,1);Array.prototype.push.apply(T,A.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(T,A){function n(){this.objects=[],this.type=Object}A.exports=n,n.prototype.release=function(){for(var T=arguments.length,A=0;A!==T;A++)this.objects.push(arguments[A])},n.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},n.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(T,A){function n(){this.data={keys:[]}}A.exports=n,n.prototype.get=function(T,A){if(T>A){var E=A;A=T,T=E}return this.data[T+"-"+A]},n.prototype.set=function(T,A,E){if(T>A){var R=A;A=T,T=R}var z=T+"-"+A;this.get(T,A)||this.data.keys.push(z),this.data[z]=E},n.prototype.reset=function(){for(var T=this.data,A=T.keys;A.length>0;)delete T[A.pop()]}},{}],53:[function(T,A){function n(){}A.exports=n,n.defaults=function(T,A){for(var E in T=T||{},A)E in T||(T[E]=A[E]);return T}},{}],54:[function(T,A){function n(){R.call(this),this.type=E}A.exports=n;var E=T("../math/Vec3"),R=T("./Pool");n.prototype=new R,n.prototype.constructObject=function(){return new E}},{"../math/Vec3":30,"./Pool":51}],55:[function(T,A){function n(T){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new H,this.world=T,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function o(T,A,E){for(var R=null,z=T.length,O=0;O!==z;O++){var V=T[O],U=St;T[(O+1)%z].vsub(V,U);var H=Et;U.cross(A,H);var G=Ct;E.vsub(V,G);var X=H.dot(G);if(!(null===R||X>0&&!0===R||0>=X&&!1===R))return!1;null===R&&(R=X>0)}return!0}A.exports=n;var E=T("../collision/AABB"),R=T("../shapes/Shape"),z=T("../collision/Ray"),O=T("../math/Vec3"),V=T("../math/Transform"),U=(T("../shapes/ConvexPolyhedron"),T("../math/Quaternion")),H=(T("../solver/Solver"),T("../utils/Vec3Pool")),G=T("../equations/ContactEquation"),X=T("../equations/FrictionEquation");n.prototype.createContactEquation=function(T,A,E,R,z,O){var V;this.contactPointPool.length?((V=this.contactPointPool.pop()).bi=T,V.bj=A):V=new G(T,A),V.enabled=T.collisionResponse&&A.collisionResponse&&E.collisionResponse&&R.collisionResponse;var U=this.currentContactMaterial;V.restitution=U.restitution,V.setSpookParams(U.contactEquationStiffness,U.contactEquationRelaxation,this.world.dt);var H=E.material||T.material,X=R.material||A.material;return H&&X&&H.restitution>=0&&X.restitution>=0&&(V.restitution=H.restitution*X.restitution),V.si=z||E,V.sj=O||R,V},n.prototype.createFrictionEquationsFromContact=function(T,A){var E=T.bi,R=T.bj,z=T.si,O=T.sj,V=this.world,U=this.currentContactMaterial,H=U.friction,G=z.material||E.material,Q=O.material||R.material;if(G&&Q&&G.friction>=0&&Q.friction>=0&&(H=G.friction*Q.friction),H>0){var Z=H*V.gravity.length(),K=E.invMass+R.invMass;K>0&&(K=1/K);var J=this.frictionEquationPool,$=J.length?J.pop():new X(E,R,Z*K),et=J.length?J.pop():new X(E,R,Z*K);return $.bi=et.bi=E,$.bj=et.bj=R,$.minForce=et.minForce=-Z*K,$.maxForce=et.maxForce=Z*K,$.ri.copy(T.ri),$.rj.copy(T.rj),et.ri.copy(T.ri),et.rj.copy(T.rj),T.ni.tangents($.t,et.t),$.setSpookParams(U.frictionEquationStiffness,U.frictionEquationRelaxation,V.dt),et.setSpookParams(U.frictionEquationStiffness,U.frictionEquationRelaxation,V.dt),$.enabled=et.enabled=T.enabled,A.push($,et),!0}return!1};var Q=new O,Z=new O,K=new O;n.prototype.createFrictionFromAverage=function(T){var A=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(A,this.frictionResult)&&1!==T){var E=this.frictionResult[this.frictionResult.length-2],R=this.frictionResult[this.frictionResult.length-1];Q.setZero(),Z.setZero(),K.setZero();for(var z=A.bi,O=(A.bj,0);O!==T;O++)(A=this.result[this.result.length-1-O]).bodyA!==z?(Q.vadd(A.ni,Q),Z.vadd(A.ri,Z),K.vadd(A.rj,K)):(Q.vsub(A.ni,Q),Z.vadd(A.rj,Z),K.vadd(A.ri,K));var V=1/T;Z.scale(V,E.ri),K.scale(V,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),Q.normalize(),Q.tangents(E.t,R.t)}};var J=new O,$=new O,et=new U,nt=new U;n.prototype.getContacts=function(T,A,E,R,z,O,V){this.contactPointPool=z,this.frictionEquationPool=V,this.result=R,this.frictionResult=O;for(var U=et,H=nt,G=J,X=$,Q=0,Z=T.length;Q!==Z;Q++){var K=T[Q],ot=A[Q],it=null;K.material&&ot.material&&(it=E.getContactMaterial(K.material,ot.material)||null);for(var rt=0;rt<K.shapes.length;rt++){K.quaternion.mult(K.shapeOrientations[rt],U),K.quaternion.vmult(K.shapeOffsets[rt],G),G.vadd(K.position,G);for(var st=K.shapes[rt],at=0;at<ot.shapes.length;at++){ot.quaternion.mult(ot.shapeOrientations[at],H),ot.quaternion.vmult(ot.shapeOffsets[at],X),X.vadd(ot.position,X);var lt=ot.shapes[at];if(!(G.distanceTo(X)>st.boundingSphereRadius+lt.boundingSphereRadius)){var ut=null;st.material&&lt.material&&(ut=E.getContactMaterial(st.material,lt.material)||null),this.currentContactMaterial=ut||it||E.defaultContactMaterial;var ct=this[st.type|lt.type];ct&&(st.type<lt.type?ct.call(this,st,lt,G,X,U,H,K,ot,st,lt):ct.call(this,lt,st,X,G,H,U,ot,K,st,lt))}}}}},n.prototype[R.types.BOX|R.types.BOX]=n.prototype.boxBox=function(T,A,E,R,z,O,V,U){T.convexPolyhedronRepresentation.material=T.material,A.convexPolyhedronRepresentation.material=A.material,T.convexPolyhedronRepresentation.collisionResponse=T.collisionResponse,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexConvex(T.convexPolyhedronRepresentation,A.convexPolyhedronRepresentation,E,R,z,O,V,U,T,A)},n.prototype[R.types.BOX|R.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(T,A,E,R,z,O,V,U){T.convexPolyhedronRepresentation.material=T.material,T.convexPolyhedronRepresentation.collisionResponse=T.collisionResponse,this.convexConvex(T.convexPolyhedronRepresentation,A,E,R,z,O,V,U,T,A)},n.prototype[R.types.BOX|R.types.PARTICLE]=n.prototype.boxParticle=function(T,A,E,R,z,O,V,U){T.convexPolyhedronRepresentation.material=T.material,T.convexPolyhedronRepresentation.collisionResponse=T.collisionResponse,this.convexParticle(T.convexPolyhedronRepresentation,A,E,R,z,O,V,U,T,A)},n.prototype[R.types.SPHERE]=n.prototype.sphereSphere=function(T,A,E,R,z,O,V,U){var H=this.createContactEquation(V,U,T,A);R.vsub(E,H.ni),H.ni.normalize(),H.ri.copy(H.ni),H.rj.copy(H.ni),H.ri.mult(T.radius,H.ri),H.rj.mult(-A.radius,H.rj),H.ri.vadd(E,H.ri),H.ri.vsub(V.position,H.ri),H.rj.vadd(R,H.rj),H.rj.vsub(U.position,H.rj),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)};var ot=new O,it=new O,rt=new O;n.prototype[R.types.PLANE|R.types.TRIMESH]=n.prototype.planeTrimesh=function(T,A,E,R,z,U,H,G){var X=new O,Q=ot;Q.set(0,0,1),z.vmult(Q,Q);for(var Z=0;Z<A.vertices.length/3;Z++){A.getVertex(Z,X);var K=new O;K.copy(X),V.pointToWorldFrame(R,U,K,X);var J=it;if(X.vsub(E,J),0>=Q.dot(J)){var $=this.createContactEquation(H,G,T,A);$.ni.copy(Q);var et=rt;Q.scale(J.dot(Q),et),X.vsub(et,et),$.ri.copy(et),$.ri.vsub(H.position,$.ri),$.rj.copy(X),$.rj.vsub(G.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}}};var st=new O,at=new O,lt=(new O,new O),ut=new O,ct=new O,ht=new O,pt=new O,dt=new O,ft=new O,vt=new O,mt=new O,gt=new O,wt=new O,bt=new E,xt=[];n.prototype[R.types.SPHERE|R.types.TRIMESH]=n.prototype.sphereTrimesh=function(T,A,E,R,O,U,H,G){var X=ct,Q=ht,Z=pt,K=dt,J=ft,$=vt,et=bt,nt=ut,ot=at,it=xt;V.pointToLocalFrame(R,U,E,J);var rt=T.radius;et.lowerBound.set(J.x-rt,J.y-rt,J.z-rt),et.upperBound.set(J.x+rt,J.y+rt,J.z+rt),A.getTrianglesInAABB(et,it);for(var Tt=lt,At=T.radius*T.radius,St=0;St<it.length;St++)for(var Et=0;3>Et;Et++)A.getVertex(A.indices[3*it[St]+Et],Tt),Tt.vsub(J,ot),ot.norm2()<=At&&(nt.copy(Tt),V.pointToWorldFrame(R,U,nt,Tt),Tt.vsub(E,ot),(Rt=this.createContactEquation(H,G,T,A)).ni.copy(ot),Rt.ni.normalize(),Rt.ri.copy(Rt.ni),Rt.ri.scale(T.radius,Rt.ri),Rt.ri.vadd(E,Rt.ri),Rt.ri.vsub(H.position,Rt.ri),Rt.rj.copy(Tt),Rt.rj.vsub(G.position,Rt.rj),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult));for(St=0;St<it.length;St++)for(Et=0;3>Et;Et++){A.getVertex(A.indices[3*it[St]+Et],X),A.getVertex(A.indices[3*it[St]+(Et+1)%3],Q),Q.vsub(X,Z),J.vsub(Q,$);var Ct=$.dot(Z);J.vsub(X,$);var It=$.dot(Z);if(It>0&&0>Ct&&(J.vsub(X,$),K.copy(Z),K.normalize(),It=$.dot(K),K.scale(It,$),$.vadd(X,$),(Lt=$.distanceTo(J))<T.radius)){var Rt=this.createContactEquation(H,G,T,A);$.vsub(J,Rt.ni),Rt.ni.normalize(),Rt.ni.scale(T.radius,Rt.ri),V.pointToWorldFrame(R,U,$,$),$.vsub(G.position,Rt.rj),V.vectorToWorldFrame(U,Rt.ni,Rt.ni),V.vectorToWorldFrame(U,Rt.ri,Rt.ri),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult)}}for(var _t=mt,Pt=gt,zt=wt,Bt=st,Ot=(St=0,it.length);St!==Ot;St++){A.getTriangleVertices(it[St],_t,Pt,zt),A.getNormal(it[St],Bt),J.vsub(_t,$);var Lt=$.dot(Bt);Bt.scale(Lt,$),J.vsub($,$),Lt=$.distanceTo(J),z.pointInTriangle($,_t,Pt,zt)&&Lt<T.radius&&(Rt=this.createContactEquation(H,G,T,A),$.vsub(J,Rt.ni),Rt.ni.normalize(),Rt.ni.scale(T.radius,Rt.ri),V.pointToWorldFrame(R,U,$,$),$.vsub(G.position,Rt.rj),V.vectorToWorldFrame(U,Rt.ni,Rt.ni),V.vectorToWorldFrame(U,Rt.ri,Rt.ri),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult))}it.length=0};var Tt=new O,At=new O;n.prototype[R.types.SPHERE|R.types.PLANE]=n.prototype.spherePlane=function(T,A,E,R,z,O,V,U){var H=this.createContactEquation(V,U,T,A);if(H.ni.set(0,0,1),O.vmult(H.ni,H.ni),H.ni.negate(H.ni),H.ni.normalize(),H.ni.mult(T.radius,H.ri),E.vsub(R,Tt),H.ni.mult(H.ni.dot(Tt),At),Tt.vsub(At,H.rj),-Tt.dot(H.ni)<=T.radius){var G=H.ri,X=H.rj;G.vadd(E,G),G.vsub(V.position,G),X.vadd(R,X),X.vsub(U.position,X),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)}};var St=new O,Et=new O,Ct=new O,It=new O,Rt=new O,_t=new O,Pt=new O,zt=[new O,new O,new O,new O,new O,new O],Bt=new O,Ot=new O,Lt=new O,Mt=new O;n.prototype[R.types.SPHERE|R.types.BOX]=n.prototype.sphereBox=function(T,A,E,R,z,O,V,U){var H=this.v3pool,G=zt;E.vsub(R,It),A.getSideNormals(G,O);for(var X=T.radius,Q=!1,Z=Ot,K=Lt,J=Mt,$=null,et=0,nt=0,ot=0,it=null,rt=0,st=G.length;rt!==st&&!1===Q;rt++){var at=Rt;at.copy(G[rt]);var lt=at.norm();at.normalize();var ut=It.dot(at);if(lt+X>ut&&ut>0){var ct=_t,ht=Pt;ct.copy(G[(rt+1)%3]),ht.copy(G[(rt+2)%3]);var pt=ct.norm(),dt=ht.norm();ct.normalize(),ht.normalize();var ft=It.dot(ct),vt=It.dot(ht);if(pt>ft&&ft>-pt&&dt>vt&&vt>-dt){var mt=Math.abs(ut-lt-X);(null===it||it>mt)&&(it=mt,nt=ft,ot=vt,$=lt,Z.copy(at),K.copy(ct),J.copy(ht),et++)}}}if(et){Q=!0;var gt=this.createContactEquation(V,U,T,A);Z.mult(-X,gt.ri),gt.ni.copy(Z),gt.ni.negate(gt.ni),Z.mult($,Z),K.mult(nt,K),Z.vadd(K,Z),J.mult(ot,J),Z.vadd(J,gt.rj),gt.ri.vadd(E,gt.ri),gt.ri.vsub(V.position,gt.ri),gt.rj.vadd(R,gt.rj),gt.rj.vsub(U.position,gt.rj),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult)}for(var wt=H.get(),bt=Bt,xt=0;2!==xt&&!Q;xt++)for(var Tt=0;2!==Tt&&!Q;Tt++)for(var At=0;2!==At&&!Q;At++)wt.set(0,0,0),xt?wt.vadd(G[0],wt):wt.vsub(G[0],wt),Tt?wt.vadd(G[1],wt):wt.vsub(G[1],wt),At?wt.vadd(G[2],wt):wt.vsub(G[2],wt),R.vadd(wt,bt),bt.vsub(E,bt),bt.norm2()<X*X&&(Q=!0,(gt=this.createContactEquation(V,U,T,A)).ri.copy(bt),gt.ri.normalize(),gt.ni.copy(gt.ri),gt.ri.mult(X,gt.ri),gt.rj.copy(wt),gt.ri.vadd(E,gt.ri),gt.ri.vsub(V.position,gt.ri),gt.rj.vadd(R,gt.rj),gt.rj.vsub(U.position,gt.rj),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult));H.release(wt),wt=null;var St=H.get(),Et=H.get(),Ct=(gt=H.get(),H.get()),Nt=(mt=H.get(),G.length);for(xt=0;xt!==Nt&&!Q;xt++)for(Tt=0;Tt!==Nt&&!Q;Tt++)if(xt%3!=Tt%3){G[Tt].cross(G[xt],St),St.normalize(),G[xt].vadd(G[Tt],Et),gt.copy(E),gt.vsub(Et,gt),gt.vsub(R,gt);var kt=gt.dot(St);for(St.mult(kt,Ct),At=0;At===xt%3||At===Tt%3;)At++;mt.copy(E),mt.vsub(Ct,mt),mt.vsub(Et,mt),mt.vsub(R,mt);var qt=Math.abs(kt),Dt=mt.norm();if(qt<G[At].norm()&&X>Dt){Q=!0;var Vt=this.createContactEquation(V,U,T,A);Et.vadd(Ct,Vt.rj),Vt.rj.copy(Vt.rj),mt.negate(Vt.ni),Vt.ni.normalize(),Vt.ri.copy(Vt.rj),Vt.ri.vadd(R,Vt.ri),Vt.ri.vsub(E,Vt.ri),Vt.ri.normalize(),Vt.ri.mult(X,Vt.ri),Vt.ri.vadd(E,Vt.ri),Vt.ri.vsub(V.position,Vt.ri),Vt.rj.vadd(R,Vt.rj),Vt.rj.vsub(U.position,Vt.rj),this.result.push(Vt),this.createFrictionEquationsFromContact(Vt,this.frictionResult)}}H.release(St,Et,gt,Ct,mt)};var Nt=new O,kt=new O,qt=new O,Dt=new O,Vt=new O,Wt=new O,Ut=new O,Ht=new O,jt=new O,Gt=new O;n.prototype[R.types.SPHERE|R.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(T,A,E,R,z,O,V,U){var H=this.v3pool;E.vsub(R,Nt);for(var G=A.faceNormals,X=A.faces,Q=A.vertices,Z=T.radius,K=0;K!==Q.length;K++){var J=Q[K],$=Vt;O.vmult(J,$),R.vadd($,$);var et=Dt;if($.vsub(E,et),et.norm2()<Z*Z)return nt=!0,(mt=this.createContactEquation(V,U,T,A)).ri.copy(et),mt.ri.normalize(),mt.ni.copy(mt.ri),mt.ri.mult(Z,mt.ri),$.vsub(R,mt.rj),mt.ri.vadd(E,mt.ri),mt.ri.vsub(V.position,mt.ri),mt.rj.vadd(R,mt.rj),mt.rj.vsub(U.position,mt.rj),this.result.push(mt),void this.createFrictionEquationsFromContact(mt,this.frictionResult)}for(var nt=!1,ot=(K=0,X.length);K!==ot&&!1===nt;K++){var it=G[K],rt=X[K],st=Wt;O.vmult(it,st);var at=Ut;O.vmult(Q[rt[0]],at),at.vadd(R,at);var lt=Ht;st.mult(-Z,lt),E.vadd(lt,lt);var ut=jt;lt.vsub(at,ut);var ct=ut.dot(st),ht=Gt;if(E.vsub(at,ht),0>ct&&ht.dot(st)>0){for(var pt=[],dt=0,ft=rt.length;dt!==ft;dt++){var vt=H.get();O.vmult(Q[rt[dt]],vt),R.vadd(vt,vt),pt.push(vt)}if(o(pt,st,E)){nt=!0;var mt=this.createContactEquation(V,U,T,A);st.mult(-Z,mt.ri),st.negate(mt.ni);var gt=H.get();st.mult(-ct,gt);var wt=H.get();st.mult(-Z,wt),E.vsub(R,mt.rj),mt.rj.vadd(wt,mt.rj),mt.rj.vadd(gt,mt.rj),mt.rj.vadd(R,mt.rj),mt.rj.vsub(U.position,mt.rj),mt.ri.vadd(E,mt.ri),mt.ri.vsub(V.position,mt.ri),H.release(gt),H.release(wt),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult),dt=0;for(var bt=pt.length;dt!==bt;dt++)H.release(pt[dt]);return}for(dt=0;dt!==rt.length;dt++){var xt=H.get(),Tt=H.get();O.vmult(Q[rt[(dt+1)%rt.length]],xt),O.vmult(Q[rt[(dt+2)%rt.length]],Tt),R.vadd(xt,xt),R.vadd(Tt,Tt);var At=kt;Tt.vsub(xt,At);var St=qt;At.unit(St);var Et=H.get(),Ct=H.get();E.vsub(xt,Ct);var It=Ct.dot(St);St.mult(It,Et),Et.vadd(xt,Et);var Rt=H.get();if(Et.vsub(E,Rt),It>0&&It*It<At.norm2()&&Rt.norm2()<Z*Z){for(mt=this.createContactEquation(V,U,T,A),Et.vsub(R,mt.rj),Et.vsub(E,mt.ni),mt.ni.normalize(),mt.ni.mult(Z,mt.ri),mt.rj.vadd(R,mt.rj),mt.rj.vsub(U.position,mt.rj),mt.ri.vadd(E,mt.ri),mt.ri.vsub(V.position,mt.ri),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult),dt=0,bt=pt.length;dt!==bt;dt++)H.release(pt[dt]);return H.release(xt),H.release(Tt),H.release(Et),H.release(Rt),void H.release(Ct)}H.release(xt),H.release(Tt),H.release(Et),H.release(Rt),H.release(Ct)}for(dt=0,bt=pt.length;dt!==bt;dt++)H.release(pt[dt])}}},new O,new O,n.prototype[R.types.PLANE|R.types.BOX]=n.prototype.planeBox=function(T,A,E,R,z,O,V,U){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.planeConvex(T,A.convexPolyhedronRepresentation,E,R,z,O,V,U)};var Xt=new O,Yt=new O,Qt=new O,Zt=new O;n.prototype[R.types.PLANE|R.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(T,A,E,R,z,O,V,U){var H=Xt,G=Yt;G.set(0,0,1),z.vmult(G,G);for(var X=0,Q=Qt,Z=0;Z!==A.vertices.length;Z++)if(H.copy(A.vertices[Z]),O.vmult(H,H),R.vadd(H,H),H.vsub(E,Q),0>=G.dot(Q)){var K=this.createContactEquation(V,U,T,A),J=Zt;G.mult(G.dot(Q),J),H.vsub(J,J),J.vsub(E,K.ri),K.ni.copy(G),H.vsub(R,K.rj),K.ri.vadd(E,K.ri),K.ri.vsub(V.position,K.ri),K.rj.vadd(R,K.rj),K.rj.vsub(U.position,K.rj),this.result.push(K),X++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(K,this.frictionResult)}this.enableFrictionReduction&&X&&this.createFrictionFromAverage(X)};var Jt=new O,$t=new O;n.prototype[R.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(T,A,E,R,z,O,V,U,H,G,X,Q){var Z=Jt;if(!(E.distanceTo(R)>T.boundingSphereRadius+A.boundingSphereRadius)&&T.findSeparatingAxis(A,E,z,R,O,Z,X,Q)){var K=[],J=$t;T.clipAgainstHull(E,z,A,R,O,Z,-100,100,K);for(var $=0,et=0;et!==K.length;et++){var nt=this.createContactEquation(V,U,T,A,H,G),ot=nt.ri,it=nt.rj;Z.negate(nt.ni),K[et].normal.negate(J),J.mult(K[et].depth,J),K[et].point.vadd(J,ot),it.copy(K[et].point),ot.vsub(E,ot),it.vsub(R,it),ot.vadd(E,ot),ot.vsub(V.position,ot),it.vadd(R,it),it.vsub(U.position,it),this.result.push(nt),$++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(nt,this.frictionResult)}this.enableFrictionReduction&&$&&this.createFrictionFromAverage($)}};var ee=new O,ne=new O,oe=new O;n.prototype[R.types.PLANE|R.types.PARTICLE]=n.prototype.planeParticle=function(T,A,E,R,z,O,V,U){var H=ee;H.set(0,0,1),V.quaternion.vmult(H,H);var G=ne;if(R.vsub(V.position,G),0>=H.dot(G)){var X=this.createContactEquation(U,V,A,T);X.ni.copy(H),X.ni.negate(X.ni),X.ri.set(0,0,0);var Q=oe;H.mult(H.dot(R),Q),R.vsub(Q,Q),X.rj.copy(Q),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult)}};var ie=new O;n.prototype[R.types.PARTICLE|R.types.SPHERE]=n.prototype.sphereParticle=function(T,A,E,R,z,O,V,U){var H=ie;if(H.set(0,0,1),R.vsub(E,H),H.norm2()<=T.radius*T.radius){var G=this.createContactEquation(U,V,A,T);H.normalize(),G.rj.copy(H),G.rj.mult(T.radius,G.rj),G.ni.copy(H),G.ni.negate(G.ni),G.ri.set(0,0,0),this.result.push(G),this.createFrictionEquationsFromContact(G,this.frictionResult)}};var re=new U,se=new O,ae=(new O,new O),le=new O,ue=new O;n.prototype[R.types.PARTICLE|R.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(T,A,E,R,z,O,V,U){var H=-1,G=ae,X=ue,Q=null,Z=se;if(Z.copy(R),Z.vsub(E,Z),z.conjugate(re),re.vmult(Z,Z),T.pointIsInside(Z)){T.worldVerticesNeedsUpdate&&T.computeWorldVertices(E,z),T.worldFaceNormalsNeedsUpdate&&T.computeWorldFaceNormals(z);for(var K=0,J=T.faces.length;K!==J;K++){var $=[T.worldVertices[T.faces[K][0]]],et=T.worldFaceNormals[K];R.vsub($[0],le);var nt=-et.dot(le);(null===Q||Math.abs(nt)<Math.abs(Q))&&(Q=nt,H=K,G.copy(et))}if(-1!==H){var ot=this.createContactEquation(U,V,A,T);G.mult(Q,X),X.vadd(R,X),X.vsub(E,X),ot.rj.copy(X),G.negate(ot.ni),ot.ri.set(0,0,0);var it=ot.ri,rt=ot.rj;it.vadd(R,it),it.vsub(U.position,it),rt.vadd(E,rt),rt.vsub(V.position,rt),this.result.push(ot),this.createFrictionEquationsFromContact(ot,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[R.types.BOX|R.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(T,A,E,R,z,O,V,U){T.convexPolyhedronRepresentation.material=T.material,T.convexPolyhedronRepresentation.collisionResponse=T.collisionResponse,this.convexHeightfield(T.convexPolyhedronRepresentation,A,E,R,z,O,V,U)};var ce=new O,he=new O,pe=[0];n.prototype[R.types.CONVEXPOLYHEDRON|R.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(T,A,E,R,z,O,U,H){var G=A.data,X=A.elementSize,Q=T.boundingSphereRadius,Z=he,K=pe,J=ce;V.pointToLocalFrame(R,O,E,J);var $=Math.floor((J.x-Q)/X)-1,et=Math.ceil((J.x+Q)/X)+1,nt=Math.floor((J.y-Q)/X)-1,ot=Math.ceil((J.y+Q)/X)+1;if(!(0>et||0>ot||$>G.length||nt>G[0].length)){0>$&&($=0),0>et&&(et=0),0>nt&&(nt=0),0>ot&&(ot=0),$>=G.length&&($=G.length-1),et>=G.length&&(et=G.length-1),ot>=G[0].length&&(ot=G[0].length-1),nt>=G[0].length&&(nt=G[0].length-1);var it=[];A.getRectMinMax($,nt,et,ot,it);var rt=it[0],st=it[1];if(!(J.z-Q>st||J.z+Q<rt))for(var at=$;et>at;at++)for(var lt=nt;ot>lt;lt++)A.getConvexTrianglePillar(at,lt,!1),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+T.boundingSphereRadius&&this.convexConvex(T,A.pillarConvex,E,Z,z,O,U,H,null,null,K,null),A.getConvexTrianglePillar(at,lt,!0),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+T.boundingSphereRadius&&this.convexConvex(T,A.pillarConvex,E,Z,z,O,U,H,null,null,K,null)}};var de=new O,fe=new O;n.prototype[R.types.SPHERE|R.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(T,A,E,R,z,O,U,H){var G=A.data,X=T.radius,Q=A.elementSize,Z=fe,K=de;V.pointToLocalFrame(R,O,E,K);var J=Math.floor((K.x-X)/Q)-1,$=Math.ceil((K.x+X)/Q)+1,et=Math.floor((K.y-X)/Q)-1,nt=Math.ceil((K.y+X)/Q)+1;if(!(0>$||0>nt||J>G.length||nt>G[0].length)){0>J&&(J=0),0>$&&($=0),0>et&&(et=0),0>nt&&(nt=0),J>=G.length&&(J=G.length-1),$>=G.length&&($=G.length-1),nt>=G[0].length&&(nt=G[0].length-1),et>=G[0].length&&(et=G[0].length-1);var ot=[];A.getRectMinMax(J,et,$,nt,ot);var it=ot[0],rt=ot[1];if(!(K.z-X>rt||K.z+X<it))for(var st=this.result,at=J;$>at;at++)for(var lt=et;nt>lt;lt++){var ut=st.length;if(A.getConvexTrianglePillar(at,lt,!1),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+T.boundingSphereRadius&&this.sphereConvex(T,A.pillarConvex,E,Z,z,O,U,H),A.getConvexTrianglePillar(at,lt,!0),V.pointToWorldFrame(R,O,A.pillarOffset,Z),E.distanceTo(Z)<A.pillarConvex.boundingSphereRadius+T.boundingSphereRadius&&this.sphereConvex(T,A.pillarConvex,E,Z,z,O,U,H),st.length-ut>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(T,A){function n(){U.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new R,this.broadphase=new et,this.bodies=[],this.solver=new O,this.constraints=[],this.narrowphase=new V(this),this.collisionMatrix=new H,this.collisionMatrixPrevious=new H,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new Z,this.defaultMaterial=new G("default"),this.defaultContactMaterial=new X(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}A.exports=n;var E=T("../shapes/Shape"),R=T("../math/Vec3"),z=T("../math/Quaternion"),O=T("../solver/GSSolver"),V=(T("../utils/Vec3Pool"),T("../equations/ContactEquation"),T("../equations/FrictionEquation"),T("./Narrowphase")),U=T("../utils/EventTarget"),H=T("../collision/ArrayCollisionMatrix"),G=T("../material/Material"),X=T("../material/ContactMaterial"),Q=T("../objects/Body"),Z=T("../utils/TupleDictionary"),K=T("../collision/RaycastResult"),J=T("../collision/AABB"),$=T("../collision/Ray"),et=T("../collision/NaiveBroadphase");n.prototype=new U;var nt=(new J,new $);if(n.prototype.getContactMaterial=function(T,A){return this.contactMaterialTable.get(T.id,A.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var T=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=T,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(T){-1===this.bodies.indexOf(T)&&(T.index=this.bodies.length,this.bodies.push(T),T.world=this,T.initPosition.copy(T.position),T.initVelocity.copy(T.velocity),T.timeLastSleepy=this.time,T instanceof Q&&(T.initAngularVelocity.copy(T.angularVelocity),T.initQuaternion.copy(T.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=T,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(T){this.constraints.push(T)},n.prototype.removeConstraint=function(T){var A=this.constraints.indexOf(T);-1!==A&&this.constraints.splice(A,1)},n.prototype.rayTest=function(T,A,E){E instanceof K?this.raycastClosest(T,A,{skipBackfaces:!0},E):this.raycastAll(T,A,{skipBackfaces:!0},E)},n.prototype.raycastAll=function(T,A,E,R){return E.mode=$.ALL,E.from=T,E.to=A,E.callback=R,nt.intersectWorld(this,E)},n.prototype.raycastAny=function(T,A,E,R){return E.mode=$.ANY,E.from=T,E.to=A,E.result=R,nt.intersectWorld(this,E)},n.prototype.raycastClosest=function(T,A,E,R){return E.mode=$.CLOSEST,E.from=T,E.to=A,E.result=R,nt.intersectWorld(this,E)},n.prototype.remove=function(T){T.world=null;var A=this.bodies.length-1,E=this.bodies,R=E.indexOf(T);if(-1!==R){E.splice(R,1);for(var z=0;z!==E.length;z++)E[z].index=z;this.collisionMatrix.setNumObjects(A),this.removeBodyEvent.body=T,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(T){this.materials.push(T)},n.prototype.addContactMaterial=function(T){this.contactmaterials.push(T),this.contactMaterialTable.set(T.materials[0].id,T.materials[1].id,T)},"undefined"==typeof performance&&(performance={}),!performance.now){var ot=Date.now();performance.timing&&performance.timing.navigationStart&&(ot=performance.timing.navigationStart),performance.now=function(){return Date.now()-ot}}var it=new R;n.prototype.step=function(T,A,E){if(E=E||10,0===(A=A||0))this.internalStep(T),this.time+=T;else{var R=Math.floor((this.time+A)/T)-Math.floor(this.time/T);R=Math.min(R,E);for(var z=performance.now(),O=0;O!==R&&(this.internalStep(T),!(performance.now()-z>1e3*T));O++);this.time+=A;for(var V=this.time%T/T,U=it,H=this.bodies,G=0;G!==H.length;G++){var X=H[G];X.type!==Q.STATIC&&X.sleepState!==Q.SLEEPING?(X.position.vsub(X.previousPosition,U),U.scale(V,U),X.position.vadd(U,X.interpolatedPosition)):(X.interpolatedPosition.copy(X.position),X.interpolatedQuaternion.copy(X.quaternion))}}};var rt={type:"postStep"},st={type:"preStep"},at={type:"collide",body:null,contact:null},lt=[],ut=[],ct=[],ht=[],pt=(new R,new R,new R,new R,new R,new R,new R,new R,new R,new z,new z),dt=new z,ft=new R;n.prototype.internalStep=function(T){this.dt=T;var A,R=this.contacts,z=ct,O=ht,V=this.numObjects(),U=this.bodies,H=this.solver,G=this.gravity,X=this.doProfiling,Z=this.profile,K=Q.DYNAMIC,J=this.constraints,$=ut,et=(G.norm(),G.x),nt=G.y,ot=G.z,it=0;for(X&&(A=performance.now()),it=0;it!==V;it++)if((Ct=U[it]).type&K){var vt=Ct.force,mt=Ct.mass;vt.x+=mt*et,vt.y+=mt*nt,vt.z+=mt*ot}it=0;for(var gt=this.subsystems.length;it!==gt;it++)this.subsystems[it].update();X&&(A=performance.now()),z.length=0,O.length=0,this.broadphase.collisionPairs(this,z,O),X&&(Z.broadphase=performance.now()-A);var wt=J.length;for(it=0;it!==wt;it++)if(!(Rt=J[it]).collideConnected)for(var bt=z.length-1;bt>=0;bt-=1)(Rt.bodyA===z[bt]&&Rt.bodyB===O[bt]||Rt.bodyB===z[bt]&&Rt.bodyA===O[bt])&&(z.splice(bt,1),O.splice(bt,1));this.collisionMatrixTick(),X&&(A=performance.now());var xt=lt,Tt=R.length;for(it=0;it!==Tt;it++)xt.push(R[it]);R.length=0;var At=this.frictionEquations.length;for(it=0;it!==At;it++)$.push(this.frictionEquations[it]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(z,O,this,R,xt,this.frictionEquations,$),X&&(Z.narrowphase=performance.now()-A),X&&(A=performance.now()),it=0;it<this.frictionEquations.length;it++)H.addEquation(this.frictionEquations[it]);for(var St=R.length,Et=0;Et!==St;Et++){var Ct=(Rt=R[Et]).bi,It=Rt.bj;Rt.si,Rt.sj,(Ct.material&&It.material&&this.getContactMaterial(Ct.material,It.material)||this.defaultContactMaterial).friction,Ct.material&&It.material&&(Ct.material.friction>=0&&It.material.friction>=0&&(Ct.material.friction,It.material.friction),Ct.material.restitution>=0&&It.material.restitution>=0&&(Rt.restitution=Ct.material.restitution*It.material.restitution)),H.addEquation(Rt),Ct.allowSleep&&Ct.type===Q.DYNAMIC&&Ct.sleepState===Q.SLEEPING&&It.sleepState===Q.AWAKE&&It.type!==Q.STATIC&&It.velocity.norm2()+It.angularVelocity.norm2()>=2*Math.pow(It.sleepSpeedLimit,2)&&(Ct._wakeUpAfterNarrowphase=!0),It.allowSleep&&It.type===Q.DYNAMIC&&It.sleepState===Q.SLEEPING&&Ct.sleepState===Q.AWAKE&&Ct.type!==Q.STATIC&&Ct.velocity.norm2()+Ct.angularVelocity.norm2()>=2*Math.pow(Ct.sleepSpeedLimit,2)&&(It._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(Ct,It,!0),this.collisionMatrixPrevious.get(Ct,It)||(at.body=It,at.contact=Rt,Ct.dispatchEvent(at),at.body=Ct,It.dispatchEvent(at))}for(X&&(Z.makeContactConstraints=performance.now()-A,A=performance.now()),it=0;it!==V;it++)(Ct=U[it])._wakeUpAfterNarrowphase&&(Ct.wakeUp(),Ct._wakeUpAfterNarrowphase=!1);for(wt=J.length,it=0;it!==wt;it++){var Rt;(Rt=J[it]).update(),bt=0;for(var _t=Rt.equations.length;bt!==_t;bt++){var Pt=Rt.equations[bt];H.addEquation(Pt)}}H.solve(T,this),X&&(Z.solve=performance.now()-A),H.removeAllEquations();var zt=Math.pow;for(it=0;it!==V;it++)if((Ct=U[it]).type&K){var Bt=zt(1-Ct.linearDamping,T),Ot=Ct.velocity;Ot.mult(Bt,Ot);var Lt=Ct.angularVelocity;if(Lt){var Mt=zt(1-Ct.angularDamping,T);Lt.mult(Mt,Lt)}}for(this.dispatchEvent(st),it=0;it!==V;it++)(Ct=U[it]).preStep&&Ct.preStep.call(Ct);X&&(A=performance.now());var Nt=pt,kt=dt,qt=this.stepnumber,Dt=Q.DYNAMIC|Q.KINEMATIC,Vt=qt%(this.quatNormalizeSkip+1)==0,Wt=this.quatNormalizeFast,Ut=.5*T;for(E.types.PLANE,E.types.CONVEXPOLYHEDRON,it=0;it!==V;it++){var Ht=U[it],jt=Ht.force,Gt=Ht.torque;if(Ht.type&Dt&&Ht.sleepState!==Q.SLEEPING){var Xt=Ht.velocity,Yt=Ht.angularVelocity,Qt=Ht.position,Zt=Ht.quaternion,Jt=Ht.invMass,$t=Ht.invInertiaWorld;Xt.x+=jt.x*Jt*T,Xt.y+=jt.y*Jt*T,Xt.z+=jt.z*Jt*T,Ht.angularVelocity&&($t.vmult(Gt,ft),ft.mult(T,ft),ft.vadd(Yt,Yt)),Qt.x+=Xt.x*T,Qt.y+=Xt.y*T,Qt.z+=Xt.z*T,Ht.angularVelocity&&(Nt.set(Yt.x,Yt.y,Yt.z,0),Nt.mult(Zt,kt),Zt.x+=Ut*kt.x,Zt.y+=Ut*kt.y,Zt.z+=Ut*kt.z,Zt.w+=Ut*kt.w,Vt&&(Wt?Zt.normalizeFast():Zt.normalize())),Ht.aabb&&(Ht.aabbNeedsUpdate=!0),Ht.updateInertiaWorld&&Ht.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,X&&(Z.integrate=performance.now()-A),this.time+=T,this.stepnumber+=1,this.dispatchEvent(rt),it=0;it!==V;it++){var ee=(Ct=U[it]).postStep;ee&&ee.call(Ct)}if(this.allowSleep)for(it=0;it!==V;it++)U[it].sleepTick(this.time)},n.prototype.clearForces=function(){for(var T=this.bodies,A=T.length,E=0;E!==A;E++){var R=T[E];R.force,R.torque,R.force.set(0,0,0),R.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})),define("node_modules/decentraland-builder-scripts/channel",["require","exports"],(function(T,A){Object.defineProperty(A,"__esModule",{value:!0}),A.createChannel=void 0;var E="__request_value__",R="__reply_value__";A.createChannel=function(T,A,z){var O={},V={},U={};return z.on(A.name,(function(T){var A=O[T.actionId];A&&A(T),V={}})),z.on(E,(function(E){if(E.sender!==T&&E.entityName===A.name){var O=E.key,H=U[O];if(H){var G=H(),X={entityName:A.name,key:O,sender:T,value:G};z.emit(R,X)}delete V[O]}})),z.on(R,(function(E){if(E.sender!==T&&E.entityName===A.name){var R=E.key,z=E.value,O=V[R];O&&O(z),delete V[R]}})),{id:T,bus:z,createAction:function(T,E){return{entityName:A.name,actionId:T,values:E}},sendActions:function(A){var E,R;void 0===A&&(A=[]);try{for(var O=__values(A),V=O.next();!V.done;V=O.next()){var U=V.value,H=__assign(__assign({},U),{sender:T});z.emit(H.entityName,H)}}catch(T){E={error:T}}finally{try{V&&!V.done&&(R=O.return)&&R.call(O)}finally{if(E)throw E.error}}},handleAction:function(T,A){O[T]=A},request:function(R,O){V[R]=O;var U={entityName:A.name,key:R,sender:T},H=setInterval((function(){R in V?z.emit(E,U):clearInterval(H)}),5e3)},reply:function(T,A){U[T]=A}}}})),define("node_modules/decentraland-builder-scripts/inventory",["require","exports"],(function(T,A){Object.defineProperty(A,"__esModule",{value:!0}),A.createInventory=void 0,A.createInventory=function(T,A,E){var R=null,z=null,O={};return{add:function(V,U){var H=O[V]||new E((R||(R=new T),z||((z=new A(R)).isPointerBlocker=!1,z.vAlign="bottom",z.hAlign="right",z.stackOrientation=0,z.spacing=0,z.positionY=75,z.positionX=-25),z),U);H.width=128,H.height=128,H.sourceTop=0,H.sourceLeft=0,H.sourceHeight=256,H.sourceWidth=256,H.isPointerBlocker=!1,H.visible=!0,O[V]=H},remove:function(T){var A=O[T];A&&(A.visible=!1,A.height=0,A.width=0)},has:function(T){return T in O&&O[T].visible}}}})),define("imagePanel/src/item",["require","exports"],(function(T,A){Object.defineProperty(A,"__esModule",{value:!0});var E=function(){function SignPost(){}return SignPost.prototype.init=function(){},SignPost.prototype.spawn=function(T,A,E){var R=new Entity;R.setParent(T),R.addComponent(new Transform({}));var z=A.image,O=new Texture(z),V=new BasicMaterial;V.texture=O;var U=new Entity;U.setParent(T),U.addComponent(new PlaneShape),U.addComponent(V),U.addComponent(new Transform({position:new Vector3(0,.5,0),rotation:Quaternion.Euler(180,0,0),scale:new Vector3(1,1,1)})),U.addComponentOrReplace(new OnPointerDown((function(T){openExternalURL(A.url?A.url:"https://purplebee.org/")}),{hoverText:"Learn More"}))},SignPost}();A.default=E})),define("src/messageBus",["require","exports"],(function(T,A){Object.defineProperty(A,"__esModule",{value:!0}),A.sceneMessageBus=void 0,A.sceneMessageBus=new MessageBus})),define("videoStream/src/item",["require","exports","@decentraland/RestrictedActions"],(function(T,A,E){Object.defineProperty(A,"__esModule",{value:!0});var R=function(){function Button(){this.channel="",this.video={},this.materials={},this.active={},this.volume={},this.sign={}}return Button.prototype.init=function(){},Button.prototype.toggle=function(T,A){if(log("all screens: ",this.video," setting: ",T.name," to ",A),A){if(this.activeScreen&&this.activeScreen==T)return;this.activeScreen&&this.toggle(this.activeScreen,!1),this.activeScreen=T,this.active[T.name]=!0,this.video[T.name].volume=this.volume[T.name],this.video[T.name].playing=!0,engine.removeEntity(this.sign[T.name])}else{if(!this.activeScreen||this.activeScreen!=T)return;this.activeScreen=null,this.active[T.name]=!1,this.video[T.name].playing=!1}},Button.prototype.spawn=function(T,A,R){var z=this,O=new Entity(T.name+"-screen");O.setParent(T);O.addComponent(new PlaneShape),O.addComponent(new Transform({scale:new Vector3(2.976,1.08*1.55,15.5),position:new Vector3(0,.8494,0)})),A.customStation?this.channel=A.customStation:A.station?this.channel=A.station:this.channel="https://d3kt99p6ty4t3h.cloudfront.net/20210623_jagtronica_xAy1c/tVyNQJ.m3u8",this.video[O.name]=new VideoTexture(new VideoClip(this.channel)),this.materials[O.name]=new Material,this.materials[O.name].albedoTexture=this.video[O.name],this.materials[O.name].specularIntensity=0,this.materials[O.name].roughness=1,this.materials[O.name].metallic=0,this.materials[O.name].emissiveTexture=this.video[O.name],this.materials[O.name].emissiveIntensity=.8,this.materials[O.name].emissiveColor=new Color3(1,1,1),O.addComponent(this.materials[O.name]),this.sign[O.name]=new Entity(T.name+"-sign"),this.sign[O.name].setParent(O),this.sign[O.name].addComponent(new PlaneShape),this.sign[O.name].addComponent(new Transform({position:new Vector3(0,0,.002),rotation:Quaternion.Euler(180,0,0)})),this.volume[O.name]=A.volume;var V=new Material;V.albedoTexture=new Texture(A.image?A.image:"videoStream/images/stream.png"),V.specularIntensity=0,V.roughness=1,this.sign[O.name].addComponent(V),A.onClick&&(this.sign[O.name].addComponent(new OnPointerDown((function(){R.sendActions(A.onClick)}),{button:ActionButton.POINTER,hoverText:A.onClickText,distance:A.controlDist?A.controlDist:10})),O.addComponent(new OnPointerDown((function(){log("clicked"),R.sendActions(A.onClick)}),{button:ActionButton.POINTER,hoverText:A.onClickText,distance:A.controlDist?A.controlDist:10}))),A.startOn?this.toggle(O,!0):this.toggle(O,!1),R.handleAction("activate",(function(T){var E=T.sender;z.toggle(O,!0),E===R.id&&R.sendActions(A.onActivate)})),R.handleAction("deactivate",(function(T){var E=T.sender;z.toggle(O,!1),E===R.id&&R.sendActions(A.onDeactivate)})),R.handleAction("toggle",(function(T){var V=T.sender,U=!z.active[O.name];z.toggle(O,U),V===R.id&&(U?(R.sendActions(A.onActivate),(0,E.triggerEmote)({predefined:"handsair"})):R.sendActions(A.onDeactivate))})),R.request("isActive",(function(T){return z.toggle(O,T)})),R.reply("isActive",(function(){return z.active[O.name]}))},Button}();A.default=R})),define("src/game",["require","exports","@dcl/ecs-scene-utils","node_modules/decentraland-builder-scripts/channel","node_modules/decentraland-builder-scripts/inventory","imagePanel/src/item","src/messageBus","videoStream/src/item","@decentraland/RestrictedActions"],(function(T,A,E,R,z,O,V,U,H){Object.defineProperty(A,"__esModule",{value:!0});var G=Math.random().toString(16).slice(2),X=new MessageBus,Q=((0,z.createInventory)(UICanvas,UIContainerStack,UIImage),new Entity("_scene"));engine.addEntity(Q);var Z=new Transform({position:new Vector3(0,0,0),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});Q.addComponentOrReplace(Z);var K=new Entity("mainStructure ");engine.addEntity(K),K.setParent(Q);var J=new Transform({position:new Vector3(8,0,16),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(1,1,1)});K.addComponentOrReplace(J);var $=new GLTFShape("GLB/Decentraland Arena7dboz.glb");$.withCollisions=!0,$.isPointerBlocker=!0,$.visible=!0,K.addComponentOrReplace($);var et=new Entity("blimp");engine.addEntity(et),et.setParent(Q);var nt=new Transform({position:new Vector3(8,16,16),scale:new Vector3(1,1,1)});et.addComponentOrReplace(nt);var ot=new GLTFShape("GLB/Blimp.glb");ot.withCollisions=!0,ot.isPointerBlocker=!0,ot.visible=!0,et.addComponentOrReplace(ot);var it=new Entity("videoStream");engine.addEntity(it),it.setParent(Q);var rt=new Transform({position:new Vector3(8,3.75,.5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(4.5,4.5,4.5)});it.addComponentOrReplace(rt);var st=new U.default;st.init(),st.spawn(it,{startOn:!1,onClickText:"Play/Pause",volume:1,controlDist:20,onClick:[{entityName:"videoStream",actionId:"toggle",values:{}}],image:"https://purplebee.org/wp-content/uploads/purple-bee-live-slate.jpg",station:"https://8343f7014c0ea438.mediapackage.us-west-2.amazonaws.com/out/v1/97ed27876e70411685f551766ae1cec4/index.m3u8"},(0,R.createChannel)(G,it,X));var at=new Entity("blackhole1");engine.addEntity(at),at.setParent(Q);var lt=new Transform({position:new Vector3(8,.93,7.6),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(.85,.85,.85)});at.addComponentOrReplace(lt);var ut=new GLTFShape("GLB/BlackholeLayers/BH03.glb");ut.withCollisions=!1,ut.isPointerBlocker=!0,ut.visible=!0,at.addComponentOrReplace(ut);var ct=new Entity("blackhole2");engine.addEntity(ct),ct.setParent(at);var ht=new Transform({position:new Vector3(0,-.1,0)});ct.addComponentOrReplace(ht);var pt=new GLTFShape("GLB/BlackholeLayers/BH04.glb");pt.visible=!0,ct.addComponentOrReplace(pt);var dt=new Entity("blackhole3");engine.addEntity(dt),dt.setParent(at);var ft=new Transform({position:new Vector3(0,-.2,0)});dt.addComponentOrReplace(ft);var vt=new GLTFShape("GLB/BlackholeLayers/BH02.glb");vt.visible=!0,dt.addComponentOrReplace(vt);var mt=new Entity("blackhole4");engine.addEntity(mt),mt.setParent(at);var gt=new Transform({position:new Vector3(0,-.3,0)});mt.addComponentOrReplace(gt);var wt=new GLTFShape("GLB/BlackholeLayers/BH01.glb");wt.visible=!0,mt.addComponentOrReplace(wt);var bt=new Entity("blackhole5");engine.addEntity(bt),bt.setParent(at);var xt=new Transform({position:new Vector3(0,-.4,0)});bt.addComponentOrReplace(xt);var Tt=new GLTFShape("GLB/BlackholeLayers/BH05.glb");Tt.visible=!0,bt.addComponentOrReplace(Tt);var At=new Entity("redlight");engine.addEntity(At),At.setParent(Q);var St=new Transform({position:new Vector3(8,0,16),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(1,1,1)});At.addComponentOrReplace(St);var Et=new GLTFShape("GLB/RedLight.glb");Et.withCollisions=!0,Et.visible=!0,At.addComponentOrReplace(Et);var Ct=new Entity("redlight2");engine.addEntity(Ct),Ct.setParent(At);var It=new Transform({position:new Vector3(14,0,0)});Ct.addComponentOrReplace(It);var Rt=new GLTFShape("GLB/RedLight.glb");Rt.visible=!0,Ct.addComponentOrReplace(Rt);var _t=!1;function dance(){var T=["robot","tik","hammer","tektonik","disco"],A=Math.floor(Math.random()*T.length);(0,H.triggerEmote)({predefined:T[A]})}var Pt=new E.TriggerComponent(new E.TriggerBoxShape(new Vector3(7.4,5,7.4),Vector3.Zero()),{onCameraEnter:function(){setTimeout((function(){dance()}),1e3),_t=setInterval((function(){dance()}),1e4)},onCameraExit:function(){clearInterval(_t)}});at.addComponentOrReplace(Pt);var zt=new Material;zt.albedoColor=Color3.Red();var Bt=new Entity;Bt.addComponent(zt),Bt.addComponent(new GLTFShape("GLB/DonkModel5.glb")),Bt.addComponent(new Transform({position:new Vector3(8,2.5,3)})),Bt.addComponentOrReplace(new OnPointerDown((function(T){}),{hoverText:"TOSS THE DONK!\nClick & Hold Mouse, Hold [E] to Reel in"})),engine.addEntity(Bt);var Ot=new Material;Ot.albedoColor=new Color3(9,3,1);var Lt=new Material;Lt.albedoColor=new Color3(5,1,3.5);var Mt=new Entity;Mt.addComponent(new SphereShape),Mt.addComponent(new Transform({scale:Vector3.Zero()})),Mt.addComponent(Ot),Mt.getComponent(SphereShape).withCollisions=!1,engine.addEntity(Mt);var Nt=new CANNON.World;Nt.quatNormalizeSkip=0,Nt.quatNormalizeFast=!1,Nt.gravity.set(0,-9.82,0),Nt.broadphase=new CANNON.NaiveBroadphase;var kt=new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),qt=new CANNON.Body({mass:5});qt.addShape(kt),qt.position.set(8,2.5,3),qt.linearDamping=.4,qt.angularDamping=.4,Nt.addBody(qt);var Dt=new CANNON.Plane,Vt=new CANNON.Body({mass:0});Vt.addShape(Dt),Vt.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2),Vt.position.y=1,Nt.addBody(Vt);var Wt=new CANNON.Box(new CANNON.Vec3(16,50,1)),Ut=new CANNON.Body({mass:0,shape:Wt,position:new CANNON.Vec3(8,25,8)});Nt.addBody(Ut);var Ht=new CANNON.Body({mass:0,shape:Wt,position:new CANNON.Vec3(8,25,0)});Nt.addBody(Ht);var jt=new CANNON.Body({mass:0,shape:Wt,position:new CANNON.Vec3(0,25,8)});jt.quaternion.setFromAxisAngle(new CANNON.Vec3(0,1,0),-Math.PI/2),Nt.addBody(jt);var Gt=new CANNON.Body({mass:0,shape:Wt,position:new CANNON.Vec3(16,25,8)});Gt.quaternion.setFromAxisAngle(new CANNON.Vec3(0,1,0),-Math.PI/2),Nt.addBody(Gt);var Xt,Yt,Qt=new CANNON.Sphere(.1),Zt=new CANNON.Body({mass:0});Zt.addShape(Qt),Zt.collisionFilterGroup=0,Zt.collisionFilterMask=0,Nt.addBody(Zt);var Jt=function(){function updatePhysicsSystem(){}return updatePhysicsSystem.prototype.update=function(T){Nt.step(T),Bt.getComponent(Transform).position.copyFrom(qt.position),Bt.getComponent(Transform).rotation.copyFrom(qt.quaternion)},updatePhysicsSystem}();engine.addSystem(new Jt);var $t=Input.instance,ee=!1,ne=!1,oe=0;$t.subscribe("BUTTON_DOWN",ActionButton.POINTER,!0,(function(T){ee=!0,0!=T.hit.length&&(Mt.getComponent(Transform).scale.setAll(.1),oe=T.hit.length,function(T,A,E,R){Yt=R;var z=new CANNON.Vec3(T,A,E).vsub(Yt.position),O=Yt.quaternion.inverse().vmult(z);Zt.position.set(T,A,E),Xt=new CANNON.PointToPointConstraint(Yt,O,Zt,new CANNON.Vec3(0,0,0)),Nt.addConstraint(Xt)}(T.hit.hitPoint.x,T.hit.hitPoint.y,T.hit.hitPoint.z,qt))})),$t.subscribe("BUTTON_UP",ActionButton.POINTER,!1,(function(){ee=!1,Mt.getComponent(Transform).scale.setAll(0),Mt.getComponent(Transform).position.setAll(0),oe=0,Nt.removeConstraint(Xt)})),$t.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(){ne=!0,Mt.addComponentOrReplace(Lt)})),$t.subscribe("BUTTON_UP",ActionButton.PRIMARY,!1,(function(){ne=!1,Mt.addComponentOrReplace(Ot)}));var ie=function(){function UpdateMarkerSystem(){}return UpdateMarkerSystem.prototype.update=function(T){if(ee&&0!=oe){this.forwardVector=Vector3.Forward().scale(oe).rotate(Camera.instance.rotation),this.forwardVectorTransformed=Camera.instance.position.clone().add(this.forwardVector),Mt.getComponent(Transform).position.copyFrom(this.forwardVectorTransformed);var A=Mt.getComponent(Transform).position;E=A.x,R=A.y,z=A.z,Zt.position.set(E,R,z),Xt.update()}var E,R,z;ne&&0!=oe&&oe>1&&(oe-=8*T)},UpdateMarkerSystem}();engine.addSystem(new ie);var re=Math.floor(1e4*Math.random()),se=new Entity("imageFromURL");engine.addEntity(se),se.setParent(Q);var ae=new Transform({position:new Vector3(3,3.01,31.5),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(3.4,3.4,3.4)});se.addComponentOrReplace(ae);var le=new O.default;le.init(),le.spawn(se,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-1.jpg?"+re,url:"https://purplebee.org/?dclpanel=1"},(0,R.createChannel)(G,se,X));var ue=new Entity("imageFromURL");engine.addEntity(ue),ue.setParent(se);var ce=new Transform({position:new Vector3(-1,0,0)});ue.addComponentOrReplace(ce);var he=new O.default;he.init(),he.spawn(ue,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-2.jpg?"+re,url:"https://purplebee.org/?dclpanel=2",basic:!0},(0,R.createChannel)(G,ue,X));var pe=new Entity("imageFromURL");engine.addEntity(pe),pe.setParent(se);var de=new Transform({position:new Vector3(-2,0,0)});pe.addComponentOrReplace(de);var fe=new O.default;fe.init(),fe.spawn(pe,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-3.jpg?"+re,url:"https://purplebee.org/?dclpanel=3",basic:!0},(0,R.createChannel)(G,pe,X));var ye=new Entity("imageFromURL");engine.addEntity(ye),ye.setParent(se);var ve=new Transform({position:new Vector3(-3,0,0)});ye.addComponentOrReplace(ve);var me=new O.default;me.init(),me.spawn(ye,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-4.jpg?"+re,url:"https://purplebee.org/?dclpanel=4",basic:!0},(0,R.createChannel)(G,ye,X)),V.sceneMessageBus.on("donk_moved",(function(T){log("donk moved",T.x,T.y,T.z)}))}));