"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(v){let A=0;const T=[],E=[],C={baseUrl:""},R={};function c(v,T,E){let C=null,z={},M=null;"function"==typeof v?z=v:"string"==typeof v?(C=v,"function"==typeof T?z=T:T instanceof Array&&(M=T,z=E)):v instanceof Array&&(M=v,"function"==typeof T&&(z=T)),M=M||["require","exports","module"],null===C&&(C="unnamed-module-"+A++),C=g(C),M=(M||[]).map((v=>function(v,A){return v?b(A,v):A}(C,v))),R[C]||(R[C]={name:C,parent:null,dclamd:1,dependencies:M,handlers:[],exports:{},dependants:new Set}),R[C].dependencies=M,p(M,(function(v){const A=R[C];if(!A)throw new Error("Could not access registered module "+C);let T=A.exports;T="function"==typeof z?z.apply(globalObject,v)||T:z,A.exports=T,d(C)}),(v=>{if("function"!=typeof onerror)throw v;onerror(v)}),C)}function d(v){const A=R[v];if(!A)throw new Error("Could not access registered module "+v);A.dclamd=2;const T=A.handlers;if(T&&T.length)for(let A=0;A<T.length;A++)T[A](R[v])}function u(v,A,T){if(!R[v])return null;if(v===A||50===T)return[v];const E=R[v].dependencies;for(let C=0,R=E.length;C<R;C++){const R=u(E[C],A,T+1);if(null!==R)return R.push(v),R}return null}function a(v,A){const T=R[v];if(!T)return!1;const E={};for(const v in R)E[v]=!1;const C=[];for(C.push(T),E[v]=!0;C.length>0;){const v=C.shift().dependencies;if(v)for(let T=0,z=v.length;T<z;T++){const z=v[T];if(z===A)return!0;const M=R[z];M&&!E[z]&&(E[z]=!0,C.push(M))}}return!1}function p(v,A,T,C){const z=new Array(v.length).fill(null);let M=0,O=!1;if("string"==typeof v){if(R[v]){if(1===R[v].dclamd)throw new Error(`Trying to load ${v} from ${C}. The first module is still loading.`);return R[v]}throw new Error(v+" has not been defined. Please include it as a dependency in "+C+"'s define()")}const V=v.length;for(let W=0;W<V;W++)switch(v[W]){case"require":const h=function(v,A,T){return p(v,A,T,C)};h.toUrl=function(v){return b(v,C)},z[W]=h,M++;break;case"exports":if(!R[C])throw new Error("Parent module "+C+" not registered yet");z[W]=R[C].exports,M++;break;case"module":z[W]={id:C,uri:b(C)},M++;break;default:{const j=v[W],m=()=>{z[W]=R[j].exports,M++,M===V&&A&&(O=!0,A(z))};if(a(j,C)){const v=u(j,C,0);v&&(v.reverse(),v.push(j),E.push(v)),w(j,(()=>{}),T,C),m()}else w(j,m,T,C);break}}!O&&M===V&&A&&A(z)}function h(v,A){return function(){return dcl.callRpc(v,A.name,T.slice.call(arguments,0))}}function w(v,A,T,E){if(R[v])return R[v].dependants.add(E),void(1===R[v].dclamd?A&&R[v].handlers.push(A):A&&A(R[v]));if(R[v]={name:v,parent:E,dclamd:1,handlers:[A],dependencies:[],dependants:new Set([E]),exports:{}},0===v.indexOf("@")){const A=R[v].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(v,A).then((T=>{for(const v in T.methods){const E=T.methods[v];A[E.name]=h(T.rpcHandle,E)}d(v)})).catch((v=>{T(v)}))}}function g(v){let A,T=v;for(A=/\/\.\//;A.test(T);)T=T.replace(A,"/");for(T=T.replace(/^\.\//g,""),A=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;A.test(T);)T=T.replace(A,"/");return T=T.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),T=T.replace(/^\//g,""),T}function b(v,A){switch(v){case"require":case"exports":case"module":return v}return A?function(v,A){let T=v;if(!T.startsWith("@")&&(T.startsWith("./")||T.startsWith("../"))){const v=A.split("/");v.pop(),T=g(v.join("/")+"/"+T)}return T}(v,A):g(v)}v.config=function(v){if("object"==typeof v)for(const A in v)v.hasOwnProperty(A)&&(C[A]=v[A])},v.define=c,function(v){v.amd={},v.modules=R}(c=v.define||(v.define={})),v.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const v=new Set,A=[];for(const T in R)R[T]&&(1===R[T].dclamd&&A.push(R[T]),R[T].dependencies.forEach((A=>{"require"!==A&&"exports"!==A&&"module"!==A&&(R[A]||v.add(A))})));const T=[];if(E.length&&T.push(`\n> Cyclic dependencies: ${E.map((v=>"\n  - "+v.join(" -> "))).join("")}`),v.size&&T.push(`\n> Undeclared/unknown modules: ${Array.from(v).map((v=>"\n  - "+v)).join("")}`),A.length&&T.push(`\n> These modules didn't load: ${A.map((v=>"\n  - "+v.name)).join("")}.\n`),T.length)throw new Error(T.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(v){var A=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(v){return v.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(v){return v.firstPersonCameraEntity}},t}(),n=function(v,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(v[T]=A[T])})(v,A)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function i(v,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}var o=function(){return(o=Object.assign||function(v){for(var A,T=1,E=arguments.length;T<E;T++)for(var C in A=arguments[T])Object.prototype.hasOwnProperty.call(A,C)&&(v[C]=A[C]);return v}).apply(this,arguments)};function r(v,A,T,E){var C,R=arguments.length,z=R<3?A:null===E?E=Object.getOwnPropertyDescriptor(A,T):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,T,E);else for(var M=v.length-1;M>=0;M--)(C=v[M])&&(z=(R<3?C(z):R>3?C(A,T,z):C(A,T))||z);return R>3&&z&&Object.defineProperty(A,T,z),z}function s(v,A){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(v,A)}function h(v){var A="function"==typeof Symbol&&Symbol.iterator,T=A&&v[A],E=0;if(T)return T.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(v,A){var T="function"==typeof Symbol&&v[Symbol.iterator];if(!T)return v;var E,C,R=T.call(v),z=[];try{for(;(void 0===A||A-- >0)&&!(E=R.next()).done;)z.push(E.value)}catch(v){C={error:v}}finally{try{E&&!E.done&&(T=R.return)&&T.call(R)}finally{if(C)throw C.error}}return z}function p(v,A){for(var T=0,E=A.length,C=v.length;T<E;T++,C++)v[C]=A[T];return v}var T=0;function c(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(v))):console.log.apply(console,p(["DEBUG:"],l(v)))}function y(v,A){"undefined"!=typeof dcl?dcl.error(v,A):console.error("ERROR:",v,A)}function f(v){if(T++,0===v.length)throw new Error("newId(type: string): type cannot be empty");return v+T.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(v){var A=16*Math.random()|0;return("x"===v?A:3&A|8).toString(16)}))}var E=[];function _(v){if(!("__event_name__"in v)||"string"!=typeof v.__event_name__)throw new Error("The EventConstructor is not registered");return v.__event_name__}var C=function(){function t(){this.listeners={}}return t.prototype.addListener=function(v,A,T){if(!v||"function"!=typeof v)throw new Error("Invalid EventConstructor");var E=_(v),C=this.listeners[E];C||(C=this.listeners[E]=[]);for(var R=0;R<C.length;R++)if(C[R].listener===A)throw new Error("The provided listener is already registered");return C.push({listener:A,fn:T}),this},t.prototype.removeListener=function(v,A){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var T=_(A),E=this.listeners[T];if(!E)return!1;for(var C=0;C<E.length;C++)if(E[C].listener===v)return E.splice(C,1),!0;return!1},t.prototype.fireEvent=function(v){var A=_(v.constructor),T=this.listeners[A];if(T)for(var E=0;E<T.length;E++)try{var C=T[E];C.fn.call(C.listener,v)}catch(v){y(v)}return this},t}();function x(){var v=f("EV");if(-1!==E.indexOf(v))throw new Error("The event name "+v+" is already taken");return E.push(v),function(A){return A.__event_name__=v,A}}var R,z=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,T){this.entity=v,this.componentName=A,this.component=T})),M=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,T){this.entity=v,this.componentName=A,this.classId=T})),O=r([x(),s("design:paramtypes",[Object,Object])],(function(v,A){this.entity=v,this.parent=A}));v.UIValueType=void 0,(R=v.UIValueType||(v.UIValueType={}))[R.PERCENT=0]="PERCENT",R[R.PIXELS=1]="PIXELS";var V=function(){function e(A){if(this.type=v.UIValueType.PIXELS,"string"==typeof A){var T=A;T.indexOf("px")>-1?this.type=v.UIValueType.PIXELS:T.indexOf("%")>-1&&(this.type=v.UIValueType.PERCENT),this.value=parseFloat(T)}else this.value=A}return e.prototype.toString=function(){var A=this.value.toString();return this.type===v.UIValueType.PERCENT?A+="%":A+="px",A},e}(),W="__name__symbol_",j="__classId__symbol_",H="__component__id_",X=r([x(),s("design:paramtypes",[String,String,Number])],(function(v,A,T){this.componentId=v,this.componentName=A,this.classId=T})),Z=r([x(),s("design:paramtypes",[String])],(function(v){this.componentId=v})),K=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.componentId=v,this.component=A}));function P(v,A){return function(T){if(T.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+T.originalClassName+" with: "+v);var E=T,o=function(){var T=Array.prototype.slice.call(arguments),C=new(E.bind.apply(E,p([void 0],l(T))));return Object.defineProperty(C,W,{enumerable:!1,writable:!1,configurable:!1,value:v}),void 0!==A&&Object.defineProperty(C,j,{enumerable:!1,writable:!1,configurable:!1,value:A}),C};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.originalClassName=v,(o.prototype=T.prototype).constructor=T,o}}function N(v,A){return function(T){if(T.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+T.originalClassName+" with: "+v);if("number"!=typeof A||isNaN(A))throw new Error("classId: "+A+" is an invalid integer");var E=T,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var T=Array.prototype.slice.call(arguments),C=new(E.bind.apply(E,p([void 0],l(T)))),R=f("C");return Object.defineProperty(C,W,{enumerable:!1,writable:!1,configurable:!1,value:v}),Object.defineProperty(C,H,{enumerable:!1,writable:!1,configurable:!1,value:R}),void 0!==A&&Object.defineProperty(C,j,{enumerable:!1,writable:!1,configurable:!1,value:A}),N.engine&&N.engine.registerComponent(C),C};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=v,(o.prototype=T.prototype).constructor=T,o}}function F(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__name__symbol_)return v.__name__symbol_;throw new TypeError(v+" is not a registered component.")}function L(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__classId__symbol_)return v.__classId__symbol_;if(!v.__name__symbol_)throw new TypeError(v+" is not a registered component.");return null}function D(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__component__id_)return v.__component__id_;throw new TypeError(v+" is not a registered disposable component.")}!function(v){v.engine=null}(N||(N={}));var J=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(v,A){if(delete v[A]){var T=A+"_"+Math.random();v[T]=void 0,Object.defineProperty(v,T,o(o({},Object.getOwnPropertyDescriptor(v,T)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[T]},set:function(v){var E=this[T];if(this.data[A]=v?D(v):null,this[T]=v,v!==E){this.dirty=!0;for(var C=0;C<this.subscriptions.length;C++)this.subscriptions[C](A,v,E)}},enumerable:!0})}},t.field=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A]},set:function(v){var T=this.data[A];if(this.data[A]=v,v!==T){this.dirty=!0;for(var E=0;E<this.subscriptions.length;E++)this.subscriptions[E](A,v,T)}},enumerable:!0})},t.uiValue=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A].toString()},set:function(v){var T=this.data[A],E=new V(v);if(this.data[A]=E,E!==T){this.dirty=!0;for(var C=0;C<this.subscriptions.length;C++)this.subscriptions[C](A,E,T)}},enumerable:!0})},t.readonly=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){if(A in this.data==0)throw new Error("The field "+A+" is uninitialized");return this.data[A]},set:function(v){if(A in this.data)throw new Error("The field "+A+" is readonly");this.data[A]=v,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(v){return this.subscriptions.push(v),this},t.prototype.toJSON=function(){return this.data},t}();function U(v){return H in v}var $=function(){function t(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];if(this.entities=[],this.active=!1,this._requiresNames=[],!v)throw new Error("ComponentGroup: Could not load the requires list");if(!(v instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return v.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(A){var E=v[A],C=null;if(!E)throw new Error("ComponentGroup: the required component at location "+A+" is invalid");try{C=F(E)}catch(v){throw new Error("ComponentGroup: the required component at location "+A+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(T._requiresNames.some((function(v){return v===C})))throw new Error("ComponentGroup: the required component list has a repeated name "+C);T._requiresNames.push(C)},T=this,E=0;E<v.length;E++)n(E)}return t.prototype.hasEntity=function(v){return!!v.isAddedToEngine()&&-1!==this.entities.indexOf(v)},t.prototype.addEntity=function(v){if(!v.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(v)&&this.entities.push(v)},t.prototype.removeEntity=function(v){var A=this.entities.indexOf(v);-1!==A&&this.entities.splice(A,1)},t.prototype.componentRemoved=function(v,A){-1!==this._requiresNames.indexOf(A)&&this.removeEntity(v)},t.prototype.meetsRequirements=function(v){for(var A=0;A<this._requiresNames.length;A++)if(!(this._requiresNames[A]in v.components))return!1;return!0},t}(),et=function(){function t(v){this.name=v,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(v){if("function"==typeof v)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof v)throw new Error("You passed a "+typeof v+", an instance of component is expected");var A=F(v);if(this.components[A]){if(this.components[A]===v)return v;this.removeComponent(this.components[A],!1)}return this.addComponent(v)},t.prototype.hasComponent=function(v){var A=typeof v;if("string"!==A&&"object"!==A&&"function"!==A)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===v)return!1;var T="string"===A?v:F(v),E=this.components[T];return!!E&&("object"===A?E===v:"function"!==A||E instanceof v)},t.prototype.getComponent=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#get(component): component is not a class or name");var T="string"===A?v:F(v),E=this.components[T];if(!E)throw new Error('Can not get component "'+T+'" from entity "'+this.identifier+'"');if("function"===A){if(E instanceof v)return E;throw new Error('Can not get component "'+T+'" from entity "'+this.identifier+'" (by instance)')}return E},t.prototype.getComponentOrNull=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#getOrNull(component): component is not a class or name");var T="string"===A?v:F(v),E=this.components[T];return E?"function"===A?E instanceof v?E:null:E:null},t.prototype.getComponentOrCreate=function(v){if("function"!=typeof v)throw new Error("Entity#getOrCreate(component): component is not a class");var A=this.getComponentOrNull(v);return A||(F(A=new v),this.addComponentOrReplace(A)),A},t.prototype.addComponent=function(v){if("object"!=typeof v)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var A=F(v),T=L(v);if(this.components[A])throw new Error('A component of type "'+A+'" is already present in entity "'+this.identifier+'"');this.components[A]=v,this.eventManager&&this.eventManager.fireEvent(new M(this,A,T));var E=v;return"function"==typeof E.addedToEntity&&E.addedToEntity(this),v},t.prototype.removeComponent=function(v,A){void 0===A&&(A=!0);var T=typeof v;if("string"!==T&&"function"!==T&&"object"!==T)throw new Error("Entity#remove(component): component is not a class, class or name");var E="string"===T?v:F(v),C=this.components[E];if(C){if("function"===T)return C instanceof v?(delete this.components[E],void(C&&(A&&this.eventManager&&this.eventManager.fireEvent(new z(this,E,C)),"function"==typeof C.removedFromEntity&&C.removedFromEntity(this)))):void c('Entity Warning: Trying to remove wrong (by constructor) component "'+E+'" from entity "'+this.identifier+'"');delete this.components[E],C&&(A&&this.eventManager&&this.eventManager.fireEvent(new z(this,E,C)),"function"==typeof C.removedFromEntity&&C.removedFromEntity(this))}else c('Entity Warning: Trying to remove inexisting component "'+E+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(v){var A;if(v&&"getEntityRepresentation"in v){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");A=v.getEntityRepresentation(this.engine)}else A=!v&&this.engine?this.engine.rootEntity:v;var T=this.getParent();if(A===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(A===T)return this;var E=this.getCircularAncestor(A);if(E)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+E+'")');return T&&delete T.children[this.uuid],null!==A&&"0"!==A.uuid&&(!A.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),A.isAddedToEngine()&&!this.isAddedToEngine()&&A.engine.addEntity(this)),this._parent=A||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new O(this,A)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(v){for(var A=this.engine?this.engine.rootEntity:null,T=v;T&&T!==A;){var E=T.getParent();if(E===this)return T.uuid;T=E}return null},t.prototype.registerAsChild=function(){var v=this.getParent();this.uuid&&v&&(v.children[this.uuid]=this)},t}(),nt=function(){function t(v){this.eventManager=new C,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(M,this,this.componentAddedHandler),this.eventManager.addListener(z,this,this.componentRemovedHandler),this.rootEntity=v,this.firstPersonCameraEntity=new et,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new et,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(v){var A=v.getParent();if(v.isAddedToEngine())return v;for(var T in v.eventManager=this.eventManager,v.engine=this,this._entities[v.uuid]=v,this.checkRequirementsAndAdd(v),A?A.isAddedToEngine()||A===this.rootEntity||c("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+A.uuid):v.setParent(this.rootEntity),v.alive=!0,v.children){var E=v.children[T];E&&(E.isAddedToEngine()||this.addEntity(E))}return v},t.prototype.removeEntity=function(v){var A=v.uuid;if(v.isAddedToEngine()){for(var T in v.components){var E=this._componentGroups[T];if(E)for(var C in E)E[C].removeEntity(v);delete this.entityLists[T][A]}for(var R=0;R<this.simpleSystems.length;R++){var z=this.simpleSystems[R];z.onRemoveEntity&&z.onRemoveEntity(v)}for(var R in v.children){var M=v.children[R];M&&this.removeEntity(M)}return v.alive=!1,v.eventManager=null,delete this._entities[A],!0}for(var T in c("Engine: Trying to remove non existent entity from engine."),v.isAddedToEngine()?c("Engine: Entity id: "+A):c('Engine: Entity "'+v.uuid+'" has not been added to any engine yet.'),c("Engine: Entity's components:"),v.components)c(T);return!1},t.prototype.addSystem=function(v,A){if(void 0===A&&(A=0),-1!==this.addedSystems.indexOf(v))return c("Engine: Trying to add a system that is already added. Aborting"),v;if(this.systems.length>0)for(var T=0;T<this.systems.length;T++){var E=this.systems[T],C=T===this.systems.length-1;if(E.priority>A){this.addedSystems.push(v),this.systems.splice(T,0,{system:v,priority:A});break}if(C){this.addedSystems.push(v),this.systems.splice(T+1,0,{system:v,priority:A});break}}else this.addedSystems.push(v),this.systems.splice(1,0,{system:v,priority:A});return this.registerSystem(v),v},t.prototype.removeSystem=function(v){var A=this.addedSystems.indexOf(v);if(-1!==A){v.active=!1,v.deactivate&&v.deactivate(),this.addedSystems.splice(A,1);for(var T=0;T<this.systems.length;T++)this.systems[T].system===v&&this.systems.splice(T,1);return!0}return!1},t.prototype.update=function(v){for(var A in this.systems){var T=this.systems[A].system;if(T.active&&T.update)try{T.update(v)}catch(v){y(v)}}return this},t.prototype.getEntitiesWithComponent=function(v){var A="string"==typeof v?v:F(v);return A in this.entityLists?this.entityLists[A]:this.entityLists[A]={}},t.prototype.registerComponent=function(v){var A=D(v),T=F(v),E=L(v);this._disposableComponents[A]=v,null!==E&&(this.eventManager.fireEvent(new X(A,T,E)),this.eventManager.fireEvent(new K(A,v)))},t.prototype.disposeComponent=function(v){var A=D(v);return delete this._disposableComponents[A]&&(this.eventManager.fireEvent(new Z(A)),v.onDispose&&v.onDispose(),!0)},t.prototype.updateComponent=function(v){this.eventManager.fireEvent(new K(D(v),v))},t.prototype.getComponentGroup=function(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];var T=void 0;if(v.length>0&&(O=this._componentGroups[F(v[0])]))for(var E=v.slice(),C=0;C<O.length;C++){var R=O[C];if(E.length===R.requires.length){for(var z=0;z<E.length&&-1!==R.requires.indexOf(E[z]);z++)z===E.length-1&&(T=R);if(T)break}}if(T)return T;(T=new($.bind.apply($,p([void 0],l(v))))).active=!0;var M=T.requiresNames;for(C=0;C<M.length;C++){var O,V=M[C];(O=this._componentGroups[V])||(this._componentGroups[V]=O=[]),-1===O.indexOf(T)&&O.push(T)}for(var W in this._entities)this.checkRequirements(this._entities[W],T);return T},t.prototype.removeComponentGroup=function(v){if(v.active){v.active=!1;for(var A=v.requiresNames,T=0;T<A.length;T++){var E=A[T],C=this._componentGroups[E];if(C){var R=C.indexOf(v);-1!==R&&C.splice(R,1)}}return!0}return!1},t.prototype.registerSystem=function(v){v.active=!0,v.activate&&v.activate(this),this.simpleSystems.push(v)},t.prototype.checkRequirementsAndAdd=function(v){if(v.isAddedToEngine()){for(var A in v.components){A in this.entityLists||(this.entityLists[A]={}),this.entityLists[A][v.uuid]=v;var T=this._componentGroups[A];if(T)for(var E in T)this.checkRequirements(v,T[E])}for(var C=0;C<this.simpleSystems.length;C++){var R=this.simpleSystems[C];R.onAddEntity&&R.onAddEntity(v)}}},t.prototype.checkRequirements=function(v,A){A.meetsRequirements(v)?A.hasEntity(v)||A.addEntity(v):A.hasEntity(v)&&A.removeEntity(v)},t.prototype.componentAddedHandler=function(v){var A,T=v.entity,E=v.componentName;if(T.isAddedToEngine()){this.entityLists[E]?this.entityLists[E][T.uuid]=T:this.entityLists[E]=((A={})[T.uuid]=T,A);var C=this._componentGroups[E];if(C)for(var R in C)this.checkRequirements(T,C[R])}},t.prototype.componentRemovedHandler=function(v){var A=v.entity,T=v.componentName;if(A.isAddedToEngine()){delete this.entityLists[T][A.uuid];var E=this._componentGroups[T];if(E)for(var C in E)this.checkRequirements(A,E[C])}},t}(),it=Promise.resolve().then.bind(Promise.resolve());function G(v){var A=it(v);return A.isComplete=!1,A.then((function(v){A.isComplete=!0,A.result=v,A.didFail=!1})).catch((function(v){A.isComplete=!0,A.error=v,A.didFail=!0,y("executeTask: FAILED "+v.toString(),v)})),A}var ot,rt,st=function(){function t(v,A,T,E){void 0===A&&(A=!1),this.initalize(v,A,T,E)}return t.prototype.initalize=function(v,A,T,E){return void 0===A&&(A=!1),this.mask=v,this.skipNextObservers=A,this.target=T,this.currentTarget=E,this},t}(),Y=function(v,A,T){void 0===T&&(T=null),this.callback=v,this.mask=A,this.scope=T,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},at=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(v,A,T,E){var C,R;void 0===T&&(T=-1),void 0===E&&(E=null);var z=new t;z._observers=new Array,z._observables=v;try{for(var M=h(v),O=M.next();!O.done;O=M.next()){var V=O.value.add(A,T,!1,E);V&&z._observers.push(V)}}catch(v){C={error:v}}finally{try{O&&!O.done&&(R=M.return)&&R.call(M)}finally{if(C)throw C.error}}return z},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var v=0;v<this._observers.length;v++)this._observables[v].remove(this._observers[v]);this._observers=null,this._observables=null},t}(),lt=function(){function t(v){this._observers=new Array,this._onObserverAdded=null,this._eventState=new st(0),v&&(this._onObserverAdded=v)}return t.prototype.add=function(v,A,T,E,C){if(void 0===A&&(A=-1),void 0===T&&(T=!1),void 0===E&&(E=null),void 0===C&&(C=!1),!v)return null;var R=new Y(v,A,E);return R.unregisterOnNextCall=C,T?this._observers.unshift(R):this._observers.push(R),this._onObserverAdded&&this._onObserverAdded(R),R},t.prototype.addOnce=function(v){return this.add(v,void 0,void 0,void 0,!0)},t.prototype.remove=function(v){return!!v&&-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)},t.prototype.removeCallback=function(v,A){for(var T=0;T<this._observers.length;T++)if(this._observers[T].callback===v&&(!A||A===this._observers[T].scope))return this._deferUnregister(this._observers[T]),!0;return!1},t.prototype.notifyObservers=function(v,A,T,E){var C,R;if(void 0===A&&(A=-1),!this._observers.length)return!0;var z=this._eventState;z.mask=A,z.target=T,z.currentTarget=E,z.skipNextObservers=!1,z.lastReturnValue=v;try{for(var M=h(this._observers),O=M.next();!O.done;O=M.next()){var V=O.value;if(!V._willBeUnregistered&&(V.mask&A&&(V.scope?z.lastReturnValue=V.callback.apply(V.scope,[v,z]):z.lastReturnValue=V.callback(v,z),V.unregisterOnNextCall&&this._deferUnregister(V)),z.skipNextObservers))return!1}}catch(v){C={error:v}}finally{try{O&&!O.done&&(R=M.return)&&R.call(M)}finally{if(C)throw C.error}}return!0},t.prototype.notifyObserversWithPromise=function(v,A,T,E){var C=this;void 0===A&&(A=-1);var R=Promise.resolve(v);if(!this._observers.length)return R;var z=this._eventState;return z.mask=A,z.target=T,z.currentTarget=E,z.skipNextObservers=!1,this._observers.forEach((function(T){z.skipNextObservers||T._willBeUnregistered||T.mask&A&&(R=T.scope?R.then((function(A){return z.lastReturnValue=A,T.callback.apply(T.scope,[v,z])})):R.then((function(A){return z.lastReturnValue=A,T.callback(v,z)})),T.unregisterOnNextCall&&C._deferUnregister(T))})),R.then((function(){return v}))},t.prototype.notifyObserver=function(v,A,T){void 0===T&&(T=-1);var E=this._eventState;E.mask=T,E.skipNextObservers=!1,v.callback(A,E)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var v=new t;return v._observers=this._observers.slice(0),v},t.prototype.hasSpecificMask=function(v){var A,T;void 0===v&&(v=-1);try{for(var E=h(this._observers),C=E.next();!C.done;C=E.next()){var R=C.value;if(R.mask&v||R.mask===v)return!0}}catch(v){A={error:v}}finally{try{C&&!C.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}return!1},t.prototype._deferUnregister=function(v){var A=this;v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,G((function(){return function(v,A,T,E){return new(T||(T=Promise))((function(A,C){function s(v){try{d(E.next(v))}catch(v){C(v)}}function a(v){try{d(E.throw(v))}catch(v){C(v)}}function d(v){var E;v.done?A(v.value):(E=v.value,E instanceof T?E:new T((function(v){v(E)}))).then(s,a)}d((E=E.apply(v,[])).next())}))}(A,0,void 0,(function(){return function(v,A){var T,E,C,R,z={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return R={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(R[Symbol.iterator]=function(){return this}),R;function a(R){return function(M){return function(R){if(T)throw new TypeError("Generator is already executing.");for(;z;)try{if(T=1,E&&(C=2&R[0]?E.return:R[0]?E.throw||((C=E.return)&&C.call(E),0):E.next)&&!(C=C.call(E,R[1])).done)return C;switch(E=0,C&&(R=[2&R[0],C.value]),R[0]){case 0:case 1:C=R;break;case 4:return z.label++,{value:R[1],done:!1};case 5:z.label++,E=R[1],R=[0];continue;case 7:R=z.ops.pop(),z.trys.pop();continue;default:if(!((C=(C=z.trys).length>0&&C[C.length-1])||6!==R[0]&&2!==R[0])){z=0;continue}if(3===R[0]&&(!C||R[1]>C[0]&&R[1]<C[3])){z.label=R[1];break}if(6===R[0]&&z.label<C[1]){z.label=C[1],C=R;break}if(C&&z.label<C[2]){z.label=C[2],z.ops.push(R);break}C[2]&&z.ops.pop(),z.trys.pop();continue}R=A.call(v,z)}catch(v){R=[6,v],E=0}finally{T=C=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}([R,M])}}}(this,(function(A){return[2,this._remove(v)]}))}))}))},t.prototype._remove=function(v){if(!v)return!1;var A=this._observers.indexOf(v);return-1!==A&&(this._observers.splice(A,1),!0)},t}(),ct=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.uuid=v,this.payload=A})),ht=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v})),ut=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v}));function tt(v){return function(){rt&&rt.subscribe(v)}}var pt=new lt(tt("cameraModeChanged")),dt=new lt(tt("idleStateChanged")),yt=new lt(tt("onEnterScene")),ft=yt,gt=new lt(tt("onLeaveScene")),vt=gt,bt=new lt(tt("sceneStart")),wt=new lt(tt("playerExpression")),xt=new lt(tt("onPointerLock")),At=new lt(tt("videoEvent")),Tt=new lt(tt("profileChanged")),St=new lt(tt("playerConnected")),Ct=new lt(tt("playerDisconnected")),It=new lt(tt("onRealmChanged")),Rt=new lt(tt("playerClicked"));function mt(v){(rt=v)&&rt.onEvent((function(v){switch(v.type){case"onEnterScene":return void yt.notifyObservers(v.data);case"onLeaveScene":return void gt.notifyObservers(v.data);case"cameraModeChanged":return void pt.notifyObservers(v.data);case"idleStateChanged":return void dt.notifyObservers(v.data);case"sceneStart":return void bt.notifyObservers(v.data);case"playerExpression":return void wt.notifyObservers(v.data);case"videoEvent":var A=v.data,T=N.engine.disposableComponents[A.componentId];return T&&T.update(A),void At.notifyObservers(A);case"profileChanged":return void Tt.notifyObservers(v.data);case"onPointerLock":return void xt.notifyObservers(v.data);case"playerConnected":return void St.notifyObservers(v.data);case"playerDisconnected":return void Ct.notifyObservers(v.data);case"onRealmChanged":return void It.notifyObservers(v.data);case"playerClicked":return void Rt.notifyObservers(v.data)}}))}var _t=function(){function t(v){this.dcl=v,this.cachedComponents={}}return t.prototype.activate=function(v){var A=this;this.engine=v,v.eventManager.addListener(M,this,this.componentAdded),v.eventManager.addListener(z,this,this.componentRemoved),v.eventManager.addListener(X,this,this.disposableComponentCreated),v.eventManager.addListener(Z,this,this.disposableComponentRemoved),v.eventManager.addListener(K,this,this.disposableComponentUpdated),v.eventManager.addListener(O,this,this.parentChanged);var T=v.rootEntity.uuid;this.dcl.addEntity(T),this.dcl.onUpdate((function(T){v.update(T),A.presentEntities()})),this.dcl.onEvent((function(A){var T=A.data;switch(A.type){case"uuidEvent":v.eventManager.fireEvent(new ct(T.uuid,T.payload));break;case"raycastResponse":("HitFirst"===T.queryType||"HitAll"===T.queryType)&&v.eventManager.fireEvent(new ht(T));break;case"actionButtonEvent":v.eventManager.fireEvent(new ut(T.payload))}}))},t.prototype.onAddEntity=function(v){if(v&&v.isAddedToEngine()){var A=v.uuid,T=v.getParent();for(var E in this.dcl.addEntity(A),T&&this.dcl.setParent(A,T.uuid),this.cachedComponents[A]={},v.components){var C=v.components[E],R=L(C);if(null!==R)if(U(C))this.dcl.attachEntityComponent(v.uuid,E,D(C));else{var z=JSON.stringify(C);this.dcl.updateEntityComponent(A,E,R,z),this.cachedComponents[A][E]=z}}}},t.prototype.onRemoveEntity=function(v){if(v.isAddedToEngine()){var A=v.uuid;this.dcl.removeEntity(A),delete this.cachedComponents[A]}},t.prototype.presentEntities=function(){for(var v in this.engine.entities){var A=this.engine.entities[v];for(var T in A.components){var E=L(z=A.components[T]);if(null!==E&&!U(z)){var C=this.getJsonIfDirty(A.uuid,T,z);C&&(this.dcl.updateEntityComponent(A.uuid,T,E,C),this.clearDirty(A.uuid,T,z,C))}}}for(var R in this.engine.disposableComponents){var z;(z=this.engine.disposableComponents[R])instanceof J&&z.dirty&&(this.dcl.componentUpdated(R,JSON.stringify(z)),z.dirty=!1)}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];if(U(A))this.dcl.attachEntityComponent(v.entity.uuid,v.componentName,D(A));else if(null!==v.classId){var T=JSON.stringify(A);this.dcl.updateEntityComponent(v.entity.uuid,v.componentName,v.classId,T),this.cachedComponents[v.entity.uuid][v.componentName]=T}}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(v.entity.uuid,v.componentName),delete this.cachedComponents[v.entity.uuid][v.componentName])},t.prototype.disposableComponentCreated=function(v){this.dcl.componentCreated(v.componentId,v.componentName,v.classId)},t.prototype.disposableComponentRemoved=function(v){this.dcl.componentDisposed(v.componentId)},t.prototype.disposableComponentUpdated=function(v){this.dcl.componentUpdated(v.componentId,JSON.stringify(v.component))},t.prototype.parentChanged=function(v){this.dcl.setParent(v.entity.uuid,v.parent?v.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(v,A,T){var E=JSON.stringify(T);return E!==this.cachedComponents[v][A]&&E},t.prototype.clearDirty=function(v,A,T,E){this.cachedComponents[v][A]=E},t}(),Pt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Bt={},zt={};!function(v){var A,T;Object.defineProperty(v,"__esModule",{value:!0}),v.RAD2DEG=v.DEG2RAD=v.Epsilon=v.ToLinearSpace=v.ToGammaSpace=v.Space=v.Orientation=void 0,(A=v.Orientation||(v.Orientation={}))[A.CW=0]="CW",A[A.CCW=1]="CCW",(T=v.Space||(v.Space={}))[T.LOCAL=0]="LOCAL",T[T.WORLD=1]="WORLD",T[T.BONE=2]="BONE",v.ToGammaSpace=1/2.2,v.ToLinearSpace=2.2,v.Epsilon=1e-6,v.DEG2RAD=Math.PI/180,v.RAD2DEG=360/(2*Math.PI)}(zt);var Ot={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.buildArray=void 0,Nt.buildArray=function(v,A){const T=[];for(let E=0;E<v;++E)T.push(A());return T};var Lt={},Ft={},kt={},Vt={},qt={};Object.defineProperty(qt,"__esModule",{value:!0}),qt.Scalar=void 0;class Et{static WithinEpsilon(v,A,T=1401298e-51){const E=v-A;return-T<=E&&E<=T}static ToHex(v){const A=v.toString(16);return v<=15?("0"+A).toUpperCase():A.toUpperCase()}static Sign(v){const A=+v;return 0===A||isNaN(A)?A:A>0?1:-1}static Clamp(v,A=0,T=1){return Math.min(T,Math.max(A,v))}static Log2(v){return Math.log(v)*Math.LOG2E}static Repeat(v,A){return v-Math.floor(v/A)*A}static Normalize(v,A,T){return(v-A)/(T-A)}static Denormalize(v,A,T){return v*(T-A)+A}static DeltaAngle(v,A){let T=Et.Repeat(A-v,360);return T>180&&(T-=360),T}static PingPong(v,A){const T=Et.Repeat(v,2*A);return A-Math.abs(T-A)}static SmoothStep(v,A,T){let E=Et.Clamp(T);return E=-2*E*E*E+3*E*E,A*E+v*(1-E)}static MoveTowards(v,A,T){let E=0;return E=Math.abs(A-v)<=T?A:v+Et.Sign(A-v)*T,E}static MoveTowardsAngle(v,A,T){const E=Et.DeltaAngle(v,A);let C=0;return C=-T<E&&E<T?A:Et.MoveTowards(v,v+E,T),C}static Lerp(v,A,T){return v+(A-v)*T}static LerpAngle(v,A,T){let E=Et.Repeat(A-v,360);return E>180&&(E-=360),v+E*Et.Clamp(T)}static InverseLerp(v,A,T){let E=0;return E=v!==A?Et.Clamp((T-v)/(A-v)):0,E}static Hermite(v,A,T,E,C){const R=C*C,z=C*R;return v*(2*z-3*R+1)+T*(-2*z+3*R)+A*(z-2*R+C)+E*(z-R)}static RandomRange(v,A){return v===A?v:Math.random()*(A-v)+v}static RangeToPercent(v,A,T){return(v-A)/(T-A)}static PercentToRange(v,A,T){return(T-A)*v+A}static NormalizeRadians(v){return v-Et.TwoPi*Math.floor((v+Math.PI)/Et.TwoPi)}}qt.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Vector4=void 0;const Ut=zt,Wt=qt,Ht=Lt;class Mt{constructor(v,A,T,E){this.x=v,this.y=A,this.z=T,this.w=E}static Add(v,A){return new Mt(v.x,v.y,v.z,v.w).addInPlace(A)}static FromArray(v,A=0){return new Mt(v[A],v[A+1],v[A+2],v[A+3])}static FromArrayToRef(v,A,T){T.x=v[A],T.y=v[A+1],T.z=v[A+2],T.w=v[A+3]}static FromFloatArrayToRef(v,A,T){Mt.FromArrayToRef(v,A,T)}static FromFloatsToRef(v,A,T,E,C){C.x=v,C.y=A,C.z=T,C.w=E}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(v){const A=Mt.Zero();return Mt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){A.copyFrom(v),A.normalize()}static Minimize(v,A){const T=new Mt(v.x,v.y,v.z,v.w);return T.minimizeInPlace(A),T}static Maximize(v,A){const T=new Mt(v.x,v.y,v.z,v.w);return T.maximizeInPlace(A),T}static Distance(v,A){return Math.sqrt(Mt.DistanceSquared(v,A))}static DistanceSquared(v,A){const T=v.x-A.x,E=v.y-A.y,C=v.z-A.z,R=v.w-A.w;return T*T+E*E+C*C+R*R}static Center(v,A){const T=Mt.Add(v,A);return T.scaleInPlace(.5),T}static TransformNormal(v,A){const T=Mt.Zero();return Mt.TransformNormalToRef(v,A,T),T}static TransformNormalToRef(v,A,T){const E=A.m,C=v.x*E[0]+v.y*E[4]+v.z*E[8],R=v.x*E[1]+v.y*E[5]+v.z*E[9],z=v.x*E[2]+v.y*E[6]+v.z*E[10];T.x=C,T.y=R,T.z=z,T.w=v.w}static TransformNormalFromFloatsToRef(v,A,T,E,C,R){const z=C.m;R.x=v*z[0]+A*z[4]+T*z[8],R.y=v*z[1]+A*z[5]+T*z[9],R.z=v*z[2]+A*z[6]+T*z[10],R.w=E}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,v[A+3]=this.w,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}add(v){return new Mt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,A.z=this.z+v.z,A.w=this.w+v.w,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}subtract(v){return new Mt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,A.z=this.z-v.z,A.w=this.w-v.w,this}subtractFromFloats(v,A,T,E){return new Mt(this.x-v,this.y-A,this.z-T,this.w-E)}subtractFromFloatsToRef(v,A,T,E,C){return C.x=this.x-v,C.y=this.y-A,C.z=this.z-T,C.w=this.w-E,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new Mt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v,A=Ut.Epsilon){return v&&Wt.Scalar.WithinEpsilon(this.x,v.x,A)&&Wt.Scalar.WithinEpsilon(this.y,v.y,A)&&Wt.Scalar.WithinEpsilon(this.z,v.z,A)&&Wt.Scalar.WithinEpsilon(this.w,v.w,A)}equalsToFloats(v,A,T,E){return this.x===v&&this.y===A&&this.z===T&&this.w===E}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new Mt(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,A.z=this.z*v.z,A.w=this.w*v.w,this}multiplyByFloats(v,A,T,E){return new Mt(this.x*v,this.y*A,this.z*T,this.w*E)}divide(v){return new Mt(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,A.z=this.z/v.z,A.w=this.w/v.w,this}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const v=this.length();return 0===v?this:this.scaleInPlace(1/v)}toVector3(){return new Ht.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,T,E){return this.x=v,this.y=A,this.z=T,this.w=E,this}set(v,A,T,E){return this.copyFromFloats(v,A,T,E)}setAll(v){return this.x=this.y=this.z=this.w=v,this}}Vt.Vector4=Mt,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Matrix=void 0;const Gt=Lt,Yt=Ft,Qt=Ot,Zt=Vt;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(v,A=0){const T=new Dt;return Dt.FromArrayToRef(v,A,T),T}static FromArrayToRef(v,A,T){for(let E=0;E<16;E++)T._m[E]=v[E+A];T._markAsUpdated()}static FromFloatArrayToRefScaled(v,A,T,E){for(let C=0;C<16;C++)E._m[C]=v[C+A]*T;E._markAsUpdated()}static FromValuesToRef(v,A,T,E,C,R,z,M,O,V,W,j,H,X,Z,K,J){const $=J._m;$[0]=v,$[1]=A,$[2]=T,$[3]=E,$[4]=C,$[5]=R,$[6]=z,$[7]=M,$[8]=O,$[9]=V,$[10]=W,$[11]=j,$[12]=H,$[13]=X,$[14]=Z,$[15]=K,J._markAsUpdated()}static FromValues(v,A,T,E,C,R,z,M,O,V,W,j,H,X,Z,K){const J=new Dt,$=J._m;return $[0]=v,$[1]=A,$[2]=T,$[3]=E,$[4]=C,$[5]=R,$[6]=z,$[7]=M,$[8]=O,$[9]=V,$[10]=W,$[11]=j,$[12]=H,$[13]=X,$[14]=Z,$[15]=K,J._markAsUpdated(),J}static Compose(v,A,T){const E=new Dt;return Dt.ComposeToRef(v,A,T,E),E}static ComposeToRef(v,A,T,E){Dt.ScalingToRef(v.x,v.y,v.z,Qt.MathTmp.Matrix[1]),A.toRotationMatrix(Qt.MathTmp.Matrix[0]),Qt.MathTmp.Matrix[1].multiplyToRef(Qt.MathTmp.Matrix[0],E),E.setTranslation(T)}static Identity(){const v=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)}static Zero(){const v=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const A=new Dt;return Dt.RotationXToRef(v,A),A}static Invert(v){const A=new Dt;return v.invertToRef(A),A}static RotationXToRef(v,A){const T=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(1,0,0,0,0,E,T,0,0,-T,E,0,0,0,0,1,A),A._updateIdentityStatus(1===E&&0===T)}static RotationY(v){const A=new Dt;return Dt.RotationYToRef(v,A),A}static RotationYToRef(v,A){const T=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,0,-T,0,0,1,0,0,T,0,E,0,0,0,0,1,A),A._updateIdentityStatus(1===E&&0===T)}static RotationZ(v){const A=new Dt;return Dt.RotationZToRef(v,A),A}static RotationZToRef(v,A){const T=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,T,0,0,-T,E,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(1===E&&0===T)}static RotationAxis(v,A){const T=new Dt;return Dt.RotationAxisToRef(v,A,T),T}static RotationAxisToRef(v,A,T){const E=Math.sin(-A),C=Math.cos(-A),R=1-C;v.normalize();const z=T._m;z[0]=v.x*v.x*R+C,z[1]=v.x*v.y*R-v.z*E,z[2]=v.x*v.z*R+v.y*E,z[3]=0,z[4]=v.y*v.x*R+v.z*E,z[5]=v.y*v.y*R+C,z[6]=v.y*v.z*R-v.x*E,z[7]=0,z[8]=v.z*v.x*R-v.y*E,z[9]=v.z*v.y*R+v.x*E,z[10]=v.z*v.z*R+C,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,T._markAsUpdated()}static RotationYawPitchRoll(v,A,T){const E=new Dt;return Dt.RotationYawPitchRollToRef(v,A,T,E),E}static RotationYawPitchRollToRef(v,A,T,E){Yt.Quaternion.RotationYawPitchRollToRef(v,A,T,Qt.MathTmp.Quaternion[0]),Qt.MathTmp.Quaternion[0].toRotationMatrix(E)}static Scaling(v,A,T){const E=new Dt;return Dt.ScalingToRef(v,A,T,E),E}static ScalingToRef(v,A,T,E){Dt.FromValuesToRef(v,0,0,0,0,A,0,0,0,0,T,0,0,0,0,1,E),E._updateIdentityStatus(1===v&&1===A&&1===T)}static Translation(v,A,T){const E=new Dt;return Dt.TranslationToRef(v,A,T,E),E}static TranslationToRef(v,A,T,E){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,A,T,1,E),E._updateIdentityStatus(0===v&&0===A&&0===T)}static Lerp(v,A,T){const E=new Dt;return Dt.LerpToRef(v,A,T,E),E}static LerpToRef(v,A,T,E){for(let C=0;C<16;C++)E._m[C]=v._m[C]*(1-T)+A._m[C]*T;E._markAsUpdated()}static DecomposeLerp(v,A,T){const E=new Dt;return Dt.DecomposeLerpToRef(v,A,T,E),E}static DecomposeLerpToRef(v,A,T,E){const C=Qt.MathTmp.Vector3[0],R=Qt.MathTmp.Quaternion[0],z=Qt.MathTmp.Vector3[1];v.decompose(C,R,z);const M=Qt.MathTmp.Vector3[2],O=Qt.MathTmp.Quaternion[1],V=Qt.MathTmp.Vector3[3];A.decompose(M,O,V);const W=Qt.MathTmp.Vector3[4];Gt.Vector3.LerpToRef(C,M,T,W);const j=Qt.MathTmp.Quaternion[2];Yt.Quaternion.SlerpToRef(R,O,T,j);const H=Qt.MathTmp.Vector3[5];Gt.Vector3.LerpToRef(z,V,T,H),Dt.ComposeToRef(W,j,H,E)}static LookAtLH(v,A,T){const E=new Dt;return Dt.LookAtLHToRef(v,A,T,E),E}static LookAtLHToRef(v,A,T,E){const C=Qt.MathTmp.Vector3[0],R=Qt.MathTmp.Vector3[1],z=Qt.MathTmp.Vector3[2];A.subtractToRef(v,z),z.normalize(),Gt.Vector3.CrossToRef(T,z,C);const M=C.lengthSquared();0===M?C.x=1:C.normalizeFromLength(Math.sqrt(M)),Gt.Vector3.CrossToRef(z,C,R),R.normalize();const O=-Gt.Vector3.Dot(C,v),V=-Gt.Vector3.Dot(R,v),W=-Gt.Vector3.Dot(z,v);Dt.FromValuesToRef(C.x,R.x,z.x,0,C.y,R.y,z.y,0,C.z,R.z,z.z,0,O,V,W,1,E)}static LookAtRH(v,A,T){const E=new Dt;return Dt.LookAtRHToRef(v,A,T,E),E}static LookAtRHToRef(v,A,T,E){const C=Qt.MathTmp.Vector3[0],R=Qt.MathTmp.Vector3[1],z=Qt.MathTmp.Vector3[2];v.subtractToRef(A,z),z.normalize(),Gt.Vector3.CrossToRef(T,z,C);const M=C.lengthSquared();0===M?C.x=1:C.normalizeFromLength(Math.sqrt(M)),Gt.Vector3.CrossToRef(z,C,R),R.normalize();const O=-Gt.Vector3.Dot(C,v),V=-Gt.Vector3.Dot(R,v),W=-Gt.Vector3.Dot(z,v);Dt.FromValuesToRef(C.x,R.x,z.x,0,C.y,R.y,z.y,0,C.z,R.z,z.z,0,O,V,W,1,E)}static OrthoLH(v,A,T,E){const C=new Dt;return Dt.OrthoLHToRef(v,A,T,E,C),C}static OrthoLHToRef(v,A,T,E,C){const R=2/v,z=2/A,M=2/(E-T),O=-(E+T)/(E-T);Dt.FromValuesToRef(R,0,0,0,0,z,0,0,0,0,M,0,0,0,O,1,C),C._updateIdentityStatus(1===R&&1===z&&1===M&&0===O)}static OrthoOffCenterLH(v,A,T,E,C,R){const z=new Dt;return Dt.OrthoOffCenterLHToRef(v,A,T,E,C,R,z),z}static OrthoOffCenterLHToRef(v,A,T,E,C,R,z){const M=2/(A-v),O=2/(E-T),V=2/(R-C),W=-(R+C)/(R-C),j=(v+A)/(v-A),H=(E+T)/(T-E);Dt.FromValuesToRef(M,0,0,0,0,O,0,0,0,0,V,0,j,H,W,1,z),z._markAsUpdated()}static OrthoOffCenterRH(v,A,T,E,C,R){const z=new Dt;return Dt.OrthoOffCenterRHToRef(v,A,T,E,C,R,z),z}static OrthoOffCenterRHToRef(v,A,T,E,C,R,z){Dt.OrthoOffCenterLHToRef(v,A,T,E,C,R,z),z._m[10]*=-1}static PerspectiveLH(v,A,T,E){const C=new Dt,R=2*T/v,z=2*T/A,M=(E+T)/(E-T),O=-2*E*T/(E-T);return Dt.FromValuesToRef(R,0,0,0,0,z,0,0,0,0,M,1,0,0,O,0,C),C._updateIdentityStatus(!1),C}static PerspectiveFovLH(v,A,T,E){const C=new Dt;return Dt.PerspectiveFovLHToRef(v,A,T,E,C),C}static PerspectiveFovLHToRef(v,A,T,E,C,R=!0){const z=T,M=E,O=1/Math.tan(.5*v),V=R?O/A:O,W=R?O:O*A,j=(M+z)/(M-z),H=-2*M*z/(M-z);Dt.FromValuesToRef(V,0,0,0,0,W,0,0,0,0,j,1,0,0,H,0,C),C._updateIdentityStatus(!1)}static PerspectiveFovRH(v,A,T,E){const C=new Dt;return Dt.PerspectiveFovRHToRef(v,A,T,E,C),C}static PerspectiveFovRHToRef(v,A,T,E,C,R=!0){const z=T,M=E,O=1/Math.tan(.5*v),V=R?O/A:O,W=R?O:O*A,j=-(M+z)/(M-z),H=-2*M*z/(M-z);Dt.FromValuesToRef(V,0,0,0,0,W,0,0,0,0,j,-1,0,0,H,0,C),C._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(v,A,T,E,C=!1){const R=C?-1:1,z=Math.tan(v.upDegrees*Math.PI/180),M=Math.tan(v.downDegrees*Math.PI/180),O=Math.tan(v.leftDegrees*Math.PI/180),V=Math.tan(v.rightDegrees*Math.PI/180),W=2/(O+V),j=2/(z+M),H=E._m;H[0]=W,H[1]=H[2]=H[3]=H[4]=0,H[5]=j,H[6]=H[7]=0,H[8]=(O-V)*W*.5,H[9]=-(z-M)*j*.5,H[10]=-T/(A-T),H[11]=1*R,H[12]=H[13]=H[15]=0,H[14]=-2*T*A/(T-A),E._markAsUpdated()}static GetAsMatrix2x2(v){return[v._m[0],v._m[1],v._m[4],v._m[5]]}static GetAsMatrix3x3(v){return[v._m[0],v._m[1],v._m[2],v._m[4],v._m[5],v._m[6],v._m[8],v._m[9],v._m[10]]}static Transpose(v){const A=new Dt;return Dt.TransposeToRef(v,A),A}static TransposeToRef(v,A){const T=A._m,E=v._m;T[0]=E[0],T[1]=E[4],T[2]=E[8],T[3]=E[12],T[4]=E[1],T[5]=E[5],T[6]=E[9],T[7]=E[13],T[8]=E[2],T[9]=E[6],T[10]=E[10],T[11]=E[14],T[12]=E[3],T[13]=E[7],T[14]=E[11],T[15]=E[15],A._updateIdentityStatus(v._isIdentity,v._isIdentityDirty)}static Reflection(v){const A=new Dt;return Dt.ReflectionToRef(v,A),A}static ReflectionToRef(v,A){v.normalize();const T=v.normal.x,E=v.normal.y,C=v.normal.z,R=-2*T,z=-2*E,M=-2*C;Dt.FromValuesToRef(R*T+1,z*T,M*T,0,R*E,z*E+1,M*E,0,R*C,z*C,M*C+1,0,R*v.d,z*v.d,M*v.d,1,A)}static FromXYZAxesToRef(v,A,T,E){Dt.FromValuesToRef(v.x,v.y,v.z,0,A.x,A.y,A.z,0,T.x,T.y,T.z,0,0,0,0,1,E)}static FromQuaternionToRef(v,A){const T=v.x*v.x,E=v.y*v.y,C=v.z*v.z,R=v.x*v.y,z=v.z*v.w,M=v.z*v.x,O=v.y*v.w,V=v.y*v.z,W=v.x*v.w;A._m[0]=1-2*(E+C),A._m[1]=2*(R+z),A._m[2]=2*(M-O),A._m[3]=0,A._m[4]=2*(R-z),A._m[5]=1-2*(C+T),A._m[6]=2*(V+W),A._m[7]=0,A._m[8]=2*(M+O),A._m[9]=2*(V-W),A._m[10]=1-2*(E+T),A._m[11]=0,A._m[12]=0,A._m[13]=0,A._m[14]=0,A._m[15]=1,A._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this._m;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this._m,A=v[0],T=v[1],E=v[2],C=v[3],R=v[4],z=v[5],M=v[6],O=v[7],V=v[8],W=v[9],j=v[10],H=v[11],X=v[12],Z=v[13],K=v[14],J=v[15],$=j*J-K*H,et=W*J-Z*H,nt=W*K-Z*j,it=V*J-X*H,ot=V*K-j*X,rt=V*Z-X*W;return A*+(z*$-M*et+O*nt)+T*-(R*$-M*it+O*ot)+E*+(R*et-z*it+O*rt)+C*-(R*nt-z*ot+M*rt)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const A=new Dt;return this.addToRef(v,A),A}addToRef(v,A){for(let T=0;T<16;T++)A._m[T]=this._m[T]+v._m[T];return A._markAsUpdated(),this}addToSelf(v){for(let A=0;A<16;A++)this._m[A]+=v._m[A];return this._markAsUpdated(),this}invertToRef(v){if(!0===this._isIdentity)return Dt.IdentityToRef(v),this;const A=this._m,T=A[0],E=A[1],C=A[2],R=A[3],z=A[4],M=A[5],O=A[6],V=A[7],W=A[8],j=A[9],H=A[10],X=A[11],Z=A[12],K=A[13],J=A[14],$=A[15],et=H*$-J*X,nt=j*$-K*X,it=j*J-K*H,ot=W*$-Z*X,rt=W*J-H*Z,st=W*K-Z*j,at=+(M*et-O*nt+V*it),lt=-(z*et-O*ot+V*rt),ct=+(z*nt-M*ot+V*st),ht=-(z*it-M*rt+O*st),ut=T*at+E*lt+C*ct+R*ht;if(0===ut)return v.copyFrom(this),this;const pt=1/ut,dt=O*$-J*V,yt=M*$-K*V,ft=M*J-K*O,gt=z*$-Z*V,vt=z*J-Z*O,bt=z*K-Z*M,wt=O*X-H*V,xt=M*X-j*V,At=M*H-j*O,Tt=z*X-W*V,St=z*H-W*O,Ct=z*j-W*M,It=-(E*et-C*nt+R*it),Rt=+(T*et-C*ot+R*rt),_t=-(T*nt-E*ot+R*st),Pt=+(T*it-E*rt+C*st),Bt=+(E*dt-C*yt+R*ft),zt=-(T*dt-C*gt+R*vt),Ot=+(T*yt-E*gt+R*bt),Nt=-(T*ft-E*vt+C*bt),Lt=-(E*wt-C*xt+R*At),Ft=+(T*wt-C*Tt+R*St),kt=-(T*xt-E*Tt+R*Ct),Vt=+(T*At-E*St+C*Ct);return Dt.FromValuesToRef(at*pt,It*pt,Bt*pt,Lt*pt,lt*pt,Rt*pt,zt*pt,Ft*pt,ct*pt,_t*pt,Ot*pt,kt*pt,ht*pt,Pt*pt,Nt*pt,Vt*pt,v),this}addAtIndex(v,A){return this._m[v]+=A,this._markAsUpdated(),this}multiplyAtIndex(v,A){return this._m[v]*=A,this._markAsUpdated(),this}setTranslationFromFloats(v,A,T){return this._m[12]=v,this._m[13]=A,this._m[14]=T,this._markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v.x,v.y,v.z)}getTranslation(){return new Gt.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(v){return v.x=this._m[12],v.y=this._m[13],v.z=this._m[14],this}removeRotationAndScaling(){const v=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}multiply(v){const A=new Dt;return this.multiplyToRef(v,A),A}copyFrom(v){v.copyToArray(this._m);const A=v;return this._updateIdentityStatus(A._isIdentity,A._isIdentityDirty,A._isIdentity3x2,A._isIdentity3x2Dirty),this}copyToArray(v,A=0){for(let T=0;T<16;T++)v[A+T]=this._m[T];return this}multiplyToRef(v,A){return this._isIdentity?(A.copyFrom(v),this):v._isIdentity?(A.copyFrom(this),this):(this.multiplyToArray(v,A._m,0),A._markAsUpdated(),this)}multiplyToArray(v,A,T){const E=this._m,C=v.m,R=E[0],z=E[1],M=E[2],O=E[3],V=E[4],W=E[5],j=E[6],H=E[7],X=E[8],Z=E[9],K=E[10],J=E[11],$=E[12],et=E[13],nt=E[14],it=E[15],ot=C[0],rt=C[1],st=C[2],at=C[3],lt=C[4],ct=C[5],ht=C[6],ut=C[7],pt=C[8],dt=C[9],yt=C[10],ft=C[11],gt=C[12],vt=C[13],bt=C[14],wt=C[15];return A[T]=R*ot+z*lt+M*pt+O*gt,A[T+1]=R*rt+z*ct+M*dt+O*vt,A[T+2]=R*st+z*ht+M*yt+O*bt,A[T+3]=R*at+z*ut+M*ft+O*wt,A[T+4]=V*ot+W*lt+j*pt+H*gt,A[T+5]=V*rt+W*ct+j*dt+H*vt,A[T+6]=V*st+W*ht+j*yt+H*bt,A[T+7]=V*at+W*ut+j*ft+H*wt,A[T+8]=X*ot+Z*lt+K*pt+J*gt,A[T+9]=X*rt+Z*ct+K*dt+J*vt,A[T+10]=X*st+Z*ht+K*yt+J*bt,A[T+11]=X*at+Z*ut+K*ft+J*wt,A[T+12]=$*ot+et*lt+nt*pt+it*gt,A[T+13]=$*rt+et*ct+nt*dt+it*vt,A[T+14]=$*st+et*ht+nt*yt+it*bt,A[T+15]=$*at+et*ut+nt*ft+it*wt,this}equals(v){const A=v;if(!A)return!1;if((this._isIdentity||A._isIdentity)&&!this._isIdentityDirty&&!A._isIdentityDirty)return this._isIdentity&&A._isIdentity;const T=this.m,E=A.m;return T[0]===E[0]&&T[1]===E[1]&&T[2]===E[2]&&T[3]===E[3]&&T[4]===E[4]&&T[5]===E[5]&&T[6]===E[6]&&T[7]===E[7]&&T[8]===E[8]&&T[9]===E[9]&&T[10]===E[10]&&T[11]===E[11]&&T[12]===E[12]&&T[13]===E[13]&&T[14]===E[14]&&T[15]===E[15]}clone(){const v=new Dt;return v.copyFrom(this),v}getClassName(){return"Matrix"}getHashCode(){let v=this._m[0]||0;for(let A=1;A<16;A++)v=397*v^(this._m[A]||0);return v}decompose(v,A,T){if(this._isIdentity)return T&&T.setAll(0),v&&v.setAll(1),A&&A.copyFromFloats(0,0,0,1),!0;const E=this._m;T&&T.copyFromFloats(E[12],E[13],E[14]);const C=v||Qt.MathTmp.Vector3[0];if(C.x=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),C.y=Math.sqrt(E[4]*E[4]+E[5]*E[5]+E[6]*E[6]),C.z=Math.sqrt(E[8]*E[8]+E[9]*E[9]+E[10]*E[10]),this.determinant()<=0&&(C.y*=-1),0===C.x||0===C.y||0===C.z)return A&&A.copyFromFloats(0,0,0,1),!1;if(A){const v=1/C.x,T=1/C.y,R=1/C.z;Dt.FromValuesToRef(E[0]*v,E[1]*v,E[2]*v,0,E[4]*T,E[5]*T,E[6]*T,0,E[8]*R,E[9]*R,E[10]*R,0,0,0,0,1,Qt.MathTmp.Matrix[0]),Yt.Quaternion.FromRotationMatrixToRef(Qt.MathTmp.Matrix[0],A)}return!0}getRow(v){if(v<0||v>3)return null;const A=4*v;return new Zt.Vector4(this._m[A+0],this._m[A+1],this._m[A+2],this._m[A+3])}setRow(v,A){return this.setRowFromFloats(v,A.x,A.y,A.z,A.w)}transpose(){return Dt.Transpose(this)}transposeToRef(v){return Dt.TransposeToRef(this,v),this}setRowFromFloats(v,A,T,E,C){if(v<0||v>3)return this;const R=4*v;return this._m[R+0]=A,this._m[R+1]=T,this._m[R+2]=E,this._m[R+3]=C,this._markAsUpdated(),this}scale(v){const A=new Dt;return this.scaleToRef(v,A),A}scaleToRef(v,A){for(let T=0;T<16;T++)A._m[T]=this._m[T]*v;return A._markAsUpdated(),this}scaleAndAddToRef(v,A){for(let T=0;T<16;T++)A._m[T]+=this._m[T]*v;return A._markAsUpdated(),this}toNormalMatrix(v){const A=Qt.MathTmp.Matrix[0];this.invertToRef(A),A.transposeToRef(v);const T=v._m;Dt.FromValuesToRef(T[0],T[1],T[2],0,T[4],T[5],T[6],0,T[8],T[9],T[10],0,0,0,0,1,v)}getRotationMatrix(){const v=new Dt;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const A=Qt.MathTmp.Vector3[0];if(!this.decompose(A))return Dt.IdentityToRef(v),this;const T=this._m,E=1/A.x,C=1/A.y,R=1/A.z;return Dt.FromValuesToRef(T[0]*E,T[1]*E,T[2]*E,0,T[4]*C,T[5]*C,T[6]*C,0,T[8]*R,T[9]*R,T[10]*R,0,0,0,0,1,v),this}toggleModelMatrixHandInPlace(){const v=this._m;v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const v=this._m;v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(v,A=!1,T=!1,E=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=v,this._isIdentity3x2=v||T,this._isIdentityDirty=!this._isIdentity&&A,this._isIdentity3x2Dirty=!this._isIdentity3x2&&E}}kt.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.Quaternion=void 0;const Kt=kt,Jt=Lt,$t=Ot,ee=zt,ne=qt;class jt{constructor(v=0,A=0,T=0,E=1){this.x=v,this.y=A,this.z=T,this.w=E}static FromRotationMatrix(v){const A=new jt;return jt.FromRotationMatrixToRef(v,A),A}static FromRotationMatrixToRef(v,A){const T=v.m,E=T[0],C=T[4],R=T[8],z=T[1],M=T[5],O=T[9],V=T[2],W=T[6],j=T[10],H=E+M+j;let X;H>0?(X=.5/Math.sqrt(H+1),A.w=.25/X,A.x=(W-O)*X,A.y=(R-V)*X,A.z=(z-C)*X):E>M&&E>j?(X=2*Math.sqrt(1+E-M-j),A.w=(W-O)/X,A.x=.25*X,A.y=(C+z)/X,A.z=(R+V)/X):M>j?(X=2*Math.sqrt(1+M-E-j),A.w=(R-V)/X,A.x=(C+z)/X,A.y=.25*X,A.z=(O+W)/X):(X=2*Math.sqrt(1+j-E-M),A.w=(z-C)/X,A.x=(R+V)/X,A.y=(O+W)/X,A.z=.25*X)}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w}static AreClose(v,A){return jt.Dot(v,A)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(v){return new jt(-v.x,-v.y,-v.z,v.w)}static IsIdentity(v){return v&&0===v.x&&0===v.y&&0===v.z&&1===v.w}static RotationAxis(v,A){const T=A*ee.DEG2RAD;return jt.RotationAxisToRef(v,T,new jt)}static RotationAxisToRef(v,A,T){const E=A*ee.DEG2RAD,C=Math.sin(E/2);return v.normalize(),T.w=Math.cos(E/2),T.x=v.x*C,T.y=v.y*C,T.z=v.z*C,T}static FromArray(v,A=0){return new jt(v[A],v[A+1],v[A+2],v[A+3])}static FromEulerAnglesRef(v,A,T,E){return jt.RotationYawPitchRollToRef(A*ee.DEG2RAD,v*ee.DEG2RAD,T*ee.DEG2RAD,E)}static RotationYawPitchRoll(v,A,T){const E=new jt;return jt.RotationYawPitchRollToRef(v,A,T,E),E}static RotationYawPitchRollToRef(v,A,T,E){const C=.5*A,R=.5*v,z=.5*T,M=Math.cos(C),O=Math.cos(R),V=Math.cos(z),W=Math.sin(C),j=Math.sin(R),H=Math.sin(z);E.x=O*W*V+j*M*H,E.y=j*M*V-O*W*H,E.z=O*M*H-j*W*V,E.w=O*M*V+j*W*H}static RotationAlphaBetaGamma(v,A,T){const E=new jt;return jt.RotationAlphaBetaGammaToRef(v,A,T,E),E}static RotationAlphaBetaGammaToRef(v,A,T,E){const C=.5*(T+v),R=.5*(T-v),z=.5*A;E.x=Math.cos(R)*Math.sin(z),E.y=Math.sin(R)*Math.sin(z),E.z=Math.sin(C)*Math.cos(z),E.w=Math.cos(C)*Math.cos(z)}static RotationQuaternionFromAxis(v,A,T){const E=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(v,A,T,E),E}static RotationQuaternionFromAxisToRef(v,A,T,E){const C=$t.MathTmp.Matrix[0];Kt.Matrix.FromXYZAxesToRef(v.normalize(),A.normalize(),T.normalize(),C),jt.FromRotationMatrixToRef(C,E)}static Slerp(v,A,T){const E=jt.Identity;return jt.SlerpToRef(v,A,T,E),E}static SlerpToRef(v,A,T,E){let C,R,z=v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w,M=!1;if(z<0&&(M=!0,z=-z),z>.999999)R=1-T,C=M?-T:T;else{const v=Math.acos(z),A=1/Math.sin(v);R=Math.sin((1-T)*v)*A,C=M?-Math.sin(T*v)*A:Math.sin(T*v)*A}E.x=R*v.x+C*A.x,E.y=R*v.y+C*A.y,E.z=R*v.z+C*A.z,E.w=R*v.w+C*A.w}static Hermite(v,A,T,E,C){const R=C*C,z=C*R,M=2*z-3*R+1,O=-2*z+3*R,V=z-2*R+C,W=z-R,j=v.x*M+T.x*O+A.x*V+E.x*W,H=v.y*M+T.y*O+A.y*V+E.y*W,X=v.z*M+T.z*O+A.z*V+E.z*W,Z=v.w*M+T.w*O+A.w*V+E.w*W;return new jt(j,H,X,Z)}static get Identity(){return new jt(0,0,0,1)}static Angle(v,A){const T=jt.Dot(v,A);return 2*Math.acos(Math.min(Math.abs(T),1))*ee.RAD2DEG}static Euler(v,A,T){return jt.RotationYawPitchRoll(A*ee.DEG2RAD,v*ee.DEG2RAD,T*ee.DEG2RAD)}static LookRotation(v,A=$t.MathTmp.staticUp){const T=Jt.Vector3.Normalize(v),E=Jt.Vector3.Normalize(Jt.Vector3.Cross(A,T)),C=Jt.Vector3.Cross(T,E),R=E.x,z=E.y,M=E.z,O=C.x,V=C.y,W=C.z,j=T.x,H=T.y,X=T.z,Z=R+V+X,K=new jt;if(Z>0){let v=Math.sqrt(Z+1);return K.w=.5*v,v=.5/v,K.x=(W-H)*v,K.y=(j-M)*v,K.z=(z-O)*v,K}if(R>=V&&R>=X){const v=Math.sqrt(1+R-V-X),A=.5/v;return K.x=.5*v,K.y=(z+O)*A,K.z=(M+j)*A,K.w=(W-H)*A,K}if(V>X){const v=Math.sqrt(1+V-R-X),A=.5/v;return K.x=(O+z)*A,K.y=.5*v,K.z=(H+W)*A,K.w=(j-M)*A,K}const J=Math.sqrt(1+X-R-V),$=.5/J;return K.x=(j+M)*$,K.y=(H+W)*$,K.z=.5*J,K.w=(z-O)*$,K}static RotateTowards(v,A,T){const E=jt.Angle(v,A);if(0===E)return A;const C=Math.min(1,T/E);return jt.Slerp(v,A,C)}static FromToRotation(v,A,T=$t.MathTmp.staticUp){const E=v.normalize(),C=A.normalize(),R=Jt.Vector3.Cross(E,C),z=Math.sqrt(E.lengthSquared()*C.lengthSquared())+Jt.Vector3.Dot(E,C);return R.lengthSquared()<1e-4?Math.abs(z)<1e-4?new jt(T.x,T.y,T.z,0).normalized:jt.Identity:new jt(R.x,R.y,R.z,z).normalized}get normalized(){return this.normalize()}setFromToRotation(v,A,T=$t.MathTmp.staticUp){const E=jt.FromToRotation(v,A,T);this.x=E.x,this.y=E.y,this.z=E.z,this.w=E.w}set eulerAngles(v){this.setEuler(v.x,v.y,v.z)}get eulerAngles(){const v=new Jt.Vector3,A=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,T=this.x*this.w-this.y*this.z;return T>.4995*A?(v.x=Math.PI/2,v.y=2*Math.atan2(this.y,this.x),v.z=0):T<-.4995*A?(v.x=-Math.PI/2,v.y=-2*Math.atan2(this.y,this.x),v.z=0):(v.x=Math.asin(2*(this.w*this.x-this.y*this.z)),v.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),v.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),v.x*=ee.RAD2DEG,v.y*=ee.RAD2DEG,v.z*=ee.RAD2DEG,v.x=ne.Scalar.Repeat(v.x,360),v.y=ne.Scalar.Repeat(v.y,360),v.z=ne.Scalar.Repeat(v.z,360),v}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){return[this.x,this.y,this.z,this.w]}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,T,E){return this.x=v,this.y=A,this.z=T,this.w=E,this}set(v,A,T,E){return this.copyFromFloats(v,A,T,E)}setEuler(v,A,T){return jt.RotationYawPitchRollToRef(A*ee.DEG2RAD,v*ee.DEG2RAD,T*ee.DEG2RAD,this),this}add(v){return new jt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}subtract(v){return new jt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}scale(v){return new jt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}multiply(v){const A=new jt(0,0,0,1);return this.multiplyToRef(v,A),A}multiplyToRef(v,A){const T=this.x*v.w+this.y*v.z-this.z*v.y+this.w*v.x,E=-this.x*v.z+this.y*v.w+this.z*v.x+this.w*v.y,C=this.x*v.y-this.y*v.x+this.z*v.w+this.w*v.z,R=-this.x*v.x-this.y*v.y-this.z*v.z+this.w*v.w;return A.copyFromFloats(T,E,C,R),this}multiplyInPlace(v){return this.multiplyToRef(v,this),this}conjugateToRef(v){return v.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const v=1/this.length;return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}angleAxis(v,A){if(0===A.lengthSquared())return jt.Identity;const T=jt.Identity;let E=v*ee.DEG2RAD;E*=.5;let C=A.normalize();return C=A.scaleInPlace(Math.sin(E)),T.x=C.x,T.y=C.y,T.z=C.z,T.w=Math.cos(E),T.normalize()}toRotationMatrix(v){return Kt.Matrix.FromQuaternionToRef(this,v),this}fromRotationMatrix(v){return jt.FromRotationMatrixToRef(v,this),this}}Ft.Quaternion=jt,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Vector3=void 0;const ie=Ot,oe=zt,se=Ft,ae=qt;class Xt{constructor(v=0,A=0,T=0){this.x=v,this.y=A,this.z=T}get isNonUniform(){const v=Math.abs(this.x),A=Math.abs(this.y);if(v!==A)return!0;const T=Math.abs(this.z);return v!==T||A!==T}static Add(v,A){return new Xt(v.x,v.y,v.z).addInPlace(A)}static GetClipFactor(v,A,T,E){const C=Xt.Dot(v,T)-E;return C/(C-(Xt.Dot(A,T)-E))}static GetAngleBetweenVectors(v,A,T){const E=v.normalizeToRef(ie.MathTmp.Vector3[1]),C=A.normalizeToRef(ie.MathTmp.Vector3[2]),R=Xt.Dot(E,C),z=ie.MathTmp.Vector3[3];return Xt.CrossToRef(E,C,z),Xt.Dot(z,T)>0?Math.acos(R):-Math.acos(R)}static FromArray(v,A=0){return new Xt(v[A],v[A+1],v[A+2])}static FromFloatArray(v,A){return Xt.FromArray(v,A)}static FromArrayToRef(v,A,T){T.x=v[A],T.y=v[A+1],T.z=v[A+2]}static FromFloatArrayToRef(v,A,T){return Xt.FromArrayToRef(v,A,T)}static FromFloatsToRef(v,A,T,E){E.copyFromFloats(v,A,T)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(v,A){const T=Xt.Zero();return Xt.TransformCoordinatesToRef(v,A,T),T}static TransformCoordinatesToRef(v,A,T){return Xt.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,A,T)}static TransformCoordinatesFromFloatsToRef(v,A,T,E,C){const R=E.m,z=v*R[0]+A*R[4]+T*R[8]+R[12],M=v*R[1]+A*R[5]+T*R[9]+R[13],O=v*R[2]+A*R[6]+T*R[10]+R[14],V=1/(v*R[3]+A*R[7]+T*R[11]+R[15]);C.x=z*V,C.y=M*V,C.z=O*V}static TransformNormal(v,A){const T=Xt.Zero();return Xt.TransformNormalToRef(v,A,T),T}static TransformNormalToRef(v,A,T){this.TransformNormalFromFloatsToRef(v.x,v.y,v.z,A,T)}static TransformNormalFromFloatsToRef(v,A,T,E,C){const R=E.m;C.x=v*R[0]+A*R[4]+T*R[8],C.y=v*R[1]+A*R[5]+T*R[9],C.z=v*R[2]+A*R[6]+T*R[10]}static CatmullRom(v,A,T,E,C){const R=C*C,z=C*R,M=.5*(2*A.x+(-v.x+T.x)*C+(2*v.x-5*A.x+4*T.x-E.x)*R+(-v.x+3*A.x-3*T.x+E.x)*z),O=.5*(2*A.y+(-v.y+T.y)*C+(2*v.y-5*A.y+4*T.y-E.y)*R+(-v.y+3*A.y-3*T.y+E.y)*z),V=.5*(2*A.z+(-v.z+T.z)*C+(2*v.z-5*A.z+4*T.z-E.z)*R+(-v.z+3*A.z-3*T.z+E.z)*z);return new Xt(M,O,V)}static Clamp(v,A,T){const E=new Xt;return Xt.ClampToRef(v,A,T,E),E}static ClampToRef(v,A,T,E){let C=v.x;C=C>T.x?T.x:C,C=C<A.x?A.x:C;let R=v.y;R=R>T.y?T.y:R,R=R<A.y?A.y:R;let z=v.z;z=z>T.z?T.z:z,z=z<A.z?A.z:z,E.copyFromFloats(C,R,z)}static Hermite(v,A,T,E,C){const R=C*C,z=C*R,M=2*z-3*R+1,O=-2*z+3*R,V=z-2*R+C,W=z-R,j=v.x*M+T.x*O+A.x*V+E.x*W,H=v.y*M+T.y*O+A.y*V+E.y*W,X=v.z*M+T.z*O+A.z*V+E.z*W;return new Xt(j,H,X)}static Lerp(v,A,T){const E=new Xt(0,0,0);return Xt.LerpToRef(v,A,T,E),E}static LerpToRef(v,A,T,E){E.x=v.x+(A.x-v.x)*T,E.y=v.y+(A.y-v.y)*T,E.z=v.z+(A.z-v.z)*T}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z}static Cross(v,A){const T=Xt.Zero();return Xt.CrossToRef(v,A,T),T}static CrossToRef(v,A,T){const E=v.y*A.z-v.z*A.y,C=v.z*A.x-v.x*A.z,R=v.x*A.y-v.y*A.x;T.copyFromFloats(E,C,R)}static Normalize(v){const A=Xt.Zero();return Xt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){v.normalizeToRef(A)}static Minimize(v,A){const T=new Xt(v.x,v.y,v.z);return T.minimizeInPlace(A),T}static Maximize(v,A){const T=new Xt(v.x,v.y,v.z);return T.maximizeInPlace(A),T}static Distance(v,A){return Math.sqrt(Xt.DistanceSquared(v,A))}static DistanceSquared(v,A){const T=v.x-A.x,E=v.y-A.y,C=v.z-A.z;return T*T+E*E+C*C}static Center(v,A){const T=Xt.Add(v,A);return T.scaleInPlace(.5),T}static RotationFromAxis(v,A,T){const E=Xt.Zero();return Xt.RotationFromAxisToRef(v,A,T,E),E}static RotationFromAxisToRef(v,A,T,E){const C=ie.MathTmp.Quaternion[0];se.Quaternion.RotationQuaternionFromAxisToRef(v,A,T,C),E.copyFrom(C.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v}asArray(){const v=[];return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,this}toQuaternion(){return se.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(v){return this.addInPlaceFromFloats(v.x,v.y,v.z)}addInPlaceFromFloats(v,A,T){return this.x+=v,this.y+=A,this.z+=T,this}add(v){return new Xt(this.x+v.x,this.y+v.y,this.z+v.z)}addToRef(v,A){return A.copyFromFloats(this.x+v.x,this.y+v.y,this.z+v.z)}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subtract(v){return new Xt(this.x-v.x,this.y-v.y,this.z-v.z)}subtractToRef(v,A){return this.subtractFromFloatsToRef(v.x,v.y,v.z,A)}subtractFromFloats(v,A,T){return new Xt(this.x-v,this.y-A,this.z-T)}subtractFromFloatsToRef(v,A,T,E){return E.copyFromFloats(this.x-v,this.y-A,this.z-T)}applyMatrix4(v){this.applyMatrix4ToRef(v,this)}applyMatrix4ToRef(v,A){const{x:T,y:E,z:C}=this,{m:R}=v,z=1/(R[3]*T+R[7]*E+R[11]*C+R[15]);return A.x=(R[0]*T+R[4]*E+R[8]*C+R[12])*z,A.y=(R[1]*T+R[5]*E+R[9]*C+R[13])*z,A.z=(R[2]*T+R[6]*E+R[10]*C+R[14])*z,A}rotate(v){return this.rotateToRef(v,this)}rotateToRef(v,A){const{x:T,y:E,z:C}=this,{x:R,y:z,z:M,w:O}=v,V=O*T+z*C-M*E,W=O*E+M*T-R*C,j=O*C+R*E-z*T,H=-R*T-z*E-M*C;return A.x=V*O+H*-R+W*-M-j*-z,A.y=W*O+H*-z+j*-R-V*-M,A.z=j*O+H*-M+V*-z-W*-R,A}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this}scale(v){return new Xt(this.x*v,this.y*v,this.z*v)}scaleToRef(v,A){return A.copyFromFloats(this.x*v,this.y*v,this.z*v)}scaleAndAddToRef(v,A){return A.addInPlaceFromFloats(this.x*v,this.y*v,this.z*v)}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z}equalsWithEpsilon(v,A=oe.Epsilon){return v&&ae.Scalar.WithinEpsilon(this.x,v.x,A)&&ae.Scalar.WithinEpsilon(this.y,v.y,A)&&ae.Scalar.WithinEpsilon(this.z,v.z,A)}equalsToFloats(v,A,T){return this.x===v&&this.y===A&&this.z===T}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiply(v){return this.multiplyByFloats(v.x,v.y,v.z)}multiplyToRef(v,A){return A.copyFromFloats(this.x*v.x,this.y*v.y,this.z*v.z)}multiplyByFloats(v,A,T){return new Xt(this.x*v,this.y*A,this.z*T)}divide(v){return new Xt(this.x/v.x,this.y/v.y,this.z/v.z)}divideToRef(v,A){return A.copyFromFloats(this.x/v.x,this.y/v.y,this.z/v.z)}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y,v.z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y,v.z)}minimizeInPlaceFromFloats(v,A,T){return v<this.x&&(this.x=v),A<this.y&&(this.y=A),T<this.z&&(this.z=T),this}maximizeInPlaceFromFloats(v,A,T){return v>this.x&&(this.x=v),A>this.y&&(this.y=A),T>this.z&&(this.z=T),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Xt(0,0,0);return this.normalizeToRef(v),v}normalizeToRef(v){const A=this.length();return 0===A||1===A?v.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/A,v)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(v){return this.copyFromFloats(v.x,v.y,v.z)}copyFromFloats(v,A,T){return this.x=v,this.y=A,this.z=T,this}set(v,A,T){return this.copyFromFloats(v,A,T)}setAll(v){return this.x=this.y=this.z=v,this}}Lt.Vector3=Xt,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.MathTmp=void 0;const le=Nt,ce=Lt,he=Ft,ue=kt;Ot.MathTmp={Vector3:(0,le.buildArray)(6,ce.Vector3.Zero),Matrix:(0,le.buildArray)(2,ue.Matrix.Identity),Quaternion:(0,le.buildArray)(3,he.Quaternion.Zero),staticUp:ce.Vector3.Up(),tmpMatrix:ue.Matrix.Zero()};var de={};Object.defineProperty(de,"__esModule",{value:!0}),de.Angle=void 0;class te{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(v,A){const T=A.subtract(v),E=Math.atan2(T.y,T.x);return new te(E)}static FromRadians(v){return new te(v)}static FromDegrees(v){return new te(v*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}de.Angle=te;var ye={},fe={};Object.defineProperty(fe,"__esModule",{value:!0}),fe.Vector2=void 0;const me=zt,ve=qt;class re{constructor(v=0,A=0){this.x=v,this.y=A}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(v,A){return new re(v.x,v.y).addInPlace(A)}static FromArray(v,A=0){return new re(v[A],v[A+1])}static FromArrayToRef(v,A,T){T.x=v[A],T.y=v[A+1]}static CatmullRom(v,A,T,E,C){const R=C*C,z=C*R,M=.5*(2*A.x+(-v.x+T.x)*C+(2*v.x-5*A.x+4*T.x-E.x)*R+(-v.x+3*A.x-3*T.x+E.x)*z),O=.5*(2*A.y+(-v.y+T.y)*C+(2*v.y-5*A.y+4*T.y-E.y)*R+(-v.y+3*A.y-3*T.y+E.y)*z);return new re(M,O)}static Clamp(v,A,T){let E=v.x;E=E>T.x?T.x:E,E=E<A.x?A.x:E;let C=v.y;return C=C>T.y?T.y:C,C=C<A.y?A.y:C,new re(E,C)}static Hermite(v,A,T,E,C){const R=C*C,z=C*R,M=2*z-3*R+1,O=-2*z+3*R,V=z-2*R+C,W=z-R,j=v.x*M+T.x*O+A.x*V+E.x*W,H=v.y*M+T.y*O+A.y*V+E.y*W;return new re(j,H)}static Lerp(v,A,T){const E=v.x+(A.x-v.x)*T,C=v.y+(A.y-v.y)*T;return new re(E,C)}static Dot(v,A){return v.x*A.x+v.y*A.y}static Normalize(v){const A=new re(v.x,v.y);return A.normalize(),A}static Minimize(v,A){const T=v.x<A.x?v.x:A.x,E=v.y<A.y?v.y:A.y;return new re(T,E)}static Maximize(v,A){const T=v.x>A.x?v.x:A.x,E=v.y>A.y?v.y:A.y;return new re(T,E)}static Transform(v,A){const T=re.Zero();return re.TransformToRef(v,A,T),T}static TransformToRef(v,A,T){const E=A.m,C=v.x*E[0]+v.y*E[4]+E[12],R=v.x*E[1]+v.y*E[5]+E[13];T.x=C,T.y=R}static PointInTriangle(v,A,T,E){const C=.5*(-T.y*E.x+A.y*(-T.x+E.x)+A.x*(T.y-E.y)+T.x*E.y),R=C<0?-1:1,z=(A.y*E.x-A.x*E.y+(E.y-A.y)*v.x+(A.x-E.x)*v.y)*R,M=(A.x*T.y-A.y*T.x+(A.y-T.y)*v.x+(T.x-A.x)*v.y)*R;return z>0&&M>0&&z+M<2*C*R}static Distance(v,A){return Math.sqrt(re.DistanceSquared(v,A))}static DistanceSquared(v,A){const T=v.x-A.x,E=v.y-A.y;return T*T+E*E}static Center(v,A){const T=re.Add(v,A);return T.scaleInPlace(.5),T}static DistanceOfPointFromSegment(v,A,T){const E=re.DistanceSquared(A,T);if(0===E)return re.Distance(v,A);const C=T.subtract(A),R=Math.max(0,Math.min(1,re.Dot(v.subtract(A),C)/E)),z=A.add(C.multiplyByFloats(R,R));return re.Distance(v,z)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,this}asArray(){const v=new Array;return this.toArray(v,0),v}copyFrom(v){return this.x=v.x,this.y=v.y,this}copyFromFloats(v,A){return this.x=v,this.y=A,this}set(v,A){return this.copyFromFloats(v,A)}add(v){return new re(this.x+v.x,this.y+v.y)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addVector3(v){return new re(this.x+v.x,this.y+v.y)}subtract(v){return new re(this.x-v.x,this.y-v.y)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new re(this.x*v.x,this.y*v.y)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,this}multiplyByFloats(v,A){return new re(this.x*v,this.y*A)}divide(v){return new re(this.x/v.x,this.y/v.y)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,this}divideInPlace(v){return this.divideToRef(v,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){const A=new re(0,0);return this.scaleToRef(v,A),A}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v,A=me.Epsilon){return v&&ve.Scalar.WithinEpsilon(this.x,v.x,A)&&ve.Scalar.WithinEpsilon(this.y,v.y,A)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const v=this.length();if(0===v)return this;const A=1/v;return this.x*=A,this.y*=A,this}clone(){return new re(this.x,this.y)}}fe.Vector2=re,Object.defineProperty(ye,"__esModule",{value:!0}),ye.Arc2=void 0;const be=de,we=fe,Te=zt;ye.Arc2=class{constructor(v,A,T){this.startPoint=v,this.midPoint=A,this.endPoint=T;const E=Math.pow(A.x,2)+Math.pow(A.y,2),C=(Math.pow(v.x,2)+Math.pow(v.y,2)-E)/2,R=(E-Math.pow(T.x,2)-Math.pow(T.y,2))/2,z=(v.x-A.x)*(A.y-T.y)-(A.x-T.x)*(v.y-A.y);this.centerPoint=new we.Vector2((C*(A.y-T.y)-R*(v.y-A.y))/z,((v.x-A.x)*R-(A.x-T.x)*C)/z),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=be.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const M=this.startAngle.degrees();let O=be.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),V=be.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();O-M>180&&(O-=360),O-M<-180&&(O+=360),V-O>180&&(V-=360),V-O<-180&&(V+=360),this.orientation=O-M<0?Te.Orientation.CW:Te.Orientation.CCW,this.angle=be.Angle.FromDegrees(this.orientation===Te.Orientation.CW?M-V:V-M)}};var Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.Axis=void 0;const Ee=Lt;class pe{}Se.Axis=pe,pe.X=new Ee.Vector3(1,0,0),pe.Y=new Ee.Vector3(0,1,0),pe.Z=new Ee.Vector3(0,0,1);var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.BezierCurve=void 0,Ce.BezierCurve=class{static Interpolate(v,A,T,E,C){const R=1-3*E+3*A,z=3*E-6*A,M=3*A;let O=v;for(let A=0;A<5;A++){const A=O*O;O-=1/(3*R*A+2*z*O+M)*(R*(A*O)+z*A+M*O-v),O=Math.min(1,Math.max(0,O))}return 3*Math.pow(1-O,2)*O*T+3*(1-O)*Math.pow(O,2)*C+Math.pow(O,3)}};var Ie={},Re={};Object.defineProperty(Re,"__esModule",{value:!0}),Re.Color4=void 0;const _e=qt,Pe=zt;class ge{constructor(v=0,A=0,T=0,E=1){this.r=v,this.g=A,this.b=T,this.a=E}static FromHexString(v){if("#"!==v.substring(0,1)||9!==v.length)return new ge(0,0,0,0);const A=parseInt(v.substring(1,3),16),T=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16),C=parseInt(v.substring(7,9),16);return ge.FromInts(A,T,E,C)}static Lerp(v,A,T){const E=new ge(0,0,0,0);return ge.LerpToRef(v,A,T,E),E}static LerpToRef(v,A,T,E){E.r=v.r+(A.r-v.r)*T,E.g=v.g+(A.g-v.g)*T,E.b=v.b+(A.b-v.b)*T,E.a=v.a+(A.a-v.a)*T}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(v,A=1){return new ge(v.r,v.g,v.b,A)}static FromArray(v,A=0){return new ge(v[A],v[A+1],v[A+2],v[A+3])}static FromInts(v,A,T,E){return new ge(v/255,A/255,T/255,E/255)}static CheckColors4(v,A){if(v.length===3*A){const A=[];for(let T=0;T<v.length;T+=3){const E=T/3*4;A[E]=v[T],A[E+1]=v[T+1],A[E+2]=v[T+2],A[E+3]=1}return A}return v}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,v[A+3]=this.a,this}add(v){return new ge(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}subtract(v){return new ge(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,A.a=this.a-v.a,this}scale(v){return new ge(this.r*v,this.g*v,this.b*v,this.a*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,A.a=this.a*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,A.a+=this.a*v,this}clampToRef(v=0,A=1,T){return T.r=_e.Scalar.Clamp(this.r,v,A),T.g=_e.Scalar.Clamp(this.g,v,A),T.b=_e.Scalar.Clamp(this.b,v,A),T.a=_e.Scalar.Clamp(this.a,v,A),this}multiply(v){return new ge(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,A.a=this.a*v.a,A}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v=397*v^(this.a||0),v}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}copyFromFloats(v,A,T,E){return this.r=v,this.g=A,this.b=T,this.a=E,this}set(v,A,T,E){return this.copyFromFloats(v,A,T,E)}toHexString(){const v=255*this.r|0,A=255*this.g|0,T=255*this.b|0,E=255*this.a|0;return"#"+_e.Scalar.ToHex(v)+_e.Scalar.ToHex(A)+_e.Scalar.ToHex(T)+_e.Scalar.ToHex(E)}toLinearSpace(){const v=new ge;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Pe.ToLinearSpace),v.g=Math.pow(this.g,Pe.ToLinearSpace),v.b=Math.pow(this.b,Pe.ToLinearSpace),v.a=this.a,this}toGammaSpace(){const v=new ge;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Pe.ToGammaSpace),v.g=Math.pow(this.g,Pe.ToGammaSpace),v.b=Math.pow(this.b,Pe.ToGammaSpace),v.a=this.a,this}}Re.Color4=ge,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Color3=void 0;const Be=zt,Oe=Re,Ne=qt;class xe{constructor(v=0,A=0,T=0){this.r=v,this.g=A,this.b=T}static FromHexString(v){if("#"!==v.substring(0,1)||7!==v.length)return new xe(0,0,0);const A=parseInt(v.substring(1,3),16),T=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16);return xe.FromInts(A,T,E)}static FromArray(v,A=0){return new xe(v[A],v[A+1],v[A+2])}static FromInts(v,A,T){return new xe(v/255,A/255,T/255)}static Lerp(v,A,T){const E=new xe(0,0,0);return xe.LerpToRef(v,A,T,E),E}static LerpToRef(v,A,T,E){E.r=v.r+(A.r-v.r)*T,E.g=v.g+(A.g-v.g)*T,E.b=v.b+(A.b-v.b)*T}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,this}toColor4(v=1){return new Oe.Color4(this.r,this.g,this.b,v)}asArray(){const v=new Array;return this.toArray(v,0),v}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new xe(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,A,T){return this.r===v&&this.g===A&&this.b===T}scale(v){return new xe(this.r*v,this.g*v,this.b*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,this}clampToRef(v=0,A=1,T){return T.r=Ne.Scalar.Clamp(this.r,v,A),T.g=Ne.Scalar.Clamp(this.g,v,A),T.b=Ne.Scalar.Clamp(this.b,v,A),this}add(v){return new xe(this.r+v.r,this.g+v.g,this.b+v.b)}addToRef(v,A){return A.r=this.r+v.r,A.g=this.g+v.g,A.b=this.b+v.b,this}subtract(v){return new xe(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}copyFromFloats(v,A,T){return this.r=v,this.g=A,this.b=T,this}set(v,A,T){return this.copyFromFloats(v,A,T)}toHexString(){const v=255*this.r|0,A=255*this.g|0,T=255*this.b|0;return"#"+Ne.Scalar.ToHex(v)+Ne.Scalar.ToHex(A)+Ne.Scalar.ToHex(T)}toLinearSpace(){const v=new xe;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Be.ToLinearSpace),v.g=Math.pow(this.g,Be.ToLinearSpace),v.b=Math.pow(this.b,Be.ToLinearSpace),this}toGammaSpace(){const v=new xe;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Be.ToGammaSpace),v.g=Math.pow(this.g,Be.ToGammaSpace),v.b=Math.pow(this.b,Be.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}Ie.Color3=xe;var Le={};Object.defineProperty(Le,"__esModule",{value:!0}),Le.Curve3=void 0;const Fe=Lt;class Ae{constructor(v){this._length=0,this._points=v,this._length=this._computeLength(v)}static CreateQuadraticBezier(v,A,T,E){E=E>2?E:3;const C=new Array,r=(v,A,T,E)=>(1-v)*(1-v)*A+2*v*(1-v)*T+v*v*E;for(let R=0;R<=E;R++)C.push(new Fe.Vector3(r(R/E,v.x,A.x,T.x),r(R/E,v.y,A.y,T.y),r(R/E,v.z,A.z,T.z)));return new Ae(C)}static CreateCubicBezier(v,A,T,E,C){C=C>3?C:4;const R=new Array,s=(v,A,T,E,C)=>(1-v)*(1-v)*(1-v)*A+3*v*(1-v)*(1-v)*T+3*v*v*(1-v)*E+v*v*v*C;for(let z=0;z<=C;z++)R.push(new Fe.Vector3(s(z/C,v.x,A.x,T.x,E.x),s(z/C,v.y,A.y,T.y,E.y),s(z/C,v.z,A.z,T.z,E.z)));return new Ae(R)}static CreateHermiteSpline(v,A,T,E,C){const R=new Array,z=1/C;for(let M=0;M<=C;M++)R.push(Fe.Vector3.Hermite(v,A,T,E,M*z));return new Ae(R)}static CreateCatmullRomSpline(v,A,T){const E=new Array,C=1/A;let R=0;if(T){const T=v.length;for(let z=0;z<T;z++){R=0;for(let M=0;M<A;M++)E.push(Fe.Vector3.CatmullRom(v[z%T],v[(z+1)%T],v[(z+2)%T],v[(z+3)%T],R)),R+=C}E.push(E[0])}else{const T=new Array;T.push(v[0].clone()),Array.prototype.push.apply(T,v),T.push(v[v.length-1].clone());let z=0;for(z=0;z<T.length-3;z++){R=0;for(let v=0;v<A;v++)E.push(Fe.Vector3.CatmullRom(T[z],T[z+1],T[z+2],T[z+3],R)),R+=C}z--,E.push(Fe.Vector3.CatmullRom(T[z],T[z+1],T[z+2],T[z+3],R))}return new Ae(E)}getPoints(){return this._points}length(){return this._length}continue(v){const A=this._points[this._points.length-1],T=this._points.slice(),E=v.getPoints();for(let v=1;v<E.length;v++)T.push(E[v].subtract(E[0]).add(A));return new Ae(T)}_computeLength(v){let A=0;for(let T=1;T<v.length;T++)A+=v[T].subtract(v[T-1]).length();return A}}Le.Curve3=Ae;var ke={},Ve={};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.Plane=void 0;const qe=Lt,Ue=kt,We=Ot;class ze{constructor(v,A,T,E){this.normal=new qe.Vector3(v,A,T),this.d=E}static FromArray(v){return new ze(v[0],v[1],v[2],v[3])}static FromPoints(v,A,T){const E=new ze(0,0,0,0);return E.copyFromPoints(v,A,T),E}static FromPositionAndNormal(v,A){const T=new ze(0,0,0,0);return A.normalize(),T.normal=A,T.d=-(A.x*v.x+A.y*v.y+A.z*v.z),T}static SignedDistanceToPlaneFromPositionAndNormal(v,A,T){const E=-(A.x*v.x+A.y*v.y+A.z*v.z);return qe.Vector3.Dot(T,A)+E}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.normal.getHashCode();return v=397*v^(this.d||0),v}normalize(){const v=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let A=0;return 0!==v&&(A=1/v),this.normal.x*=A,this.normal.y*=A,this.normal.z*=A,this.d*=A,this}transform(v){const A=We.MathTmp.Matrix[0];Ue.Matrix.TransposeToRef(v,A);const T=A.m,E=this.normal.x,C=this.normal.y,R=this.normal.z,z=this.d,M=E*T[0]+C*T[1]+R*T[2]+z*T[3],O=E*T[4]+C*T[5]+R*T[6]+z*T[7],V=E*T[8]+C*T[9]+R*T[10]+z*T[11],W=E*T[12]+C*T[13]+R*T[14]+z*T[15];return new ze(M,O,V,W)}dotCoordinate(v){return this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z+this.d}copyFromPoints(v,A,T){const E=A.x-v.x,C=A.y-v.y,R=A.z-v.z,z=T.x-v.x,M=T.y-v.y,O=T.z-v.z,V=C*O-R*M,W=R*z-E*O,j=E*M-C*z,H=Math.sqrt(V*V+W*W+j*j);let X;return X=0!==H?1/H:0,this.normal.x=V*X,this.normal.y=W*X,this.normal.z=j*X,this.d=-(this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z),this}isFrontFacingTo(v,A){return qe.Vector3.Dot(this.normal,v)<=A}signedDistanceTo(v){return qe.Vector3.Dot(v,this.normal)+this.d}}Ve.Plane=ze,Object.defineProperty(ke,"__esModule",{value:!0}),ke.Frustum=void 0;const He=Ve;class Me{static GetPlanes(v){const A=[];for(let v=0;v<6;v++)A.push(new He.Plane(0,0,0,0));return Me.GetPlanesToRef(v,A),A}static GetNearPlaneToRef(v,A){const T=v.m;A.normal.x=T[3]+T[2],A.normal.y=T[7]+T[6],A.normal.z=T[11]+T[10],A.d=T[15]+T[14],A.normalize()}static GetFarPlaneToRef(v,A){const T=v.m;A.normal.x=T[3]-T[2],A.normal.y=T[7]-T[6],A.normal.z=T[11]-T[10],A.d=T[15]-T[14],A.normalize()}static GetLeftPlaneToRef(v,A){const T=v.m;A.normal.x=T[3]+T[0],A.normal.y=T[7]+T[4],A.normal.z=T[11]+T[8],A.d=T[15]+T[12],A.normalize()}static GetRightPlaneToRef(v,A){const T=v.m;A.normal.x=T[3]-T[0],A.normal.y=T[7]-T[4],A.normal.z=T[11]-T[8],A.d=T[15]-T[12],A.normalize()}static GetTopPlaneToRef(v,A){const T=v.m;A.normal.x=T[3]-T[1],A.normal.y=T[7]-T[5],A.normal.z=T[11]-T[9],A.d=T[15]-T[13],A.normalize()}static GetBottomPlaneToRef(v,A){const T=v.m;A.normal.x=T[3]+T[1],A.normal.y=T[7]+T[5],A.normal.z=T[11]+T[9],A.d=T[15]+T[13],A.normalize()}static GetPlanesToRef(v,A){Me.GetNearPlaneToRef(v,A[0]),Me.GetFarPlaneToRef(v,A[1]),Me.GetLeftPlaneToRef(v,A[2]),Me.GetRightPlaneToRef(v,A[3]),Me.GetTopPlaneToRef(v,A[4]),Me.GetBottomPlaneToRef(v,A[5])}}ke.Frustum=Me;var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.Path2=void 0;const Xe=fe,Ye=ye,Qe=zt;class De{constructor(v,A){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Xe.Vector2(v,A))}static StartingAt(v,A){return new De(v,A)}addLineTo(v,A){if(this.closed)return this;const T=new Xe.Vector2(v,A),E=this._points[this._points.length-1];return this._points.push(T),this._length+=T.subtract(E).length(),this}addArcTo(v,A,T,E,C=36){if(this.closed)return this;const R=this._points[this._points.length-1],z=new Xe.Vector2(v,A),M=new Xe.Vector2(T,E),O=new Ye.Arc2(R,z,M);let V=O.angle.radians()/C;O.orientation===Qe.Orientation.CW&&(V*=-1);let W=O.startAngle.radians()+V;for(let v=0;v<C;v++){const v=Math.cos(W)*O.radius+O.centerPoint.x,A=Math.sin(W)*O.radius+O.centerPoint.y;this.addLineTo(v,A),W+=V}return this}close(){return this.closed=!0,this}length(){let v=this._length;if(!this.closed){const A=this._points[this._points.length-1];v+=this._points[0].subtract(A).length()}return v}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return Xe.Vector2.Zero();const A=v*this.length();let T=0;for(let v=0;v<this._points.length;v++){const E=(v+1)%this._points.length,C=this._points[v],R=this._points[E].subtract(C),z=R.length()+T;if(A>=T&&A<=z){const v=R.normalize(),E=A-T;return new Xe.Vector2(C.x+v.x*E,C.y+v.y*E)}T=z}return Xe.Vector2.Zero()}}Ge.Path2=De;var Ze={};Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.Path3D=void 0;const Je=Lt,$e=zt,tn=qt;Ze.Path3D=class{constructor(v,A=null,T){this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let A=0;A<v.length;A++)this._curve[A]=v[A].clone();this._raw=T||!1,this._compute(A)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(v,A=null){for(let A=0;A<v.length;A++)this._curve[A].x=v[A].x,this._curve[A].y=v[A].y,this._curve[A].z=v[A].z;return this._compute(A),this}_compute(v){const A=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[A-1]=this._curve[A-1].subtract(this._curve[A-2]),this._raw||this._tangents[A-1].normalize();const T=this._tangents[0],E=this._normalVector(this._curve[0],T,v);let C,R,z,M;this._normals[0]=E,this._raw||this._normals[0].normalize(),this._binormals[0]=Je.Vector3.Cross(T,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let v=1;v<A;v++)C=this._getLastNonNullVector(v),v<A-1&&(R=this._getFirstNonNullVector(v),this._tangents[v]=C.add(R),this._tangents[v].normalize()),this._distances[v]=this._distances[v-1]+C.length(),z=this._tangents[v],M=this._binormals[v-1],this._normals[v]=Je.Vector3.Cross(M,z),this._raw||this._normals[v].normalize(),this._binormals[v]=Je.Vector3.Cross(z,this._normals[v]),this._raw||this._binormals[v].normalize()}_getFirstNonNullVector(v){let A=1,T=this._curve[v+A].subtract(this._curve[v]);for(;0===T.length()&&v+A+1<this._curve.length;)A++,T=this._curve[v+A].subtract(this._curve[v]);return T}_getLastNonNullVector(v){let A=1,T=this._curve[v].subtract(this._curve[v-A]);for(;0===T.length()&&v>A+1;)A++,T=this._curve[v].subtract(this._curve[v-A]);return T}_normalVector(v,A,T){let E,C=A.length();if(0===C&&(C=1),null==T){let v;v=tn.Scalar.WithinEpsilon(Math.abs(A.y)/C,1,$e.Epsilon)?tn.Scalar.WithinEpsilon(Math.abs(A.x)/C,1,$e.Epsilon)?tn.Scalar.WithinEpsilon(Math.abs(A.z)/C,1,$e.Epsilon)?Je.Vector3.Zero():new Je.Vector3(0,0,1):new Je.Vector3(1,0,0):new Je.Vector3(0,-1,0),E=Je.Vector3.Cross(A,v)}else E=Je.Vector3.Cross(A,T),Je.Vector3.CrossToRef(E,A,E);return E.normalize(),E}};var nn={};Object.defineProperty(nn,"__esModule",{value:!0}),nn.Size=void 0;class je{constructor(v,A){this.width=v,this.height=A}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(v,A,T){const E=v.width+(A.width-v.width)*T,C=v.height+(A.height-v.height)*T;return new je(E,C)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=this.width||0;return v=397*v^(this.height||0),v}copyFrom(v){this.width=v.width,this.height=v.height}copyFromFloats(v,A){return this.width=v,this.height=A,this}set(v,A){return this.copyFromFloats(v,A)}multiplyByFloats(v,A){return new je(this.width*v,this.height*A)}clone(){return new je(this.width,this.height)}equals(v){return!!v&&this.width===v.width&&this.height===v.height}add(v){return new je(this.width+v.width,this.height+v.height)}subtract(v){return new je(this.width-v.width,this.height-v.height)}}nn.Size=je,function(v){var A=Pt&&Pt.__createBinding||(Object.create?function(v,A,T,E){void 0===E&&(E=T),Object.defineProperty(v,E,{enumerable:!0,get:function(){return A[T]}})}:function(v,A,T,E){void 0===E&&(E=T),v[E]=A[T]}),T=Pt&&Pt.__exportStar||function(v,T){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(T,E)||A(T,v,E)};Object.defineProperty(v,"__esModule",{value:!0}),T(zt,v),T(Ot,v),T(de,v),T(ye,v),T(Se,v),T(Ce,v),T(Ie,v),T(Re,v),T(Le,v),T(ke,v),T(kt,v),T(Ge,v),T(Ze,v),T(Ve,v),T(Ft,v),T(qt,v),T(nn,v),T(fe,v),T(Lt,v),T(Vt,v),T(Bt,v)}(Bt);var on,rn,sn,an,ln={looping:!0,speed:1,weight:1,layer:0},cn=function(v){function e(A,T){void 0===T&&(T=ln);var E=v.call(this)||this;return E.isAnimationClip=!0,E.looping=ln.looping,E.weight=ln.weight,E.playing=!1,E.shouldReset=!1,E.speed=ln.speed,E.name=f("AnimClip"),E.layer=ln.layer,E.clip=A,E.setParams(o({},T)),E}return i(e,v),e.prototype.setParams=function(v){return this.looping=void 0!==v.looping?v.looping:this.looping,this.speed=v.speed||this.speed,this.weight=v.weight||this.weight,this.layer=v.layer||this.layer,this},e.prototype.toJSON=function(){var A=JSON.parse(JSON.stringify(v.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),A},e.prototype.play=function(v){var A;void 0===v&&(v=!1),null===(A=this.owner)||void 0===A||A.play(this,v)},e.prototype.pause=function(){var v;null===(v=this.owner)||void 0===v||v.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var v;null===(v=this.owner)||void 0===v||v.stop(this)},r([J.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([J.field,s("design:type",Number)],e.prototype,"weight",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([J.field,s("design:type",Number)],e.prototype,"speed",void 0),r([J.readonly,s("design:type",String)],e.prototype,"name",void 0),e}(J);v.InputEventType=void 0,(on=v.InputEventType||(v.InputEventType={}))[on.DOWN=0]="DOWN",on[on.UP=1]="UP",v.CameraMode=void 0,(rn=v.CameraMode||(v.CameraMode={}))[rn.FirstPerson=0]="FirstPerson",rn[rn.ThirdPerson=1]="ThirdPerson",rn[rn.BuildingToolGodMode=2]="BuildingToolGodMode",v.LandRole=void 0,(sn=v.LandRole||(v.LandRole={})).OWNER="owner",sn.OPERATOR="operator",v.ActionButton=void 0,(an=v.ActionButton||(v.ActionButton={})).POINTER="POINTER",an.PRIMARY="PRIMARY",an.SECONDARY="SECONDARY",an.ANY="ANY",an.FORWARD="FORWARD",an.BACKWARD="BACKWARD",an.RIGHT="RIGHT",an.LEFT="LEFT",an.JUMP="JUMP",an.WALK="WALK",an.ACTION_3="ACTION_3",an.ACTION_4="ACTION_4",an.ACTION_5="ACTION_5",an.ACTION_6="ACTION_6";var hn,un,Ke=function(v){if(this.callback=v,!v||!("apply"in v)||!("call"in v))throw new Error("Callback is not a function");yn.ensureInstance()},pn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerDown")],e)}(Ke),dn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerUp")],e)}(Ke),en=function(v,A){this.fn=v,this.useRaycast=A},yn=function(){function e(){this.buttonIdMapping=[v.ActionButton.POINTER,v.ActionButton.PRIMARY,v.ActionButton.SECONDARY,v.ActionButton.ANY,v.ActionButton.FORWARD,v.ActionButton.BACKWARD,v.ActionButton.RIGHT,v.ActionButton.LEFT,v.ActionButton.JUMP,v.ActionButton.WALK,v.ActionButton.ACTION_3,v.ActionButton.ACTION_4,v.ActionButton.ACTION_5,v.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(v,A){var T;return o(o({},v),((T={})[A]={BUTTON_DOWN:[],BUTTON_UP:[]},T))}),{}),this.internalState=this.buttonIdMapping.reduce((function(v,A){var T;return o(o({},v),((T={})[A]={BUTTON_DOWN:!1},T))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(v){return this.internalState[v]},e.prototype.subscribe=function(v,A,T,E){var C=this;return this.subscriptions[A][v].push(new en(E,T)),function(){C.unsubscribe(v,A,E)}},e.prototype.unsubscribe=function(v,A,T){var E=this.getSubscriptionId(v,A,T);return E>-1&&this.subscriptions[A][v].splice(E,1)},e.prototype.handlePointerEvent=function(A){var T=this.getPointerById(A.buttonId);if(T){var E=o(o({},A),{button:T,direction:(new Bt.Vector3).copyFrom(A.direction),origin:(new Bt.Vector3).copyFrom(A.origin),hit:void 0}),C=A.hit?o(o({},A.hit),{hitPoint:(new Bt.Vector3).copyFrom(A.hit.hitPoint),normal:(new Bt.Vector3).copyFrom(A.hit.normal),worldNormal:(new Bt.Vector3).copyFrom(A.hit.worldNormal)}):void 0;if(A.type===v.InputEventType.DOWN){this.internalState[T].BUTTON_DOWN=!0;for(var R=0;R<this.subscriptions[T].BUTTON_DOWN.length;R++)(z=this.subscriptions[T].BUTTON_DOWN[R]).useRaycast?E.hit=C:E.hit=void 0,z.fn(E);C&&C.entityId&&N.engine&&(O=(M=N.engine.entities[C.entityId])&&M.getComponentOrNull(pn))&&(E.hit=C,O.callback(E))}else{for(this.internalState[T].BUTTON_DOWN=!1,R=0;R<this.subscriptions[T].BUTTON_UP.length;R++){var z;(z=this.subscriptions[T].BUTTON_UP[R]).useRaycast?E.hit=C:E.hit=void 0,z.fn(E)}var M,O;C&&C.entityId&&N.engine&&(O=(M=N.engine.entities[C.entityId])&&M.getComponentOrNull(dn))&&(E.hit=C,O.callback(E))}}},e.prototype.getSubscriptionId=function(v,A,T){for(var E=0;E<this.subscriptions[A][v].length;E++)if(this.subscriptions[A][v][E].fn===T)return E;return-1},e.prototype.getPointerById=function(A){if(A<0||A>=this.buttonIdMapping.length)return null;var T=this.buttonIdMapping[A];return T===v.ActionButton.ANY?null:T},e}();v.CLASS_ID=void 0,(hn=v.CLASS_ID||(v.CLASS_ID={}))[hn.TRANSFORM=1]="TRANSFORM",hn[hn.UUID_CALLBACK=8]="UUID_CALLBACK",hn[hn.BOX_SHAPE=16]="BOX_SHAPE",hn[hn.SPHERE_SHAPE=17]="SPHERE_SHAPE",hn[hn.PLANE_SHAPE=18]="PLANE_SHAPE",hn[hn.CONE_SHAPE=19]="CONE_SHAPE",hn[hn.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",hn[hn.TEXT_SHAPE=21]="TEXT_SHAPE",hn[hn.NFT_SHAPE=22]="NFT_SHAPE",hn[hn.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",hn[hn.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",hn[hn.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",hn[hn.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",hn[hn.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",hn[hn.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",hn[hn.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",hn[hn.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",hn[hn.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",hn[hn.BILLBOARD=32]="BILLBOARD",hn[hn.ANIMATION=33]="ANIMATION",hn[hn.FONT=34]="FONT",hn[hn.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",hn[hn.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",hn[hn.GLTF_SHAPE=54]="GLTF_SHAPE",hn[hn.OBJ_SHAPE=55]="OBJ_SHAPE",hn[hn.AVATAR_SHAPE=56]="AVATAR_SHAPE",hn[hn.BASIC_MATERIAL=64]="BASIC_MATERIAL",hn[hn.PBR_MATERIAL=65]="PBR_MATERIAL",hn[hn.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",hn[hn.SOUND=67]="SOUND",hn[hn.TEXTURE=68]="TEXTURE",hn[hn.VIDEO_CLIP=70]="VIDEO_CLIP",hn[hn.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",hn[hn.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",hn[hn.AUDIO_CLIP=200]="AUDIO_CLIP",hn[hn.AUDIO_SOURCE=201]="AUDIO_SOURCE",hn[hn.AUDIO_STREAM=202]="AUDIO_STREAM",hn[hn.GIZMOS=203]="GIZMOS",hn[hn.SMART_ITEM=204]="SMART_ITEM",hn[hn.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",hn[hn.AVATAR_ATTACH=206]="AVATAR_ATTACH",hn[hn.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",hn[hn.NAME=300]="NAME",hn[hn.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",hn[hn.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",v.AvatarModifiers=void 0,(un=v.AvatarModifiers||(v.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",un.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var fn,mn=function(A){function n(v){var T=A.call(this)||this;return T.area=v.area,T.modifiers=v.modifiers,T.excludeIds=v.excludeIds,T}return i(n,A),r([J.field,s("design:type",Object)],n.prototype,"area",void 0),r([J.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([J.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",v.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}(J),gn=function(A){function n(v){void 0===v&&(v={});var T=A.call(this)||this;return T.position=v.position||Bt.Vector3.Zero(),T.rotation=v.rotation||Bt.Quaternion.Identity,T.scale=v.scale||new Bt.Vector3(1,1,1),T}return i(n,A),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(v,A){void 0===A&&(A=Bt.MathTmp.staticUp);var T=new Bt.Matrix;return Bt.Matrix.LookAtLHToRef(this.position,v,A,T),T.invert(),Bt.Quaternion.FromRotationMatrixToRef(T,this.rotation),this},n.prototype.rotate=function(v,A){return this.rotation.multiplyInPlace(this.rotation.angleAxis(A,v)),this},n.prototype.translate=function(v){return this.position.addInPlace(v),this},r([J.field,s("design:type",Bt.Vector3)],n.prototype,"position",void 0),r([J.field,s("design:type",Bt.Quaternion)],n.prototype,"rotation",void 0),r([J.field,s("design:type",Bt.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",v.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}(J);v.AttachToAvatarAnchorPointId=void 0,(fn=v.AttachToAvatarAnchorPointId||(v.AttachToAvatarAnchorPointId={}))[fn.Position=0]="Position",fn[fn.NameTag=1]="NameTag",fn[fn.LeftHand=2]="LeftHand",fn[fn.RightHand=3]="RightHand";var vn,bn=function(A){function n(T){void 0===T&&(T={});var E=A.call(this)||this;return E.avatarId=T.avatarId||"",E.anchorPointId=T.anchorPointId||v.AttachToAvatarAnchorPointId.Position,E}return i(n,A),r([J.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([J.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([J.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",v.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}(J),wn=function(A){function n(v,T,E){void 0===v&&(v=!0),void 0===T&&(T=!0),void 0===E&&(E=!0);var C=A.call(this)||this;return C.x=!0,C.y=!0,C.z=!0,C.x=v,C.y=T,C.z=E,C}return i(n,A),r([J.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",v.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}(J),xn=function(v){function e(){var A=null!==v&&v.apply(this,arguments)||this;return A.withCollisions=!0,A.isPointerBlocker=!0,A.visible=!0,A}return i(e,v),r([J.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}(J),An=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([J.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.BOX_SHAPE)],n)}(xn),Tn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.SPHERE_SHAPE)],n)}(xn),Sn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"segments",void 0),r([J.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CIRCLE_SHAPE)],n)}(xn),En=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.width=1,v.height=1,v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"width",void 0),r([J.field,s("design:type",Number)],n.prototype,"height",void 0),r([J.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.PLANE_SHAPE)],n)}(xn),Cn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=0,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([J.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([J.field,s("design:type",Object)],n.prototype,"radius",void 0),r([J.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CONE_SHAPE)],n)}(xn),In=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=1,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([J.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([J.field,s("design:type",Object)],n.prototype,"radius",void 0),r([J.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CYLINDER_SHAPE)],n)}(xn),Rn=function(A){function n(v){var T=A.call(this)||this;return T.src=v,T}return i(n,A),r([xn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(xn);v.PictureFrameStyle=void 0,(vn=v.PictureFrameStyle||(v.PictureFrameStyle={}))[vn.Classic=0]="Classic",vn[vn.Baroque_Ornament=1]="Baroque_Ornament",vn[vn.Diamond_Ornament=2]="Diamond_Ornament",vn[vn.Minimal_Wide=3]="Minimal_Wide",vn[vn.Minimal_Grey=4]="Minimal_Grey",vn[vn.Blocky=5]="Blocky",vn[vn.Gold_Edges=6]="Gold_Edges",vn[vn.Gold_Carved=7]="Gold_Carved",vn[vn.Gold_Wide=8]="Gold_Wide",vn[vn.Gold_Rounded=9]="Gold_Rounded",vn[vn.Metal_Medium=10]="Metal_Medium",vn[vn.Metal_Wide=11]="Metal_Wide",vn[vn.Metal_Slim=12]="Metal_Slim",vn[vn.Metal_Rounded=13]="Metal_Rounded",vn[vn.Pins=14]="Pins",vn[vn.Minimal_Black=15]="Minimal_Black",vn[vn.Minimal_White=16]="Minimal_White",vn[vn.Tape=17]="Tape",vn[vn.Wood_Slim=18]="Wood_Slim",vn[vn.Wood_Wide=19]="Wood_Wide",vn[vn.Wood_Twigs=20]="Wood_Twigs",vn[vn.Canvas=21]="Canvas",vn[vn.None=22]="None";var _n,Pn=function(A){function n(T,E){void 0===E&&(E={});var C=A.call(this)||this;C.src=T;var R=new Bt.Color3(.6404918,.611472,.8584906),z=v.PictureFrameStyle.Classic;return"r"in E?R=E:null!==E&&(E.color&&(R=E.color),E.style&&(z=E.style)),C.color=R,C.style=z,C}return i(n,A),r([xn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([xn.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([J.field,s("design:type",Bt.Color3)],n.prototype,"color",void 0),r([N("engine.shape",v.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(xn),Bn=function(A){function n(v,T){var E=A.call(this)||this,C=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((v.length>2048||C.test(v))&&c("⚠️🚨 Base64 textures will be deprecated in version 7 of decentraland-ecs"),E.src=v,T)for(var R in T)E[R]=T[R];return E}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"src",void 0),r([J.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([J.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([J.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}(J),zn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.states=[],v}return i(n,A),n.prototype.addClip=function(v){var A=this;return this.states.push(v),v.onChange((function(){A.dirty=!0})),v.owner=this,this},n.prototype.getClip=function(v){for(var A=0;A<this.states.length;A++){var T=this.states[A];if(T.clip===v)return T}var E=new cn(v);return this.addClip(E),E},n.prototype.stop=function(v){if(v)v.playing=!1,v.shouldReset=!0;else for(var A=0;A<this.states.length;A++){var T=this.states[A];this.stop(T)}},n.prototype.play=function(v,A){void 0===A&&(A=!1);for(var T=0;T<this.states.length;T++){var E=this.states[T];E.layer===v.layer&&v!==E&&this.pause(E)}A&&(v.shouldReset=!0),v.playing=!0,v.dirty=!0,v.data.nonce=Math.random()},n.prototype.pause=function(v){if(v)v.playing=!1;else for(var A=0;A<this.states.length;A++){var T=this.states[A];this.pause(T)}},r([J.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",v.CLASS_ID.ANIMATION)],n)}(xn),Mn=function(A){function n(v){var T=A.call(this)||this;return T.src=v,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(xn),On=function(A){function n(v){void 0===v&&(v="");var T=A.call(this)||this;return T.src=v,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",v.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}(J);v.Fonts=void 0,(_n=v.Fonts||(v.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",_n.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",_n.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",_n.LiberationSans="builtin:LiberationSans SDF",_n.SansSerif="SansSerif",_n.SansSerif_Heavy="SansSerif_Heavy",_n.SansSerif_Bold="SansSerif_Bold",_n.SansSerif_SemiBold="SansSerif_SemiBold";var Nn,Ln=function(A){function n(v){var T=A.call(this)||this;return T.outlineWidth=0,T.outlineColor=new Bt.Color3(1,1,1),T.color=new Bt.Color3(1,1,1),T.fontSize=10,T.opacity=1,T.value="",T.lineSpacing="0px",T.lineCount=0,T.textWrapping=!1,T.shadowBlur=0,T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowColor=new Bt.Color3(1,1,1),T.hTextAlign="center",T.vTextAlign="center",T.width=1,T.height=1,T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T.billboard=!1,T.visible=!0,v&&(T.value=v),T}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([J.field,s("design:type",Bt.Color3)],n.prototype,"outlineColor",void 0),r([J.field,s("design:type",Bt.Color3)],n.prototype,"color",void 0),r([J.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([J.component,s("design:type",On)],n.prototype,"font",void 0),r([J.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([J.field,s("design:type",String)],n.prototype,"value",void 0),r([J.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([J.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([J.field,s("design:type",Bt.Color3)],n.prototype,"shadowColor",void 0),r([J.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([J.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([J.field,s("design:type",Number)],n.prototype,"width",void 0),r([J.field,s("design:type",Number)],n.prototype,"height",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",v.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}(J);v.TransparencyMode=void 0,(Nn=v.TransparencyMode||(v.TransparencyMode={}))[Nn.OPAQUE=0]="OPAQUE",Nn[Nn.ALPHA_TEST=1]="ALPHA_TEST",Nn[Nn.ALPHA_BLEND=2]="ALPHA_BLEND",Nn[Nn.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Nn[Nn.AUTO=4]="AUTO";var Fn,Dn=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.alphaTest=.5,T.castShadows=!0,T.transparencyMode=v.TransparencyMode.AUTO,T}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([J.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([J.field,s("design:type",Bt.Color3)],n.prototype,"emissiveColor",void 0),r([J.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([J.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([J.field,s("design:type",Bt.Color3)],n.prototype,"reflectivityColor",void 0),r([J.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([J.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([J.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([J.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([J.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([J.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([J.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([J.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([J.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",v.CLASS_ID.PBR_MATERIAL)],n)}(J),kn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v}return i(n,A),r([J.component,s("design:type",Object)],n.prototype,"texture",void 0),r([J.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",v.CLASS_ID.BASIC_MATERIAL)],n)}(J),Vn=function(v){function e(A){var T=v.call(this)||this;if(T.uuid=f("UUID"),!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");return T.callback=A,T}return i(e,v),e.uuidEvent=function(v,A){if(delete v[A]){var T=A+"_"+Math.random();v[T]=void 0,Object.defineProperty(v,T,o(o({},Object.getOwnPropertyDescriptor(v,T)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[T]},set:function(v){var E=this[T];if(v){if(!(v instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[A]=v.uuid}else this.data[A]=null;if(this[T]=v,v!==E){this.dirty=!0;for(var C=0;C<this.subscriptions.length;C++)this.subscriptions[C](A,v,E)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([J.field,s("design:type",Function)],e.prototype,"callback",void 0),e}(J),qn=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.button=v.ActionButton.ANY,T.hoverText="Interact",T.distance=10,T.showFeedback=!0,T}return i(n,A),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([J.field,s("design:type",String)],n.prototype,"button",void 0),r([J.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([J.field,s("design:type",Number)],n.prototype,"distance",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Vn),Un=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onPointerLock",v}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",v.CLASS_ID.UUID_CALLBACK)],n)}(Vn),Wn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onAnimationEnd",v}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",v.CLASS_ID.UUID_CALLBACK)],n)}(Vn),jn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([P("engine.smartItem",v.CLASS_ID.SMART_ITEM)],n)}(J),Hn=function(A){function n(v){var T=A.call(this)||this;return T.url=v,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",v.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}(J);v.VideoStatus=void 0,(Fn=v.VideoStatus||(v.VideoStatus={}))[Fn.NONE=0]="NONE",Fn[Fn.ERROR=1]="ERROR",Fn[Fn.LOADING=2]="LOADING",Fn[Fn.READY=3]="READY",Fn[Fn.PLAYING=4]="PLAYING",Fn[Fn.BUFFERING=5]="BUFFERING";var Gn,Xn=function(A){function n(T,E){var C=A.call(this)||this;if(C.volume=1,C.playbackRate=1,C.loop=!1,C.seek=-1,C._position=-1,C._videoLength=-1,C._status=v.VideoStatus.NONE,C.playing=!1,!(T instanceof Hn))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(C.videoClipId=D(T),E)for(var R in E)C[R]=E[R];return C}return i(n,A),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(v){this.seek=v,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var v=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.seek=-1,v}return A.prototype.toJSON.call(this)},n.prototype.update=function(A){A.videoClipId===this.videoClipId&&(this._status=A.videoStatus||v.VideoStatus.NONE,this._videoLength=A.totalVideoLength,this._position=A.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([J.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([J.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([J.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([J.field,s("design:type",Number)],n.prototype,"volume",void 0),r([J.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([J.field,s("design:type",Number)],n.prototype,"seek",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",v.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[Hn,Object])],n)}(J),Yn=function(A){function n(v){var T=A.call(this)||this;return T.area=v.area,T.cameraMode=v.cameraMode,T}return i(n,A),r([J.field,s("design:type",Object)],n.prototype,"area",void 0),r([J.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",v.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}(J),Qn=function(A){function n(v,T){var E=A.call(this)||this;if(E.userId=v,T)for(var C in T)E[C]=T[C];return E}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([J.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([J.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([J.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}(J),Zn=function(){function e(){var A=this;this.position=new Bt.Vector3,this.rotation=new Bt.Quaternion,this.feetPosition=new Bt.Vector3,this.worldPosition=new Bt.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=v.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(v){switch(v.type){case"positionChanged":A.positionChanged(v.data);break;case"rotationChanged":A.rotationChanged(v.data);break;case"cameraModeChanged":A.cameraModeChanged(v.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return A.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return A.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return A.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return A.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return A.lastEventPosition.y-A.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return A.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return A.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return A.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return A.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(v){this.lastEventPosition=v.position,this.lastEventWorldPosition=v.cameraPosition,this._playerHeight=v.playerHeight},e.prototype.rotationChanged=function(v){this.lastEventRotation=v.quaternion},e.prototype.cameraModeChanged=function(v){this._cameraMode=v.cameraMode},e}();!function(v){v.HitFirst="rqhf",v.HitAll="rqha"}(Gn||(Gn={}));var Kn,Jn=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(v){var A=Zn.instance.rotation,T=Bt.Matrix.Identity();A.toRotationMatrix(T);var E=Bt.Vector3.TransformCoordinates(Bt.Vector3.Forward(),T);return{origin:Zn.instance.position,direction:E,distance:v}},t.prototype.getRayFromPositions=function(v,A){var T=A.subtract(v),E=T.length();return{origin:v,direction:T.normalize(),distance:E}},t.prototype.hitFirst=function(v,A,T){var E="number"==typeof T?Gn.HitFirst+T:m();this.queries[E]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitFirst",ray:v})},t.prototype.hitAll=function(v,A,T){var E="number"==typeof T?Gn.HitAll+T:m();this.queries[E]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitAll",ray:v})},t.prototype.hitFirstAvatar=function(v,A){c("not implemented yet")},t.prototype.hitAllAvatars=function(v,A){c("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t}(),$n=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ht,this,(function(v){"HitFirst"===v.payload.queryType?Jn.instance.handleRaycastHitFirstResponse(v):"HitAll"===v.payload.queryType&&Jn.instance.handleRaycastHitAllResponse(v)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),ti=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ut,this,(function(v){yn.instance.handlePointerEvent(v.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),ei=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(v){v.eventManager.addListener(ct,this,this.handleEvent),v.eventManager.addListener(M,this,this.componentAdded),v.eventManager.addListener(z,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(v){for(var A in v.components){var T=v.components[A];T instanceof Vn&&(this.handlerMap[T.uuid]=T)}},t.prototype.onRemoveEntity=function(v){for(var A in v.components){var T=v.components[A];T instanceof Vn&&delete this.handlerMap[T.uuid]}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];A instanceof Vn&&(this.handlerMap[A.uuid]=A)}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&v.component instanceof Vn&&delete this.handlerMap[v.component.uuid]},t.prototype.handleEvent=function(v){if(v.uuid in this.handlerMap){var A=this.handlerMap[v.uuid];A&&A.callback&&"call"in A.callback&&A.callback(v.payload)}},t}(),ni=new $n,ii=new ti,oi=new ei,ri=function(A){function n(v){var T=A.call(this)||this;return T.loop=!1,T.volume=1,T.url=v,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"url",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([J.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([J.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",v.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}(J),si=function(A){function n(v){var T=A.call(this)||this;if(T.audioClip=v,T.loop=!1,T.volume=1,T.playing=!1,T.pitch=1,T.playedAtTimestamp=Date.now(),!(v instanceof ri))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return T.audioClipId=D(v),T}return i(n,A),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([J.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([J.field,s("design:type",Number)],n.prototype,"volume",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([J.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([J.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",v.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[ri])],n)}(J),ai=function(A){function n(v){var T=A.call(this)||this;return T.playing=!1,T.volume=1,T.url=v,T.playing=!0,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"url",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([J.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",v.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}(J);v.Gizmo=void 0,(Kn=v.Gizmo||(v.Gizmo={})).MOVE="MOVE",Kn.ROTATE="ROTATE",Kn.SCALE="SCALE",Kn.NONE="NONE";var li,ci=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="gizmoEvent",v}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",v.CLASS_ID.UUID_CALLBACK)],n)}(Vn),hi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.position=!0,v.rotation=!0,v.scale=!0,v.cycle=!0,v.localReference=!1,v}return i(n,A),r([J.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([J.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",v.CLASS_ID.GIZMOS)],n)}(J),ui=function(A){function n(v){var T=A.call(this,v)||this;return T.type="onFocus",oi.handlerMap[T.uuid]=T,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),pi=function(A){function n(v){var T=A.call(this,v)||this;return T.type="onTextSubmit",oi.handlerMap[T.uuid]=T,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),di=function(A){function n(v){var T=A.call(this,v)||this;return T.type="onBlur",oi.handlerMap[T.uuid]=T,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),yi=function(A){function n(v){var T=A.call(this,v)||this;return T.type="onEnter",oi.handlerMap[T.uuid]=T,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),fi=function(A){function n(v){var T=A.call(this,v)||this;return T.type="onChange",oi.handlerMap[T.uuid]=T,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),mi=function(A){function n(v,T){var E=A.call(this,v)||this;return E.type="onClick",oi.handlerMap[E.uuid]=E,T&&(E.showFeedback=!(!1===T.showFeedback),T.button&&(E.button=T.button),T.hoverText&&(E.hoverText=T.hoverText),T.distance&&(E.distance=T.distance)),E}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),gi=function(A){function n(v,T){var E=A.call(this,v)||this;return E.type="pointerDown",oi.handlerMap[E.uuid]=E,T&&(E.showFeedback=!(!1===T.showFeedback),T.button&&(E.button=T.button),T.hoverText&&(E.hoverText=T.hoverText),T.distance&&(E.distance=T.distance)),E}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),vi=function(A){function n(v,T){var E=A.call(this,v)||this;return E.type="pointerUp",oi.handlerMap[E.uuid]=E,T&&(E.showFeedback=!(!1===T.showFeedback),T.button&&(E.button=T.button),T.hoverText&&(E.hoverText=T.hoverText),T.distance&&(E.distance=T.distance)),E}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),bi=function(A){function n(v,T){var E=A.call(this,v)||this;return E.type="pointerHoverEnter",oi.handlerMap[E.uuid]=E,T&&T.distance&&(E.distance=T.distance),E}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(qn),wi=function(A){function n(v){var T=A.call(this,v)||this;return T.type="pointerHoverExit",oi.handlerMap[T.uuid]=T,T.distance=160,T}return i(n,A),r([J.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(qn),xi=function(v){function e(A){var T=v.call(this)||this;return T.name=null,T.visible=!0,T.opacity=1,T.hAlign="center",T.vAlign="center",T.width="100px",T.height="50px",T.positionX="0px",T.positionY="0px",T.isPointerBlocker=!0,A&&(T._parent=A,T.data.parentComponent=D(A)),T}return i(e,v),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([J.field,s("design:type",Object)],e.prototype,"name",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([J.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([J.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([J.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([J.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([J.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([J.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([J.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([J.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}(J),Ai=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(xi),Ti=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(xi),Si=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(xi),Ei=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.thickness=0,v.color=Bt.Color4.Clear(),v.alignmentUsesSize=!0,v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"color",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_RECT)],n)}(xi);v.UIStackOrientation=void 0,(li=v.UIStackOrientation||(v.UIStackOrientation={}))[li.VERTICAL=0]="VERTICAL",li[li.HORIZONTAL=1]="HORIZONTAL";var Ci=function(A){function n(){var T=null!==A&&A.apply(this,arguments)||this;return T.adaptWidth=!0,T.adaptHeight=!0,T.color=Bt.Color4.Clear(),T.stackOrientation=v.UIStackOrientation.VERTICAL,T.spacing=0,T}return i(n,A),r([J.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"color",void 0),r([J.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([J.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_STACK)],n)}(xi),Ii=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.fontSize=10,v.fontWeight="normal",v.thickness=0,v.cornerRadius=0,v.color=Bt.Color4.White(),v.background=Bt.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Bt.Color4.Black(),v.text="button",v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([J.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([J.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([J.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"color",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"background",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"shadowColor",void 0),r([J.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",v.CLASS_ID.UI_BUTTON_SHAPE)],n)}(xi),_i=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.outlineWidth=0,v.outlineColor=Bt.Color4.White(),v.color=Bt.Color4.White(),v.fontSize=10,v.fontAutoSize=!1,v.value="",v.lineSpacing=0,v.lineCount=0,v.adaptWidth=!1,v.adaptHeight=!1,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Bt.Color4.Black(),v.hTextAlign="left",v.vTextAlign="bottom",v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"outlineColor",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"color",void 0),r([J.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([J.component,s("design:type",On)],n.prototype,"font",void 0),r([J.field,s("design:type",String)],n.prototype,"value",void 0),r([J.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([J.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"shadowColor",void 0),r([J.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([J.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",v.CLASS_ID.UI_TEXT_SHAPE)],n)}(xi),Pi=function(A){function n(v){var T=A.call(this,v)||this;return T.outlineWidth=0,T.outlineColor=Bt.Color4.Black(),T.color=Bt.Color4.Clear(),T.fontSize=10,T.value="",T.placeholder="",T.margin=10,T.hTextAlign="left",T.vTextAlign="bottom",T.focusedBackground=Bt.Color4.Black(),T.textWrapping=!1,T.shadowBlur=0,T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowColor=Bt.Color4.White(),T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T.onTextSubmit=null,T.onChanged=null,T.onFocus=null,T.onBlur=null,T.onTextChanged=new fi((function(v){var A=v.value,E=A.value,C=A.isSubmit,R=T.dirty;if(T.value=E,T.dirty=R,C&&T.onTextSubmit){var z={text:E};T.onTextSubmit.callback(z)}else if(!C&&T.onChanged){var M={value:E,pointerId:v.pointerId};T.onChanged.callback(M)}})),T}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"outlineColor",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"color",void 0),r([J.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([J.component,s("design:type",On)],n.prototype,"font",void 0),r([J.field,s("design:type",String)],n.prototype,"value",void 0),r([J.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([J.field,s("design:type",Number)],n.prototype,"margin",void 0),r([J.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([J.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"focusedBackground",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([J.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"shadowColor",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Vn.uuidEvent,s("design:type",fi)],n.prototype,"onTextChanged",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",v.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(xi),Bi=function(A){function n(v,T){var E=A.call(this,v)||this;return E.sourceLeft=0,E.sourceTop=0,E.sourceWidth=1,E.sourceHeight=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.sizeInPixels=!0,E.onClick=null,E.source=T,E}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([J.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([J.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([J.component,s("design:type",Object)],n.prototype,"source",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",v.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[xi,Object])],n)}(xi),zi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.valueX=0,v.valueY=0,v.backgroundColor=Bt.Color4.Clear(),v.isHorizontal=!1,v.isVertical=!1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onChanged=null,v}return i(n,A),r([J.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([J.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([J.field,s("design:type",Bt.Color4)],n.prototype,"backgroundColor",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([J.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",v.CLASS_ID.UI_SLIDER_SHAPE)],n)}(xi),Mi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.useDummyModel=!1,v.talking=!1,v}var T;return i(n,A),T=n,n.Dummy=function(){var v=new T;return v.useDummyModel=!0,v},r([J.field,s("design:type",String)],n.prototype,"id",void 0),r([J.field,s("design:type",String)],n.prototype,"name",void 0),r([J.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([J.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([J.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([J.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([J.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([J.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([J.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([J.field,s("design:type",Boolean)],n.prototype,"talking",void 0),T=r([P("engine.avatarShape",v.CLASS_ID.AVATAR_SHAPE)],n)}(J),Oi=null,Ni=null,Li=null;function Ri(){return Li||(Li=new lt),Li}var Fi=function(){function t(){var v=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Ni){(Ni=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(v){Oi=v}));var v=Ri();dcl.subscribe("comms"),dcl.onEvent((function(A){"comms"===A.type&&v.notifyObservers(A.data)}))}return Ni}().then((function(){v.connected=!0,v.flush()}))}return t.prototype.on=function(v,A){return Ri().add((function(T){try{var E=JSON.parse(T.message);E.message===v&&A(E.payload,T.sender)}catch(T){dcl.error("Error parsing comms message "+(T.message||""),T)}}))},t.prototype.sendRaw=function(v){this.messageQueue.push(v),this.connected&&this.flush()},t.prototype.emit=function(v,A){var T=JSON.stringify({message:v,payload:A});this.sendRaw(T),Ri().notifyObservers({message:T,sender:"self"})},t.prototype.flush=function(){var v=this;if(0!==this.messageQueue.length&&this.connected&&Oi&&!this.flushing){var A=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Oi.rpcHandle,"send",[A]).then((function(A){v.flushing=!1,v.flush()}),(function(A){v.flushing=!1,y("Error flushing MessageBus",A)}))}},t}(),Di=new et("scene");Di.uuid="0";var ki=new nt(Di);N.engine=ki,"undefined"!=typeof dcl&&(ki.addSystem(new _t(dcl),1/0),mt(dcl)),ki.addSystem(oi),ki.addSystem(ii),ki.addSystem(ni),v.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",v.Angle=Bt.Angle,v.AnimationState=cn,v.Animator=zn,v.Arc2=Bt.Arc2,v.AttachToAvatar=bn,v.Attachable=A,v.AudioClip=ri,v.AudioSource=si,v.AudioStream=ai,v.AvatarModifierArea=mn,v.AvatarShape=Mi,v.AvatarTexture=Qn,v.Axis=Bt.Axis,v.BasicMaterial=kn,v.BezierCurve=Bt.BezierCurve,v.Billboard=wn,v.BoxShape=An,v.Camera=Zn,v.CameraModeArea=Yn,v.CircleShape=Sn,v.Color3=Bt.Color3,v.Color4=Bt.Color4,v.Component=P,v.ComponentAdded=M,v.ComponentGroup=$,v.ComponentRemoved=z,v.ConeShape=Cn,v.Curve3=Bt.Curve3,v.CylinderShape=In,v.DEG2RAD=Bt.DEG2RAD,v.DisposableComponent=N,v.DisposableComponentCreated=X,v.DisposableComponentRemoved=Z,v.DisposableComponentUpdated=K,v.Engine=nt,v.Entity=et,v.Epsilon=Bt.Epsilon,v.EventConstructor=x,v.EventManager=C,v.Font=On,v.Frustum=Bt.Frustum,v.GLTFShape=Rn,v.Gizmos=hi,v.GlobalPointerDown=pn,v.GlobalPointerUp=dn,v.Input=yn,v.Material=Dn,v.Matrix=Bt.Matrix,v.MessageBus=Fi,v.MultiObserver=at,v.NFTShape=Pn,v.OBJShape=Mn,v.Observable=lt,v.ObservableComponent=J,v.Observer=Y,v.ObserverEventState=st,v.OnAnimationEnd=Wn,v.OnBlur=di,v.OnChanged=fi,v.OnClick=mi,v.OnEnter=yi,v.OnFocus=ui,v.OnGizmoEvent=ci,v.OnPointerDown=gi,v.OnPointerHoverEnter=bi,v.OnPointerHoverExit=wi,v.OnPointerLock=Un,v.OnPointerUUIDEvent=qn,v.OnPointerUp=vi,v.OnTextSubmit=pi,v.OnUUIDEvent=Vn,v.Orientation=Bt.Orientation,v.ParentChanged=O,v.Path2=Bt.Path2,v.Path3D=Bt.Path3D,v.PhysicsCast=Jn,v.Plane=Bt.Plane,v.PlaneShape=En,v.PointerEvent=ut,v.PointerEventComponent=Ke,v.PointerEventSystem=ti,v.Quaternion=Bt.Quaternion,v.RAD2DEG=Bt.RAD2DEG,v.RaycastEventSystem=$n,v.RaycastResponse=ht,v.Scalar=Bt.Scalar,v.Shape=xn,v.Size=Bt.Size,v.SmartItem=jn,v.Space=Bt.Space,v.SphereShape=Tn,v.Subscription=en,v.TextShape=Ln,v.Texture=Bn,v.ToGammaSpace=Bt.ToGammaSpace,v.ToLinearSpace=Bt.ToLinearSpace,v.Transform=gn,v.UIButton=Ii,v.UICanvas=Si,v.UIContainerRect=Ei,v.UIContainerStack=Ci,v.UIFullScreen=Ai,v.UIImage=Bi,v.UIInputText=Pi,v.UIScrollRect=zi,v.UIShape=xi,v.UIText=_i,v.UIValue=V,v.UIWorldSpace=Ti,v.UUIDEvent=ct,v.UUIDEventSystem=ei,v.Vector2=Bt.Vector2,v.Vector3=Bt.Vector3,v.Vector4=Bt.Vector4,v.VideoClip=Hn,v.VideoTexture=Xn,v._initEventObservables=mt,v.buildArray=function(v,A){for(var T=[],E=0;E<v;++E)T.push(A());return T},v.engine=ki,v.error=y,v.executeTask=G,v.getComponentClassId=L,v.getComponentId=D,v.getComponentName=F,v.getMessageObserver=Ri,v.isDisposableComponent=U,v.log=c,v.newId=f,v.onCameraModeChangedObservable=pt,v.onEnterScene=ft,v.onEnterSceneObservable=yt,v.onIdleStateChangedObservable=dt,v.onLeaveScene=vt,v.onLeaveSceneObservable=gt,v.onPlayerClickedObservable=Rt,v.onPlayerConnectedObservable=St,v.onPlayerDisconnectedObservable=Ct,v.onPlayerExpressionObservable=wt,v.onPointerLockedStateChange=xt,v.onProfileChanged=Tt,v.onRealmChangedObservable=It,v.onSceneReadyObservable=bt,v.onVideoEvent=At,v.openExternalURL=function(v){"undefined"!=typeof dcl?dcl.openExternalUrl(v):y("ERROR: openExternalURL dcl is undefined")},v.openNFTDialog=function(v,A){if(void 0===A&&(A=null),"undefined"!=typeof dcl){var T=v.match(/ethereum:\/\/(.+)\/(.+)/);if(!T||T.length<3)return;dcl.openNFTDialog(T[1],T[2],A)}else y("ERROR: openNFTDialog dcl is undefined")},v.pointerEventSystem=ii,v.raycastEventSystem=ni,v.teleportTo=function(v){var A;A=[v],void 0===ot&&"undefined"!=typeof dcl&&(ot=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==ot&&"undefined"!=typeof dcl&&ot.then((function(v){dcl.callRpc(v.rpcHandle,"requestTeleport",A)}))},v.uuid=m,v.uuidEventSystem=oi,Object.defineProperty(v,"__esModule",{value:!0})}(this.self=this.self||{}),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(v,A){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(v,A){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(v[T]=A[T])})(v,A)};function i(v,A){function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}function r(v,A,T,E){var C,R=arguments.length,z=R<3?A:null===E?E=Object.getOwnPropertyDescriptor(A,T):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,T,E);else for(var M=v.length-1;M>=0;M--)(C=v[M])&&(z=(R<3?C(z):R>3?C(A,T,z):C(A,T))||z);return R>3&&z&&Object.defineProperty(A,T,z),z}function o(v,A,T,E){return new(T||(T=Promise))((function(C,R){function a(v){try{u(E.next(v))}catch(v){R(v)}}function s(v){try{u(E.throw(v))}catch(v){R(v)}}function u(v){var A;v.done?C(v.value):(A=v.value,A instanceof T?A:new T((function(v){v(A)}))).then(a,s)}u((E=E.apply(v,A||[])).next())}))}function a(v,A){var T,E,C,R,z={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return R={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(R[Symbol.iterator]=function(){return this}),R;function s(R){return function(M){return function(R){if(T)throw new TypeError("Generator is already executing.");for(;z;)try{if(T=1,E&&(C=2&R[0]?E.return:R[0]?E.throw||((C=E.return)&&C.call(E),0):E.next)&&!(C=C.call(E,R[1])).done)return C;switch(E=0,C&&(R=[2&R[0],C.value]),R[0]){case 0:case 1:C=R;break;case 4:return z.label++,{value:R[1],done:!1};case 5:z.label++,E=R[1],R=[0];continue;case 7:R=z.ops.pop(),z.trys.pop();continue;default:if(!((C=(C=z.trys).length>0&&C[C.length-1])||6!==R[0]&&2!==R[0])){z=0;continue}if(3===R[0]&&(!C||R[1]>C[0]&&R[1]<C[3])){z.label=R[1];break}if(6===R[0]&&z.label<C[1]){z.label=C[1],C=R;break}if(C&&z.label<C[2]){z.label=C[2],z.ops.push(R);break}C[2]&&z.ops.pop(),z.trys.pop();continue}R=A.call(v,z)}catch(v){R=[6,v],E=0}finally{T=C=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}([R,M])}}}function s(v){var A="function"==typeof Symbol&&Symbol.iterator,T=A&&v[A],E=0;if(T)return T.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var T,E=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var A,T;try{for(var E=s(this._components),C=E.next();!C.done;C=E.next())if(v==C.value)return}catch(v){A={error:v}}finally{try{C&&!C.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}this._components.push(v),this._componentGroups.push(engine.getComponentGroup(v,Transform))},e.prototype.update=function(v){for(var A=0;A<this._components.length;A++)this.updateComponent(v,this._components[A],this._componentGroups[A])},e.prototype.updateComponent=function(v,A,T){T.entities.forEach((function(T){var E=T.getComponent(Transform),C=T.getComponent(A);C.update(v),C.assignValueToTransform(E),C.hasFinished()&&(T.removeComponent(C),null!=C.onFinishCallback&&C.onFinishCallback())}))},e._instance=null,e}();function h(A,T){switch(A){case v.InterpolationType.LINEAR:return T;case v.InterpolationType.EASEINQUAD:return function(v){return v*v}(T);case v.InterpolationType.EASEOUTQUAD:return function(v){return v*(2-v)}(T);case v.InterpolationType.EASEQUAD:return function(v){return v*v/(2*(v*v-v)+1)}(T);case v.InterpolationType.EASEINSINE:return function(v){return 1-Math.cos(v*Math.PI/2)}(T);case v.InterpolationType.EASEOUTSINE:return function(v){return Math.sin(v*Math.PI/2)}(T);case v.InterpolationType.EASESINE:return function(v){return-(Math.cos(Math.PI*v)-1)/2}(T);case v.InterpolationType.EASEINEXPO:return function(v){return 0===v?0:Math.pow(2,10*v-10)}(T);case v.InterpolationType.EASEOUTEXPO:return function(v){return 1===v?1:1-Math.pow(2,-10*v)}(T);case v.InterpolationType.EASEEXPO:return function(v){return 0===v?0:1===v?1:v<.5?Math.pow(2,20*v-10)/2:(2-Math.pow(2,-20*v+10))/2}(T);case v.InterpolationType.EASEINELASTIC:return function(v){var A=2*Math.PI/3;return 0===v?0:1===v?1:-Math.pow(2,10*v-10)*Math.sin((10*v-10.75)*A)}(T);case v.InterpolationType.EASEOUTELASTIC:return function(v){var A=2*Math.PI/3;return 0===v?0:1===v?1:Math.pow(2,-10*v)*Math.sin((10*v-.75)*A)+1}(T);case v.InterpolationType.EASEELASTIC:return function(v){var A=2*Math.PI/4.5;return 0===v?0:1===v?1:v<.5?-Math.pow(2,20*v-10)*Math.sin((20*v-11.125)*A)/2:Math.pow(2,-20*v+10)*Math.sin((20*v-11.125)*A)/2+1}(T);case v.InterpolationType.EASEINBOUNCE:return function(v){return 1-l(1-v)}(T);case v.InterpolationType.EASEOUTEBOUNCE:return function(v){return l(v)}(T);case v.InterpolationType.EASEBOUNCE:return function(v){return v<.5?(1-l(1-2*v))/2:(1+l(2*v-1))/2}(T);default:return T}}function l(v){var A=7.5625,T=2.75;return v<1/T?A*v*v:v<2/T?A*(v-=1.5/T)*v+.75:v<2.5/T?A*(v-=2.25/T)*v+.9375:A*(v-=2.625/T)*v+.984375}v.InterpolationType=void 0,(T=v.InterpolationType||(v.InterpolationType={}))[T.LINEAR=0]="LINEAR",T[T.EASEINQUAD=1]="EASEINQUAD",T[T.EASEOUTQUAD=2]="EASEOUTQUAD",T[T.EASEQUAD=3]="EASEQUAD",T.EASEINSINE="easeinsine",T.EASEOUTSINE="easeoutsine",T.EASESINE="easeinoutsine",T.EASEINEXPO="easeinexpo",T.EASEOUTEXPO="easeoutexpo",T.EASEEXPO="easeinoutexpo",T.EASEINELASTIC="easeinelastic",T.EASEOUTELASTIC="easeoutelastic",T.EASEELASTIC="easeinoutelastic",T.EASEINBOUNCE="easeinbounce",T.EASEOUTEBOUNCE="easeoutbounce",T.EASEBOUNCE="easeinoutbounce";var C,R=function(){function t(T,C,R,z,M){void 0===M&&(M=v.InterpolationType.LINEAR),this.start=T,this.end=C,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=M,0!=R?this.speed=1/R:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("moveTransformComponent")],t)}(),z=function(){function t(T,C,R,z,M){void 0===M&&(M=v.InterpolationType.LINEAR),this.start=T,this.end=C,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=M,0!=R?this.speed=1/R:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},A=r([Component("rotateTransformComponent")],t)}(),M=function(){function t(T,C,R,z,M){void 0===M&&(M=v.InterpolationType.LINEAR),this.start=T,this.end=C,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=M,0!=R?this.speed=1/R:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(A)}var A;return A=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},A=r([Component("scaleTransformComponent")],t)}(),O=function(){function e(A,T,C,R){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=A,this.onFinishCallback=C,this.onPointReachedCallback=R,A.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(T>0){for(var z=0,M=[],O=0;O<A.length-1;O++){var V=Vector3.Distance(A[O],A[O+1]);z+=V,M.push(V)}for(O=0;O<M.length;O++)this.speed.push(1/(M[O]/z*T))}else this.normalizedTime=1,this.currentIndex=A.length-2;E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},v=r([Component("followPathComponent")],e)}(),V=function(){function e(A,T,C,R,z,M){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(A,C,!!z).getPoints(),this.onFinishCallback=M,this.turnToFaceNext=R||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(T>0){for(var O=0,V=[],W=0;W<this.points.length-1;W++){var j=Vector3.Distance(this.points[W],this.points[W+1]);O+=j,V.push(j)}for(W=0;W<V.length;W++)this.speed.push(1/(V[W]/O*T))}else this.normalizedTime=1,this.currentIndex=A.length-2;E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?v.lookAt(this.points[this.currentIndex+1]):v.lookAt(this.points[0]))},v=r([Component("followCurvedPathComponent")],e)}(),W=function(){function e(A,T){this.rotationVelocity=A,this.onFinishCallback=T,this.rotation=Quaternion.Identity,this.finished=!1,E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,v)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(v){v.rotation=v.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},v=r([Component("keepRotatingComponent")],e)}();v.ToggleState=void 0,(C=v.ToggleState||(v.ToggleState={}))[C.Off=0]="Off",C[C.On=1]="On";var j=function(){function t(A,T){void 0===A&&(A=v.ToggleState.On),this.enabled=!0,this.state=v.ToggleState.Off,this.set(A),T&&this.setCallback(T)}return t.prototype.set=function(v){this.state=v,this.onValueChangedCallback&&this.onValueChangedCallback(v)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==v.ToggleState.On},t.prototype.setCallback=function(v){this.onValueChangedCallback=v},r([Component("toggle")],t)}(),H=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var A,T;try{for(var E=s(this._components),C=E.next();!C.done;C=E.next())if(v==C.value)return}catch(v){A={error:v}}finally{try{C&&!C.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}this._components.push(v)},e.prototype.update=function(v){var A=this;this._components.forEach((function(T){A.updateComponent(v,T)}))},e.prototype.updateComponent=function(v,A){var T=engine.getEntitiesWithComponent(A);for(var E in T)if(T.hasOwnProperty(E)){var C=T[E],R=C.getComponent(A);R.elapsedTime+=v,R.elapsedTime>=R.targetTime&&R.onTargetTimeReached(C)}},e._instance=null,e}(),X=function(){function e(A,T){var E=this;H.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=T,this.onTargetTimeReached=function(v){E.onTimeReachedCallback&&E.onTimeReachedCallback(),v.removeComponent(E)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerDelay")],e)}(),Z=function(){function e(A,T){var E=this;H.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=T,this.onTargetTimeReached=function(v){E.onTimeReachedCallback&&E.onTimeReachedCallback(),v.removeComponent(E),engine.removeEntity(v)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerExpireIn")],e)}(),K=function(){function e(A,T){var E=this;H.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=A/1e3,this.onTimeReachedCallback=T,this.onTargetTimeReached=function(){E.elapsedTime=0,E.onTimeReachedCallback&&E.onTimeReachedCallback()}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerInterval")],e)}();function I(v,A,T,E,C,R){var z=new Entity;z.addComponent(new Transform(R||{position:new Vector3(0,1.5,0)})),z.setParent(A);var M=new TextShape(v);return M.fontSize=C||3,M.color=E||Color3.Black(),z.addComponent(M),T&&z.addComponent(new Billboard),engine.addEntity(z),z}var J,$,et=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new it(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(ot)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},e.prototype.update=function(){var v=this,A=this._componentGroup.entities;for(var T in A.forEach((function(A){v.shouldWrapTriggerEntity(A)&&v.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(T)){var E=this._triggers[T];E.isDebugging()&&E.updateDebugEntity(),E.isInEngine()?null!=E.trigger&&E.trigger.enabled?(E.wasEnabled||E.isDebugging()&&E.addDebugEntity(),E.wasEnabled=!0,(E.trigger.onCameraEnter||E.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(E),(E.trigger.onTriggerEnter||E.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(E)):E.wasEnabled&&(E.wasEnabled=!1,E.isDebugging()&&E.removeDebugEntity(),e.removeTriggerFromSystem(E)):(E.isDebugging()&&E.removeDebugEntity(),e.removeTriggerFromSystem(E),delete this._triggers[T])}},e.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},e.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new nt(v)},e.removeTriggerFromSystem=function(v){for(var A,T=v.getActiveCollisions(),E=0;E<T.length;E++)!(T[E]===(null===(A=e._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==T[E].trigger)&&T[E].trigger.onTriggerExit&&v.entity&&T[E].trigger.onTriggerExit(v.entity),T[E].disengageActiveCollision(v),v.disengageActiveCollision(T[E])},e.disengageCollision=function(v,A){v.disengageActiveCollision(A),A.disengageActiveCollision(v),v.trigger.onTriggerExit&&A.entity&&v.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&v.entity&&A.trigger.onTriggerExit(v.entity)},e.engageCollision=function(v,A){v.engageCollision(A),A.engageCollision(v),v.trigger.onTriggerEnter&&A.entity&&v.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&v.entity&&A.trigger.onTriggerEnter(v.entity)},e.prototype.checkCollisionAgainstCamera=function(v){var A=v.hasActiveCollision(this._cameraTriggerWrapper),T=e.areColliding(v,this._cameraTriggerWrapper);A&&!T?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!A&&T&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=v.uuid&&this._triggers[A].trigger.enabled&&e.canTriggersCollide(v,this._triggers[A])){var T=v.hasActiveCollision(this._triggers[A]),E=e.areColliding(v,this._triggers[A]);T&&!E?e.disengageCollision(v,this._triggers[A]):!T&&E&&e.engageCollision(v,this._triggers[A])}},e.canTriggersCollide=function(v,A){return 0==v.trigger.triggeredByLayer||0!=(A.trigger.layer&v.trigger.triggeredByLayer)},e.areColliding=function(v,A){return v.getShape()instanceof P&&A.getShape()instanceof P?e.areCollidingAABB(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof k&&A.getShape()instanceof k?e.areCollidingSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof P&&A.getShape()instanceof k?e.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof k&&A.getShape()instanceof P&&e.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),v.getGlobalPosition(),v.getShape())},e.areCollidingAABB=function(v,A,T,E){var C=e.getBoxShapeValues(v,A),R=e.getBoxShapeValues(T,E);return C.min.x<=R.max.x&&C.max.x>=R.min.x&&C.min.y<=R.max.y&&C.max.y>=R.min.y&&C.min.z<=R.max.z&&C.max.z>=R.min.z},e.areCollidingSphere=function(v,A,T,E){return Vector3.DistanceSquared(v.add(A.position),T.add(E.position))<A.radius*A.radius+E.radius*E.radius},e.areCollidingAABBSphere=function(v,A,T,E){var C=e.getBoxShapeValues(v,A),R=T.add(E.position),z=E.radius,M=0;return R.x<C.min.x&&(M+=(C.min.x-R.x)*(C.min.x-R.x)),R.x>C.max.x&&(M+=(R.x-C.max.x)*(R.x-C.max.x)),R.y<C.min.y&&(M+=(C.min.y-R.y)*(C.min.y-R.y)),R.y>C.max.y&&(M+=(R.y-C.max.y)*(R.y-C.max.y)),R.z<C.min.z&&(M+=(C.min.z-R.z)*(C.min.z-R.z)),R.z>C.max.z&&(M+=(R.z-C.max.z)*(R.z-C.max.z)),M<z*z},e.getBoxShapeValues=function(v,A){var T=v.add(A.position);return{center:T,min:T.subtract(A.size.scale(.5)),max:T.add(A.size.scale(.5))}},e._instance=null,e}(),nt=function(){function e(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(ot),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var v=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&v.push(this._collidingWith[A]);return v},e.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},e.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},e.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var v,T,E;return a(this,(function(C){switch(C.label){case 0:return[4,!A.isPreviewMode()];case 1:return C.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,v=new Transform,this._debugEntity.addComponent(v),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((T=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(T),v.scale=this.getShape().size),this.getShape()instanceof k&&((T=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(T),E=this.getShape().radius,v.scale=new Vector3(E,E,E))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),T=v.getParent();if(null!=T){var E=T.hasComponent(Transform)?T.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(T).add(A.rotate(E))}return A},e._debugMaterial=null,e}(),it=function(v){function t(A){var T=v.call(this)||this;return T._shape=A,T._uuid="cameraTrigger",T}return i(t,v),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(v){this._shape=v},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(v){return!1},t.prototype.disengageActiveCollision=function(v){},t.prototype.engageCollision=function(v){},t.prototype.isDebugging=function(){return!1},t}(nt),ot=function(){function e(v,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,et.createAndAddToEngine(),this.shape=v,A&&(A.layer&&(this.layer=A.layer),A.triggeredByLayer&&(this.triggeredByLayer=A.triggeredByLayer),A.onTriggerEnter&&(this.onTriggerEnter=A.onTriggerEnter),A.onTriggerExit&&(this.onTriggerExit=A.onTriggerExit),A.onCameraEnter&&(this.onCameraEnter=A.onCameraEnter),A.onCameraExit&&(this.onCameraExit=A.onCameraExit),A.enableDebug&&(this._debugEnabled=A.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(v,A){void 0===v&&(v=Vector3.One().scale(2)),void 0===A&&(A=Vector3.Zero()),this.size=v,this.position=A},k=function(v,A){void 0===v&&(v=2),void 0===A&&(A=Vector3.Zero()),this.radius=v,this.position=A};v.ActionsSequenceSystem=function(){function e(v){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,v&&this.startSequence(v)}return e.prototype.startSequence=function(v){this.beginSequenceNode=v.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(v){this.onFinishCallback=v},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var v=this.currentSequenceNode;if(this.currentSequenceNode instanceof st)do{v=v.currentInnerSequence}while(v instanceof st);return v.action},e.prototype.update=function(v){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(v):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),J=v.ActionsSequenceSystem||(v.ActionsSequenceSystem={}),$=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(v){if(null==this.currentSequenceNode)this.currentSequenceNode=new rt,this.currentSequenceNode.action=v,this.beginSequenceNode=this.currentSequenceNode;else{var A=new rt;A.action=v,this.currentSequenceNode=this.currentSequenceNode.then(A)}return this},e.prototype.if=function(v){var A=new at(v);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.else=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof at))throw new Error("IF statement is needed to be called before ELSE statement.");v.closed=!0;var A=new lt(v);return this.currentSequenceNode=this.currentSequenceNode.then(A),this},e.prototype.endIf=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof at||v instanceof lt))throw new Error("IF statement is needed to be called before ENDIF statement.");return v.closed=!0,this},e.prototype.while=function(v){var A=new ct(v);return null==this.currentSequenceNode?(this.currentSequenceNode=A,this.beginSequenceNode=A):this.currentSequenceNode=this.currentSequenceNode.then(A),this.whileNodeStack.push(A),this},e.prototype.endWhile=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof ct))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return v.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new ht(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),J.SequenceBuilder=$;var rt=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(v){return this.next=v,v},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(v){this.action&&this.action.update(v)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),st=function(v){function t(){var A=null!==v&&v.apply(this,arguments)||this;return A.currentInnerSequence=null,A.startingInnerSequence=null,A.closed=!1,A}return i(t,v),t.prototype.then=function(v){if(null==this.currentInnerSequence)this.currentInnerSequence=v,this.startingInnerSequence=v;else{if(this.closed)return this.next=v,v;this.currentInnerSequence=this.currentInnerSequence.then(v)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var v=this.currentInnerSequence.getSequence();if(v instanceof t&&!v.closed)return v}return this},t}(rt),at=function(v){function t(A){var T=v.call(this)||this;return T.result=!1,T.condition=A,T}return i(t,v),t.prototype.onStart=function(){this.result=this.condition(),this.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(st),lt=function(v){function t(A){var T=v.call(this)||this;return T.ifSequence=null,T.ifSequence=A,T}return i(t,v),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(st),ct=function(v){function t(A){var T=v.call(this)||this;return T.breakWhile=!1,T.condition=A,T}return i(t,v),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?v.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(st),ht=function(v){function t(A){var T=v.call(this)||this;return T.whileNode=A,T}return i(t,v),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(rt);v.Delay=X,v.ExpireIn=Z,v.FollowCurvedPathComponent=V,v.FollowPathComponent=O,v.Interpolate=h,v.Interval=K,v.KeepRotatingComponent=W,v.MoveTransformComponent=R,v.RotateTransformComponent=z,v.ScaleTransformComponent=M,v.SequenceNode=rt,v.ToggleComponent=j,v.TransformSystem=E,v.TriggerBoxShape=P,v.TriggerComponent=ot,v.TriggerSphereShape=k,v.TriggerSystem=et,v.addLabel=I,v.addOneTimeTrigger=function(v,A,T){var E=!1,C=!1,R=new Entity;R.addComponent(new Transform({}));var z={};return A.layer&&(z.layer=A.layer),A.triggeredByLayer&&(z.triggeredByLayer=A.triggeredByLayer),A.onCameraEnter&&(z.onCameraEnter=function(){E||(E=!0,A.onCameraEnter()),!E&&A.onCameraEnter||!C&&A.onCameraExit||engine.removeEntity(R)}),A.onCameraExit&&(z.onCameraExit=function(){C||(C=!0,A.onCameraExit()),!E&&A.onCameraEnter||!C&&A.onCameraExit||engine.removeEntity(R)}),A.enableDebug&&(z.enableDebug=A.enableDebug),R.addComponent(new ot(v,z)),T&&R.setParent(T),engine.addEntity(R),R},v.addTestCube=function(v,T,E,C,R,z,M){return o(this,void 0,void 0,(function(){var O,V,W;return a(this,(function(j){switch(j.label){case 0:return(O=!M)?[4,!A.isPreviewMode()]:[3,2];case 1:O=j.sent(),j.label=2;case 2:return O?[2]:((V=new Entity).addComponent(new Transform(v)),R?(V.addComponent(new SphereShape),V.getComponent(Transform).scale.setAll(.5)):V.addComponent(new BoxShape),engine.addEntity(V),V.addComponent(new OnPointerDown(T,{hoverText:E||"click",button:ActionButton.POINTER})),C&&((W=new Material).albedoColor=C,V.addComponent(W)),z&&(V.getComponent(BoxShape).withCollisions=!1),E&&I(E,V,!0),[2,V])}}))}))},v.clamp=function(v,A,T){var E=v;return v>T?E=T:v<A&&(E=A),E},v.getEntityWorldPosition=function e(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),T=v.getParent();if(null!=T&&"0"!=T.uuid){if("FirstPersonCameraEntityReference"==T.uuid){var E=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(A.rotate(E))}if("AvatarEntityReference"==T.uuid){var C=Camera.instance.rotation;return E=Quaternion.Euler(0,C.eulerAngles.y,0),Camera.instance.position.clone().add(A.rotate(E)).add(new Vector3(0,-.875,0))}return E=T.hasComponent(Transform)?T.getComponent(Transform).rotation:Quaternion.Identity,e(T).add(A.rotate(E))}return A},v.getEntityWorldRotation=function e(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).rotation.clone():Quaternion.Zero(),T=v.getParent();if(null!=T&&"0"!=T.uuid){if("FirstPersonCameraEntityReference"==T.uuid){var E=Camera.instance.rotation.clone();return A.multiply(E)}return"AvatarEntityReference"==T.uuid?(E=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),A.multiply(E)):(E=e(T),A.multiply(E))}return A},v.map=function(v,A,T,E,C){return(v-A)/(T-A)*(C-E)+E},v.sendRequest=function(v,A,T,E){return o(this,void 0,void 0,(function(){var C,R,z;return a(this,(function(M){switch(M.label){case 0:return M.trys.push([0,6,,7]),C={method:A||"GET"},T&&(C.headers=T),E&&(C.body=JSON.stringify(E)),[4,fetch(v,C)];case 1:R=M.sent(),M.label=2;case 2:return M.trys.push([2,4,,5]),[4,R.json()];case 3:return[2,M.sent()];case 4:return M.sent(),[2,R];case 5:return[3,7];case 6:return z=M.sent(),log("error fetching from ",v," : ",z),[3,7];case 7:return[2]}}))}))},v.setTimeout=function(v,A){var T=new Entity;return T.addComponent(new X(v,(function(){A(),engine.removeEntity(T)}))),engine.addEntity(T),T},Object.defineProperty(v,"__esModule",{value:!0})})),function(v,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/ui-scene-utils",["exports"],A):A((v="undefined"!=typeof globalThis?globalThis:v||self)["ui-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var T in A)Object.prototype.hasOwnProperty.call(A,T)&&(v[T]=A[T])})(v,A)};function i(v,A){function o(){this.constructor=v}e(v,A),v.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}var o=function(){return(o=Object.assign||function(v){for(var A,T=1,E=arguments.length;T<E;T++)for(var C in A=arguments[T])Object.prototype.hasOwnProperty.call(A,C)&&(v[C]=A[C]);return v}).apply(this,arguments)};function n(v,A){var T={};for(var E in v)Object.prototype.hasOwnProperty.call(v,E)&&A.indexOf(E)<0&&(T[E]=v[E]);if(null!=v&&"function"==typeof Object.getOwnPropertySymbols){var C=0;for(E=Object.getOwnPropertySymbols(v);C<E.length;C++)A.indexOf(E[C])<0&&Object.prototype.propertyIsEnumerable.call(v,E[C])&&(T[E[C]]=v[E[C]])}return T}function r(v){var A="function"==typeof Symbol&&Symbol.iterator,T=A&&v[A],E=0;if(T)return T.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=function(){function t(A,T){var C=this;E.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=T,this.onTargetTimeReached=function(A){C.onTimeReachedCallback(),A.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=function(v,A,T,E){var C,R=arguments.length,z=R<3?A:null===E?E=Object.getOwnPropertyDescriptor(A,T):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,A,T,E);else for(var M=v.length-1;M>=0;M--)(C=v[M])&&(z=(R<3?C(z):R>3?C(A,T,z):C(A,T))||z);return R>3&&z&&Object.defineProperty(A,T,z),z}([Component("UItimerDelay")],t)}(),T=engine.getComponentGroup(A),E=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var E,C;try{for(var R=r(T.entities),z=R.next();!z.done;z=R.next()){var M=z.value,O=M.getComponent(A);O.elapsedTime+=v,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(M)}}catch(v){E={error:v}}finally{try{z&&!z.done&&(C=R.return)&&C.call(R)}finally{if(E)throw E.error}}},t._instance=null,t}(),C=new UICanvas;C.visible=!0;var R=new Font(Fonts.SanFrancisco),z=new Font(Fonts.SanFrancisco_Heavy),M=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),O=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),V=new UIText(C);V.vAlign="center",V.hAlign="center",V.hTextAlign="center",V.vTextAlign="center",V.font=R,V.fontSize=60,V.color=new Color4(0,0,0,1),V.visible=!1,V.positionY=80;var W=new UIImage(C,M);W.hAlign="center",W.vAlign="center",W.width=400,W.height=250,W.visible=!1;var j,H,X,Z,K=function(v){function e(A,T,E,z,M,O,V){var W=v.call(this)||this;return W.canvas=C,W.valueAsNum=A,W.uiText=new UIText(C),W.fixedDigits=V||null,W.uiText.value=W.toFixedLengthString(A),W.uiText.hAlign="right",W.uiText.vAlign="bottom",W.uiText.positionX=T||0,W.uiText.positionY=E||0,W.uiText.fontSize=M||25,W.uiText.font=R,W.uiText.vTextAlign="center",W.uiText.hTextAlign="center",W.uiText.color=z||Color4.White(),W.uiText.outlineColor=Color4.Black(),W.uiText.outlineWidth=O?0:.1,W}return i(e,v),e.prototype.read=function(){return this.valueAsNum},e.prototype.increase=function(v){this.valueAsNum+=v||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.decrease=function(v){this.valueAsNum-=v||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.set=function(v){this.valueAsNum=v,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.toFixedLengthString=function(v){var A=v.toString();if(!this.fixedDigits)return A;for(var T=A.length-this.fixedDigits;T<0;)A="0".concat(A),T+=1;return T>0&&(A=v.toPrecision(this.fixedDigits)),A},e}(Entity);(j=v.PromptStyles||(v.PromptStyles={})).LIGHT="light",j.DARK="dark",j.LIGHTLARGE="lightlarge",j.DARKLARGE="darklarge",j.LIGHTSLANTED="lightslanted",j.DARKSLANTED="darkslanted",(H=v.BarStyles||(v.BarStyles={})).ROUNDBLACK="roundblack",H.ROUNDWHITE="roundwhite",H.ROUNDSILVER="roundsilver",H.ROUNDGOLD="roundgold",H.SQUAREBLACK="squareblack",H.SQUAREWHITE="squarewhite",H.SQUARESILVER="squaresilver",H.SQUAREGOLD="squaregold",(X=v.ButtonStyles||(v.ButtonStyles={})).E="e",X.F="f",X.DARK="dark",X.RED="red",X.ROUNDBLACK="roundblack",X.ROUNDWHITE="roundwhite",X.ROUNDSILVER="roundsilver",X.ROUNDGOLD="roundgold",X.SQUAREBLACK="squareblack",X.SQUAREWHITE="squarewhite",X.SQUARESILVER="squaresilver",X.SQUAREGOLD="squaregold",(Z=v.SwitchStyles||(v.SwitchStyles={})).ROUNDGREEN="roundgreen",Z.ROUNDRED="roundred",Z.SQUAREGREEN="squaregreen",Z.SQUARERED="squarered";var J={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},$={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},et={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},nt={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},it={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},ot={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},rt={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},st={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},at={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},lt={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},ct={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},ht={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567},ut={sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},pt={sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},dt={sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},yt={sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},ft={sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},gt={closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},vt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},bt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},wt={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},xt={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},At={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},Tt={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},St={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},Ct={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168},It={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},Rt={sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},_t={sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},Pt={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},Bt={sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},zt={sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501};function S(v,A){v.sourceWidth=A.sourceWidth,v.sourceHeight=A.sourceHeight,v.sourceLeft=A.sourceLeft?A.sourceLeft:0,v.sourceTop=A.sourceTop?A.sourceTop:0}function B(v){var A=-10-4*v;return A>-65?A:-65}var Ot=function(A){function o(T,E,R,z,O,V,W){var j=A.call(this)||this;if(j.canvas=C,j.valueAsNum=T>1?1:T,j.fullWidth=V?128*V:128,j.background=new UIImage(C,M),j.background.width=V?128*V:128,j.background.height=V?32*V:32,j.background.hAlign="right",j.background.vAlign="bottom",j.background.positionX=E||0,j.background.positionY=R||0,O)switch(O){case v.BarStyles.ROUNDBLACK:S(j.background,it);break;case v.BarStyles.ROUNDWHITE:S(j.background,rt);break;case v.BarStyles.ROUNDSILVER:S(j.background,at);break;case v.BarStyles.ROUNDGOLD:S(j.background,ct);break;case v.BarStyles.SQUAREBLACK:S(j.background,ot);break;case v.BarStyles.SQUAREWHITE:S(j.background,st);break;case v.BarStyles.SQUARESILVER:S(j.background,lt);break;case v.BarStyles.SQUAREGOLD:S(j.background,ht)}else S(j.background,at);return j.background.sourceWidth=128,j.background.sourceHeight=32,j.background.visible=!0,j.bar=new UIContainerRect(j.background),j.bar.color=z||Color4.Red(),j.bar.thickness=0,j.bar.hAlign="left",j.bar.vAlign="center",j.bar.positionX=V?2.55*V:2.55,j.bar.positionY=0,j.bar.height=V?32*V-7.5*V:24.5,j.bar.width=V?j.fullWidth*j.valueAsNum-5.1*V:j.fullWidth*j.valueAsNum-5.1,W&&j.hide(),j}return i(o,A),o.prototype.read=function(){return this.valueAsNum},o.prototype.increase=function(v){this.valueAsNum+=v||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.decrease=function(v){this.valueAsNum-=v||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.set=function(v){this.valueAsNum=v,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.hide=function(){this.background.visible=!1,this.bar.visible=!1},o.prototype.show=function(){this.background.visible=!0,this.bar.visible=!0},o}(Entity),Nt=function(v){function e(A,T,E,R,z,M){var O=v.call(this)||this;O.canvas=C;var V=new Texture(A);return O.image=new UIImage(C,V),O.image.hAlign="right",O.image.vAlign="bottom",O.image.positionX=T||0,O.image.positionY=E||0,O.image.width=R||64,O.image.height=z||64,O.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,O.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,O.image.sourceWidth=M&&M.sourceWidth?M.sourceWidth:R||64,O.image.sourceHeight=M&&M.sourceHeight?M.sourceHeight:z||64,O}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var T=this;if(this.image.visible=!0,v){var E=new Entity;engine.addEntity(E),E.addComponentOrReplace(new A(v,(function(){T.hide()})))}},e}(Entity),Lt=function(v){function e(A,T,E,R,z,M){var O=v.call(this)||this;O.canvas=C;var V=new Texture(A);return O.image=new UIImage(C,V),O.image.hAlign="right",O.image.vAlign="bottom",O.image.positionX=T||0,O.image.positionY=E||0,O.image.width=R||32,O.image.height=z||32,O.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,O.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,O.image.sourceWidth=M?M.sourceWidth:R||32,O.image.sourceHeight=M?M.sourceHeight:z||32,O}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var T=this;if(this.image.visible=!0,v){var E=new Entity;engine.addEntity(E),E.addComponentOrReplace(new A(v,(function(){T.hide()})))}},e}(Entity),Ft=function(v){function e(A,T,E,R,z,M){var O=v.call(this)||this;O.canvas=C;var V=new Texture(A);return O.image=new UIImage(C,V),O.image.hAlign="right",O.image.vAlign="bottom",O.image.positionX=T||0,O.image.positionY=E||0,O.image.width=R||128,O.image.height=z||128,O.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,O.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,O.image.sourceWidth=M?M.sourceWidth:R||128,O.image.sourceHeight=M?M.sourceHeight:z||128,O}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var T=this;if(this.image.visible=!0,v){var E=new Entity;engine.addEntity(E),E.addComponentOrReplace(new A(v,(function(){T.hide()})))}},e}(Entity),kt=function(v){function e(T,E,R,z,M,O,V,W){var j=v.call(this)||this;j.canvas=C;var H=new Texture(T);if(j.image=new UIImage(C,H),j.image.hAlign="center",j.image.vAlign="center",j.image.positionX=z||0,j.image.positionY=M||0,j.image.width=O||512,j.image.height=V||512,j.image.sourceLeft=W&&W.sourceLeft?W.sourceLeft:0,j.image.sourceTop=W&&W.sourceTop?W.sourceTop:0,j.image.sourceWidth=W?W.sourceWidth:O||512,j.image.sourceHeight=W?W.sourceHeight:V||512,j.image.visible=!R,-1!=E){var X=new Entity;engine.addEntity(X),X.addComponentOrReplace(new A(E||3,(function(){j.hide()})))}return j}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(v){var T=this;if(this.image.visible=!0,v){var E=new Entity;engine.addEntity(E),E.addComponentOrReplace(new A(v,(function(){T.hide()})))}},e}(Entity),Vt=function(v){function e(A,T,E,z){var V=v.call(this)||this;V.canvas=C,V.UIOpenTime=+Date.now(),V.background=new UIImage(C,M),V.background.hAlign="center",V.background.vAlign="center",V.onAccept=T||null;var W=z?O:M;return V.background.source=W,V.background.width=400,V.background.height=250,V.background.positionY=0,S(V.background,dt),V.background.visible=!0,V.closeIcon=new UIImage(V.background,W),V.closeIcon.positionX=175,V.closeIcon.positionY=100,V.closeIcon.width=32,V.closeIcon.height=32,S(V.closeIcon,z?gt.closeW:gt.closeD),V.closeIcon.onClick=new OnClick((function(){V.close()})),V.text=new UIText(V.background),V.text.value=A,V.text.adaptWidth=!1,V.text.textWrapping=!0,V.text.width=380,V.text.hAlign="center",V.text.vAlign="top",V.text.positionX=0,V.text.positionY=-65,V.text.fontSize=24,V.text.font=R,V.text.vTextAlign="center",V.text.hTextAlign="center",V.text.color=z?Color4.White():Color4.Black(),V.button=new UIImage(V.background,W),V.button.positionX=0,V.button.positionY=-60,V.button.width=174,V.button.height=46,S(V.button,J),V.icon=new UIImage(V.button,1==z?O:M),V.icon.width=26,V.icon.height=26,V.icon.hAlign="center",V.icon.vAlign="center",V.icon.isPointerBlocker=!1,S(V.icon,ut),V.icon.positionX=B(E?E.length:2),V.buttonLabel=new UIText(V.button),V.buttonLabel.value=E||"Ok",V.buttonLabel.hTextAlign="center",V.buttonLabel.vTextAlign="center",V.buttonLabel.positionX=30,V.buttonLabel.fontSize=18,V.buttonLabel.font=R,V.buttonLabel.color=Color4.White(),V.buttonLabel.isPointerBlocker=!1,V.button.onClick=new OnClick((function(){V.accept()})),V.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){V.button.visible&&+Date.now()-V.UIOpenTime>100&&V.accept()})),V}return i(e,v),e.prototype.close=function(){this.background.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.hide()},e.prototype.hide=function(){this.background.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.EButtonAction)},e.prototype.show=function(){this.background.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,this.EButtonAction)},e}(Entity),qt=function(v){function e(A,T,E,V,W,j,H){var X=v.call(this)||this;X.canvas=C,X.UIOpenTime=+Date.now(),X.background=new UIImage(C,M),X.background.hAlign="center",X.background.vAlign="center",X.onAccept=E,X.onReject=V||null;var Z=H?O:M;return X.background.source=Z,X.background.width=480,X.background.height=384,S(X.background,yt),X.background.visible=!0,X.closeIcon=new UIImage(X.background,Z),X.closeIcon.positionX=215,X.closeIcon.positionY=164,X.closeIcon.width=32,X.closeIcon.height=32,S(X.closeIcon,H?gt.closeW:gt.closeD),X.closeIcon.onClick=new OnClick((function(){X.close()})),X.title=new UIText(X.background),X.title.value=A,X.title.adaptWidth=!1,X.title.textWrapping=!0,X.title.width=380,X.title.hAlign="center",X.title.vAlign="top",X.title.positionX=0,X.title.positionY=-20,X.title.font=z,X.title.fontSize=24,X.title.vTextAlign="center",X.title.hTextAlign="center",X.title.color=H?Color4.White():Color4.Black(),X.text=new UIText(X.background),X.text.value=T,X.text.adaptWidth=!1,X.text.textWrapping=!0,X.text.width=380,X.text.hAlign="center",X.text.vAlign="top",X.text.positionX=0,X.text.positionY=-145,X.text.fontSize=24,X.text.font=R,X.text.vTextAlign="center",X.text.hTextAlign="center",X.text.color=H?Color4.White():Color4.Black(),X.buttonE=new UIImage(X.background,Z),X.buttonE.positionX=-100,X.buttonE.positionY=-120,X.buttonE.width=174,X.buttonE.height=46,S(X.buttonE,J),X.buttonEIcon=new UIImage(X.buttonE,1==H?O:M),X.buttonEIcon.width=26,X.buttonEIcon.height=26,X.buttonEIcon.hAlign="center",X.buttonEIcon.vAlign="center",X.buttonEIcon.isPointerBlocker=!1,S(X.buttonEIcon,ut),X.buttonEIcon.positionX=B(W?W.length:2),X.buttonELabel=new UIText(X.buttonE),X.buttonELabel.value=W||"Ok",X.buttonELabel.hTextAlign="center",X.buttonELabel.vTextAlign="center",X.buttonELabel.positionX=30,X.buttonELabel.fontSize=18,X.buttonELabel.font=R,X.buttonELabel.color=Color4.White(),X.buttonELabel.isPointerBlocker=!1,X.buttonE.onClick=new OnClick((function(){X.accept()})),X.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){X.buttonE.visible&&+Date.now()-X.UIOpenTime>100&&X.accept()})),X.buttonF=new UIImage(X.background,Z),X.buttonF.positionX=100,X.buttonF.positionY=-120,X.buttonF.width=174,X.buttonF.height=46,S(X.buttonF,$),X.buttonFIcon=new UIImage(X.buttonF,1==H?O:M),X.buttonFIcon.width=26,X.buttonFIcon.height=26,X.buttonFIcon.hAlign="center",X.buttonFIcon.vAlign="center",X.buttonFIcon.isPointerBlocker=!1,S(X.buttonFIcon,pt),X.buttonFIcon.positionX=B(j?j.length:6),X.buttonFLabel=new UIText(X.buttonF),X.buttonFLabel.value=j||"Cancel",X.buttonFLabel.hTextAlign="center",X.buttonFLabel.vTextAlign="center",X.buttonFLabel.positionX=30,X.buttonFLabel.fontSize=18,X.buttonFLabel.font=R,X.buttonFLabel.color=Color4.White(),X.buttonFLabel.isPointerBlocker=!1,X.buttonF.onClick=new OnClick((function(){X.reject()})),X.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){X.buttonF.visible&&+Date.now()-X.UIOpenTime>100&&X.reject()})),X}return i(e,v),e.prototype.close=function(){this.background.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.title.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.hide()},e.prototype.reject=function(){this.onReject&&this.onReject(),this.hide()},e.prototype.hide=function(){this.background.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.buttonEIcon.visible=!1,this.buttonFIcon.visible=!1,Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.EButtonAction),Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.FButtonAction)},e.prototype.show=function(){this.background.visible=!0,this.closeIcon.visible=!0,this.buttonE.visible=!0,this.buttonF.visible=!0,this.text.visible=!0,this.buttonELabel.visible=!0,this.buttonFLabel.visible=!0,this.buttonEIcon.visible=!0,this.buttonFIcon.visible=!0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,this.EButtonAction),Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,this.FButtonAction)},e}(Entity),Ut=function(v){function e(A,T,E,V,W){var j=v.call(this)||this;j.canvas=C,j.UIOpenTime=+Date.now(),j.background=new UIImage(C,M),j.background.hAlign="center",j.background.vAlign="center",j.onAccept=T;var H=W?O:M;j.background.source=H,j.background.width=400,j.background.height=250,S(j.background,dt),j.background.visible=!0,j.text=new UIText(j.background),j.text.value=A,j.text.adaptWidth=!1,j.text.textWrapping=!0,j.text.width=320,j.text.hAlign="center",j.text.vAlign="top",j.text.positionX=0,j.text.positionY=-20,j.text.fontSize=24,j.text.font=z,j.text.vTextAlign="center",j.text.hTextAlign="center",j.text.color=W?Color4.White():Color4.Black(),j.closeIcon=new UIImage(j.background,H),j.closeIcon.positionX=175,j.closeIcon.positionY=100,j.closeIcon.width=32,j.closeIcon.height=32,S(j.closeIcon,W?gt.closeW:gt.closeD),j.closeIcon.onClick=new OnClick((function(){j.hide()})),j.button=new UIImage(j.background,H),j.button.positionX=0,j.button.positionY=-60,j.button.width=174,j.button.height=46,S(j.button,J),j.icon=new UIImage(j.button,1==W?O:M),j.icon.width=26,j.icon.height=26,j.icon.hAlign="center",j.icon.vAlign="center",j.icon.isPointerBlocker=!1,S(j.icon,ut),j.icon.positionX=B(E?E.length:6),j.buttonLabel=new UIText(j.button),j.buttonLabel.value=E||"Submit",j.buttonLabel.hTextAlign="center",j.buttonLabel.vTextAlign="center",j.buttonLabel.positionX=30,j.buttonLabel.fontSize=18,j.buttonLabel.font=R,j.buttonLabel.color=Color4.White(),j.buttonLabel.isPointerBlocker=!1,j.fillInBox=new UIInputText(j.background),j.fillInBox.color=Color4.Black(),j.fillInBox.font=R,j.fillInBox.width=312,j.fillInBox.height=46,j.fillInBox.positionX=0,j.fillInBox.positionY=15,j.fillInBox.placeholder=V||"Fill in",j.fillInBox.hTextAlign="center",j.fillInBox.vTextAlign="center",j.fillInBox.fontSize=22;var X="";return j.fillInBox.onChanged=new OnChanged((function(v){X=v.value})),j.fillInBox.onTextSubmit=new OnTextSubmit((function(v){j.accept(X)})),j.button.onClick=new OnClick((function(){j.accept(X)})),j.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){j.button.visible&&+Date.now()-j.UIOpenTime>100&&j.accept(X)})),j}return i(e,v),e.prototype.close=function(){this.background.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.accept=function(v){this.onAccept(v),this.hide()},e.prototype.hide=function(){this.background.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1,Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.EButtonAction)},e.prototype.show=function(){this.background.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,this.fillInBox.visible=!0,Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,this.EButtonAction)},e}(Entity),Wt=function(A){function o(T,E,R,z){var V=A.call(this)||this;switch(V.elements=[],V.texture=M,V.darkTheme=!1,V.UIOpenTime=0,V.canvas=C,V.UIOpenTime=+Date.now(),V.background=new UIImage(C,M),V.background.hAlign="center",V.background.vAlign="center",V.closeIcon=new UIImage(V.background,V.texture),T||(T=v.PromptStyles.LIGHT),T){case v.PromptStyles.LIGHT:V.texture=M,S(V.background,dt),S(V.closeIcon,gt.closeD),V.closeIcon.positionX=E?E/2-25:175,V.closeIcon.positionY=R?R/2-25:145;break;case v.PromptStyles.DARK:V.texture=O,V.darkTheme=!0,S(V.background,dt),S(V.closeIcon,gt.closeW),V.closeIcon.positionX=E?E/2-25:175,V.closeIcon.positionY=R?R/2-25:145;break;case v.PromptStyles.LIGHTLARGE:V.texture=M,S(V.background,yt),S(V.closeIcon,gt.closeD),V.closeIcon.positionX=E?E/2-25:215,V.closeIcon.positionY=R?R/2-25:165;break;case v.PromptStyles.DARKLARGE:V.texture=O,V.darkTheme=!0,S(V.background,yt),S(V.closeIcon,gt.closeW),V.closeIcon.positionX=E?E/2-25:215,V.closeIcon.positionY=R?R/2-25:165;break;case v.PromptStyles.LIGHTSLANTED:V.texture=M,S(V.background,ft),S(V.closeIcon,gt.closeD),V.closeIcon.positionX=E?E/2-25:215,V.closeIcon.positionY=R?R/2-25:138;break;case v.PromptStyles.DARKSLANTED:V.texture=O,V.darkTheme=!0,S(V.background,ft),S(V.closeIcon,gt.closeW),V.closeIcon.positionX=E?E/2-25:215,V.closeIcon.positionY=R?R/2-25:138;break;default:V.texture=new Texture(T),V.closeIcon.visible=!1}return V.background.source=V.texture,V.background.width=E||V.background.sourceWidth,V.background.height=R||V.background.sourceHeight,V.background.visible=!0,V.closeIcon.width=32,V.closeIcon.height=32,V.closeIcon.source=V.texture,V.closeIcon.onClick=new OnClick((function(){V.hide()})),z&&V.hide(),V}return i(o,A),o.prototype.hide=function(){var v,A;this.background.visible=!1,this.closeIcon.visible=!1;try{for(var T=r(this.elements),E=T.next();!E.done;E=T.next())E.value.hide()}catch(A){v={error:A}}finally{try{E&&!E.done&&(A=T.return)&&A.call(T)}finally{if(v)throw v.error}}},o.prototype.show=function(){var v,A;this.background.visible=!0,this.closeIcon.visible=!0;try{for(var T=r(this.elements),E=T.next();!E.done;E=T.next())E.value.show()}catch(A){v={error:A}}finally{try{E&&!E.done&&(A=T.return)&&A.call(T)}finally{if(v)throw v.error}}},o.prototype.addText=function(v,A,T,E,C){var R=new Zt(this,v,A,T,this.darkTheme,E||void 0,C||void 0);return this.elements.push(R),R},o.prototype.addButton=function(v,A,T,E,C){var R=new Ht(this,this.texture,this.UIOpenTime,v,A,T,E,C||void 0);return this.elements.push(R),R},o.prototype.addCheckbox=function(v,A,T,E,C,R,z){var M=new Gt(this,this.texture,this.darkTheme,v,A,T,E||void 0,C||void 0,R||void 0,z||void 0);return this.elements.push(M),M},o.prototype.addSwitch=function(v,A,T,E,C,R,z){var M=new Yt(this,this.texture,this.darkTheme,v,A,T,E||void 0,C||void 0,R||void 0,z||void 0);return this.elements.push(M),M},o.prototype.addIcon=function(v,A,T,E,C,R){var z=new Texture(v),M=new Qt(this,z,A,T,E||void 0,C||void 0,R||void 0);return this.elements.push(M),M},o.prototype.addTextBox=function(v,A,T,E){var C=new Kt(this,v,A,T||void 0,E||void 0);return this.elements.push(C),C},o}(Entity),Ht=function(A){function o(T,E,C,z,M,O,V,W){var j=A.call(this)||this;if(j.icon=null,j.image=new UIImage(T.background,E),j.image.positionX=M,j.image.positionY=O,j.image.width=174,j.image.height=46,j.label=new UIText(j.image),W)switch(W){case v.ButtonStyles.E:S(j.image,J),j.label.positionX=25,j.icon=new UIImage(j.image,E),j.icon.width=26,j.icon.height=26,j.icon.hAlign="center",j.icon.vAlign="center",j.icon.isPointerBlocker=!1,S(j.icon,ut),j.icon.positionX=B(z.length);break;case v.ButtonStyles.F:S(j.image,$),j.label.positionX=25,j.icon=new UIImage(j.image,E),j.icon.width=26,j.icon.height=26,j.icon.hAlign="center",j.icon.vAlign="center",j.icon.isPointerBlocker=!1,S(j.icon,pt),j.icon.positionX=B(z.length);break;case v.ButtonStyles.RED:S(j.image,et);break;case v.ButtonStyles.DARK:S(j.image,nt);break;case v.ButtonStyles.ROUNDBLACK:S(j.image,it);break;case v.ButtonStyles.ROUNDWHITE:S(j.image,rt);break;case v.ButtonStyles.ROUNDSILVER:S(j.image,at);break;case v.ButtonStyles.ROUNDGOLD:S(j.image,ct);break;case v.ButtonStyles.SQUAREBLACK:S(j.image,ot);break;case v.ButtonStyles.SQUAREWHITE:S(j.image,st);break;case v.ButtonStyles.SQUARESILVER:S(j.image,lt);break;case v.ButtonStyles.SQUAREGOLD:S(j.image,ht);break;default:S(j.image,at)}else S(j.image,at);return j.label.value=z,j.label.hTextAlign="center",j.label.vTextAlign="center",j.label.fontSize=20,j.label.font=R,j.label.color=W==v.ButtonStyles.ROUNDWHITE||W==v.ButtonStyles.SQUAREWHITE?Color4.Black():Color4.White(),j.label.isPointerBlocker=!1,j.image.onClick=new OnClick((function(){V()})),W==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){j.image.visible&&+Date.now()-C>100&&V()})):W==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){j.image.visible&&+Date.now()-C>100&&V()})),j}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1,this.icon&&(this.icon.visible=!1)},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0,this.icon&&(this.icon.visible=!0)},o}(Entity),Gt=function(v){function e(A,T,E,C,z,M,O,V,W,j){var H=v.call(this)||this;return H.checked=!!j,H.darkTheme=E,H.large=W||!1,H.image=new UIImage(A.background,T),H.image.positionX=z,H.image.positionY=M,H.image.width=W?32:24,H.image.height=W?32:24,0==H.checked?H.uncheck():H.check(),H.label=new UIText(H.image),H.label.positionX=W?40:30,H.label.color=E?Color4.White():Color4.Black(),H.label.value=C,H.label.hTextAlign="left",H.label.vTextAlign="center",H.label.fontSize=20,H.label.font=R,H.label.isPointerBlocker=!1,H.image.onClick=new OnClick((function(){0==H.checked?H.check():H.uncheck(),H.checked?O&&O():V&&V()})),H}return i(e,v),e.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},e.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},e.prototype.uncheck=function(){this.checked=!1,this.darkTheme?this.large?S(this.image,At):S(this.image,vt):this.large?S(this.image,St):S(this.image,wt)},e.prototype.check=function(){this.checked=!0,this.darkTheme?this.large?S(this.image,Tt):S(this.image,bt):this.large?S(this.image,Ct):S(this.image,xt)},e}(Entity),Yt=function(A){function o(T,E,C,z,M,O,V,W,j,H){var X=A.call(this)||this;return X.checked=!!H,X.darkTheme=C,X.style=j||v.SwitchStyles.ROUNDGREEN,X.image=new UIImage(T.background,E),X.image.positionX=M,X.image.positionY=O,X.image.width=64,X.image.height=32,0==X.checked?X.check():X.uncheck(),X.label=new UIText(X.image),X.label.positionX=80,X.label.color=C?Color4.White():Color4.Black(),X.label.value=z,X.label.hTextAlign="left",X.label.vTextAlign="center",X.label.fontSize=20,X.label.font=R,X.label.isPointerBlocker=!1,X.image.onClick=new OnClick((function(){0==X.checked?X.check():X.uncheck(),X.checked?V&&V():W&&W()})),X}return i(o,A),o.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},o.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},o.prototype.check=function(){switch(this.checked=!0,this.style){case v.SwitchStyles.ROUNDGREEN:S(this.image,_t);break;case v.SwitchStyles.ROUNDRED:S(this.image,Rt);break;case v.SwitchStyles.SQUAREGREEN:S(this.image,zt);break;case v.SwitchStyles.SQUARERED:S(this.image,Bt)}},o.prototype.uncheck=function(){this.checked=!1,this.style==v.SwitchStyles.ROUNDGREEN||this.style==v.SwitchStyles.ROUNDRED?S(this.image,It):S(this.image,Pt)},o}(Entity),Qt=function(v){function e(A,T,E,C,R,z,M){var O=v.call(this)||this;return O.image=new UIImage(A.background,T),O.image.positionX=E,O.image.positionY=C,O.image.width=R||128,O.image.height=z||128,O.image.sourceLeft=M&&M.sourceLeft?M.sourceLeft:0,O.image.sourceTop=M&&M.sourceTop?M.sourceTop:0,O.image.sourceWidth=M&&M.sourceWidth?M.sourceWidth:R||128,O.image.sourceHeight=M&&M.sourceHeight?M.sourceHeight:z||128,O}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity),Zt=function(v){function e(A,T,E,C,R,z,M){var O=v.call(this)||this;return O.text=new UIText(A.background),O.text.value=T,O.text.positionX=E||0,O.text.positionY=C||0,O.text.hTextAlign="center",O.text.color=z||(R?Color4.White():Color4.Black()),O.text.fontSize=M||15,O}return i(e,v),e.prototype.hide=function(){this.text.visible=!1},e.prototype.show=function(){this.text.visible=!0},e}(Entity),Kt=function(v){function e(A,T,E,C,z){var M=v.call(this)||this;return M.currentText="",M.fillInBox=new UIInputText(A.background),M.fillInBox.color=Color4.Black(),M.fillInBox.font=R,M.fillInBox.width=312,M.fillInBox.height=46,M.fillInBox.positionX=T,M.fillInBox.positionY=E,M.fillInBox.placeholder=C||"Fill in",M.fillInBox.hTextAlign="center",M.fillInBox.vTextAlign="center",M.fillInBox.fontSize=22,M.fillInBox.onChanged=new OnChanged((function(v){M.fillInBox&&!M.fillInBox.visible||(M.currentText=v.value,z&&z(M.currentText))})),M.fillInBox.onTextSubmit=new OnTextSubmit((function(v){M.fillInBox&&!M.fillInBox.visible||(M.currentText=v.text,z&&z(M.currentText))})),M}return i(e,v),e.prototype.hide=function(){this.fillInBox.visible=!1},e.prototype.show=function(){this.fillInBox.visible=!0},e}(Entity),Jt=function(v){function e(A,T,E,z,M,O){var V=v.call(this)||this;return V.canvas=C,V.uiText=new UIText(C),V.uiText.value=A,V.uiText.hAlign="right",V.uiText.vAlign="bottom",V.uiText.positionX=T||0,V.uiText.positionY=E||0,V.uiText.fontSize=M||25,V.uiText.font=R,V.uiText.vTextAlign="center",V.uiText.hTextAlign="center",V.uiText.color=z||Color4.White(),V.uiText.outlineColor=Color4.Black(),V.uiText.outlineWidth=O?0:.1,V}return i(e,v),e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.set=function(v){this.uiText.value=v,this.uiText.visible=!0},e}(Entity),$t=function(v){function e(T,E,R,z){var O=v.call(this)||this;if(O.canvas=C,O.image=new UIImage(C,M),O.image.hAlign="center",O.image.vAlign="center",O.image.positionX=E||0,O.image.positionY=R?R+80:80,O.image.width=z?48*z:48,O.image.height=z?64*z:64,S(O.image,gt.TimerLarge),T&&0!=T){var V=new Entity;engine.addEntity(V),V.addComponentOrReplace(new A(T||3,(function(){O.hide()})))}return O}return i(e,v),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity);function Q(v){return v&&"object"==typeof v&&!Array.isArray(v)}function q(v,A){var T=o({},v);return Q(v)&&Q(A)&&Object.keys(A).forEach((function(E){var C,R;Q(A[E])?E in v?T[E]=q(v[E],A[E]):T=o(o({},T),((C={})[E]=A[E],C)):T=o(o({},T),((R={})[E]=A[E],R))})),T}var ee=function(){function t(v,A){this.shape=v,A&&this.setProperties(A)}return t.prototype.setProperties=function(v){var A,T;try{for(var E=r(Object.keys(v)),C=E.next();!C.done;C=E.next()){var R=C.value;this.shape[R]=v[R]}}catch(v){A={error:v}}finally{try{C&&!C.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}},t.prototype.getProperty=function(v){return this.shape[v]},t}(),ne=function(v){function e(A,T){var E,C,R,z=v.call(this,new UIInputText(A),o(o({},T),{placeholder:null!==(E=null==T?void 0:T.placeholder)&&void 0!==E?E:null==T?void 0:T.value,onFocus:new OnFocus((function(){var v;z.isInputFocused=!0,null===(v=null==T?void 0:T.onFocus)||void 0===v||v.call(T)})),onBlur:new OnBlur((function(){var v,A;z.isInputFocused=!1,""===z.inputValue&&void 0!==z.placeholder?(z.setInputValue(z.placeholder),null===(v=null==T?void 0:T.onBlur)||void 0===v||v.call(T,!0)):null===(A=null==T?void 0:T.onBlur)||void 0===A||A.call(T,!1)})),onChanged:new OnChanged((function(v){var A,E=v.value;if(z.shape.visible&&(z.inputValue=E,E!==z.placeholder&&(""===E&&(z.shape.placeholder=""),z.isInputFocused||""===E))){var C=null!==(A=null==T?void 0:T.waitTime)&&void 0!==A?A:e.DEFAULT_WAIT_TIME;setTimeout((function(){var v;z.inputValue===E&&(null===(v=null==T?void 0:T.onChanged)||void 0===v||v.call(T,E))}),C)}})),onTextSubmit:new OnTextSubmit((function(v){var A=v.text,E=A.substr(0,A.length-1),C=null==T?void 0:T.onTextSubmit;C?C(E):setTimeout((function(){return z.shape.placeholder=E}),0)}))}))||this;return z.inputValue="",z.isInputFocused=!1,z.placeholder=z.shape.placeholder,z.inputValue=null!==(R=null!==(C=null==T?void 0:T.value)&&void 0!==C?C:null==T?void 0:T.placeholder)&&void 0!==R?R:"",z.isInputFocused=!1,z}return i(e,v),e.prototype.getValue=function(){return this.inputValue},e.prototype.isFocused=function(){return this.isInputFocused},e.prototype.setInputValue=function(v){var A=this.isInputFocused;this.isInputFocused=!1,this.shape.placeholder="",this.inputValue=this.shape.placeholder=v,this.isInputFocused=A},e.prototype.reset=function(){this.setInputValue(this.placeholder)},e.prototype.hide=function(){this.setProperties({visible:!1})},e.prototype.show=function(){this.setProperties({visible:!0}),this.setInputValue(this.inputValue)},e.DEFAULT_WAIT_TIME=650,e}(ee),ie=function(v){function e(A,T){var E=v.call(this,new UIContainerRect(A),o({isPointerBlocker:!0},T))||this,C=new UIImage(E.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));return C.width="100%",C.height="100%",C.sourceWidth=1,C.sourceHeight=1,C.isPointerBlocker=!0,E.image=C,(null==T?void 0:T.onClick)&&E.setOnClick(T.onClick),E}return i(e,v),e.prototype.performClick=function(){var v;null===(v=this.image.onClick)||void 0===v||v.callback({})},e.prototype.setOnClick=function(v){this.image.onClick=new OnClick(v)},e.prototype.clearOnClick=function(){this.image.onClick=null},e}(ee),oe=function(v){function e(A,T){var E=v.call(this,new UIContainerRect(A),o({width:"100%",vAlign:"top",visible:!1},T))||this;E.config=o(o({},e.DEFAULTS),T);var C=new ie(E.shape,{width:"100%",height:"100%",color:Color4.Clear()});E.clickableContainer=C;var R=new UIImage(C.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));R.width=R.height=E.config.imageSize,R.hAlign="left",R.positionX=10,R.vAlign="center",E.image=R;var z=new UIText(C.shape);z.vAlign="top",z.hAlign="left",z.vTextAlign="top",z.fontSize=E.config.topFontSize,z.color=E.config.topTextColor,z.positionX=55,z.positionY=-10,z.isPointerBlocker=!1,E.topLeftText=z;var M=new UIText(C.shape);M.vAlign="top",M.hAlign="right",M.vTextAlign="top",M.hTextAlign="right",M.fontSize=z.fontSize,M.color=z.color,M.isPointerBlocker=!1,M.positionX=-10,M.positionY=z.positionY,E.topRightText=M;var O=new UIText(C.shape);O.vAlign="bottom",O.hAlign="left",O.vTextAlign="bottom",O.fontSize=E.config.bottomFontSize,O.color=E.config.bottomTextColor,O.positionX=z.positionX,O.positionY=10,O.isPointerBlocker=!1,E.bottomLeftText=O;var V=new UIText(C.shape);return V.vAlign="bottom",V.hAlign="right",V.vTextAlign="bottom",V.hTextAlign="right",V.fontSize=O.fontSize,V.color=O.color,V.isPointerBlocker=!1,V.positionX=M.positionX,V.positionY=O.positionY,E.bottomRightText=V,E}return i(e,v),e.prototype.setOption=function(v,A){this.image.visible=!1,this.topRightText.visible=!1,this.bottomLeftText.visible=!1,this.bottomRightText.visible=!1,v.image?(this.image.source=new Texture(v.image.src),this.image.sourceWidth=v.image.sourceWidth,this.image.sourceHeight=v.image.sourceHeight,this.image.visible=!0,this.topLeftText.positionX=this.config.imageSize+20):this.topLeftText.positionX=10,"string"==typeof v.visualText?(this.topLeftText.value=v.visualText,this.topLeftText.vAlign=this.topLeftText.vTextAlign="center",this.topLeftText.positionY=0):"text"in v.visualText?(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=v.visualText.text,this.bottomLeftText.value=v.visualText.subText,this.bottomLeftText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX):"bottomLeft"in v.visualText&&(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=v.visualText.topLeft,this.topRightText.value=v.visualText.topRight,this.bottomLeftText.value=v.visualText.bottomLeft,this.bottomRightText.value=v.visualText.bottomRight,this.topRightText.visible=!0,this.bottomLeftText.visible=!0,this.bottomRightText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX),A?this.clickableContainer.setOnClick(A):this.clickableContainer.clearOnClick()},e.prototype.setProperties=function(A){v.prototype.setProperties.call(this,A)},e.prototype.getProperty=function(A){return v.prototype.getProperty.call(this,A)},e.prototype.performClick=function(){this.clickableContainer.performClick()},e.DEFAULTS={topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},e}(ee),se=function(v){function e(A,T,E,C){var R=v.call(this,new UIContainerRect(A),o({},E))||this;R.onSuccessfulSelection=C,R.uiOptions=[],R.options={},E.visible,E.opacity,E.hAlign,E.vAlign,E.positionX,E.positionY;var z=n(E,["visible","opacity","hAlign","vAlign","positionX","positionY"]);R.config=q(e.DEFAULTS,z),R.setProperties({width:R.config.width,height:R.config.initialHeight,color:R.config.borderColor}),R.setItems(T.items,T.dropdownDefaultItemIds);var O=new UIContainerRect(R.shape);O.color=R.config.backgroundColor,O.width=R.config.width-2*R.config.borderSize,O.height=R.config.initialHeight-2*R.config.borderSize,R.insideContainer=O;var V=new ne(O,{vAlign:"top",hTextAlign:"left",vTextAlign:"center",width:"92%",fontSize:R.config.search.fontSize,placeholder:R.config.search.placeholder.defaultText,color:R.config.search.textColor,focusedBackground:Color4.Clear(),height:.95*R.config.initialHeight,onBlur:function(){return R.close()},onTextSubmit:function(){R.uiOptions[0].getProperty("visible")?R.uiOptions[0].performClick():R.close()},onChanged:function(v){if(R.hideAllOptions(),v===R.config.search.placeholder.defaultText||""===v)R.showDefaultOptions();else{var A=v.toLowerCase(),T=[];for(var E in R.options){var C=R.options[E];if(C.searchBy.toLowerCase().indexOf(A)>=0&&(T.push(C),T.length===R.config.options.maxVisibleOptions))break}T.length>0?R.showOptions(T):R.showErrorMessage("Sorry, we can't find \""+v+'"')}}});R.inputText=V;for(var W=0;W<R.config.options.maxVisibleOptions;W++){var j=new oe(O,o(o({},R.config.options),{height:R.config.initialHeight,positionY:-R.config.initialHeight-R.config.initialHeight*W,color:W%2==0?R.config.options.oddBackgroundColor:O.color}));R.uiOptions.push(j)}var H=new UIImage(O,M);H.onClick=new OnClick((function(){return R.close()})),H.sourceTop=305,H.sourceLeft=985,H.sourceWidth=H.sourceHeight=35,H.width=H.height=18,H.hAlign="right",H.vAlign="top",H.positionX=-12,H.positionY=-12,H.visible=H.isPointerBlocker=!0;var X=new UIText(O);return X.height=20,X.visible=!1,X.width="92%",X.hTextAlign="center",X.vAlign="bottom",X.positionY=20,X.fontSize=R.config.errorMessage.fontSize,X.color=R.config.errorMessage.textColor,R.errorMessage=X,R}return i(e,v),e.prototype.open=function(){this.setProperties({visible:!0}),this.showDefaultOptions()},e.prototype.close=function(){this.setProperties({visible:!1}),this.inputText.reset()},e.prototype.setItems=function(v,A){this.options=v.reduce((function(v,A){var T;return A.searchBy=null!==(T=A.searchBy)&&void 0!==T?T:"string"==typeof A.visualText?A.visualText:"text"in A.visualText?A.visualText.text:A.visualText.topLeft,v[A.id]=A,v}),{}),A?this.setDropdownDefaults(A):this.defaultOptions=A,this.hideAllOptions()},e.prototype.setDropdownDefaults=function(v){var A,T;try{for(var E=r(v),C=E.next();!C.done;C=E.next()){var R=C.value;if(!(R in this.options))return void error("Couldn't find an option with id '"+R+"'. Will not set new defaults")}}catch(v){A={error:v}}finally{try{C&&!C.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}this.defaultOptions=v},e.prototype.showDefaultOptions=function(){var v,A=this;if(this.defaultOptions)v=this.defaultOptions.map((function(v){return A.options[v]})).slice(0,this.config.options.maxVisibleOptions);else for(var T in v=[],this.options)if(v.push(this.options[T]),v.length===this.config.options.maxVisibleOptions)break;this.showOptions(v)},e.prototype.showOptions=function(v){var A=this;this.resizeHeight(this.config.initialHeight*v.length+2*this.config.borderSize),v.forEach((function(v,T){var E=A.uiOptions[T];E.setOption(v,(function(){A.onSuccessfulSelection(v),A.setProperties({visible:!1})})),E.setProperties({visible:!0})})),this.errorMessage.visible=!1},e.prototype.hideAllOptions=function(){this.uiOptions.forEach((function(v){return v.setProperties({visible:!1})}))},e.prototype.showErrorMessage=function(v){this.errorMessage.visible=!0,this.errorMessage.value=v,this.resizeHeight(60)},e.prototype.resizeHeight=function(v){this.setProperties({height:this.config.initialHeight+v}),this.insideContainer.height=this.config.initialHeight+v-2*this.config.borderSize},e.DEFAULTS={borderColor:Color4.FromInts(232,236,253,255),backgroundColor:Color4.White(),borderSize:2,width:300,initialHeight:60,search:{fontSize:16,textColor:Color4.FromInts(24,26,70,255),placeholder:{defaultText:"Click to search",textColor:Color4.FromInts(118,120,181,200)}},options:{maxVisibleOptions:5,oddBackgroundColor:Color4.FromInts(246,246,255,255),topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},errorMessage:{fontSize:13,textColor:Color4.FromInts(125,127,157,255)}},e}(ee),ae=function(v){function e(A,T,E,C){var R=v.call(this,new UIContainerRect(A),o({},E))||this;R.onSuccessfulSelection=C,E.visible,E.opacity,E.hAlign,E.vAlign,E.positionX,E.positionY;var z=n(E,["visible","opacity","hAlign","vAlign","positionX","positionY"]);R.config=q(se.DEFAULTS,z),R.setProperties({width:R.config.width,height:R.config.initialHeight,color:R.config.borderColor});var M=new ie(R.shape,{color:R.config.backgroundColor,width:R.config.width-2*R.config.borderSize,height:R.config.initialHeight-2*R.config.borderSize,onClick:function(){return R.uiSearchPrompt.open()}}),O=new oe(M.shape,o(o({},R.config.options),{height:R.config.initialHeight,color:Color4.Clear(),width:R.config.width-2*R.config.borderSize-20,visible:!0,hAlign:"left",isPointerBlocker:!1})),V=new UIText(M.shape);if(V.value="Click to select an option",V.fontSize=R.config.search.fontSize,V.color=R.config.search.placeholder.textColor,V.vTextAlign=V.hTextAlign="center",V.positionX=-R.config.borderSize-10,V.isPointerBlocker=!1,V.opacity=V.color.a,R.initialText=V,null==T?void 0:T.initialItemId){var W=T.items.filter((function(v){return v.id===T.initialItemId}))[0];W&&(O.setOption(W),R.initialText.visible=!1)}var j=new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAN5AAADeQELGyzWAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlQTFRF////AAAAAAAAflGpXQAAAAJ0Uk5TAICbK04YAAAAeklEQVQ4je3PsRXEMAgE0VFCEapG9agaiiDRVXkJxlpq8IYT/AfwTbZ/ssPUEJgGZ2hYDTmgSIAiDoqsdskBRQIUcVBktXdO/jeVuBDPMBpRyEMUEhVMiUKKSOQlEokrmBKJXARsJWAqAaYEjEbAVgJmtGDewmjEt9wfISOqAUzY2sAAAAAASUVORK5CYII="),H=new UIImage(M.shape,j);return H.sourceWidth=H.sourceHeight=64,H.height=15,H.width=12,H.hAlign="right",H.vAlign="center",H.positionX=-10,H.visible=!0,H.isPointerBlocker=!1,R.uiSearchPrompt=new se(R.shape,T,o(o({},E),{visible:!1,vAlign:"top",initialHeight:R.config.initialHeight-2*R.config.borderSize}),(function(v){O.setOption(v),R.initialText.visible=!1,R.onSuccessfulSelection(v)})),R}return i(e,v),e.prototype.open=function(){this.setProperties({visible:!0})},e.prototype.close=function(){this.setProperties({visible:!1})},e.prototype.setSearchItems=function(v,A){this.uiSearchPrompt.setItems(v,A)},e.prototype.setSearchDropdownDefaults=function(v){this.uiSearchPrompt.setDropdownDefaults(v)},e}(ee);v.CenterImage=kt,v.CornerLabel=Jt,v.CustomPrompt=Wt,v.CustomPromptButton=Ht,v.CustomPromptCheckBox=Gt,v.CustomPromptIcon=Qt,v.CustomPromptSwitch=Yt,v.CustomPromptText=Zt,v.CustomPromptTextBox=Kt,v.FillInPrompt=Ut,v.LargeIcon=Ft,v.LoadingIcon=$t,v.MediumIcon=Nt,v.OkPrompt=Vt,v.OptionPrompt=qt,v.SFFont=R,v.SFHeavyFont=z,v.SmallIcon=Lt,v.UIBar=Ot,v.UICounter=K,v.UISearchPrompt=se,v.UISelectBox=ae,v.canvas=C,v.darkTheme=O,v.displayAnnouncement=function(v,T,E,C,R){V.visible=!0,V.value=v,V.color=E||Color4.Yellow(),V.fontSize=C||50,V.font=z,V.outlineColor=Color4.Black(),V.outlineWidth=R?0:.1,V.adaptWidth=!1,V.textWrapping=!0,V.width=900;var M=new Entity;engine.addEntity(M),-1!=T&&M.addComponentOrReplace(new A(T||3,(function(){V.visible=!1})))},v.hideAnnouncements=function(){V.visible=!1},v.lightTheme=M,Object.defineProperty(v,"__esModule",{value:!0})}));var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(v){for(var A,T=1,E=arguments.length;T<E;T++)for(var C in A=arguments[T])Object.prototype.hasOwnProperty.call(A,C)&&(v[C]=A[C]);return v},__assign.apply(this,arguments)},__values=this&&this.__values||function(v){var A="function"==typeof Symbol&&Symbol.iterator,T=A&&v[A],E=0;if(T)return T.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(v){var A;"object"==typeof exports&&"undefined"!=typeof module?module.exports=v():("undefined"!=typeof window?A=window:"undefined"!=typeof global?A=global:"undefined"!=typeof self&&(A=self),A.CANNON=v())}((function(){return function e(v,A,T){function d(C,R){if(!A[C]){if(!v[C]){var z="function"==typeof require&&require;if(!R&&z)return z(C,!0);if(E)return E(C,!0);throw new Error("Cannot find module '"+C+"'")}var M=A[C]={exports:{}};v[C][0].call(M.exports,(function(A){return d(v[C][1][A]||A)}),M,M.exports,e,v,A,T)}return A[C].exports}for(var E="function"==typeof require&&require,C=0;C<T.length;C++)d(T[C]);return d}({1:[function(v,A){A.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(v,A){A.exports={version:v("../package.json").version,AABB:v("./collision/AABB"),ArrayCollisionMatrix:v("./collision/ArrayCollisionMatrix"),Body:v("./objects/Body"),Box:v("./shapes/Box"),Broadphase:v("./collision/Broadphase"),Constraint:v("./constraints/Constraint"),ContactEquation:v("./equations/ContactEquation"),Narrowphase:v("./world/Narrowphase"),ConeTwistConstraint:v("./constraints/ConeTwistConstraint"),ContactMaterial:v("./material/ContactMaterial"),ConvexPolyhedron:v("./shapes/ConvexPolyhedron"),Cylinder:v("./shapes/Cylinder"),DistanceConstraint:v("./constraints/DistanceConstraint"),Equation:v("./equations/Equation"),EventTarget:v("./utils/EventTarget"),FrictionEquation:v("./equations/FrictionEquation"),GSSolver:v("./solver/GSSolver"),GridBroadphase:v("./collision/GridBroadphase"),Heightfield:v("./shapes/Heightfield"),HingeConstraint:v("./constraints/HingeConstraint"),LockConstraint:v("./constraints/LockConstraint"),Mat3:v("./math/Mat3"),Material:v("./material/Material"),NaiveBroadphase:v("./collision/NaiveBroadphase"),ObjectCollisionMatrix:v("./collision/ObjectCollisionMatrix"),Pool:v("./utils/Pool"),Particle:v("./shapes/Particle"),Plane:v("./shapes/Plane"),PointToPointConstraint:v("./constraints/PointToPointConstraint"),Quaternion:v("./math/Quaternion"),Ray:v("./collision/Ray"),RaycastVehicle:v("./objects/RaycastVehicle"),RaycastResult:v("./collision/RaycastResult"),RigidVehicle:v("./objects/RigidVehicle"),RotationalEquation:v("./equations/RotationalEquation"),RotationalMotorEquation:v("./equations/RotationalMotorEquation"),SAPBroadphase:v("./collision/SAPBroadphase"),SPHSystem:v("./objects/SPHSystem"),Shape:v("./shapes/Shape"),Solver:v("./solver/Solver"),Sphere:v("./shapes/Sphere"),SplitSolver:v("./solver/SplitSolver"),Spring:v("./objects/Spring"),Trimesh:v("./shapes/Trimesh"),Vec3:v("./math/Vec3"),Vec3Pool:v("./utils/Vec3Pool"),World:v("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(v,A){function n(v){v=v||{},this.lowerBound=new T,v.lowerBound&&this.lowerBound.copy(v.lowerBound),this.upperBound=new T,v.upperBound&&this.upperBound.copy(v.upperBound)}var T=v("../math/Vec3");v("../utils/Utils"),A.exports=n;var E=new T;n.prototype.setFromPoints=function(v,A,T,C){var R=this.lowerBound,z=this.upperBound,M=T;R.copy(v[0]),M&&M.vmult(R,R),z.copy(R);for(var O=1;O<v.length;O++){var V=v[O];M&&(M.vmult(V,E),V=E),V.x>z.x&&(z.x=V.x),V.x<R.x&&(R.x=V.x),V.y>z.y&&(z.y=V.y),V.y<R.y&&(R.y=V.y),V.z>z.z&&(z.z=V.z),V.z<R.z&&(R.z=V.z)}return A&&(A.vadd(R,R),A.vadd(z,z)),C&&(R.x-=C,R.y-=C,R.z-=C,z.x+=C,z.y+=C,z.z+=C),this},n.prototype.copy=function(v){return this.lowerBound.copy(v.lowerBound),this.upperBound.copy(v.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(v){var A=v.lowerBound.x;this.lowerBound.x>A&&(this.lowerBound.x=A);var T=v.upperBound.x;this.upperBound.x<T&&(this.upperBound.x=T),A=v.lowerBound.y,this.lowerBound.y>A&&(this.lowerBound.y=A),T=v.upperBound.y,this.upperBound.y<T&&(this.upperBound.y=T),A=v.lowerBound.z,this.lowerBound.z>A&&(this.lowerBound.z=A),T=v.upperBound.z,this.upperBound.z<T&&(this.upperBound.z=T)},n.prototype.overlaps=function(v){var A=this.lowerBound,T=this.upperBound,E=v.lowerBound,C=v.upperBound;return(E.x<=T.x&&T.x<=C.x||A.x<=C.x&&C.x<=T.x)&&(E.y<=T.y&&T.y<=C.y||A.y<=C.y&&C.y<=T.y)&&(E.z<=T.z&&T.z<=C.z||A.z<=C.z&&C.z<=T.z)},n.prototype.contains=function(v){var A=this.lowerBound,T=this.upperBound,E=v.lowerBound,C=v.upperBound;return A.x<=E.x&&T.x>=C.x&&A.y<=E.y&&T.y>=C.y&&A.z<=E.z&&T.z>=C.z},n.prototype.getCorners=function(v,A,T,E,C,R,z,M){var O=this.lowerBound,V=this.upperBound;v.copy(O),A.set(V.x,O.y,O.z),T.set(V.x,V.y,O.z),E.set(O.x,V.y,V.z),C.set(V.x,O.y,O.z),R.set(O.x,V.y,O.z),z.set(O.x,O.y,V.z),M.copy(V)};var C=[new T,new T,new T,new T,new T,new T,new T,new T];n.prototype.toLocalFrame=function(v,A){var T=C,E=T[0],R=T[1],z=T[2],M=T[3],O=T[4],V=T[5],W=T[6],j=T[7];this.getCorners(E,R,z,M,O,V,W,j);for(var H=0;8!==H;H++){var X=T[H];v.pointToLocal(X,X)}return A.setFromPoints(T)},n.prototype.toWorldFrame=function(v,A){var T=C,E=T[0],R=T[1],z=T[2],M=T[3],O=T[4],V=T[5],W=T[6],j=T[7];this.getCorners(E,R,z,M,O,V,W,j);for(var H=0;8!==H;H++){var X=T[H];v.pointToWorld(X,X)}return A.setFromPoints(T)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(v,A){function n(){this.matrix=[]}A.exports=n,n.prototype.get=function(v,A){if(v=v.index,(A=A.index)>v){var T=A;A=v,v=T}return this.matrix[(v*(v+1)>>1)+A-1]},n.prototype.set=function(v,A,T){if(v=v.index,(A=A.index)>v){var E=A;A=v,v=E}this.matrix[(v*(v+1)>>1)+A-1]=T?1:0},n.prototype.reset=function(){for(var v=0,A=this.matrix.length;v!==A;v++)this.matrix[v]=0},n.prototype.setNumObjects=function(v){this.matrix.length=v*(v-1)>>1}},{}],5:[function(v,A){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var T=v("../objects/Body"),E=v("../math/Vec3"),C=v("../math/Quaternion");v("../shapes/Shape"),v("../shapes/Plane"),A.exports=n,n.prototype.collisionPairs=function(){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var R=T.STATIC|T.KINEMATIC;n.prototype.needBroadphaseCollision=function(v,A){return 0!=(v.collisionFilterGroup&A.collisionFilterMask)&&0!=(A.collisionFilterGroup&v.collisionFilterMask)&&(0==(v.type&R)&&v.sleepState!==T.SLEEPING||0==(A.type&R)&&A.sleepState!==T.SLEEPING)},n.prototype.intersectionTest=function(v,A,T,E){this.useBoundingBoxes?this.doBoundingBoxBroadphase(v,A,T,E):this.doBoundingSphereBroadphase(v,A,T,E)};var z=new E;new E,new C,new E,n.prototype.doBoundingSphereBroadphase=function(v,A,T,E){var C=z;A.position.vsub(v.position,C),Math.pow(v.boundingRadius+A.boundingRadius,2)>C.norm2()&&(T.push(v),E.push(A))},n.prototype.doBoundingBoxBroadphase=function(v,A,T,E){v.aabbNeedsUpdate&&v.computeAABB(),A.aabbNeedsUpdate&&A.computeAABB(),v.aabb.overlaps(A.aabb)&&(T.push(v),E.push(A))};var M={keys:[]},O=[],V=[];n.prototype.makePairsUnique=function(v,A){for(var T=M,E=O,C=V,R=v.length,z=0;z!==R;z++)E[z]=v[z],C[z]=A[z];for(v.length=0,A.length=0,z=0;z!==R;z++){var W=E[z].id,j=C[z].id;T[H=j>W?W+","+j:j+","+W]=z,T.keys.push(H)}for(z=0;z!==T.keys.length;z++){var H=T.keys.pop(),X=T[H];v.push(E[X]),A.push(C[X]),delete T[H]}},n.prototype.setWorld=function(){};var W=new E;n.boundingSphereCheck=function(v,A){var T=W;return v.position.vsub(A.position,T),Math.pow(v.shape.boundingSphereRadius+A.shape.boundingSphereRadius,2)>T.norm2()},n.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(v,A){function n(v,A,C,R,z){T.apply(this),this.nx=C||10,this.ny=R||10,this.nz=z||10,this.aabbMin=v||new E(100,100,100),this.aabbMax=A||new E(-100,-100,-100);var M=this.nx*this.ny*this.nz;if(0>=M)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=M,this.binLengths.length=M;for(var O=0;M>O;O++)this.bins[O]=[],this.binLengths[O]=0}A.exports=n;var T=v("./Broadphase"),E=v("../math/Vec3"),C=v("../shapes/Shape");n.prototype=new T,n.prototype.constructor=n;var R=new E;new E,n.prototype.collisionPairs=function(v,A,T){function o(v,A,T,E,C,R,z){var M=(v-et)*ot|0,O=(A-nt)*rt|0,K=(T-it)*st|0,J=bt((E-et)*ot),$=bt((C-nt)*rt),at=bt((R-it)*st);0>M?M=0:M>=V&&(M=V-1),0>O?O=0:O>=W&&(O=W-1),0>K?K=0:K>=j&&(K=j-1),0>J?J=0:J>=V&&(J=V-1),0>$?$=0:$>=W&&($=W-1),0>at?at=0:at>=j&&(at=j-1),O*=X,K*=Z,J*=H,$*=X,at*=Z;for(var lt=M*=H;J>=lt;lt+=H)for(var ct=O;$>=ct;ct+=X)for(var ht=K;at>=ht;ht+=Z){var ut=lt+ct+ht;yt[ut][ft[ut]++]=z}}for(var E=v.numObjects(),z=v.bodies,M=this.aabbMax,O=this.aabbMin,V=this.nx,W=this.ny,j=this.nz,H=W*j,X=j,Z=1,K=M.x,J=M.y,$=M.z,et=O.x,nt=O.y,it=O.z,ot=V/(K-et),rt=W/(J-nt),st=j/($-it),at=(K-et)/V,lt=(J-nt)/W,ct=($-it)/j,ht=.5*Math.sqrt(at*at+lt*lt+ct*ct),ut=C.types,pt=ut.SPHERE,dt=ut.PLANE,yt=(ut.BOX,ut.COMPOUND,ut.CONVEXPOLYHEDRON,this.bins),ft=this.binLengths,gt=this.bins.length,vt=0;vt!==gt;vt++)ft[vt]=0;var bt=Math.ceil;for(O=Math.min,M=Math.max,vt=0;vt!==E;vt++){var wt=(Ut=z[vt]).shape;switch(wt.type){case pt:var xt=Ut.position.x,At=Ut.position.y,Tt=Ut.position.z,St=wt.radius;o(xt-St,At-St,Tt-St,xt+St,At+St,Tt+St,Ut);break;case dt:wt.worldNormalNeedsUpdate&&wt.computeWorldNormal(Ut.quaternion);var Ct=wt.worldNormal,It=et+.5*at-Ut.position.x,Rt=nt+.5*lt-Ut.position.y,_t=it+.5*ct-Ut.position.z,Pt=R;Pt.set(It,Rt,_t);for(var Bt=0,zt=0;Bt!==V;Bt++,zt+=H,Pt.y=Rt,Pt.x+=at)for(var Ot=0,Nt=0;Ot!==W;Ot++,Nt+=X,Pt.z=_t,Pt.y+=lt)for(var Lt=0,Ft=0;Lt!==j;Lt++,Ft+=Z,Pt.z+=ct)if(Pt.dot(Ct)<ht){var kt=zt+Nt+Ft;yt[kt][ft[kt]++]=Ut}break;default:Ut.aabbNeedsUpdate&&Ut.computeAABB(),o(Ut.aabb.lowerBound.x,Ut.aabb.lowerBound.y,Ut.aabb.lowerBound.z,Ut.aabb.upperBound.x,Ut.aabb.upperBound.y,Ut.aabb.upperBound.z,Ut)}}for(vt=0;vt!==gt;vt++){var Vt=ft[vt];if(Vt>1){var qt=yt[vt];for(Bt=0;Bt!==Vt;Bt++){var Ut=qt[Bt];for(Ot=0;Ot!==Bt;Ot++){var Wt=qt[Ot];this.needBroadphaseCollision(Ut,Wt)&&this.intersectionTest(Ut,Wt,A,T)}}}}this.makePairsUnique(A,T)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(v,A){function n(){T.apply(this)}A.exports=n;var T=v("./Broadphase"),E=v("./AABB");n.prototype=new T,n.prototype.constructor=n,n.prototype.collisionPairs=function(v,A,T){var E,C,R,z,M=v.bodies,O=M.length;for(E=0;E!==O;E++)for(C=0;C!==E;C++)R=M[E],z=M[C],this.needBroadphaseCollision(R,z)&&this.intersectionTest(R,z,A,T)},new E,n.prototype.aabbQuery=function(v,A,T){T=T||[];for(var E=0;E<v.bodies.length;E++){var C=v.bodies[E];C.aabbNeedsUpdate&&C.computeAABB(),C.aabb.overlaps(A)&&T.push(C)}return T}},{"./AABB":3,"./Broadphase":5}],8:[function(v,A){function n(){this.matrix={}}A.exports=n,n.prototype.get=function(v,A){if(v=v.id,(A=A.id)>v){var T=A;A=v,v=T}return v+"-"+A in this.matrix},n.prototype.set=function(v,A,T){if(v=v.id,(A=A.id)>v){var E=A;A=v,v=E}T?this.matrix[v+"-"+A]=!0:delete this.matrix[v+"-"+A]},n.prototype.reset=function(){this.matrix={}},n.prototype.setNumObjects=function(){}},{}],9:[function(v,A){function n(v,A){this.from=v?v.clone():new T,this.to=A?A.clone():new T,this._direction=new T,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new R,this.hasHit=!1,this.callback=function(){}}function o(v,A,T,E){E.vsub(A,yt),T.vsub(A,W),v.vsub(A,j);var C,R,z=yt.dot(yt),M=yt.dot(W),O=yt.dot(j),V=W.dot(W),H=W.dot(j);return(C=V*O-M*H)>=0&&(R=z*H-M*O)>=0&&z*V-M*M>C+R}A.exports=n;var T=v("../math/Vec3"),E=v("../math/Quaternion"),C=v("../math/Transform"),R=(v("../shapes/ConvexPolyhedron"),v("../shapes/Box"),v("../collision/RaycastResult")),z=v("../shapes/Shape"),M=v("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var O=new M,V=[];n.prototype.intersectWorld=function(v,A){return this.mode=A.mode||n.ANY,this.result=A.result||new R,this.skipBackfaces=!!A.skipBackfaces,this.collisionFilterMask=void 0!==A.collisionFilterMask?A.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==A.collisionFilterGroup?A.collisionFilterGroup:-1,A.from&&this.from.copy(A.from),A.to&&this.to.copy(A.to),this.callback=A.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(O),V.length=0,v.broadphase.aabbQuery(v,O,V),this.intersectBodies(V),this.hasHit};var W=new T,j=new T;n.pointInTriangle=o;var H=new T,X=new E;n.prototype.intersectBody=function(v,A){A&&(this.result=A,this._updateDirection());var T=this.checkCollisionResponse;if((!T||v.collisionResponse)&&0!=(this.collisionFilterGroup&v.collisionFilterMask)&&0!=(v.collisionFilterGroup&this.collisionFilterMask))for(var E=H,C=X,R=0,z=v.shapes.length;z>R;R++){var M=v.shapes[R];if((!T||M.collisionResponse)&&(v.quaternion.mult(v.shapeOrientations[R],C),v.quaternion.vmult(v.shapeOffsets[R],E),E.vadd(v.position,E),this.intersectShape(M,C,E,v),this.result._shouldStop))break}},n.prototype.intersectBodies=function(v,A){A&&(this.result=A,this._updateDirection());for(var T=0,E=v.length;!this.result._shouldStop&&E>T;T++)this.intersectBody(v[T])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(v,A,T,E){var C=function(v,A,T){T.vsub(v,yt);var E=yt.dot(A);return A.mult(E,ft),ft.vadd(v,ft),T.distanceTo(ft)}(this.from,this._direction,T);if(!(C>v.boundingSphereRadius)){var R=this[v.type];R&&R.call(this,v,A,T,E)}};var Z=(new T,new T,new T),K=new T,J=new T,$=new T;new T,new R,n.prototype.intersectBox=function(v,A,T,E){return this.intersectConvex(v.convexPolyhedronRepresentation,A,T,E)},n.prototype[z.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(v,A,E,C){var R=this.from,z=this.to,M=this._direction,O=new T(0,0,1);A.vmult(O,O);var V=new T;R.vsub(E,V);var W=V.dot(O);if(z.vsub(E,V),!(W*V.dot(O)>0||R.distanceTo(z)<W)){var j=O.dot(M);if(!(Math.abs(j)<this.precision)){var H=new T,X=new T,Z=new T;R.vsub(E,H);var K=-O.dot(H)/j;M.scale(K,X),R.vadd(X,Z),this.reportIntersection(O,Z,v,C,-1)}}},n.prototype[z.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(v){var A=this.to,T=this.from;v.lowerBound.x=Math.min(A.x,T.x),v.lowerBound.y=Math.min(A.y,T.y),v.lowerBound.z=Math.min(A.z,T.z),v.upperBound.x=Math.max(A.x,T.x),v.upperBound.y=Math.max(A.y,T.y),v.upperBound.z=Math.max(A.z,T.z)};var et={faceList:[0]};n.prototype.intersectHeightfield=function(v,A,E,R){var z=(v.data,v.elementSize,new T),M=new n(this.from,this.to);C.pointToLocalFrame(E,A,M.from,M.from),C.pointToLocalFrame(E,A,M.to,M.to);var O=[],V=null,W=null,j=null,H=null,X=v.getIndexOfPosition(M.from.x,M.from.y,O,!1);if(X&&(V=O[0],W=O[1],j=O[0],H=O[1]),(X=v.getIndexOfPosition(M.to.x,M.to.y,O,!1))&&((null===V||O[0]<V)&&(V=O[0]),(null===j||O[0]>j)&&(j=O[0]),(null===W||O[1]<W)&&(W=O[1]),(null===H||O[1]>H)&&(H=O[1])),null!==V){v.getRectMinMax(V,W,j,H,[]);for(var Z=V;j>=Z;Z++)for(var K=W;H>=K;K++){if(this.result._shouldStop)return;if(v.getConvexTrianglePillar(Z,K,!1),C.pointToWorldFrame(E,A,v.pillarOffset,z),this.intersectConvex(v.pillarConvex,A,z,R,et),this.result._shouldStop)return;v.getConvexTrianglePillar(Z,K,!0),C.pointToWorldFrame(E,A,v.pillarOffset,z),this.intersectConvex(v.pillarConvex,A,z,R,et)}}},n.prototype[z.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var nt=new T,it=new T;n.prototype.intersectSphere=function(v,A,T,E){var C=this.from,R=this.to,z=v.radius,M=Math.pow(R.x-C.x,2)+Math.pow(R.y-C.y,2)+Math.pow(R.z-C.z,2),O=2*((R.x-C.x)*(C.x-T.x)+(R.y-C.y)*(C.y-T.y)+(R.z-C.z)*(C.z-T.z)),V=Math.pow(C.x-T.x,2)+Math.pow(C.y-T.y,2)+Math.pow(C.z-T.z,2)-Math.pow(z,2),W=Math.pow(O,2)-4*M*V,j=nt,H=it;if(!(0>W))if(0===W)C.lerp(R,W,j),j.vsub(T,H),H.normalize(),this.reportIntersection(H,j,v,E,-1);else{var X=(-O-Math.sqrt(W))/(2*M),Z=(-O+Math.sqrt(W))/(2*M);if(X>=0&&1>=X&&(C.lerp(R,X,j),j.vsub(T,H),H.normalize(),this.reportIntersection(H,j,v,E,-1)),this.result._shouldStop)return;Z>=0&&1>=Z&&(C.lerp(R,Z,j),j.vsub(T,H),H.normalize(),this.reportIntersection(H,j,v,E,-1))}},n.prototype[z.types.SPHERE]=n.prototype.intersectSphere;var ot=new T,rt=(new T,new T,new T);n.prototype.intersectConvex=function(v,A,T,E,C){for(var R=ot,z=rt,M=C&&C.faceList||null,O=v.faces,V=v.vertices,W=v.faceNormals,j=this._direction,H=this.from,X=this.to,et=H.distanceTo(X),nt=M?M.length:O.length,it=this.result,st=0;!it._shouldStop&&nt>st;st++){var at=M?M[st]:st,lt=O[at],ct=W[at],ht=A,ut=T;z.copy(V[lt[0]]),ht.vmult(z,z),z.vadd(ut,z),z.vsub(H,z),ht.vmult(ct,R);var pt=j.dot(R);if(!(Math.abs(pt)<this.precision)){var dt=R.dot(z)/pt;if(!(0>dt)){j.mult(dt,Z),Z.vadd(H,Z),K.copy(V[lt[0]]),ht.vmult(K,K),ut.vadd(K,K);for(var yt=1;!it._shouldStop&&yt<lt.length-1;yt++){J.copy(V[lt[yt]]),$.copy(V[lt[yt+1]]),ht.vmult(J,J),ht.vmult($,$),ut.vadd(J,J),ut.vadd($,$);var ft=Z.distanceTo(H);!o(Z,K,J,$)&&!o(Z,J,K,$)||ft>et||this.reportIntersection(R,Z,v,E,at)}}}}},n.prototype[z.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var st=new T,at=new T,lt=new T,ct=new T,ht=new T,ut=new T,pt=(new M,[]),dt=new C;n.prototype.intersectTrimesh=function(v,A,T,E,R){var z=st,M=pt,O=dt,V=rt,W=at,j=lt,H=ct,X=ut,et=ht,nt=(R&&R.faceList,v.indices),it=(v.vertices,v.faceNormals,this.from),ot=this.to,yt=this._direction;O.position.copy(T),O.quaternion.copy(A),C.vectorToLocalFrame(T,A,yt,W),C.pointToLocalFrame(T,A,it,j),C.pointToLocalFrame(T,A,ot,H);var ft=j.distanceSquared(H);v.tree.rayQuery(this,O,M);for(var gt=0,vt=M.length;!this.result._shouldStop&&gt!==vt;gt++){var bt=M[gt];v.getNormal(bt,z),v.getVertex(nt[3*bt],K),K.vsub(j,V);var wt=W.dot(z),xt=z.dot(V)/wt;if(!(0>xt)){W.scale(xt,Z),Z.vadd(j,Z),v.getVertex(nt[3*bt+1],J),v.getVertex(nt[3*bt+2],$);var At=Z.distanceSquared(j);!o(Z,J,K,$)&&!o(Z,K,J,$)||At>ft||(C.vectorToWorldFrame(A,z,et),C.pointToWorldFrame(T,A,Z,X),this.reportIntersection(et,X,v,E,bt))}}M.length=0},n.prototype[z.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(v,A,T,E,C){var R=this.from,z=this.to,M=R.distanceTo(A),O=this.result;if(!(this.skipBackfaces&&v.dot(this._direction)>0))switch(O.hitFaceIndex=void 0!==C?C:-1,this.mode){case n.ALL:this.hasHit=!0,O.set(R,z,v,A,T,E,M),O.hasHit=!0,this.callback(O);break;case n.CLOSEST:(M<O.distance||!O.hasHit)&&(this.hasHit=!0,O.hasHit=!0,O.set(R,z,v,A,T,E,M));break;case n.ANY:this.hasHit=!0,O.hasHit=!0,O.set(R,z,v,A,T,E,M),O._shouldStop=!0}};var yt=new T,ft=new T},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(v,A){function n(){this.rayFromWorld=new T,this.rayToWorld=new T,this.hitNormalWorld=new T,this.hitPointWorld=new T,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var T=v("../math/Vec3");A.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(v,A,T,E,C,R,z){this.rayFromWorld.copy(v),this.rayToWorld.copy(A),this.hitNormalWorld.copy(T),this.hitPointWorld.copy(E),this.shape=C,this.body=R,this.distance=z}},{"../math/Vec3":30}],11:[function(v,A){function n(v){T.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var A=this.axisList;this._addBodyHandler=function(v){A.push(v.body)},this._removeBodyHandler=function(v){var T=A.indexOf(v.body);-1!==T&&A.splice(T,1)},v&&this.setWorld(v)}var T=(v("../shapes/Shape"),v("../collision/Broadphase"));A.exports=n,n.prototype=new T,n.prototype.setWorld=function(v){this.axisList.length=0;for(var A=0;A<v.bodies.length;A++)this.axisList.push(v.bodies[A]);v.removeEventListener("addBody",this._addBodyHandler),v.removeEventListener("removeBody",this._removeBodyHandler),v.addEventListener("addBody",this._addBodyHandler),v.addEventListener("removeBody",this._removeBodyHandler),this.world=v,this.dirty=!0},n.insertionSortX=function(v){for(var A=1,T=v.length;T>A;A++){for(var E=v[A],C=A-1;C>=0&&!(v[C].aabb.lowerBound.x<=E.aabb.lowerBound.x);C--)v[C+1]=v[C];v[C+1]=E}return v},n.insertionSortY=function(v){for(var A=1,T=v.length;T>A;A++){for(var E=v[A],C=A-1;C>=0&&!(v[C].aabb.lowerBound.y<=E.aabb.lowerBound.y);C--)v[C+1]=v[C];v[C+1]=E}return v},n.insertionSortZ=function(v){for(var A=1,T=v.length;T>A;A++){for(var E=v[A],C=A-1;C>=0&&!(v[C].aabb.lowerBound.z<=E.aabb.lowerBound.z);C--)v[C+1]=v[C];v[C+1]=E}return v},n.prototype.collisionPairs=function(v,A,T){var E,C,R=this.axisList,z=R.length,M=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),E=0;E!==z;E++){var O=R[E];for(C=E+1;z>C;C++){var V=R[C];if(this.needBroadphaseCollision(O,V)){if(!n.checkBounds(O,V,M))break;this.intersectionTest(O,V,A,T)}}}},n.prototype.sortList=function(){for(var v=this.axisList,A=this.axisIndex,T=v.length,E=0;E!==T;E++){var C=v[E];C.aabbNeedsUpdate&&C.computeAABB()}0===A?n.insertionSortX(v):1===A?n.insertionSortY(v):2===A&&n.insertionSortZ(v)},n.checkBounds=function(v,A,T){var E,C;return 0===T?(E=v.position.x,C=A.position.x):1===T?(E=v.position.y,C=A.position.y):2===T&&(E=v.position.z,C=A.position.z),E+v.boundingRadius>C-A.boundingRadius},n.prototype.autoDetectAxis=function(){for(var v=0,A=0,T=0,E=0,C=0,R=0,z=this.axisList,M=z.length,O=1/M,V=0;V!==M;V++){var W=z[V],j=W.position.x;v+=j,A+=j*j;var H=W.position.y;T+=H,E+=H*H;var X=W.position.z;C+=X,R+=X*X}var Z=A-v*v*O,K=E-T*T*O,J=R-C*C*O;this.axisIndex=Z>K?Z>J?0:2:K>J?1:2},n.prototype.aabbQuery=function(v,A,T){T=T||[],this.dirty&&(this.sortList(),this.dirty=!1);var E=this.axisIndex,C="x";1===E&&(C="y"),2===E&&(C="z");for(var R=this.axisList,z=(A.lowerBound[C],A.upperBound[C],0);z<R.length;z++){var M=R[z];M.aabbNeedsUpdate&&M.computeAABB(),M.aabb.overlaps(A)&&T.push(M)}return T}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(v,A){function n(v,A,z){var M=void 0!==(z=z||{}).maxForce?z.maxForce:1e6,O=z.pivotA?z.pivotA.clone():new R,V=z.pivotB?z.pivotB.clone():new R;this.axisA=z.axisA?z.axisA.clone():new R,this.axisB=z.axisB?z.axisB.clone():new R,T.call(this,v,O,A,V,M),this.collideConnected=!!z.collideConnected,this.angle=void 0!==z.angle?z.angle:0;var W=this.coneEquation=new E(v,A,z),j=this.twistEquation=new C(v,A,z);this.twistAngle=void 0!==z.twistAngle?z.twistAngle:0,W.maxForce=0,W.minForce=-M,j.maxForce=0,j.minForce=-M,this.equations.push(W,j)}A.exports=n;var T=(v("./Constraint"),v("./PointToPointConstraint")),E=v("../equations/ConeEquation"),C=v("../equations/RotationalEquation"),R=(v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new T,n.constructor=n,new R,new R,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=this.coneEquation,C=this.twistEquation;T.prototype.update.call(this),v.vectorToWorldFrame(this.axisA,E.axisA),A.vectorToWorldFrame(this.axisB,E.axisB),this.axisA.tangents(C.axisA,C.axisA),v.vectorToWorldFrame(C.axisA,C.axisA),this.axisB.tangents(C.axisB,C.axisB),A.vectorToWorldFrame(C.axisB,C.axisB),E.angle=this.angle,C.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(v,A){function n(v,A,E){E=T.defaults(E,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=v,this.bodyB=A,this.id=n.idCounter++,this.collideConnected=E.collideConnected,E.wakeUpBodies&&(v&&v.wakeUp(),A&&A.wakeUp())}A.exports=n;var T=v("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var v=this.equations,A=0;A<v.length;A++)v[A].enabled=!0},n.prototype.disable=function(){for(var v=this.equations,A=0;A<v.length;A++)v[A].enabled=!1},n.idCounter=0},{"../utils/Utils":53}],14:[function(v,A){function n(v,A,C,R){T.call(this,v,A),void 0===C&&(C=v.position.distanceTo(A.position)),void 0===R&&(R=1e6),this.distance=C;var z=this.distanceEquation=new E(v,A);this.equations.push(z),z.minForce=-R,z.maxForce=R}A.exports=n;var T=v("./Constraint"),E=v("../equations/ContactEquation");n.prototype=new T,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,T=this.distanceEquation,E=.5*this.distance,C=T.ni;A.position.vsub(v.position,C),C.normalize(),C.mult(E,T.ri),C.mult(-E,T.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(v,A){function n(v,A,z){var M=void 0!==(z=z||{}).maxForce?z.maxForce:1e6,O=z.pivotA?z.pivotA.clone():new R,V=z.pivotB?z.pivotB.clone():new R;T.call(this,v,O,A,V,M),(this.axisA=z.axisA?z.axisA.clone():new R(1,0,0)).normalize(),(this.axisB=z.axisB?z.axisB.clone():new R(1,0,0)).normalize();var W=this.rotationalEquation1=new E(v,A,z),j=this.rotationalEquation2=new E(v,A,z),H=this.motorEquation=new C(v,A,M);H.enabled=!1,this.equations.push(W,j,H)}A.exports=n;var T=(v("./Constraint"),v("./PointToPointConstraint")),E=v("../equations/RotationalEquation"),C=v("../equations/RotationalMotorEquation"),R=(v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new T,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(v){this.motorEquation.targetVelocity=v},n.prototype.setMotorMaxForce=function(v){this.motorEquation.maxForce=v,this.motorEquation.minForce=-v};var z=new R,M=new R;n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=this.motorEquation,C=this.rotationalEquation1,R=this.rotationalEquation2,O=z,V=M,W=this.axisA,j=this.axisB;T.prototype.update.call(this),v.quaternion.vmult(W,O),A.quaternion.vmult(j,V),O.tangents(C.axisA,R.axisA),C.axisB.copy(V),R.axisB.copy(V),this.motorEquation.enabled&&(v.quaternion.vmult(this.axisA,E.axisA),A.quaternion.vmult(this.axisB,E.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(v,A){function n(v,A,R){var z=void 0!==(R=R||{}).maxForce?R.maxForce:1e6,M=new C,O=new C,V=new C;v.position.vadd(A.position,V),V.scale(.5,V),A.pointToLocalFrame(V,O),v.pointToLocalFrame(V,M),T.call(this,v,M,A,O,z);var W=this.rotationalEquation1=new E(v,A,R),j=this.rotationalEquation2=new E(v,A,R),H=this.rotationalEquation3=new E(v,A,R);this.equations.push(W,j,H)}A.exports=n;var T=(v("./Constraint"),v("./PointToPointConstraint")),E=v("../equations/RotationalEquation"),C=(v("../equations/RotationalMotorEquation"),v("../equations/ContactEquation"),v("../math/Vec3"));n.prototype=new T,n.constructor=n,new C,new C,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,E=(this.motorEquation,this.rotationalEquation1),R=this.rotationalEquation2,z=this.rotationalEquation3;T.prototype.update.call(this),v.vectorToWorldFrame(C.UNIT_X,E.axisA),A.vectorToWorldFrame(C.UNIT_Y,E.axisB),v.vectorToWorldFrame(C.UNIT_Y,R.axisA),A.vectorToWorldFrame(C.UNIT_Z,R.axisB),v.vectorToWorldFrame(C.UNIT_Z,z.axisA),A.vectorToWorldFrame(C.UNIT_X,z.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(v,A){function n(v,A,R,z,M){T.call(this,v,R),M=void 0!==M?M:1e6,this.pivotA=A?A.clone():new C,this.pivotB=z?z.clone():new C;var O=this.equationX=new E(v,R),V=this.equationY=new E(v,R),W=this.equationZ=new E(v,R);this.equations.push(O,V,W),O.minForce=V.minForce=W.minForce=-M,O.maxForce=V.maxForce=W.maxForce=M,O.ni.set(1,0,0),V.ni.set(0,1,0),W.ni.set(0,0,1)}A.exports=n;var T=v("./Constraint"),E=v("../equations/ContactEquation"),C=v("../math/Vec3");n.prototype=new T,n.prototype.update=function(){var v=this.bodyA,A=this.bodyB,T=this.equationX,E=this.equationY,C=this.equationZ;v.quaternion.vmult(this.pivotA,T.ri),A.quaternion.vmult(this.pivotB,T.rj),E.ri.copy(T.ri),E.rj.copy(T.rj),C.ri.copy(T.ri),C.rj.copy(T.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(v,A){function n(v,A,C){var R=void 0!==(C=C||{}).maxForce?C.maxForce:1e6;E.call(this,v,A,-R,R),this.axisA=C.axisA?C.axisA.clone():new T(1,0,0),this.axisB=C.axisB?C.axisB.clone():new T(0,1,0),this.angle=void 0!==C.angle?C.angle:0}A.exports=n;var T=v("../math/Vec3"),E=(v("../math/Mat3"),v("./Equation"));n.prototype=new E,n.prototype.constructor=n;var C=new T,R=new T;n.prototype.computeB=function(v){var A=this.a,T=this.b,E=this.axisA,z=this.axisB,M=C,O=R,V=this.jacobianElementA,W=this.jacobianElementB;return E.cross(z,M),z.cross(E,O),V.rotational.copy(O),W.rotational.copy(M),-(Math.cos(this.angle)-E.dot(z))*A-this.computeGW()*T-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(v,A){function n(v,A,C){C=void 0!==C?C:1e6,T.call(this,v,A,0,C),this.restitution=0,this.ri=new E,this.rj=new E,this.ni=new E}A.exports=n;var T=v("./Equation"),E=v("../math/Vec3");v("../math/Mat3"),n.prototype=new T,n.prototype.constructor=n;var C=new E,R=new E,z=new E;n.prototype.computeB=function(v){var A=this.a,T=this.b,E=this.bi,M=this.bj,O=this.ri,V=this.rj,W=C,j=R,H=E.velocity,X=E.angularVelocity,Z=(E.force,E.torque,M.velocity),K=M.angularVelocity,J=(M.force,M.torque,z),$=this.jacobianElementA,et=this.jacobianElementB,nt=this.ni;O.cross(nt,W),V.cross(nt,j),nt.negate($.spatial),W.negate($.rotational),et.spatial.copy(nt),et.rotational.copy(j),J.copy(M.position),J.vadd(V,J),J.vsub(E.position,J),J.vsub(O,J);var it=nt.dot(J),ot=this.restitution+1;return-it*A-(ot*Z.dot(nt)-ot*H.dot(nt)+K.dot(j)-X.dot(W))*T-v*this.computeGiMf()};var M=new E,O=new E,V=new E,W=new E,j=new E;n.prototype.getImpactVelocityAlongNormal=function(){var v=M,A=O,T=V,E=W,C=j;return this.bi.position.vadd(this.ri,T),this.bj.position.vadd(this.rj,E),this.bi.getVelocityAtWorldPoint(T,v),this.bj.getVelocityAtWorldPoint(E,A),v.vsub(A,C),this.ni.dot(C)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(v,A){function n(v,A,E,C){this.id=n.id++,this.minForce=void 0===E?-1e6:E,this.maxForce=void 0===C?1e6:C,this.bi=v,this.bj=A,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new T,this.jacobianElementB=new T,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}A.exports=n;var T=v("../math/JacobianElement"),E=v("../math/Vec3");n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(v,A,T){var E=A,C=v,R=T;this.a=4/(R*(1+4*E)),this.b=4*E/(1+4*E),this.eps=4/(R*R*C*(1+4*E))},n.prototype.computeB=function(v,A,T){var E=this.computeGW();return-this.computeGq()*v-E*A-this.computeGiMf()*T},n.prototype.computeGq=function(){var v=this.jacobianElementA,A=this.jacobianElementB,T=this.bi,E=this.bj,C=T.position,R=E.position;return v.spatial.dot(C)+A.spatial.dot(R)};var C=new E;n.prototype.computeGW=function(){var v=this.jacobianElementA,A=this.jacobianElementB,T=this.bi,E=this.bj,R=T.velocity,z=E.velocity,M=T.angularVelocity||C,O=E.angularVelocity||C;return v.multiplyVectors(R,M)+A.multiplyVectors(z,O)},n.prototype.computeGWlambda=function(){var v=this.jacobianElementA,A=this.jacobianElementB,T=this.bi,E=this.bj,R=T.vlambda,z=E.vlambda,M=T.wlambda||C,O=E.wlambda||C;return v.multiplyVectors(R,M)+A.multiplyVectors(z,O)};var R=new E,z=new E,M=new E,O=new E;n.prototype.computeGiMf=function(){var v=this.jacobianElementA,A=this.jacobianElementB,T=this.bi,E=this.bj,C=T.force,V=T.torque,W=E.force,j=E.torque,H=T.invMassSolve,X=E.invMassSolve;return T.invInertiaWorldSolve?T.invInertiaWorldSolve.vmult(V,M):M.set(0,0,0),E.invInertiaWorldSolve?E.invInertiaWorldSolve.vmult(j,O):O.set(0,0,0),C.mult(H,R),W.mult(X,z),v.multiplyVectors(R,M)+A.multiplyVectors(z,O)};var V=new E;n.prototype.computeGiMGt=function(){var v=this.jacobianElementA,A=this.jacobianElementB,T=this.bi,E=this.bj,C=T.invMassSolve,R=E.invMassSolve,z=T.invInertiaWorldSolve,M=E.invInertiaWorldSolve,O=C+R;return z&&(z.vmult(v.rotational,V),O+=V.dot(v.rotational)),M&&(M.vmult(A.rotational,V),O+=V.dot(A.rotational)),O};var W=new E;new E,new E,new E,new E,new E,n.prototype.addToWlambda=function(v){var A=this.jacobianElementA,T=this.jacobianElementB,E=this.bi,C=this.bj,R=W;A.spatial.mult(E.invMassSolve*v,R),E.vlambda.vadd(R,E.vlambda),T.spatial.mult(C.invMassSolve*v,R),C.vlambda.vadd(R,C.vlambda),E.invInertiaWorldSolve&&(E.invInertiaWorldSolve.vmult(A.rotational,R),R.mult(v,R),E.wlambda.vadd(R,E.wlambda)),C.invInertiaWorldSolve&&(C.invInertiaWorldSolve.vmult(T.rotational,R),R.mult(v,R),C.wlambda.vadd(R,C.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(v,A){function n(v,A,C){T.call(this,v,A,-C,C),this.ri=new E,this.rj=new E,this.t=new E}A.exports=n;var T=v("./Equation"),E=v("../math/Vec3");v("../math/Mat3"),n.prototype=new T,n.prototype.constructor=n;var C=new E,R=new E;n.prototype.computeB=function(v){var A=(this.a,this.b),T=(this.bi,this.bj,this.ri),E=this.rj,z=C,M=R,O=this.t;T.cross(O,z),E.cross(O,M);var V=this.jacobianElementA,W=this.jacobianElementB;return O.negate(V.spatial),z.negate(V.rotational),W.spatial.copy(O),W.rotational.copy(M),-this.computeGW()*A-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(v,A){function n(v,A,C){var R=void 0!==(C=C||{}).maxForce?C.maxForce:1e6;E.call(this,v,A,-R,R),this.axisA=C.axisA?C.axisA.clone():new T(1,0,0),this.axisB=C.axisB?C.axisB.clone():new T(0,1,0),this.maxAngle=Math.PI/2}A.exports=n;var T=v("../math/Vec3"),E=(v("../math/Mat3"),v("./Equation"));n.prototype=new E,n.prototype.constructor=n;var C=new T,R=new T;n.prototype.computeB=function(v){var A=this.a,T=this.b,E=this.axisA,z=this.axisB,M=C,O=R,V=this.jacobianElementA,W=this.jacobianElementB;return E.cross(z,M),z.cross(E,O),V.rotational.copy(O),W.rotational.copy(M),-(Math.cos(this.maxAngle)-E.dot(z))*A-this.computeGW()*T-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(v,A){function n(v,A,C){C=void 0!==C?C:1e6,E.call(this,v,A,-C,C),this.axisA=new T,this.axisB=new T,this.targetVelocity=0}A.exports=n;var T=v("../math/Vec3"),E=(v("../math/Mat3"),v("./Equation"));n.prototype=new E,n.prototype.constructor=n,n.prototype.computeB=function(v){var A=(this.a,this.b),T=(this.bi,this.bj,this.axisA),E=this.axisB,C=this.jacobianElementA,R=this.jacobianElementB;return C.rotational.copy(T),E.negate(R.rotational),-(this.computeGW()-this.targetVelocity)*A-v*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(v,A){function n(v,A,E){E=T.defaults(E,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[v,A],this.friction=E.friction,this.restitution=E.restitution,this.contactEquationStiffness=E.contactEquationStiffness,this.contactEquationRelaxation=E.contactEquationRelaxation,this.frictionEquationStiffness=E.frictionEquationStiffness,this.frictionEquationRelaxation=E.frictionEquationRelaxation}var T=v("../utils/Utils");A.exports=n,n.idCounter=0},{"../utils/Utils":53}],25:[function(v,A){function n(v){var A="";"string"==typeof(v=v||{})?(A=v,v={}):"object"==typeof v&&(A=""),this.name=A,this.id=n.idCounter++,this.friction=void 0!==v.friction?v.friction:-1,this.restitution=void 0!==v.restitution?v.restitution:-1}A.exports=n,n.idCounter=0},{}],26:[function(v,A){function n(){this.spatial=new T,this.rotational=new T}A.exports=n;var T=v("./Vec3");n.prototype.multiplyElement=function(v){return v.spatial.dot(this.spatial)+v.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(v,A){return v.dot(this.spatial)+A.dot(this.rotational)}},{"./Vec3":30}],27:[function(v,A){function n(v){this.elements=v||[0,0,0,0,0,0,0,0,0]}A.exports=n;var T=v("./Vec3");n.prototype.identity=function(){var v=this.elements;v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1},n.prototype.setZero=function(){var v=this.elements;v[0]=0,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=0,v[6]=0,v[7]=0,v[8]=0},n.prototype.setTrace=function(v){var A=this.elements;A[0]=v.x,A[4]=v.y,A[8]=v.z},n.prototype.getTrace=function(v){v=v||new T;var A=this.elements;v.x=A[0],v.y=A[4],v.z=A[8]},n.prototype.vmult=function(v,A){A=A||new T;var E=this.elements,C=v.x,R=v.y,z=v.z;return A.x=E[0]*C+E[1]*R+E[2]*z,A.y=E[3]*C+E[4]*R+E[5]*z,A.z=E[6]*C+E[7]*R+E[8]*z,A},n.prototype.smult=function(v){for(var A=0;A<this.elements.length;A++)this.elements[A]*=v},n.prototype.mmult=function(v,A){for(var T=A||new n,E=0;3>E;E++)for(var C=0;3>C;C++){for(var R=0,z=0;3>z;z++)R+=v.elements[E+3*z]*this.elements[z+3*C];T.elements[E+3*C]=R}return T},n.prototype.scale=function(v,A){A=A||new n;for(var T=this.elements,E=A.elements,C=0;3!==C;C++)E[3*C+0]=v.x*T[3*C+0],E[3*C+1]=v.y*T[3*C+1],E[3*C+2]=v.z*T[3*C+2];return A},n.prototype.solve=function(v,A){A=A||new T;for(var E=[],C=0;12>C;C++)E.push(0);var R;for(C=0;3>C;C++)for(R=0;3>R;R++)E[C+4*R]=this.elements[C+3*R];E[3]=v.x,E[7]=v.y,E[11]=v.z;var z,M,O=3,V=O;do{if(0===E[(C=V-O)+4*C])for(R=C+1;V>R;R++)if(0!==E[C+4*R]){z=4;do{E[(M=4-z)+4*C]+=E[M+4*R]}while(--z);break}if(0!==E[C+4*C])for(R=C+1;V>R;R++){var W=E[C+4*R]/E[C+4*C];z=4;do{E[(M=4-z)+4*R]=C>=M?0:E[M+4*R]-E[M+4*C]*W}while(--z)}}while(--O);if(A.z=E[11]/E[10],A.y=(E[7]-E[6]*A.z)/E[5],A.x=(E[3]-E[2]*A.z-E[1]*A.y)/E[0],isNaN(A.x)||isNaN(A.y)||isNaN(A.z)||1/0===A.x||1/0===A.y||1/0===A.z)throw"Could not solve equation! Got x=["+A.toString()+"], b=["+v.toString()+"], A=["+this.toString()+"]";return A},n.prototype.e=function(v,A,T){return void 0===T?this.elements[A+3*v]:void(this.elements[A+3*v]=T)},n.prototype.copy=function(v){for(var A=0;A<v.elements.length;A++)this.elements[A]=v.elements[A];return this},n.prototype.toString=function(){for(var v="",A=0;9>A;A++)v+=this.elements[A]+",";return v},n.prototype.reverse=function(v){v=v||new n;for(var A=[],T=0;18>T;T++)A.push(0);var E;for(T=0;3>T;T++)for(E=0;3>E;E++)A[T+6*E]=this.elements[T+3*E];A[3]=1,A[9]=0,A[15]=0,A[4]=0,A[10]=1,A[16]=0,A[5]=0,A[11]=0,A[17]=1;var C,R,z=3,M=z;do{if(0===A[(T=M-z)+6*T])for(E=T+1;M>E;E++)if(0!==A[T+6*E]){C=6;do{A[(R=6-C)+6*T]+=A[R+6*E]}while(--C);break}if(0!==A[T+6*T])for(E=T+1;M>E;E++){var O=A[T+6*E]/A[T+6*T];C=6;do{A[(R=6-C)+6*E]=T>=R?0:A[R+6*E]-A[R+6*T]*O}while(--C)}}while(--z);T=2;do{E=T-1;do{O=A[T+6*E]/A[T+6*T],C=6;do{A[(R=6-C)+6*E]=A[R+6*E]-A[R+6*T]*O}while(--C)}while(E--)}while(--T);T=2;do{O=1/A[T+6*T],C=6;do{A[(R=6-C)+6*T]=A[R+6*T]*O}while(--C)}while(T--);T=2;do{E=2;do{if(R=A[3+E+6*T],isNaN(R)||1/0===R)throw"Could not reverse! A=["+this.toString()+"]";v.e(T,E,R)}while(E--)}while(T--);return v},n.prototype.setRotationFromQuaternion=function(v){var A=v.x,T=v.y,E=v.z,C=v.w,R=A+A,z=T+T,M=E+E,O=A*R,V=A*z,W=A*M,j=T*z,H=T*M,X=E*M,Z=C*R,K=C*z,J=C*M,$=this.elements;return $[0]=1-(j+X),$[1]=V-J,$[2]=W+K,$[3]=V+J,$[4]=1-(O+X),$[5]=H-Z,$[6]=W-K,$[7]=H+Z,$[8]=1-(O+j),this},n.prototype.transpose=function(v){for(var A=(v=v||new n).elements,T=this.elements,E=0;3!==E;E++)for(var C=0;3!==C;C++)A[3*E+C]=T[3*C+E];return v}},{"./Vec3":30}],28:[function(v,A){function n(v,A,T,E){this.x=void 0!==v?v:0,this.y=void 0!==A?A:0,this.z=void 0!==T?T:0,this.w=void 0!==E?E:1}A.exports=n;var T=v("./Vec3");n.prototype.set=function(v,A,T,E){this.x=v,this.y=A,this.z=T,this.w=E},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(v,A){var T=Math.sin(.5*A);this.x=v.x*T,this.y=v.y*T,this.z=v.z*T,this.w=Math.cos(.5*A)},n.prototype.toAxisAngle=function(v){v=v||new T,this.normalize();var A=2*Math.acos(this.w),E=Math.sqrt(1-this.w*this.w);return.001>E?(v.x=this.x,v.y=this.y,v.z=this.z):(v.x=this.x/E,v.y=this.y/E,v.z=this.z/E),[v,A]};var E=new T,C=new T;n.prototype.setFromVectors=function(v,A){if(v.isAntiparallelTo(A)){var T=E,R=C;v.tangents(T,R),this.setFromAxisAngle(T,Math.PI)}else{var z=v.cross(A);this.x=z.x,this.y=z.y,this.z=z.z,this.w=Math.sqrt(Math.pow(v.norm(),2)*Math.pow(A.norm(),2))+v.dot(A),this.normalize()}};var R=new T,z=new T,M=new T;n.prototype.mult=function(v,A){A=A||new n;var T=this.w,E=R,C=z,O=M;return E.set(this.x,this.y,this.z),C.set(v.x,v.y,v.z),A.w=T*v.w-E.dot(C),E.cross(C,O),A.x=T*C.x+v.w*E.x+O.x,A.y=T*C.y+v.w*E.y+O.y,A.z=T*C.z+v.w*E.z+O.z,A},n.prototype.inverse=function(v){var A=this.x,T=this.y,E=this.z,C=this.w;v=v||new n,this.conjugate(v);var R=1/(A*A+T*T+E*E+C*C);return v.x*=R,v.y*=R,v.z*=R,v.w*=R,v},n.prototype.conjugate=function(v){return(v=v||new n).x=-this.x,v.y=-this.y,v.z=-this.z,v.w=this.w,v},n.prototype.normalize=function(){var v=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===v?(this.x=0,this.y=0,this.z=0,this.w=0):(v=1/v,this.x*=v,this.y*=v,this.z*=v,this.w*=v)},n.prototype.normalizeFast=function(){var v=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===v?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=v,this.y*=v,this.z*=v,this.w*=v)},n.prototype.vmult=function(v,A){A=A||new T;var E=v.x,C=v.y,R=v.z,z=this.x,M=this.y,O=this.z,V=this.w,W=V*E+M*R-O*C,j=V*C+O*E-z*R,H=V*R+z*C-M*E,X=-z*E-M*C-O*R;return A.x=W*V+X*-z+j*-O-H*-M,A.y=j*V+X*-M+H*-z-W*-O,A.z=H*V+X*-O+W*-M-j*-z,A},n.prototype.copy=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this},n.prototype.toEuler=function(v,A){A=A||"YZX";var T,E,C,R=this.x,z=this.y,M=this.z,O=this.w;if("YZX"!==A)throw new Error("Euler order "+A+" not supported yet.");var V=R*z+M*O;if(V>.499&&(T=2*Math.atan2(R,O),E=Math.PI/2,C=0),-.499>V&&(T=-2*Math.atan2(R,O),E=-Math.PI/2,C=0),isNaN(T)){var W=R*R,j=z*z,H=M*M;T=Math.atan2(2*z*O-2*R*M,1-2*j-2*H),E=Math.asin(2*V),C=Math.atan2(2*R*O-2*z*M,1-2*W-2*H)}v.y=T,v.z=E,v.x=C},n.prototype.setFromEuler=function(v,A,T,E){E=E||"XYZ";var C=Math.cos(v/2),R=Math.cos(A/2),z=Math.cos(T/2),M=Math.sin(v/2),O=Math.sin(A/2),V=Math.sin(T/2);return"XYZ"===E?(this.x=M*R*z+C*O*V,this.y=C*O*z-M*R*V,this.z=C*R*V+M*O*z,this.w=C*R*z-M*O*V):"YXZ"===E?(this.x=M*R*z+C*O*V,this.y=C*O*z-M*R*V,this.z=C*R*V-M*O*z,this.w=C*R*z+M*O*V):"ZXY"===E?(this.x=M*R*z-C*O*V,this.y=C*O*z+M*R*V,this.z=C*R*V+M*O*z,this.w=C*R*z-M*O*V):"ZYX"===E?(this.x=M*R*z-C*O*V,this.y=C*O*z+M*R*V,this.z=C*R*V-M*O*z,this.w=C*R*z+M*O*V):"YZX"===E?(this.x=M*R*z+C*O*V,this.y=C*O*z+M*R*V,this.z=C*R*V-M*O*z,this.w=C*R*z-M*O*V):"XZY"===E&&(this.x=M*R*z-C*O*V,this.y=C*O*z-M*R*V,this.z=C*R*V+M*O*z,this.w=C*R*z+M*O*V),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(v,A){function n(v){v=v||{},this.position=new T,v.position&&this.position.copy(v.position),this.quaternion=new E,v.quaternion&&this.quaternion.copy(v.quaternion)}var T=v("./Vec3"),E=v("./Quaternion");A.exports=n;var C=new E;n.pointToLocalFrame=function(v,A,E,R){return R=R||new T,E.vsub(v,R),A.conjugate(C),C.vmult(R,R),R},n.prototype.pointToLocal=function(v,A){return n.pointToLocalFrame(this.position,this.quaternion,v,A)},n.pointToWorldFrame=function(v,A,E,C){return C=C||new T,A.vmult(E,C),C.vadd(v,C),C},n.prototype.pointToWorld=function(v,A){return n.pointToWorldFrame(this.position,this.quaternion,v,A)},n.prototype.vectorToWorldFrame=function(v,A){return A=A||new T,this.quaternion.vmult(v,A),A},n.vectorToWorldFrame=function(v,A,T){return v.vmult(A,T),T},n.vectorToLocalFrame=function(v,A,E,C){return C=C||new T,A.w*=-1,A.vmult(E,C),A.w*=-1,C}},{"./Quaternion":28,"./Vec3":30}],30:[function(v,A){function n(v,A,T){this.x=v||0,this.y=A||0,this.z=T||0}A.exports=n;var T=v("./Mat3");n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(v,A){var T=v.x,E=v.y,C=v.z,R=this.x,z=this.y,M=this.z;return(A=A||new n).x=z*C-M*E,A.y=M*T-R*C,A.z=R*E-z*T,A},n.prototype.set=function(v,A,T){return this.x=v,this.y=A,this.z=T,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(v,A){return A?(A.x=v.x+this.x,A.y=v.y+this.y,void(A.z=v.z+this.z)):new n(this.x+v.x,this.y+v.y,this.z+v.z)},n.prototype.vsub=function(v,A){return A?(A.x=this.x-v.x,A.y=this.y-v.y,void(A.z=this.z-v.z)):new n(this.x-v.x,this.y-v.y,this.z-v.z)},n.prototype.crossmat=function(){return new T([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var v=this.x,A=this.y,T=this.z,E=Math.sqrt(v*v+A*A+T*T);if(E>0){var C=1/E;this.x*=C,this.y*=C,this.z*=C}else this.x=0,this.y=0,this.z=0;return E},n.prototype.unit=function(v){v=v||new n;var A=this.x,T=this.y,E=this.z,C=Math.sqrt(A*A+T*T+E*E);return C>0?(C=1/C,v.x=A*C,v.y=T*C,v.z=E*C):(v.x=1,v.y=0,v.z=0),v},n.prototype.norm=function(){var v=this.x,A=this.y,T=this.z;return Math.sqrt(v*v+A*A+T*T)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(v){var A=this.x,T=this.y,E=this.z,C=v.x,R=v.y,z=v.z;return Math.sqrt((C-A)*(C-A)+(R-T)*(R-T)+(z-E)*(z-E))},n.prototype.distanceSquared=function(v){var A=this.x,T=this.y,E=this.z,C=v.x,R=v.y,z=v.z;return(C-A)*(C-A)+(R-T)*(R-T)+(z-E)*(z-E)},n.prototype.mult=function(v,A){A=A||new n;var T=this.x,E=this.y,C=this.z;return A.x=v*T,A.y=v*E,A.z=v*C,A},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(v){return(v=v||new n).x=-this.x,v.y=-this.y,v.z=-this.z,v};var E=new n,C=new n;n.prototype.tangents=function(v,A){var T=this.norm();if(T>0){var R=E,z=1/T;R.set(this.x*z,this.y*z,this.z*z);var M=C;Math.abs(R.x)<.9?(M.set(1,0,0),R.cross(M,v)):(M.set(0,1,0),R.cross(M,v)),R.cross(v,A)}else v.set(1,0,0),A.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},n.prototype.lerp=function(v,A,T){var E=this.x,C=this.y,R=this.z;T.x=E+(v.x-E)*A,T.y=C+(v.y-C)*A,T.z=R+(v.z-R)*A},n.prototype.almostEquals=function(v,A){return void 0===A&&(A=1e-6),!(Math.abs(this.x-v.x)>A||Math.abs(this.y-v.y)>A||Math.abs(this.z-v.z)>A)},n.prototype.almostZero=function(v){return void 0===v&&(v=1e-6),!(Math.abs(this.x)>v||Math.abs(this.y)>v||Math.abs(this.z)>v)};var R=new n;n.prototype.isAntiparallelTo=function(v,A){return this.negate(R),R.almostEquals(v,A)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(v,A){function n(v){v=v||{},T.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new E,this.collisionFilterGroup="number"==typeof v.collisionFilterGroup?v.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof v.collisionFilterMask?v.collisionFilterMask:1,this.collisionResponse=!0,this.position=new E,v.position&&this.position.copy(v.position),this.previousPosition=new E,this.initPosition=new E,this.velocity=new E,v.velocity&&this.velocity.copy(v.velocity),this.initVelocity=new E,this.force=new E;var A="number"==typeof v.mass?v.mass:0;this.mass=A,this.invMass=A>0?1/A:0,this.material=v.material||null,this.linearDamping="number"==typeof v.linearDamping?v.linearDamping:.01,this.type=0>=A?n.STATIC:n.DYNAMIC,typeof v.type==typeof n.STATIC&&(this.type=v.type),this.allowSleep=void 0===v.allowSleep||v.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==v.sleepSpeedLimit?v.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==v.sleepTimeLimit?v.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new E,this.quaternion=new R,v.quaternion&&this.quaternion.copy(v.quaternion),this.initQuaternion=new R,this.angularVelocity=new E,v.angularVelocity&&this.angularVelocity.copy(v.angularVelocity),this.initAngularVelocity=new E,this.interpolatedPosition=new E,this.interpolatedQuaternion=new R,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new E,this.invInertia=new E,this.invInertiaWorld=new C,this.invMassSolve=0,this.invInertiaSolve=new E,this.invInertiaWorldSolve=new C,this.fixedRotation=void 0!==v.fixedRotation&&v.fixedRotation,this.angularDamping=void 0!==v.angularDamping?v.angularDamping:.01,this.aabb=new z,this.aabbNeedsUpdate=!0,this.wlambda=new E,v.shape&&this.addShape(v.shape),this.updateMassProperties()}A.exports=n;var T=v("../utils/EventTarget"),E=(v("../shapes/Shape"),v("../math/Vec3")),C=v("../math/Mat3"),R=v("../math/Quaternion"),z=(v("../material/Material"),v("../collision/AABB")),M=v("../shapes/Box");n.prototype=new T,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var v=this.sleepState;this.sleepState=0,v===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(v){if(this.allowSleep){var A=this.sleepState,T=this.velocity.norm2()+this.angularVelocity.norm2(),E=Math.pow(this.sleepSpeedLimit,2);A===n.AWAKE&&E>T?(this.sleepState=n.SLEEPY,this.timeLastSleepy=v,this.dispatchEvent(n.sleepyEvent)):A===n.SLEEPY&&T>E?this.wakeUp():A===n.SLEEPY&&v-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(v,A){return A=A||new E,v.vsub(this.position,A),this.quaternion.conjugate().vmult(A,A),A},n.prototype.vectorToLocalFrame=function(v,A){return A=A||new E,this.quaternion.conjugate().vmult(v,A),A},n.prototype.pointToWorldFrame=function(v,A){return A=A||new E,this.quaternion.vmult(v,A),A.vadd(this.position,A),A},n.prototype.vectorToWorldFrame=function(v,A){return A=A||new E,this.quaternion.vmult(v,A),A};var O=new E,V=new R;n.prototype.addShape=function(v,A,T){var C=new E,z=new R;return A&&C.copy(A),T&&z.copy(T),this.shapes.push(v),this.shapeOffsets.push(C),this.shapeOrientations.push(z),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var v=this.shapes,A=this.shapeOffsets,T=v.length,E=0,C=0;C!==T;C++){var R=v[C];R.updateBoundingSphereRadius();var z=A[C].norm(),M=R.boundingSphereRadius;z+M>E&&(E=z+M)}this.boundingRadius=E};var W=new z;n.prototype.computeAABB=function(){for(var v=this.shapes,A=this.shapeOffsets,T=this.shapeOrientations,E=v.length,C=O,R=V,z=this.quaternion,M=this.aabb,j=W,H=0;H!==E;H++){var X=v[H];T[H].mult(z,R),R.vmult(A[H],C),C.vadd(this.position,C),X.calculateWorldAABB(C,R,j.lowerBound,j.upperBound),0===H?M.copy(j):M.extend(j)}this.aabbNeedsUpdate=!1};var j=new C,H=new C;new C,n.prototype.updateInertiaWorld=function(v){var A=this.invInertia;if(A.x!==A.y||A.y!==A.z||v){var T=j,E=H;T.setRotationFromQuaternion(this.quaternion),T.transpose(E),T.scale(A,T),T.mmult(E,this.invInertiaWorld)}};var X=new E,Z=new E;n.prototype.applyForce=function(v,A){if(this.type===n.DYNAMIC){var T=X;A.vsub(this.position,T);var E=Z;T.cross(v,E),this.force.vadd(v,this.force),this.torque.vadd(E,this.torque)}};var K=new E,J=new E;n.prototype.applyLocalForce=function(v,A){if(this.type===n.DYNAMIC){var T=K,E=J;this.vectorToWorldFrame(v,T),this.pointToWorldFrame(A,E),this.applyForce(T,E)}};var $=new E,et=new E,nt=new E;n.prototype.applyImpulse=function(v,A){if(this.type===n.DYNAMIC){var T=$;A.vsub(this.position,T);var E=et;E.copy(v),E.mult(this.invMass,E),this.velocity.vadd(E,this.velocity);var C=nt;T.cross(v,C),this.invInertiaWorld.vmult(C,C),this.angularVelocity.vadd(C,this.angularVelocity)}};var it=new E,ot=new E;n.prototype.applyLocalImpulse=function(v,A){if(this.type===n.DYNAMIC){var T=it,E=ot;this.vectorToWorldFrame(v,T),this.pointToWorldFrame(A,E),this.applyImpulse(T,E)}};var rt=new E;n.prototype.updateMassProperties=function(){var v=rt;this.invMass=this.mass>0?1/this.mass:0;var A=this.inertia,T=this.fixedRotation;this.computeAABB(),v.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),M.calculateInertia(v,this.mass,A),this.invInertia.set(A.x>0&&!T?1/A.x:0,A.y>0&&!T?1/A.y:0,A.z>0&&!T?1/A.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(v,A){var T=new E;return v.vsub(this.position,T),this.angularVelocity.cross(T,A),this.velocity.vadd(A,A),A}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(v,A){function n(v){this.chassisBody=v.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==v.indexRightAxis?v.indexRightAxis:1,this.indexForwardAxis=void 0!==v.indexForwardAxis?v.indexForwardAxis:0,this.indexUpAxis=void 0!==v.indexUpAxis?v.indexUpAxis:2}function o(v,A,T,E,C){var R=0,z=T,M=K,O=J,V=$;return v.getVelocityAtWorldPoint(z,M),A.getVelocityAtWorldPoint(z,O),M.vsub(O,V),(R=-E.dot(V)*(1/(d(v,T,E)+d(A,T,E))))>C&&(R=C),-C>R&&(R=-C),R}function d(v,A,T){var E=et,C=nt,R=it,z=ot;return A.vsub(v.position,E),E.cross(T,C),v.invInertiaWorld.vmult(C,z),z.cross(E,R),v.invMass+T.dot(R)}function i(v,A,T,E,C,R){if(C.norm2()>1.1)return 0;var z=rt,M=st,O=at;return v.getVelocityAtWorldPoint(A,z),T.getVelocityAtWorldPoint(E,M),z.vsub(M,O),-.2*C.dot(O)*(1/(v.invMass+T.invMass))}var T=(v("./Body"),v("../math/Vec3")),E=v("../math/Quaternion"),C=(v("../collision/RaycastResult"),v("../collision/Ray")),R=v("../objects/WheelInfo");A.exports=n;var z=(new T,new T,new T,new T),M=new T,O=new T;new C,n.prototype.addWheel=function(v){var A=new R(v=v||{}),T=this.wheelInfos.length;return this.wheelInfos.push(A),T},n.prototype.setSteeringValue=function(v,A){this.wheelInfos[A].steering=v},new T,n.prototype.applyEngineForce=function(v,A){this.wheelInfos[A].engineForce=v},n.prototype.setBrake=function(v,A){this.wheelInfos[A].brake=v},n.prototype.addToWorld=function(v){this.constraints,v.add(this.chassisBody);var A=this;this.preStepCallback=function(){A.updateVehicle(v.dt)},v.addEventListener("preStep",this.preStepCallback),this.world=v},n.prototype.getVehicleAxisWorld=function(v,A){A.set(0===v?1:0,1===v?1:0,2===v?1:0),this.chassisBody.vectorToWorldFrame(A,A)},n.prototype.updateVehicle=function(v){for(var A=this.wheelInfos,E=A.length,C=this.chassisBody,R=0;E>R;R++)this.updateWheelTransform(R);this.currentVehicleSpeedKmHour=3.6*C.velocity.norm();var z=new T;for(this.getVehicleAxisWorld(this.indexForwardAxis,z),z.dot(C.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),R=0;E>R;R++)this.castRay(A[R]);this.updateSuspension(v);var M=new T,O=new T;for(R=0;E>R;R++){var V=(X=A[R]).suspensionForce;V>X.maxSuspensionForce&&(V=X.maxSuspensionForce),X.raycastResult.hitNormalWorld.scale(V*v,M),X.raycastResult.hitPointWorld.vsub(C.position,O),C.applyImpulse(M,X.raycastResult.hitPointWorld)}this.updateFriction(v);var W=new T,j=new T,H=new T;for(R=0;E>R;R++){var X=A[R];C.getVelocityAtWorldPoint(X.chassisConnectionPointWorld,H);var Z=1;if(1===this.indexUpAxis&&(Z=-1),X.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,j);var K=j.dot(X.raycastResult.hitNormalWorld);X.raycastResult.hitNormalWorld.scale(K,W),j.vsub(W,j);var J=j.dot(H);X.deltaRotation=Z*J*v/X.radius}!X.sliding&&X.isInContact||0===X.engineForce||!X.useCustomSlidingRotationalSpeed||(X.deltaRotation=(X.engineForce>0?1:-1)*X.customSlidingRotationalSpeed*v),Math.abs(X.brake)>Math.abs(X.engineForce)&&(X.deltaRotation=0),X.rotation+=X.deltaRotation,X.deltaRotation*=.99}},n.prototype.updateSuspension=function(){for(var v=this.chassisBody.mass,A=this.wheelInfos,T=A.length,E=0;T>E;E++){var C=A[E];if(C.isInContact){var R,z=C.suspensionRestLength-C.suspensionLength;R=C.suspensionStiffness*z*C.clippedInvContactDotSuspension;var M=C.suspensionRelativeVelocity;R-=(0>M?C.dampingCompression:C.dampingRelaxation)*M,C.suspensionForce=R*v,C.suspensionForce<0&&(C.suspensionForce=0)}else C.suspensionForce=0}},n.prototype.removeFromWorld=function(v){this.constraints,v.remove(this.chassisBody),v.removeEventListener("preStep",this.preStepCallback),this.world=null};var V=new T,W=new T;n.prototype.castRay=function(v){var A=V,E=W;this.updateWheelTransformWorld(v);var C=this.chassisBody,R=-1,z=v.suspensionRestLength+v.radius;v.directionWorld.scale(z,A);var M=v.chassisConnectionPointWorld;M.vadd(A,E);var O=v.raycastResult;O.reset();var j=C.collisionResponse;C.collisionResponse=!1,this.world.rayTest(M,E,O),C.collisionResponse=j;var H=O.body;if(v.raycastResult.groundObject=0,H){R=O.distance,v.raycastResult.hitNormalWorld=O.hitNormalWorld,v.isInContact=!0;var X=O.distance;v.suspensionLength=X-v.radius;var Z=v.suspensionRestLength-v.maxSuspensionTravel,K=v.suspensionRestLength+v.maxSuspensionTravel;v.suspensionLength<Z&&(v.suspensionLength=Z),v.suspensionLength>K&&(v.suspensionLength=K,v.raycastResult.reset());var J=v.raycastResult.hitNormalWorld.dot(v.directionWorld),$=new T;C.getVelocityAtWorldPoint(v.raycastResult.hitPointWorld,$);var et=v.raycastResult.hitNormalWorld.dot($);if(J>=-.1)v.suspensionRelativeVelocity=0,v.clippedInvContactDotSuspension=10;else{var nt=-1/J;v.suspensionRelativeVelocity=et*nt,v.clippedInvContactDotSuspension=nt}}else v.suspensionLength=v.suspensionRestLength+0*v.maxSuspensionTravel,v.suspensionRelativeVelocity=0,v.directionWorld.scale(-1,v.raycastResult.hitNormalWorld),v.clippedInvContactDotSuspension=1;return R},n.prototype.updateWheelTransformWorld=function(v){v.isInContact=!1;var A=this.chassisBody;A.pointToWorldFrame(v.chassisConnectionPointLocal,v.chassisConnectionPointWorld),A.vectorToWorldFrame(v.directionLocal,v.directionWorld),A.vectorToWorldFrame(v.axleLocal,v.axleWorld)},n.prototype.updateWheelTransform=function(v){var A=z,T=M,C=O,R=this.wheelInfos[v];this.updateWheelTransformWorld(R),R.directionLocal.scale(-1,A),T.copy(R.axleLocal),A.cross(T,C),C.normalize(),T.normalize();var V=R.steering,W=new E;W.setFromAxisAngle(A,V);var j=new E;j.setFromAxisAngle(T,R.rotation);var H=R.worldTransform.quaternion;this.chassisBody.quaternion.mult(W,H),H.mult(j,H),H.normalize();var X=R.worldTransform.position;X.copy(R.directionWorld),X.scale(R.suspensionLength,X),X.vadd(R.chassisConnectionPointWorld,X)};var j=[new T(1,0,0),new T(0,1,0),new T(0,0,1)];n.prototype.getWheelTransformWorld=function(v){return this.wheelInfos[v].worldTransform};var H=new T,X=[],Z=[];n.prototype.updateFriction=function(v){for(var A=H,E=this.wheelInfos,C=E.length,R=this.chassisBody,z=Z,M=X,O=0;C>O;O++)J=(lt=E[O]).raycastResult.body,lt.sideImpulse=0,lt.forwardImpulse=0,z[O]||(z[O]=new T),M[O]||(M[O]=new T);for(O=0;C>O;O++)if(J=(lt=E[O]).raycastResult.body){var V=M[O];this.getWheelTransformWorld(O).vectorToWorldFrame(j[this.indexRightAxis],V);var W=lt.raycastResult.hitNormalWorld,K=V.dot(W);W.scale(K,A),V.vsub(A,V),V.normalize(),W.cross(V,z[O]),z[O].normalize(),lt.sideImpulse=i(R,lt.raycastResult.hitPointWorld,J,lt.raycastResult.hitPointWorld,V),lt.sideImpulse*=1}for(this.sliding=!1,O=0;C>O;O++){var J=(lt=E[O]).raycastResult.body,$=0;if(lt.slipInfo=1,J){var et=lt.brake?lt.brake:0;$=o(R,J,lt.raycastResult.hitPointWorld,z[O],et);var nt=et/($+=lt.engineForce*v);lt.slipInfo*=nt}if(lt.forwardImpulse=0,lt.skidInfo=1,J){lt.skidInfo=1;var it=lt.suspensionForce*v*lt.frictionSlip,ot=it*it;lt.forwardImpulse=$;var rt=.5*lt.forwardImpulse,st=1*lt.sideImpulse,at=rt*rt+st*st;lt.sliding=!1,at>ot&&(this.sliding=!0,lt.sliding=!0,nt=it/Math.sqrt(at),lt.skidInfo*=nt)}}if(this.sliding)for(O=0;C>O;O++)0!==(lt=E[O]).sideImpulse&&lt.skidInfo<1&&(lt.forwardImpulse*=lt.skidInfo,lt.sideImpulse*=lt.skidInfo);for(O=0;C>O;O++){var lt=E[O],ct=new T;if(ct.copy(lt.raycastResult.hitPointWorld),0!==lt.forwardImpulse){var ht=new T;z[O].scale(lt.forwardImpulse,ht),R.applyImpulse(ht,ct)}if(0!==lt.sideImpulse){J=lt.raycastResult.body;var ut=new T;ut.copy(lt.raycastResult.hitPointWorld);var pt=new T;M[O].scale(lt.sideImpulse,pt),R.pointToLocalFrame(ct,ct),ct["xyz"[this.indexUpAxis]]*=lt.rollInfluence,R.pointToWorldFrame(ct,ct),R.applyImpulse(pt,ct),pt.scale(-1,pt),J.applyImpulse(pt,ut)}}};var K=new T,J=new T,$=new T,et=new T,nt=new T,it=new T,ot=new T,rt=new T,st=new T,at=new T},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(v,A){function n(v){if(this.wheelBodies=[],this.coordinateSystem=void 0===v.coordinateSystem?new R(1,2,3):v.coordinateSystem.clone(),this.chassisBody=v.chassisBody,!this.chassisBody){var A=new C(new R(5,2,.5));this.chassisBody=new T(1,A)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var T=v("./Body"),E=v("../shapes/Sphere"),C=v("../shapes/Box"),R=v("../math/Vec3"),z=v("../constraints/HingeConstraint");A.exports=n,n.prototype.addWheel=function(v){var A=(v=v||{}).body;A||(A=new T(1,new E(1.2))),this.wheelBodies.push(A),this.wheelForces.push(0);var C=(new R,void 0!==v.position?v.position.clone():new R),M=new R;this.chassisBody.pointToWorldFrame(C,M),A.position.set(M.x,M.y,M.z);var O=void 0!==v.axis?v.axis.clone():new R(0,1,0);this.wheelAxes.push(O);var V=new z(this.chassisBody,A,{pivotA:C,axisA:O,pivotB:R.ZERO,axisB:O,collideConnected:!1});return this.constraints.push(V),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(v,A){var T=this.wheelAxes[A],E=Math.cos(v),C=Math.sin(v),R=T.x,z=T.y;this.constraints[A].axisA.set(E*R-C*z,C*R+E*z,0)},n.prototype.setMotorSpeed=function(v,A){var T=this.constraints[A];T.enableMotor(),T.motorTargetVelocity=v},n.prototype.disableMotor=function(v){this.constraints[v].disableMotor()};var M=new R;n.prototype.setWheelForce=function(v,A){this.wheelForces[A]=v},n.prototype.applyWheelForce=function(v,A){var T=this.wheelAxes[A],E=this.wheelBodies[A],C=E.torque;T.scale(v,M),E.vectorToWorldFrame(M,M),C.vadd(M,C)},n.prototype.addToWorld=function(v){for(var A=this.constraints,T=this.wheelBodies.concat([this.chassisBody]),E=0;E<T.length;E++)v.add(T[E]);for(E=0;E<A.length;E++)v.addConstraint(A[E]);v.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var v=this.wheelForces,A=0;A<v.length;A++)this.applyWheelForce(v[A],A)},n.prototype.removeFromWorld=function(v){for(var A=this.constraints,T=this.wheelBodies.concat([this.chassisBody]),E=0;E<T.length;E++)v.remove(T[E]);for(E=0;E<A.length;E++)v.removeConstraint(A[E])};var O=new R;n.prototype.getWheelSpeed=function(v){var A=this.wheelAxes[v],T=this.wheelBodies[v].angularVelocity;return this.chassisBody.vectorToWorldFrame(A,O),T.dot(O)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(v,A){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}A.exports=n;var T=(v("../shapes/Shape"),v("../math/Vec3"));v("../math/Quaternion"),v("../shapes/Particle"),v("../objects/Body"),v("../material/Material"),n.prototype.add=function(v){this.particles.push(v),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(v){var A=this.particles.indexOf(v);-1!==A&&(this.particles.splice(A,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var E=new T;n.prototype.getNeighbors=function(v,A){for(var T=this.particles.length,C=v.id,R=this.smoothingRadius*this.smoothingRadius,z=E,M=0;M!==T;M++){var O=this.particles[M];O.position.vsub(v.position,z),C!==O.id&&z.norm2()<R&&A.push(O)}};var C=new T,R=new T,z=new T,M=new T,O=new T,V=new T;n.prototype.update=function(){for(var v=this.particles.length,A=C,T=this.speedOfSound,E=this.eps,W=0;W!==v;W++){var j=this.particles[W];(at=this.neighbors[W]).length=0,this.getNeighbors(j,at),at.push(this.particles[W]);for(var H=at.length,X=0,Z=0;Z!==H;Z++){j.position.vsub(at[Z].position,A);var K=A.norm(),J=this.w(K);X+=at[Z].mass*J}this.densities[W]=X,this.pressures[W]=T*T*(this.densities[W]-this.density)}var $=R,et=z,nt=M,it=O,ot=V;for(W=0;W!==v;W++){var rt,st,at,lt=this.particles[W];for($.set(0,0,0),et.set(0,0,0),H=(at=this.neighbors[W]).length,Z=0;Z!==H;Z++){var ct=at[Z];lt.position.vsub(ct.position,it);var ht=it.norm();rt=-ct.mass*(this.pressures[W]/(this.densities[W]*this.densities[W]+E)+this.pressures[Z]/(this.densities[Z]*this.densities[Z]+E)),this.gradw(it,nt),nt.mult(rt,nt),$.vadd(nt,$),ct.velocity.vsub(lt.velocity,ot),ot.mult(1/(1e-4+this.densities[W]*this.densities[Z])*this.viscosity*ct.mass,ot),st=this.nablaw(ht),ot.mult(st,ot),et.vadd(ot,et)}et.mult(lt.mass,et),$.mult(lt.mass,$),lt.force.vadd(et,lt.force),lt.force.vadd($,lt.force)}},n.prototype.w=function(v){var A=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(A,9))*Math.pow(A*A-v*v,3)},n.prototype.gradw=function(v,A){var T=v.norm(),E=this.smoothingRadius;v.mult(945/(32*Math.PI*Math.pow(E,9))*Math.pow(E*E-T*T,2),A)},n.prototype.nablaw=function(v){var A=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(A,9))*(A*A-v*v)*(7*v*v-3*A*A)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(v,A){function n(v,A,E){E=E||{},this.restLength="number"==typeof E.restLength?E.restLength:1,this.stiffness=E.stiffness||100,this.damping=E.damping||1,this.bodyA=v,this.bodyB=A,this.localAnchorA=new T,this.localAnchorB=new T,E.localAnchorA&&this.localAnchorA.copy(E.localAnchorA),E.localAnchorB&&this.localAnchorB.copy(E.localAnchorB),E.worldAnchorA&&this.setWorldAnchorA(E.worldAnchorA),E.worldAnchorB&&this.setWorldAnchorB(E.worldAnchorB)}var T=v("../math/Vec3");A.exports=n,n.prototype.setWorldAnchorA=function(v){this.bodyA.pointToLocalFrame(v,this.localAnchorA)},n.prototype.setWorldAnchorB=function(v){this.bodyB.pointToLocalFrame(v,this.localAnchorB)},n.prototype.getWorldAnchorA=function(v){this.bodyA.pointToWorldFrame(this.localAnchorA,v)},n.prototype.getWorldAnchorB=function(v){this.bodyB.pointToWorldFrame(this.localAnchorB,v)};var E=new T,C=new T,R=new T,z=new T,M=new T,O=new T,V=new T,W=new T,j=new T,H=new T,X=new T;n.prototype.applyForce=function(){var v=this.stiffness,A=this.damping,T=this.restLength,Z=this.bodyA,K=this.bodyB,J=E,$=C,et=R,nt=z,it=X,ot=M,rt=O,st=V,at=W,lt=j,ct=H;this.getWorldAnchorA(ot),this.getWorldAnchorB(rt),ot.vsub(Z.position,st),rt.vsub(K.position,at),rt.vsub(ot,J);var ht=J.norm();$.copy(J),$.normalize(),K.velocity.vsub(Z.velocity,et),K.angularVelocity.cross(at,it),et.vadd(it,et),Z.angularVelocity.cross(st,it),et.vsub(it,et),$.mult(-v*(ht-T)-A*et.dot($),nt),Z.force.vsub(nt,Z.force),K.force.vadd(nt,K.force),st.cross(nt,lt),at.cross(nt,ct),Z.torque.vsub(lt,Z.torque),K.torque.vadd(ct,K.torque)}},{"../math/Vec3":30}],36:[function(v,A){function n(v){v=R.defaults(v,{chassisConnectionPointLocal:new T,chassisConnectionPointWorld:new T,directionLocal:new T,directionWorld:new T,axleLocal:new T,axleWorld:new T,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=v.maxSuspensionTravel,this.customSlidingRotationalSpeed=v.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=v.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=v.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=v.chassisConnectionPointWorld.clone(),this.directionLocal=v.directionLocal.clone(),this.directionWorld=v.directionWorld.clone(),this.axleLocal=v.axleLocal.clone(),this.axleWorld=v.axleWorld.clone(),this.suspensionRestLength=v.suspensionRestLength,this.suspensionMaxLength=v.suspensionMaxLength,this.radius=v.radius,this.suspensionStiffness=v.suspensionStiffness,this.dampingCompression=v.dampingCompression,this.dampingRelaxation=v.dampingRelaxation,this.frictionSlip=v.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=v.rollInfluence,this.maxSuspensionForce=v.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=v.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new C,this.worldTransform=new E,this.isInContact=!1}var T=v("../math/Vec3"),E=v("../math/Transform"),C=v("../collision/RaycastResult"),R=v("../utils/Utils");A.exports=n;var z=new T,M=new T;z=new T,n.prototype.updateWheel=function(v){var A=this.raycastResult;if(this.isInContact){var T=A.hitNormalWorld.dot(A.directionWorld);A.hitPointWorld.vsub(v.position,M),v.getVelocityAtWorldPoint(M,z);var E=A.hitNormalWorld.dot(z);if(T>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var C=-1/T;this.suspensionRelativeVelocity=E*C,this.clippedInvContactDotSuspension=C}}else A.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,A.directionWorld.scale(-1,A.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(v,A){function n(v){T.call(this),this.type=T.types.BOX,this.halfExtents=v,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3"),C=v("./ConvexPolyhedron");n.prototype=new T,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var v=this.halfExtents.x,A=this.halfExtents.y,T=this.halfExtents.z,R=E,z=[new R(-v,-A,-T),new R(v,-A,-T),new R(v,A,-T),new R(-v,A,-T),new R(-v,-A,T),new R(v,-A,T),new R(v,A,T),new R(-v,A,T)],M=(new R(0,0,1),new R(0,1,0),new R(1,0,0),new C(z,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=M,M.material=this.material},n.prototype.calculateLocalInertia=function(v,A){return A=A||new E,n.calculateInertia(this.halfExtents,v,A),A},n.calculateInertia=function(v,A,T){var E=v;T.x=1/12*A*(2*E.y*2*E.y+2*E.z*2*E.z),T.y=1/12*A*(2*E.x*2*E.x+2*E.z*2*E.z),T.z=1/12*A*(2*E.y*2*E.y+2*E.x*2*E.x)},n.prototype.getSideNormals=function(v,A){var T=v,E=this.halfExtents;if(T[0].set(E.x,0,0),T[1].set(0,E.y,0),T[2].set(0,0,E.z),T[3].set(-E.x,0,0),T[4].set(0,-E.y,0),T[5].set(0,0,-E.z),void 0!==A)for(var C=0;C!==T.length;C++)A.vmult(T[C],T[C]);return T},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var R=new E;new E,n.prototype.forEachWorldCorner=function(v,A,T){for(var E=this.halfExtents,C=[[E.x,E.y,E.z],[-E.x,E.y,E.z],[-E.x,-E.y,E.z],[-E.x,-E.y,-E.z],[E.x,-E.y,-E.z],[E.x,E.y,-E.z],[-E.x,E.y,-E.z],[E.x,-E.y,E.z]],z=0;z<C.length;z++)R.set(C[z][0],C[z][1],C[z][2]),A.vmult(R,R),v.vadd(R,R),T(R.x,R.y,R.z)};var z=[new E,new E,new E,new E,new E,new E,new E,new E];n.prototype.calculateWorldAABB=function(v,A,T,E){var C=this.halfExtents;z[0].set(C.x,C.y,C.z),z[1].set(-C.x,C.y,C.z),z[2].set(-C.x,-C.y,C.z),z[3].set(-C.x,-C.y,-C.z),z[4].set(C.x,-C.y,-C.z),z[5].set(C.x,C.y,-C.z),z[6].set(-C.x,C.y,-C.z),z[7].set(C.x,-C.y,C.z);var R=z[0];A.vmult(R,R),v.vadd(R,R),E.copy(R),T.copy(R);for(var M=1;8>M;M++){R=z[M],A.vmult(R,R),v.vadd(R,R);var O=R.x,V=R.y,W=R.z;O>E.x&&(E.x=O),V>E.y&&(E.y=V),W>E.z&&(E.z=W),O<T.x&&(T.x=O),V<T.y&&(T.y=V),W<T.z&&(T.z=W)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(v,A){function n(v,A,E){T.call(this),this.type=T.types.CONVEXPOLYHEDRON,this.vertices=v||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=A||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=E?E.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3"),C=(v("../math/Quaternion"),v("../math/Transform"));n.prototype=new T,n.prototype.constructor=n;var R=new E;n.prototype.computeEdges=function(){var v=this.faces,A=this.vertices,T=(A.length,this.uniqueEdges);T.length=0;for(var E=R,C=0;C!==v.length;C++)for(var z=v[C],M=z.length,O=0;O!==M;O++){var V=(O+1)%M;A[z[O]].vsub(A[z[V]],E),E.normalize();for(var W=!1,j=0;j!==T.length;j++)if(T[j].almostEquals(E)||T[j].almostEquals(E)){W=!0;break}W||T.push(E.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var v=0;v<this.faces.length;v++){for(var A=0;A<this.faces[v].length;A++)if(!this.vertices[this.faces[v][A]])throw new Error("Vertex "+this.faces[v][A]+" not found!");var T=this.faceNormals[v]||new E;this.getFaceNormal(v,T),T.negate(T),this.faceNormals[v]=T;var C=this.vertices[this.faces[v][0]];if(T.dot(C)<0)for(console.error(".faceNormals["+v+"] = Vec3("+T.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),A=0;A<this.faces[v].length;A++)console.warn(".vertices["+this.faces[v][A]+"] = Vec3("+this.vertices[this.faces[v][A]].toString()+")")}};var z=new E,M=new E;n.computeNormal=function(v,A,T,E){A.vsub(v,M),T.vsub(A,z),z.cross(M,E),E.isZero()||E.normalize()},n.prototype.getFaceNormal=function(v,A){var T=this.faces[v],E=this.vertices[T[0]],C=this.vertices[T[1]],R=this.vertices[T[2]];return n.computeNormal(E,C,R,A)};var O=new E;n.prototype.clipAgainstHull=function(v,A,T,C,R,z,M,V,W){for(var j=O,H=-1,X=-Number.MAX_VALUE,Z=0;Z<T.faces.length;Z++){j.copy(T.faceNormals[Z]),R.vmult(j,j);var K=j.dot(z);K>X&&(X=K,H=Z)}for(var J=[],$=T.faces[H],et=$.length,nt=0;et>nt;nt++){var it=T.vertices[$[nt]],ot=new E;ot.copy(it),R.vmult(ot,ot),C.vadd(ot,ot),J.push(ot)}H>=0&&this.clipFaceAgainstHull(z,v,A,J,M,V,W)};var V=new E,W=new E,j=new E,H=new E,X=new E,Z=new E;n.prototype.findSeparatingAxis=function(v,A,T,E,C,R,z,M){var O=V,K=W,J=j,$=H,et=X,nt=Z,it=Number.MAX_VALUE,ot=this;if(ot.uniqueAxes)for(var rt=0;rt!==ot.uniqueAxes.length;rt++){if(T.vmult(ot.uniqueAxes[rt],O),!1===(ct=ot.testSepAxis(O,v,A,T,E,C)))return!1;it>ct&&(it=ct,R.copy(O))}else{var st=z?z.length:ot.faces.length;for(rt=0;st>rt;rt++){var at=z?z[rt]:rt;if(O.copy(ot.faceNormals[at]),T.vmult(O,O),!1===(ct=ot.testSepAxis(O,v,A,T,E,C)))return!1;it>ct&&(it=ct,R.copy(O))}}if(v.uniqueAxes)for(rt=0;rt!==v.uniqueAxes.length;rt++){if(C.vmult(v.uniqueAxes[rt],K),!1===(ct=ot.testSepAxis(K,v,A,T,E,C)))return!1;it>ct&&(it=ct,R.copy(K))}else{var lt=M?M.length:v.faces.length;for(rt=0;lt>rt;rt++){var ct;if(at=M?M[rt]:rt,K.copy(v.faceNormals[at]),C.vmult(K,K),!1===(ct=ot.testSepAxis(K,v,A,T,E,C)))return!1;it>ct&&(it=ct,R.copy(K))}}for(var ht=0;ht!==ot.uniqueEdges.length;ht++){T.vmult(ot.uniqueEdges[ht],$);for(var ut=0;ut!==v.uniqueEdges.length;ut++)if(C.vmult(v.uniqueEdges[ut],et),$.cross(et,nt),!nt.almostZero()){nt.normalize();var pt=ot.testSepAxis(nt,v,A,T,E,C);if(!1===pt)return!1;it>pt&&(it=pt,R.copy(nt))}}return E.vsub(A,J),J.dot(R)>0&&R.negate(R),!0};var K=[],J=[];n.prototype.testSepAxis=function(v,A,T,E,C,R){n.project(this,v,T,E,K),n.project(A,v,C,R,J);var z=K[0],M=K[1],O=J[0],V=J[1];if(V>z||M>O)return!1;var W=z-V,j=O-M;return j>W?W:j};var $=new E,et=new E;n.prototype.calculateLocalInertia=function(v,A){this.computeLocalAABB($,et);var T=et.x-$.x,E=et.y-$.y,C=et.z-$.z;A.x=1/12*v*(2*E*2*E+2*C*2*C),A.y=1/12*v*(2*T*2*T+2*C*2*C),A.z=1/12*v*(2*E*2*E+2*T*2*T)},n.prototype.getPlaneConstantOfFace=function(v){var A=this.faces[v],T=this.faceNormals[v],E=this.vertices[A[0]];return-T.dot(E)};var nt=new E,it=new E,ot=new E,rt=new E,st=new E,at=new E,lt=new E,ct=new E;n.prototype.clipFaceAgainstHull=function(v,A,T,E,C,R,z){for(var M=nt,O=it,V=ot,W=rt,j=st,H=at,X=lt,Z=ct,K=this,J=E,$=[],et=-1,ht=Number.MAX_VALUE,ut=0;ut<K.faces.length;ut++){M.copy(K.faceNormals[ut]),T.vmult(M,M);var pt=M.dot(v);ht>pt&&(ht=pt,et=ut)}if(!(0>et)){var dt=K.faces[et];dt.connectedFaces=[];for(var yt=0;yt<K.faces.length;yt++)for(var ft=0;ft<K.faces[yt].length;ft++)-1!==dt.indexOf(K.faces[yt][ft])&&yt!==et&&-1===dt.connectedFaces.indexOf(yt)&&dt.connectedFaces.push(yt);for(var gt=(J.length,dt.length),vt=0;gt>vt;vt++){var bt=K.vertices[dt[vt]],wt=K.vertices[dt[(vt+1)%gt]];bt.vsub(wt,O),V.copy(O),T.vmult(V,V),A.vadd(V,V),W.copy(this.faceNormals[et]),T.vmult(W,W),A.vadd(W,W),V.cross(W,j),j.negate(j),H.copy(bt),T.vmult(H,H),A.vadd(H,H);var xt=(H.dot(j),dt.connectedFaces[vt]);X.copy(this.faceNormals[xt]);var At=this.getPlaneConstantOfFace(xt);Z.copy(X),T.vmult(Z,Z);var Tt=At-Z.dot(A);for(this.clipFaceAgainstPlane(J,$,Z,Tt);J.length;)J.shift();for(;$.length;)J.push($.shift())}for(X.copy(this.faceNormals[et]),At=this.getPlaneConstantOfFace(et),Z.copy(X),T.vmult(Z,Z),Tt=At-Z.dot(A),yt=0;yt<J.length;yt++){var St=Z.dot(J[yt])+Tt;if(C>=St&&(console.log("clamped: depth="+St+" to minDist="+C),St=C),R>=St){var Ct=J[yt];if(0>=St){var It={point:Ct,normal:Z,depth:St};z.push(It)}}}}},n.prototype.clipFaceAgainstPlane=function(v,A,T,C){var R,z,M=v.length;if(2>M)return A;var O=v[v.length-1],V=v[0];R=T.dot(O)+C;for(var W=0;M>W;W++){if(V=v[W],z=T.dot(V)+C,0>R)if(0>z)(j=new E).copy(V),A.push(j);else{var j=new E;O.lerp(V,R/(R-z),j),A.push(j)}else 0>z&&(j=new E,O.lerp(V,R/(R-z),j),A.push(j),A.push(V));O=V,R=z}return A},n.prototype.computeWorldVertices=function(v,A){for(var T=this.vertices.length;this.worldVertices.length<T;)this.worldVertices.push(new E);for(var C=this.vertices,R=this.worldVertices,z=0;z!==T;z++)A.vmult(C[z],R[z]),v.vadd(R[z],R[z]);this.worldVerticesNeedsUpdate=!1},new E,n.prototype.computeLocalAABB=function(v,A){var T=this.vertices.length,E=this.vertices;v.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var C=0;T>C;C++){var R=E[C];R.x<v.x?v.x=R.x:R.x>A.x&&(A.x=R.x),R.y<v.y?v.y=R.y:R.y>A.y&&(A.y=R.y),R.z<v.z?v.z=R.z:R.z>A.z&&(A.z=R.z)}},n.prototype.computeWorldFaceNormals=function(v){for(var A=this.faceNormals.length;this.worldFaceNormals.length<A;)this.worldFaceNormals.push(new E);for(var T=this.faceNormals,C=this.worldFaceNormals,R=0;R!==A;R++)v.vmult(T[R],C[R]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var v=0,A=this.vertices,T=0,E=A.length;T!==E;T++){var C=A[T].norm2();C>v&&(v=C)}this.boundingSphereRadius=Math.sqrt(v)};var ht=new E;n.prototype.calculateWorldAABB=function(v,A,T,E){for(var C,R,z,M,O,V,W=this.vertices.length,j=this.vertices,H=0;W>H;H++){ht.copy(j[H]),A.vmult(ht,ht),v.vadd(ht,ht);var X=ht;X.x<C||void 0===C?C=X.x:(X.x>M||void 0===M)&&(M=X.x),X.y<R||void 0===R?R=X.y:(X.y>O||void 0===O)&&(O=X.y),X.z<z||void 0===z?z=X.z:(X.z>V||void 0===V)&&(V=X.z)}T.set(C,R,z),E.set(M,O,V)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(v){v=v||new E;for(var A=this.vertices.length,T=this.vertices,C=0;A>C;C++)v.vadd(T[C],v);return v.mult(1/A,v),v},n.prototype.transformAllPoints=function(v,A){var T=this.vertices.length,E=this.vertices;if(A){for(var C=0;T>C;C++){var R=E[C];A.vmult(R,R)}for(C=0;C<this.faceNormals.length;C++)R=this.faceNormals[C],A.vmult(R,R)}if(v)for(C=0;T>C;C++)(R=E[C]).vadd(v,R)};var ut=new E,pt=new E,dt=new E;n.prototype.pointIsInside=function(v){var A=this.vertices.length,T=this.vertices,E=this.faces,C=this.faceNormals,R=this.faces.length,z=ut;this.getAveragePointLocal(z);for(var M=0;R>M;M++){this.faces[M].length,A=C[M];var O=T[E[M][0]],V=pt;v.vsub(O,V);var W=A.dot(V),j=dt;z.vsub(O,j);var H=A.dot(j);if(0>W&&H>0||W>0&&0>H)return!1}return-1};var yt=(new E,new E),ft=new E;n.project=function(v,A,T,E,R){var z=v.vertices.length,M=yt,O=0,V=0,W=ft,j=v.vertices;W.setZero(),C.vectorToLocalFrame(T,E,A,M),C.pointToLocalFrame(T,E,W,W);var H=W.dot(M);V=O=j[0].dot(M);for(var X=1;z>X;X++){var Z=j[X].dot(M);Z>O&&(O=Z),V>Z&&(V=Z)}if((V-=H)>(O-=H)){var K=V;V=O,O=K}R[0]=O,R[1]=V}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(v,A){function n(v,A,R,z){var M=z,O=[],V=[],W=[],j=[],H=[],X=Math.cos,Z=Math.sin;O.push(new E(A*X(0),A*Z(0),.5*-R)),j.push(0),O.push(new E(v*X(0),v*Z(0),.5*R)),H.push(1);for(var K=0;M>K;K++){var J=2*Math.PI/M*(K+1),$=2*Math.PI/M*(K+.5);M-1>K?(O.push(new E(A*X(J),A*Z(J),.5*-R)),j.push(2*K+2),O.push(new E(v*X(J),v*Z(J),.5*R)),H.push(2*K+3),W.push([2*K+2,2*K+3,2*K+1,2*K])):W.push([0,1,2*K+1,2*K]),(M%2==1||M/2>K)&&V.push(new E(X($),Z($),0))}W.push(H),V.push(new E(0,0,1));var et=[];for(K=0;K<j.length;K++)et.push(j[j.length-K-1]);W.push(et),this.type=T.types.CONVEXPOLYHEDRON,C.call(this,O,W,V)}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3"),C=(v("../math/Quaternion"),v("./ConvexPolyhedron"));n.prototype=new C},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(v,A){function n(v,A){A=R.defaults(A,{maxValue:null,minValue:null,elementSize:1}),this.data=v,this.maxValue=A.maxValue,this.minValue=A.minValue,this.elementSize=A.elementSize,null===A.minValue&&this.updateMinValue(),null===A.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,T.call(this),this.pillarConvex=new E,this.pillarOffset=new C,this.type=T.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var T=v("./Shape"),E=v("./ConvexPolyhedron"),C=v("../math/Vec3"),R=v("../utils/Utils");A.exports=n,n.prototype=new T,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var v=this.data,A=v[0][0],T=0;T!==v.length;T++)for(var E=0;E!==v[T].length;E++){var C=v[T][E];A>C&&(A=C)}this.minValue=A},n.prototype.updateMaxValue=function(){for(var v=this.data,A=v[0][0],T=0;T!==v.length;T++)for(var E=0;E!==v[T].length;E++){var C=v[T][E];C>A&&(A=C)}this.maxValue=A},n.prototype.setHeightValueAtIndex=function(v,A,T){this.data[v][A]=T,this.clearCachedConvexTrianglePillar(v,A,!1),v>0&&(this.clearCachedConvexTrianglePillar(v-1,A,!0),this.clearCachedConvexTrianglePillar(v-1,A,!1)),A>0&&(this.clearCachedConvexTrianglePillar(v,A-1,!0),this.clearCachedConvexTrianglePillar(v,A-1,!1)),A>0&&v>0&&this.clearCachedConvexTrianglePillar(v-1,A-1,!0)},n.prototype.getRectMinMax=function(v,A,T,E,C){C=C||[];for(var R=this.data,z=this.minValue,M=v;T>=M;M++)for(var O=A;E>=O;O++){var V=R[M][O];V>z&&(z=V)}C[0]=this.minValue,C[1]=z},n.prototype.getIndexOfPosition=function(v,A,T,E){var C=this.elementSize,R=this.data,z=Math.floor(v/C),M=Math.floor(A/C);return T[0]=z,T[1]=M,E&&(0>z&&(z=0),0>M&&(M=0),z>=R.length-1&&(z=R.length-1),M>=R[0].length-1&&(M=R[0].length-1)),!(0>z||0>M||z>=R.length-1||M>=R[0].length-1)},n.prototype.getHeightAt=function(v,A,T){var E=[];this.getIndexOfPosition(v,A,E,T);var C=[];return this.getRectMinMax(E[0],E[1]+1,E[0],E[1]+1,C),(C[0]+C[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(v,A,T){return v+"_"+A+"_"+(T?1:0)},n.prototype.getCachedConvexTrianglePillar=function(v,A,T){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,T)]},n.prototype.setCachedConvexTrianglePillar=function(v,A,T,E,C){this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,T)]={convex:E,offset:C}},n.prototype.clearCachedConvexTrianglePillar=function(v,A,T){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(v,A,T)]},n.prototype.getConvexTrianglePillar=function(v,A,T){var R=this.pillarConvex,z=this.pillarOffset;if(this.cacheEnabled){if(M=this.getCachedConvexTrianglePillar(v,A,T))return this.pillarConvex=M.convex,void(this.pillarOffset=M.offset);R=new E,z=new C,this.pillarConvex=R,this.pillarOffset=z}var M=this.data,O=this.elementSize,V=R.faces;R.vertices.length=6;for(var W=0;6>W;W++)R.vertices[W]||(R.vertices[W]=new C);for(V.length=5,W=0;5>W;W++)V[W]||(V[W]=[]);var j=R.vertices,H=(Math.min(M[v][A],M[v+1][A],M[v][A+1],M[v+1][A+1])-this.minValue)/2+this.minValue;T?(z.set((v+.75)*O,(A+.75)*O,H),j[0].set(.25*O,.25*O,M[v+1][A+1]-H),j[1].set(-.75*O,.25*O,M[v][A+1]-H),j[2].set(.25*O,-.75*O,M[v+1][A]-H),j[3].set(.25*O,.25*O,-H-1),j[4].set(-.75*O,.25*O,-H-1),j[5].set(.25*O,-.75*O,-H-1),V[0][0]=0,V[0][1]=1,V[0][2]=2,V[1][0]=5,V[1][1]=4,V[1][2]=3,V[2][0]=2,V[2][1]=5,V[2][2]=3,V[2][3]=0,V[3][0]=3,V[3][1]=4,V[3][2]=1,V[3][3]=0,V[4][0]=1,V[4][1]=4,V[4][2]=5,V[4][3]=2):(z.set((v+.25)*O,(A+.25)*O,H),j[0].set(-.25*O,-.25*O,M[v][A]-H),j[1].set(.75*O,-.25*O,M[v+1][A]-H),j[2].set(-.25*O,.75*O,M[v][A+1]-H),j[3].set(-.25*O,-.25*O,-H-1),j[4].set(.75*O,-.25*O,-H-1),j[5].set(-.25*O,.75*O,-H-1),V[0][0]=0,V[0][1]=1,V[0][2]=2,V[1][0]=5,V[1][1]=4,V[1][2]=3,V[2][0]=0,V[2][1]=2,V[2][2]=5,V[2][3]=3,V[3][0]=1,V[3][1]=0,V[3][2]=3,V[3][3]=4,V[4][0]=4,V[4][1]=5,V[4][2]=2,V[4][3]=1),R.computeNormals(),R.computeEdges(),R.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(v,A,T,R,z)},n.prototype.calculateLocalInertia=function(v,A){return(A=A||new C).set(0,0,0),A},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(v,A,T,E){T.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),E.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var v=this.data,A=this.elementSize;this.boundingSphereRadius=new C(v.length*A,v[0].length*A,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(v,A){function n(){T.call(this),this.type=T.types.PARTICLE}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3");n.prototype=new T,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(v,A){return(A=A||new E).set(0,0,0),A},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(v,A,T,E){T.copy(v),E.copy(v)}},{"../math/Vec3":30,"./Shape":43}],42:[function(v,A){function n(){T.call(this),this.type=T.types.PLANE,this.worldNormal=new E,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3");n.prototype=new T,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(v){var A=this.worldNormal;A.set(0,0,1),v.vmult(A,A),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(v,A){return A||new E},n.prototype.volume=function(){return Number.MAX_VALUE};var C=new E;n.prototype.calculateWorldAABB=function(v,A,T,E){C.set(0,0,1),A.vmult(C,C);var R=Number.MAX_VALUE;T.set(-R,-R,-R),E.set(R,R,R),1===C.x&&(E.x=v.x),1===C.y&&(E.y=v.y),1===C.z&&(E.z=v.z),-1===C.x&&(T.x=v.x),-1===C.y&&(T.y=v.y),-1===C.z&&(T.z=v.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(v,A){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}A.exports=n;var n=v("./Shape");v("../math/Vec3"),v("../math/Quaternion"),v("../material/Material"),n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(v,A){function n(v){if(T.call(this),this.radius=void 0!==v?Number(v):1,this.type=T.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3");n.prototype=new T,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(v,A){A=A||new E;var T=2*v*this.radius*this.radius/5;return A.x=T,A.y=T,A.z=T,A},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(v,A,T,E){for(var C=this.radius,R=["x","y","z"],z=0;z<R.length;z++){var M=R[z];T[M]=v[M]-C,E[M]=v[M]+C}}},{"../math/Vec3":30,"./Shape":43}],45:[function(v,A){function n(v,A){T.call(this),this.type=T.types.TRIMESH,this.vertices=new Float32Array(v),this.indices=new Int16Array(A),this.normals=new Float32Array(A.length),this.aabb=new R,this.edges=null,this.scale=new E(1,1,1),this.tree=new z,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}A.exports=n;var T=v("./Shape"),E=v("../math/Vec3"),C=(v("../math/Quaternion"),v("../math/Transform")),R=v("../collision/AABB"),z=v("../utils/Octree");n.prototype=new T,n.prototype.constructor=n;var M=new E;n.prototype.updateTree=function(){var v=this.tree;v.reset(),v.aabb.copy(this.aabb);var A=this.scale;v.aabb.lowerBound.x*=1/A.x,v.aabb.lowerBound.y*=1/A.y,v.aabb.lowerBound.z*=1/A.z,v.aabb.upperBound.x*=1/A.x,v.aabb.upperBound.y*=1/A.y,v.aabb.upperBound.z*=1/A.z;for(var T=new R,C=new E,z=new E,M=new E,O=[C,z,M],V=0;V<this.indices.length/3;V++){var W=3*V;this._getUnscaledVertex(this.indices[W],C),this._getUnscaledVertex(this.indices[W+1],z),this._getUnscaledVertex(this.indices[W+2],M),T.setFromPoints(O),v.insert(T,V)}v.removeEmptyNodes()};var O=new R;n.prototype.getTrianglesInAABB=function(v,A){O.copy(v);var T=this.scale,E=T.x,C=T.y,R=T.z,z=O.lowerBound,M=O.upperBound;return z.x/=E,z.y/=C,z.z/=R,M.x/=E,M.y/=C,M.z/=R,this.tree.aabbQuery(O,A)},n.prototype.setScale=function(v){var A=this.scale.x===this.scale.y===this.scale.z,T=v.x===v.y===v.z;A&&T||this.updateNormals(),this.scale.copy(v),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var v=M,A=this.normals,T=0;T<this.indices.length/3;T++){var E=3*T,C=this.indices[E],R=this.indices[E+1],z=this.indices[E+2];this.getVertex(C,X),this.getVertex(R,Z),this.getVertex(z,K),n.computeNormal(Z,X,K,v),A[E]=v.x,A[E+1]=v.y,A[E+2]=v.z}},n.prototype.updateEdges=function(){for(var v={},f=function(){v[C>E?E+"_"+C:C+"_"+E]=!0},A=0;A<this.indices.length/3;A++){var T=3*A,E=this.indices[T],C=this.indices[T+1];this.indices[T+2],f(),f(),f()}var R=Object.keys(v);for(this.edges=new Int16Array(2*R.length),A=0;A<R.length;A++){var z=R[A].split("_");this.edges[2*A]=parseInt(z[0],10),this.edges[2*A+1]=parseInt(z[1],10)}},n.prototype.getEdgeVertex=function(v,A,T){var E=this.edges[2*v+(A?1:0)];this.getVertex(E,T)};var V=new E,W=new E;n.prototype.getEdgeVector=function(v,A){var T=V,E=W;this.getEdgeVertex(v,0,T),this.getEdgeVertex(v,1,E),E.vsub(T,A)};var j=new E,H=new E;n.computeNormal=function(v,A,T,E){A.vsub(v,H),T.vsub(A,j),j.cross(H,E),E.isZero()||E.normalize()};var X=new E,Z=new E,K=new E;n.prototype.getVertex=function(v,A){var T=this.scale;return this._getUnscaledVertex(v,A),A.x*=T.x,A.y*=T.y,A.z*=T.z,A},n.prototype._getUnscaledVertex=function(v,A){var T=3*v,E=this.vertices;return A.set(E[T],E[T+1],E[T+2])},n.prototype.getWorldVertex=function(v,A,T,E){return this.getVertex(v,E),C.pointToWorldFrame(A,T,E,E),E},n.prototype.getTriangleVertices=function(v,A,T,E){var C=3*v;this.getVertex(this.indices[C],A),this.getVertex(this.indices[C+1],T),this.getVertex(this.indices[C+2],E)},n.prototype.getNormal=function(v,A){var T=3*v;return A.set(this.normals[T],this.normals[T+1],this.normals[T+2])};var J=new R;n.prototype.calculateLocalInertia=function(v,A){this.computeLocalAABB(J);var T=J.upperBound.x-J.lowerBound.x,E=J.upperBound.y-J.lowerBound.y,C=J.upperBound.z-J.lowerBound.z;return A.set(1/12*v*(2*E*2*E+2*C*2*C),1/12*v*(2*T*2*T+2*C*2*C),1/12*v*(2*E*2*E+2*T*2*T))};var $=new E;n.prototype.computeLocalAABB=function(v){var A=v.lowerBound,T=v.upperBound,E=this.vertices.length,C=(this.vertices,$);this.getVertex(0,C),A.copy(C),T.copy(C);for(var R=0;R!==E;R++)this.getVertex(R,C),C.x<A.x?A.x=C.x:C.x>T.x&&(T.x=C.x),C.y<A.y?A.y=C.y:C.y>T.y&&(T.y=C.y),C.z<A.z?A.z=C.z:C.z>T.z&&(T.z=C.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var v=0,A=this.vertices,T=new E,C=0,R=A.length/3;C!==R;C++){this.getVertex(C,T);var z=T.norm2();z>v&&(v=z)}this.boundingSphereRadius=Math.sqrt(v)};var et=(new E,new C),nt=new R;n.prototype.calculateWorldAABB=function(v,A,T,E){var C=et,R=nt;C.position=v,C.quaternion=A,this.aabb.toWorldFrame(C,R),T.copy(R.lowerBound),E.copy(R.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(v,A,T,E,C){v=v||1,A=A||.5,T=T||8,E=E||6,C=C||2*Math.PI;for(var R=[],z=[],M=0;T>=M;M++)for(var O=0;E>=O;O++){var V=O/E*C,W=M/T*Math.PI*2,j=(v+A*Math.cos(W))*Math.cos(V),H=(v+A*Math.cos(W))*Math.sin(V),X=A*Math.sin(W);R.push(j,H,X)}for(M=1;T>=M;M++)for(O=1;E>=O;O++){var Z=(E+1)*M+O-1,K=(E+1)*(M-1)+O-1,J=(E+1)*(M-1)+O,$=(E+1)*M+O;z.push(Z,K,$),z.push(K,J,$)}return new n(R,z)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(v,A){function n(){T.call(this),this.iterations=10,this.tolerance=1e-7}A.exports=n;var T=(v("../math/Vec3"),v("../math/Quaternion"),v("./Solver"));n.prototype=new T;var E=[],C=[],R=[];n.prototype.solve=function(v,A){var T,z,M,O,V,W=0,j=this.iterations,H=this.tolerance*this.tolerance,X=this.equations,Z=X.length,K=A.bodies,J=K.length,$=v;if(0!==Z)for(var et=0;et!==J;et++)K[et].updateSolveMassProperties();var nt=C,it=R,ot=E;for(nt.length=Z,it.length=Z,ot.length=Z,et=0;et!==Z;et++){var rt=X[et];ot[et]=0,it[et]=rt.computeB($),nt[et]=1/rt.computeC()}if(0!==Z){for(et=0;et!==J;et++){var st=(ct=K[et]).vlambda,at=ct.wlambda;st.set(0,0,0),at&&at.set(0,0,0)}for(W=0;W!==j;W++){O=0;for(var lt=0;lt!==Z;lt++)rt=X[lt],T=it[lt],z=nt[lt],(V=ot[lt])+(M=z*(T-rt.computeGWlambda()-rt.eps*V))<rt.minForce?M=rt.minForce-V:V+M>rt.maxForce&&(M=rt.maxForce-V),ot[lt]+=M,O+=M>0?M:-M,rt.addToWlambda(M);if(H>O*O)break}for(et=0;et!==J;et++){var ct,ht=(ct=K[et]).velocity,ut=ct.angularVelocity;ht.vadd(ct.vlambda,ht),ut&&ut.vadd(ct.wlambda,ut)}}return W}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(v,A){function n(){this.equations=[]}A.exports=n,n.prototype.solve=function(){return 0},n.prototype.addEquation=function(v){v.enabled&&this.equations.push(v)},n.prototype.removeEquation=function(v){var A=this.equations,T=A.indexOf(v);-1!==T&&A.splice(T,1)},n.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(v,A){function n(v){for(T.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=v,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function o(v){for(var A=v.length,T=0;T!==A;T++){var E=v[T];if(!(E.visited||E.body.type&M))return E}return!1}function d(v,A,T,E){for(O.push(v),v.visited=!0,A(v,T,E);O.length;)for(var C,R=O.pop();C=o(R.children);)C.visited=!0,A(C,T,E),O.push(C)}function i(v,A,T){A.push(v.body);for(var E=v.eqs.length,C=0;C!==E;C++){var R=v.eqs[C];-1===T.indexOf(R)&&T.push(R)}}function t(v,A){return A.id-v.id}A.exports=n;var T=(v("../math/Vec3"),v("../math/Quaternion"),v("./Solver")),E=v("../objects/Body");n.prototype=new T;var C=[],R=[],z={bodies:[]},M=E.STATIC,O=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(v,A){for(var T=C,E=this.nodePool,M=A.bodies,O=this.equations,V=O.length,W=M.length,j=this.subsolver;E.length<W;)E.push(this.createNode());T.length=W;for(var H=0;W>H;H++)T[H]=E[H];for(H=0;H!==W;H++){var X=T[H];X.body=M[H],X.children.length=0,X.eqs.length=0,X.visited=!1}for(var Z=0;Z!==V;Z++){var K=O[Z],J=(H=M.indexOf(K.bi),M.indexOf(K.bj)),$=T[H],et=T[J];$.children.push(et),$.eqs.push(K),et.children.push($),et.eqs.push(K)}var nt,it=0,ot=R;j.tolerance=this.tolerance,j.iterations=this.iterations;for(var rt=z;nt=o(T);){ot.length=0,rt.bodies.length=0,d(nt,i,rt.bodies,ot);var st=ot.length;for(ot=ot.sort(t),H=0;H!==st;H++)j.addEquation(ot[H]);j.solve(v,rt),j.removeAllEquations(),it++}return it}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(v,A){var n=function(){};A.exports=n,n.prototype={constructor:n,addEventListener:function(v,A){void 0===this._listeners&&(this._listeners={});var T=this._listeners;return void 0===T[v]&&(T[v]=[]),-1===T[v].indexOf(A)&&T[v].push(A),this},hasEventListener:function(v,A){if(void 0===this._listeners)return!1;var T=this._listeners;return void 0!==T[v]&&-1!==T[v].indexOf(A)},removeEventListener:function(v,A){if(void 0===this._listeners)return this;var T=this._listeners;if(void 0===T[v])return this;var E=T[v].indexOf(A);return-1!==E&&T[v].splice(E,1),this},dispatchEvent:function(v){if(void 0===this._listeners)return this;var A=this._listeners[v.type];if(void 0!==A){v.target=this;for(var T=0,E=A.length;E>T;T++)A[T].call(this,v)}return this}}},{}],50:[function(v,A){function n(v){v=v||{},this.root=v.root||null,this.aabb=v.aabb?v.aabb.clone():new T,this.data=[],this.children=[]}function o(v,A){(A=A||{}).root=null,A.aabb=v,n.call(this,A),this.maxDepth=void 0!==A.maxDepth?A.maxDepth:8}var T=v("../collision/AABB"),E=v("../math/Vec3");A.exports=o,o.prototype=new n,n.prototype.reset=function(){this.children.length=this.data.length=0},n.prototype.insert=function(v,A,T){var E=this.data;if(T=T||0,!this.aabb.contains(v))return!1;var C=this.children;if(T<(this.maxDepth||this.root.maxDepth)){var R=!1;C.length||(this.subdivide(),R=!0);for(var z=0;8!==z;z++)if(C[z].insert(v,A,T+1))return!0;R&&(C.length=0)}return E.push(A),!0};var C=new E;n.prototype.subdivide=function(){var v=this.aabb,A=v.lowerBound,R=v.upperBound,z=this.children;z.push(new n({aabb:new T({lowerBound:new E(0,0,0)})}),new n({aabb:new T({lowerBound:new E(1,0,0)})}),new n({aabb:new T({lowerBound:new E(1,1,0)})}),new n({aabb:new T({lowerBound:new E(1,1,1)})}),new n({aabb:new T({lowerBound:new E(0,1,1)})}),new n({aabb:new T({lowerBound:new E(0,0,1)})}),new n({aabb:new T({lowerBound:new E(1,0,1)})}),new n({aabb:new T({lowerBound:new E(0,1,0)})})),R.vsub(A,C),C.scale(.5,C);for(var M=this.root||this,O=0;8!==O;O++){var V=z[O];V.root=M;var W=V.aabb.lowerBound;W.x*=C.x,W.y*=C.y,W.z*=C.z,W.vadd(A,W),W.vadd(C,V.aabb.upperBound)}},n.prototype.aabbQuery=function(v,A){for(var T=(this.data,this.children,[this]);T.length;){var E=T.pop();E.aabb.overlaps(v)&&Array.prototype.push.apply(A,E.data),Array.prototype.push.apply(T,E.children)}return A};var R=new T;n.prototype.rayQuery=function(v,A,T){return v.getAABB(R),R.toLocalFrame(A,R),this.aabbQuery(R,T),T},n.prototype.removeEmptyNodes=function(){for(var v=[this];v.length;){for(var A=v.pop(),T=A.children.length-1;T>=0;T--)A.children[T].data.length||A.children.splice(T,1);Array.prototype.push.apply(v,A.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(v,A){function n(){this.objects=[],this.type=Object}A.exports=n,n.prototype.release=function(){for(var v=arguments.length,A=0;A!==v;A++)this.objects.push(arguments[A])},n.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},n.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(v,A){function n(){this.data={keys:[]}}A.exports=n,n.prototype.get=function(v,A){if(v>A){var T=A;A=v,v=T}return this.data[v+"-"+A]},n.prototype.set=function(v,A,T){if(v>A){var E=A;A=v,v=E}var C=v+"-"+A;this.get(v,A)||this.data.keys.push(C),this.data[C]=T},n.prototype.reset=function(){for(var v=this.data,A=v.keys;A.length>0;)delete v[A.pop()]}},{}],53:[function(v,A){function n(){}A.exports=n,n.defaults=function(v,A){for(var T in v=v||{},A)T in v||(v[T]=A[T]);return v}},{}],54:[function(v,A){function n(){E.call(this),this.type=T}A.exports=n;var T=v("../math/Vec3"),E=v("./Pool");n.prototype=new E,n.prototype.constructObject=function(){return new T}},{"../math/Vec3":30,"./Pool":51}],55:[function(v,A){function n(v){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new O,this.world=v,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function o(v,A,T){for(var E=null,C=v.length,R=0;R!==C;R++){var z=v[R],M=At;v[(R+1)%C].vsub(z,M);var O=Tt;M.cross(A,O);var V=St;T.vsub(z,V);var W=O.dot(V);if(!(null===E||W>0&&!0===E||0>=W&&!1===E))return!1;null===E&&(E=W>0)}return!0}A.exports=n;var T=v("../collision/AABB"),E=v("../shapes/Shape"),C=v("../collision/Ray"),R=v("../math/Vec3"),z=v("../math/Transform"),M=(v("../shapes/ConvexPolyhedron"),v("../math/Quaternion")),O=(v("../solver/Solver"),v("../utils/Vec3Pool")),V=v("../equations/ContactEquation"),W=v("../equations/FrictionEquation");n.prototype.createContactEquation=function(v,A,T,E,C,R){var z;this.contactPointPool.length?((z=this.contactPointPool.pop()).bi=v,z.bj=A):z=new V(v,A),z.enabled=v.collisionResponse&&A.collisionResponse&&T.collisionResponse&&E.collisionResponse;var M=this.currentContactMaterial;z.restitution=M.restitution,z.setSpookParams(M.contactEquationStiffness,M.contactEquationRelaxation,this.world.dt);var O=T.material||v.material,W=E.material||A.material;return O&&W&&O.restitution>=0&&W.restitution>=0&&(z.restitution=O.restitution*W.restitution),z.si=C||T,z.sj=R||E,z},n.prototype.createFrictionEquationsFromContact=function(v,A){var T=v.bi,E=v.bj,C=v.si,R=v.sj,z=this.world,M=this.currentContactMaterial,O=M.friction,V=C.material||T.material,j=R.material||E.material;if(V&&j&&V.friction>=0&&j.friction>=0&&(O=V.friction*j.friction),O>0){var H=O*z.gravity.length(),X=T.invMass+E.invMass;X>0&&(X=1/X);var Z=this.frictionEquationPool,K=Z.length?Z.pop():new W(T,E,H*X),J=Z.length?Z.pop():new W(T,E,H*X);return K.bi=J.bi=T,K.bj=J.bj=E,K.minForce=J.minForce=-H*X,K.maxForce=J.maxForce=H*X,K.ri.copy(v.ri),K.rj.copy(v.rj),J.ri.copy(v.ri),J.rj.copy(v.rj),v.ni.tangents(K.t,J.t),K.setSpookParams(M.frictionEquationStiffness,M.frictionEquationRelaxation,z.dt),J.setSpookParams(M.frictionEquationStiffness,M.frictionEquationRelaxation,z.dt),K.enabled=J.enabled=v.enabled,A.push(K,J),!0}return!1};var j=new R,H=new R,X=new R;n.prototype.createFrictionFromAverage=function(v){var A=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(A,this.frictionResult)&&1!==v){var T=this.frictionResult[this.frictionResult.length-2],E=this.frictionResult[this.frictionResult.length-1];j.setZero(),H.setZero(),X.setZero();for(var C=A.bi,R=(A.bj,0);R!==v;R++)(A=this.result[this.result.length-1-R]).bodyA!==C?(j.vadd(A.ni,j),H.vadd(A.ri,H),X.vadd(A.rj,X)):(j.vsub(A.ni,j),H.vadd(A.rj,H),X.vadd(A.ri,X));var z=1/v;H.scale(z,T.ri),X.scale(z,T.rj),E.ri.copy(T.ri),E.rj.copy(T.rj),j.normalize(),j.tangents(T.t,E.t)}};var Z=new R,K=new R,J=new M,$=new M;n.prototype.getContacts=function(v,A,T,E,C,R,z){this.contactPointPool=C,this.frictionEquationPool=z,this.result=E,this.frictionResult=R;for(var M=J,O=$,V=Z,W=K,j=0,H=v.length;j!==H;j++){var X=v[j],et=A[j],nt=null;X.material&&et.material&&(nt=T.getContactMaterial(X.material,et.material)||null);for(var it=0;it<X.shapes.length;it++){X.quaternion.mult(X.shapeOrientations[it],M),X.quaternion.vmult(X.shapeOffsets[it],V),V.vadd(X.position,V);for(var ot=X.shapes[it],rt=0;rt<et.shapes.length;rt++){et.quaternion.mult(et.shapeOrientations[rt],O),et.quaternion.vmult(et.shapeOffsets[rt],W),W.vadd(et.position,W);var st=et.shapes[rt];if(!(V.distanceTo(W)>ot.boundingSphereRadius+st.boundingSphereRadius)){var at=null;ot.material&&st.material&&(at=T.getContactMaterial(ot.material,st.material)||null),this.currentContactMaterial=at||nt||T.defaultContactMaterial;var lt=this[ot.type|st.type];lt&&(ot.type<st.type?lt.call(this,ot,st,V,W,M,O,X,et,ot,st):lt.call(this,st,ot,W,V,O,M,et,X,ot,st))}}}}},n.prototype[E.types.BOX|E.types.BOX]=n.prototype.boxBox=function(v,A,T,E,C,R,z,M){v.convexPolyhedronRepresentation.material=v.material,A.convexPolyhedronRepresentation.material=A.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexConvex(v.convexPolyhedronRepresentation,A.convexPolyhedronRepresentation,T,E,C,R,z,M,v,A)},n.prototype[E.types.BOX|E.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(v,A,T,E,C,R,z,M){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexConvex(v.convexPolyhedronRepresentation,A,T,E,C,R,z,M,v,A)},n.prototype[E.types.BOX|E.types.PARTICLE]=n.prototype.boxParticle=function(v,A,T,E,C,R,z,M){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexParticle(v.convexPolyhedronRepresentation,A,T,E,C,R,z,M,v,A)},n.prototype[E.types.SPHERE]=n.prototype.sphereSphere=function(v,A,T,E,C,R,z,M){var O=this.createContactEquation(z,M,v,A);E.vsub(T,O.ni),O.ni.normalize(),O.ri.copy(O.ni),O.rj.copy(O.ni),O.ri.mult(v.radius,O.ri),O.rj.mult(-A.radius,O.rj),O.ri.vadd(T,O.ri),O.ri.vsub(z.position,O.ri),O.rj.vadd(E,O.rj),O.rj.vsub(M.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)};var et=new R,nt=new R,it=new R;n.prototype[E.types.PLANE|E.types.TRIMESH]=n.prototype.planeTrimesh=function(v,A,T,E,C,M,O,V){var W=new R,j=et;j.set(0,0,1),C.vmult(j,j);for(var H=0;H<A.vertices.length/3;H++){A.getVertex(H,W);var X=new R;X.copy(W),z.pointToWorldFrame(E,M,X,W);var Z=nt;if(W.vsub(T,Z),0>=j.dot(Z)){var K=this.createContactEquation(O,V,v,A);K.ni.copy(j);var J=it;j.scale(Z.dot(j),J),W.vsub(J,J),K.ri.copy(J),K.ri.vsub(O.position,K.ri),K.rj.copy(W),K.rj.vsub(V.position,K.rj),this.result.push(K),this.createFrictionEquationsFromContact(K,this.frictionResult)}}};var ot=new R,rt=new R,st=(new R,new R),at=new R,lt=new R,ct=new R,ht=new R,ut=new R,pt=new R,dt=new R,yt=new R,ft=new R,gt=new R,vt=new T,bt=[];n.prototype[E.types.SPHERE|E.types.TRIMESH]=n.prototype.sphereTrimesh=function(v,A,T,E,R,M,O,V){var W=lt,j=ct,H=ht,X=ut,Z=pt,K=dt,J=vt,$=at,et=rt,nt=bt;z.pointToLocalFrame(E,M,T,Z);var it=v.radius;J.lowerBound.set(Z.x-it,Z.y-it,Z.z-it),J.upperBound.set(Z.x+it,Z.y+it,Z.z+it),A.getTrianglesInAABB(J,nt);for(var wt=st,xt=v.radius*v.radius,At=0;At<nt.length;At++)for(var Tt=0;3>Tt;Tt++)A.getVertex(A.indices[3*nt[At]+Tt],wt),wt.vsub(Z,et),et.norm2()<=xt&&($.copy(wt),z.pointToWorldFrame(E,M,$,wt),wt.vsub(T,et),(It=this.createContactEquation(O,V,v,A)).ni.copy(et),It.ni.normalize(),It.ri.copy(It.ni),It.ri.scale(v.radius,It.ri),It.ri.vadd(T,It.ri),It.ri.vsub(O.position,It.ri),It.rj.copy(wt),It.rj.vsub(V.position,It.rj),this.result.push(It),this.createFrictionEquationsFromContact(It,this.frictionResult));for(At=0;At<nt.length;At++)for(Tt=0;3>Tt;Tt++){A.getVertex(A.indices[3*nt[At]+Tt],W),A.getVertex(A.indices[3*nt[At]+(Tt+1)%3],j),j.vsub(W,H),Z.vsub(j,K);var St=K.dot(H);Z.vsub(W,K);var Ct=K.dot(H);if(Ct>0&&0>St&&(Z.vsub(W,K),X.copy(H),X.normalize(),Ct=K.dot(X),X.scale(Ct,K),K.vadd(W,K),(Ot=K.distanceTo(Z))<v.radius)){var It=this.createContactEquation(O,V,v,A);K.vsub(Z,It.ni),It.ni.normalize(),It.ni.scale(v.radius,It.ri),z.pointToWorldFrame(E,M,K,K),K.vsub(V.position,It.rj),z.vectorToWorldFrame(M,It.ni,It.ni),z.vectorToWorldFrame(M,It.ri,It.ri),this.result.push(It),this.createFrictionEquationsFromContact(It,this.frictionResult)}}for(var Rt=yt,_t=ft,Pt=gt,Bt=ot,zt=(At=0,nt.length);At!==zt;At++){A.getTriangleVertices(nt[At],Rt,_t,Pt),A.getNormal(nt[At],Bt),Z.vsub(Rt,K);var Ot=K.dot(Bt);Bt.scale(Ot,K),Z.vsub(K,K),Ot=K.distanceTo(Z),C.pointInTriangle(K,Rt,_t,Pt)&&Ot<v.radius&&(It=this.createContactEquation(O,V,v,A),K.vsub(Z,It.ni),It.ni.normalize(),It.ni.scale(v.radius,It.ri),z.pointToWorldFrame(E,M,K,K),K.vsub(V.position,It.rj),z.vectorToWorldFrame(M,It.ni,It.ni),z.vectorToWorldFrame(M,It.ri,It.ri),this.result.push(It),this.createFrictionEquationsFromContact(It,this.frictionResult))}nt.length=0};var wt=new R,xt=new R;n.prototype[E.types.SPHERE|E.types.PLANE]=n.prototype.spherePlane=function(v,A,T,E,C,R,z,M){var O=this.createContactEquation(z,M,v,A);if(O.ni.set(0,0,1),R.vmult(O.ni,O.ni),O.ni.negate(O.ni),O.ni.normalize(),O.ni.mult(v.radius,O.ri),T.vsub(E,wt),O.ni.mult(O.ni.dot(wt),xt),wt.vsub(xt,O.rj),-wt.dot(O.ni)<=v.radius){var V=O.ri,W=O.rj;V.vadd(T,V),V.vsub(z.position,V),W.vadd(E,W),W.vsub(M.position,W),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}};var At=new R,Tt=new R,St=new R,Ct=new R,It=new R,Rt=new R,_t=new R,Pt=[new R,new R,new R,new R,new R,new R],Bt=new R,zt=new R,Ot=new R,Nt=new R;n.prototype[E.types.SPHERE|E.types.BOX]=n.prototype.sphereBox=function(v,A,T,E,C,R,z,M){var O=this.v3pool,V=Pt;T.vsub(E,Ct),A.getSideNormals(V,R);for(var W=v.radius,j=!1,H=zt,X=Ot,Z=Nt,K=null,J=0,$=0,et=0,nt=null,it=0,ot=V.length;it!==ot&&!1===j;it++){var rt=It;rt.copy(V[it]);var st=rt.norm();rt.normalize();var at=Ct.dot(rt);if(st+W>at&&at>0){var lt=Rt,ct=_t;lt.copy(V[(it+1)%3]),ct.copy(V[(it+2)%3]);var ht=lt.norm(),ut=ct.norm();lt.normalize(),ct.normalize();var pt=Ct.dot(lt),dt=Ct.dot(ct);if(ht>pt&&pt>-ht&&ut>dt&&dt>-ut){var yt=Math.abs(at-st-W);(null===nt||nt>yt)&&(nt=yt,$=pt,et=dt,K=st,H.copy(rt),X.copy(lt),Z.copy(ct),J++)}}}if(J){j=!0;var ft=this.createContactEquation(z,M,v,A);H.mult(-W,ft.ri),ft.ni.copy(H),ft.ni.negate(ft.ni),H.mult(K,H),X.mult($,X),H.vadd(X,H),Z.mult(et,Z),H.vadd(Z,ft.rj),ft.ri.vadd(T,ft.ri),ft.ri.vsub(z.position,ft.ri),ft.rj.vadd(E,ft.rj),ft.rj.vsub(M.position,ft.rj),this.result.push(ft),this.createFrictionEquationsFromContact(ft,this.frictionResult)}for(var gt=O.get(),vt=Bt,bt=0;2!==bt&&!j;bt++)for(var wt=0;2!==wt&&!j;wt++)for(var xt=0;2!==xt&&!j;xt++)gt.set(0,0,0),bt?gt.vadd(V[0],gt):gt.vsub(V[0],gt),wt?gt.vadd(V[1],gt):gt.vsub(V[1],gt),xt?gt.vadd(V[2],gt):gt.vsub(V[2],gt),E.vadd(gt,vt),vt.vsub(T,vt),vt.norm2()<W*W&&(j=!0,(ft=this.createContactEquation(z,M,v,A)).ri.copy(vt),ft.ri.normalize(),ft.ni.copy(ft.ri),ft.ri.mult(W,ft.ri),ft.rj.copy(gt),ft.ri.vadd(T,ft.ri),ft.ri.vsub(z.position,ft.ri),ft.rj.vadd(E,ft.rj),ft.rj.vsub(M.position,ft.rj),this.result.push(ft),this.createFrictionEquationsFromContact(ft,this.frictionResult));O.release(gt),gt=null;var At=O.get(),Tt=O.get(),St=(ft=O.get(),O.get()),Lt=(yt=O.get(),V.length);for(bt=0;bt!==Lt&&!j;bt++)for(wt=0;wt!==Lt&&!j;wt++)if(bt%3!=wt%3){V[wt].cross(V[bt],At),At.normalize(),V[bt].vadd(V[wt],Tt),ft.copy(T),ft.vsub(Tt,ft),ft.vsub(E,ft);var Ft=ft.dot(At);for(At.mult(Ft,St),xt=0;xt===bt%3||xt===wt%3;)xt++;yt.copy(T),yt.vsub(St,yt),yt.vsub(Tt,yt),yt.vsub(E,yt);var kt=Math.abs(Ft),Vt=yt.norm();if(kt<V[xt].norm()&&W>Vt){j=!0;var qt=this.createContactEquation(z,M,v,A);Tt.vadd(St,qt.rj),qt.rj.copy(qt.rj),yt.negate(qt.ni),qt.ni.normalize(),qt.ri.copy(qt.rj),qt.ri.vadd(E,qt.ri),qt.ri.vsub(T,qt.ri),qt.ri.normalize(),qt.ri.mult(W,qt.ri),qt.ri.vadd(T,qt.ri),qt.ri.vsub(z.position,qt.ri),qt.rj.vadd(E,qt.rj),qt.rj.vsub(M.position,qt.rj),this.result.push(qt),this.createFrictionEquationsFromContact(qt,this.frictionResult)}}O.release(At,Tt,ft,St,yt)};var Lt=new R,Ft=new R,kt=new R,Vt=new R,qt=new R,Ut=new R,Wt=new R,Ht=new R,Gt=new R,Yt=new R;n.prototype[E.types.SPHERE|E.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(v,A,T,E,C,R,z,M){var O=this.v3pool;T.vsub(E,Lt);for(var V=A.faceNormals,W=A.faces,j=A.vertices,H=v.radius,X=0;X!==j.length;X++){var Z=j[X],K=qt;R.vmult(Z,K),E.vadd(K,K);var J=Vt;if(K.vsub(T,J),J.norm2()<H*H)return $=!0,(yt=this.createContactEquation(z,M,v,A)).ri.copy(J),yt.ri.normalize(),yt.ni.copy(yt.ri),yt.ri.mult(H,yt.ri),K.vsub(E,yt.rj),yt.ri.vadd(T,yt.ri),yt.ri.vsub(z.position,yt.ri),yt.rj.vadd(E,yt.rj),yt.rj.vsub(M.position,yt.rj),this.result.push(yt),void this.createFrictionEquationsFromContact(yt,this.frictionResult)}for(var $=!1,et=(X=0,W.length);X!==et&&!1===$;X++){var nt=V[X],it=W[X],ot=Ut;R.vmult(nt,ot);var rt=Wt;R.vmult(j[it[0]],rt),rt.vadd(E,rt);var st=Ht;ot.mult(-H,st),T.vadd(st,st);var at=Gt;st.vsub(rt,at);var lt=at.dot(ot),ct=Yt;if(T.vsub(rt,ct),0>lt&&ct.dot(ot)>0){for(var ht=[],ut=0,pt=it.length;ut!==pt;ut++){var dt=O.get();R.vmult(j[it[ut]],dt),E.vadd(dt,dt),ht.push(dt)}if(o(ht,ot,T)){$=!0;var yt=this.createContactEquation(z,M,v,A);ot.mult(-H,yt.ri),ot.negate(yt.ni);var ft=O.get();ot.mult(-lt,ft);var gt=O.get();ot.mult(-H,gt),T.vsub(E,yt.rj),yt.rj.vadd(gt,yt.rj),yt.rj.vadd(ft,yt.rj),yt.rj.vadd(E,yt.rj),yt.rj.vsub(M.position,yt.rj),yt.ri.vadd(T,yt.ri),yt.ri.vsub(z.position,yt.ri),O.release(ft),O.release(gt),this.result.push(yt),this.createFrictionEquationsFromContact(yt,this.frictionResult),ut=0;for(var vt=ht.length;ut!==vt;ut++)O.release(ht[ut]);return}for(ut=0;ut!==it.length;ut++){var bt=O.get(),wt=O.get();R.vmult(j[it[(ut+1)%it.length]],bt),R.vmult(j[it[(ut+2)%it.length]],wt),E.vadd(bt,bt),E.vadd(wt,wt);var xt=Ft;wt.vsub(bt,xt);var At=kt;xt.unit(At);var Tt=O.get(),St=O.get();T.vsub(bt,St);var Ct=St.dot(At);At.mult(Ct,Tt),Tt.vadd(bt,Tt);var It=O.get();if(Tt.vsub(T,It),Ct>0&&Ct*Ct<xt.norm2()&&It.norm2()<H*H){for(yt=this.createContactEquation(z,M,v,A),Tt.vsub(E,yt.rj),Tt.vsub(T,yt.ni),yt.ni.normalize(),yt.ni.mult(H,yt.ri),yt.rj.vadd(E,yt.rj),yt.rj.vsub(M.position,yt.rj),yt.ri.vadd(T,yt.ri),yt.ri.vsub(z.position,yt.ri),this.result.push(yt),this.createFrictionEquationsFromContact(yt,this.frictionResult),ut=0,vt=ht.length;ut!==vt;ut++)O.release(ht[ut]);return O.release(bt),O.release(wt),O.release(Tt),O.release(It),void O.release(St)}O.release(bt),O.release(wt),O.release(Tt),O.release(It),O.release(St)}for(ut=0,vt=ht.length;ut!==vt;ut++)O.release(ht[ut])}}},new R,new R,n.prototype[E.types.PLANE|E.types.BOX]=n.prototype.planeBox=function(v,A,T,E,C,R,z,M){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.planeConvex(v,A.convexPolyhedronRepresentation,T,E,C,R,z,M)};var Qt=new R,Zt=new R,Kt=new R,Jt=new R;n.prototype[E.types.PLANE|E.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(v,A,T,E,C,R,z,M){var O=Qt,V=Zt;V.set(0,0,1),C.vmult(V,V);for(var W=0,j=Kt,H=0;H!==A.vertices.length;H++)if(O.copy(A.vertices[H]),R.vmult(O,O),E.vadd(O,O),O.vsub(T,j),0>=V.dot(j)){var X=this.createContactEquation(z,M,v,A),Z=Jt;V.mult(V.dot(j),Z),O.vsub(Z,Z),Z.vsub(T,X.ri),X.ni.copy(V),O.vsub(E,X.rj),X.ri.vadd(T,X.ri),X.ri.vsub(z.position,X.ri),X.rj.vadd(E,X.rj),X.rj.vsub(M.position,X.rj),this.result.push(X),W++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(X,this.frictionResult)}this.enableFrictionReduction&&W&&this.createFrictionFromAverage(W)};var $t=new R,ee=new R;n.prototype[E.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(v,A,T,E,C,R,z,M,O,V,W,j){var H=$t;if(!(T.distanceTo(E)>v.boundingSphereRadius+A.boundingSphereRadius)&&v.findSeparatingAxis(A,T,C,E,R,H,W,j)){var X=[],Z=ee;v.clipAgainstHull(T,C,A,E,R,H,-100,100,X);for(var K=0,J=0;J!==X.length;J++){var $=this.createContactEquation(z,M,v,A,O,V),et=$.ri,nt=$.rj;H.negate($.ni),X[J].normal.negate(Z),Z.mult(X[J].depth,Z),X[J].point.vadd(Z,et),nt.copy(X[J].point),et.vsub(T,et),nt.vsub(E,nt),et.vadd(T,et),et.vsub(z.position,et),nt.vadd(E,nt),nt.vsub(M.position,nt),this.result.push($),K++,this.enableFrictionReduction||this.createFrictionEquationsFromContact($,this.frictionResult)}this.enableFrictionReduction&&K&&this.createFrictionFromAverage(K)}};var ne=new R,ie=new R,oe=new R;n.prototype[E.types.PLANE|E.types.PARTICLE]=n.prototype.planeParticle=function(v,A,T,E,C,R,z,M){var O=ne;O.set(0,0,1),z.quaternion.vmult(O,O);var V=ie;if(E.vsub(z.position,V),0>=O.dot(V)){var W=this.createContactEquation(M,z,A,v);W.ni.copy(O),W.ni.negate(W.ni),W.ri.set(0,0,0);var j=oe;O.mult(O.dot(E),j),E.vsub(j,j),W.rj.copy(j),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}};var se=new R;n.prototype[E.types.PARTICLE|E.types.SPHERE]=n.prototype.sphereParticle=function(v,A,T,E,C,R,z,M){var O=se;if(O.set(0,0,1),E.vsub(T,O),O.norm2()<=v.radius*v.radius){var V=this.createContactEquation(M,z,A,v);O.normalize(),V.rj.copy(O),V.rj.mult(v.radius,V.rj),V.ni.copy(O),V.ni.negate(V.ni),V.ri.set(0,0,0),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}};var ae=new M,le=new R,ce=(new R,new R),he=new R,ue=new R;n.prototype[E.types.PARTICLE|E.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(v,A,T,E,C,R,z,M){var O=-1,V=ce,W=ue,j=null,H=le;if(H.copy(E),H.vsub(T,H),C.conjugate(ae),ae.vmult(H,H),v.pointIsInside(H)){v.worldVerticesNeedsUpdate&&v.computeWorldVertices(T,C),v.worldFaceNormalsNeedsUpdate&&v.computeWorldFaceNormals(C);for(var X=0,Z=v.faces.length;X!==Z;X++){var K=[v.worldVertices[v.faces[X][0]]],J=v.worldFaceNormals[X];E.vsub(K[0],he);var $=-J.dot(he);(null===j||Math.abs($)<Math.abs(j))&&(j=$,O=X,V.copy(J))}if(-1!==O){var et=this.createContactEquation(M,z,A,v);V.mult(j,W),W.vadd(E,W),W.vsub(T,W),et.rj.copy(W),V.negate(et.ni),et.ri.set(0,0,0);var nt=et.ri,it=et.rj;nt.vadd(E,nt),nt.vsub(M.position,nt),it.vadd(T,it),it.vsub(z.position,it),this.result.push(et),this.createFrictionEquationsFromContact(et,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[E.types.BOX|E.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(v,A,T,E,C,R,z,M){v.convexPolyhedronRepresentation.material=v.material,v.convexPolyhedronRepresentation.collisionResponse=v.collisionResponse,this.convexHeightfield(v.convexPolyhedronRepresentation,A,T,E,C,R,z,M)};var de=new R,ye=new R,fe=[0];n.prototype[E.types.CONVEXPOLYHEDRON|E.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(v,A,T,E,C,R,M,O){var V=A.data,W=A.elementSize,j=v.boundingSphereRadius,H=ye,X=fe,Z=de;z.pointToLocalFrame(E,R,T,Z);var K=Math.floor((Z.x-j)/W)-1,J=Math.ceil((Z.x+j)/W)+1,$=Math.floor((Z.y-j)/W)-1,et=Math.ceil((Z.y+j)/W)+1;if(!(0>J||0>et||K>V.length||$>V[0].length)){0>K&&(K=0),0>J&&(J=0),0>$&&($=0),0>et&&(et=0),K>=V.length&&(K=V.length-1),J>=V.length&&(J=V.length-1),et>=V[0].length&&(et=V[0].length-1),$>=V[0].length&&($=V[0].length-1);var nt=[];A.getRectMinMax(K,$,J,et,nt);var it=nt[0],ot=nt[1];if(!(Z.z-j>ot||Z.z+j<it))for(var rt=K;J>rt;rt++)for(var st=$;et>st;st++)A.getConvexTrianglePillar(rt,st,!1),z.pointToWorldFrame(E,R,A.pillarOffset,H),T.distanceTo(H)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.convexConvex(v,A.pillarConvex,T,H,C,R,M,O,null,null,X,null),A.getConvexTrianglePillar(rt,st,!0),z.pointToWorldFrame(E,R,A.pillarOffset,H),T.distanceTo(H)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.convexConvex(v,A.pillarConvex,T,H,C,R,M,O,null,null,X,null)}};var me=new R,ve=new R;n.prototype[E.types.SPHERE|E.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(v,A,T,E,C,R,M,O){var V=A.data,W=v.radius,j=A.elementSize,H=ve,X=me;z.pointToLocalFrame(E,R,T,X);var Z=Math.floor((X.x-W)/j)-1,K=Math.ceil((X.x+W)/j)+1,J=Math.floor((X.y-W)/j)-1,$=Math.ceil((X.y+W)/j)+1;if(!(0>K||0>$||Z>V.length||$>V[0].length)){0>Z&&(Z=0),0>K&&(K=0),0>J&&(J=0),0>$&&($=0),Z>=V.length&&(Z=V.length-1),K>=V.length&&(K=V.length-1),$>=V[0].length&&($=V[0].length-1),J>=V[0].length&&(J=V[0].length-1);var et=[];A.getRectMinMax(Z,J,K,$,et);var nt=et[0],it=et[1];if(!(X.z-W>it||X.z+W<nt))for(var ot=this.result,rt=Z;K>rt;rt++)for(var st=J;$>st;st++){var at=ot.length;if(A.getConvexTrianglePillar(rt,st,!1),z.pointToWorldFrame(E,R,A.pillarOffset,H),T.distanceTo(H)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.sphereConvex(v,A.pillarConvex,T,H,C,R,M,O),A.getConvexTrianglePillar(rt,st,!0),z.pointToWorldFrame(E,R,A.pillarOffset,H),T.distanceTo(H)<A.pillarConvex.boundingSphereRadius+v.boundingSphereRadius&&this.sphereConvex(v,A.pillarConvex,T,H,C,R,M,O),ot.length-at>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(v,A){function n(){M.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new E,this.broadphase=new J,this.bodies=[],this.solver=new R,this.constraints=[],this.narrowphase=new z(this),this.collisionMatrix=new O,this.collisionMatrixPrevious=new O,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new H,this.defaultMaterial=new V("default"),this.defaultContactMaterial=new W(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}A.exports=n;var T=v("../shapes/Shape"),E=v("../math/Vec3"),C=v("../math/Quaternion"),R=v("../solver/GSSolver"),z=(v("../utils/Vec3Pool"),v("../equations/ContactEquation"),v("../equations/FrictionEquation"),v("./Narrowphase")),M=v("../utils/EventTarget"),O=v("../collision/ArrayCollisionMatrix"),V=v("../material/Material"),W=v("../material/ContactMaterial"),j=v("../objects/Body"),H=v("../utils/TupleDictionary"),X=v("../collision/RaycastResult"),Z=v("../collision/AABB"),K=v("../collision/Ray"),J=v("../collision/NaiveBroadphase");n.prototype=new M;var $=(new Z,new K);if(n.prototype.getContactMaterial=function(v,A){return this.contactMaterialTable.get(v.id,A.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var v=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=v,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(v){-1===this.bodies.indexOf(v)&&(v.index=this.bodies.length,this.bodies.push(v),v.world=this,v.initPosition.copy(v.position),v.initVelocity.copy(v.velocity),v.timeLastSleepy=this.time,v instanceof j&&(v.initAngularVelocity.copy(v.angularVelocity),v.initQuaternion.copy(v.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=v,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(v){this.constraints.push(v)},n.prototype.removeConstraint=function(v){var A=this.constraints.indexOf(v);-1!==A&&this.constraints.splice(A,1)},n.prototype.rayTest=function(v,A,T){T instanceof X?this.raycastClosest(v,A,{skipBackfaces:!0},T):this.raycastAll(v,A,{skipBackfaces:!0},T)},n.prototype.raycastAll=function(v,A,T,E){return T.mode=K.ALL,T.from=v,T.to=A,T.callback=E,$.intersectWorld(this,T)},n.prototype.raycastAny=function(v,A,T,E){return T.mode=K.ANY,T.from=v,T.to=A,T.result=E,$.intersectWorld(this,T)},n.prototype.raycastClosest=function(v,A,T,E){return T.mode=K.CLOSEST,T.from=v,T.to=A,T.result=E,$.intersectWorld(this,T)},n.prototype.remove=function(v){v.world=null;var A=this.bodies.length-1,T=this.bodies,E=T.indexOf(v);if(-1!==E){T.splice(E,1);for(var C=0;C!==T.length;C++)T[C].index=C;this.collisionMatrix.setNumObjects(A),this.removeBodyEvent.body=v,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(v){this.materials.push(v)},n.prototype.addContactMaterial=function(v){this.contactmaterials.push(v),this.contactMaterialTable.set(v.materials[0].id,v.materials[1].id,v)},"undefined"==typeof performance&&(performance={}),!performance.now){var et=Date.now();performance.timing&&performance.timing.navigationStart&&(et=performance.timing.navigationStart),performance.now=function(){return Date.now()-et}}var nt=new E;n.prototype.step=function(v,A,T){if(T=T||10,0===(A=A||0))this.internalStep(v),this.time+=v;else{var E=Math.floor((this.time+A)/v)-Math.floor(this.time/v);E=Math.min(E,T);for(var C=performance.now(),R=0;R!==E&&(this.internalStep(v),!(performance.now()-C>1e3*v));R++);this.time+=A;for(var z=this.time%v/v,M=nt,O=this.bodies,V=0;V!==O.length;V++){var W=O[V];W.type!==j.STATIC&&W.sleepState!==j.SLEEPING?(W.position.vsub(W.previousPosition,M),M.scale(z,M),W.position.vadd(M,W.interpolatedPosition)):(W.interpolatedPosition.copy(W.position),W.interpolatedQuaternion.copy(W.quaternion))}}};var it={type:"postStep"},ot={type:"preStep"},rt={type:"collide",body:null,contact:null},st=[],at=[],lt=[],ct=[],ht=(new E,new E,new E,new E,new E,new E,new E,new E,new E,new C,new C),ut=new C,pt=new E;n.prototype.internalStep=function(v){this.dt=v;var A,E=this.contacts,C=lt,R=ct,z=this.numObjects(),M=this.bodies,O=this.solver,V=this.gravity,W=this.doProfiling,H=this.profile,X=j.DYNAMIC,Z=this.constraints,K=at,J=(V.norm(),V.x),$=V.y,et=V.z,nt=0;for(W&&(A=performance.now()),nt=0;nt!==z;nt++)if((St=M[nt]).type&X){var dt=St.force,yt=St.mass;dt.x+=yt*J,dt.y+=yt*$,dt.z+=yt*et}nt=0;for(var ft=this.subsystems.length;nt!==ft;nt++)this.subsystems[nt].update();W&&(A=performance.now()),C.length=0,R.length=0,this.broadphase.collisionPairs(this,C,R),W&&(H.broadphase=performance.now()-A);var gt=Z.length;for(nt=0;nt!==gt;nt++)if(!(It=Z[nt]).collideConnected)for(var vt=C.length-1;vt>=0;vt-=1)(It.bodyA===C[vt]&&It.bodyB===R[vt]||It.bodyB===C[vt]&&It.bodyA===R[vt])&&(C.splice(vt,1),R.splice(vt,1));this.collisionMatrixTick(),W&&(A=performance.now());var bt=st,wt=E.length;for(nt=0;nt!==wt;nt++)bt.push(E[nt]);E.length=0;var xt=this.frictionEquations.length;for(nt=0;nt!==xt;nt++)K.push(this.frictionEquations[nt]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(C,R,this,E,bt,this.frictionEquations,K),W&&(H.narrowphase=performance.now()-A),W&&(A=performance.now()),nt=0;nt<this.frictionEquations.length;nt++)O.addEquation(this.frictionEquations[nt]);for(var At=E.length,Tt=0;Tt!==At;Tt++){var St=(It=E[Tt]).bi,Ct=It.bj;It.si,It.sj,(St.material&&Ct.material&&this.getContactMaterial(St.material,Ct.material)||this.defaultContactMaterial).friction,St.material&&Ct.material&&(St.material.friction>=0&&Ct.material.friction>=0&&(St.material.friction,Ct.material.friction),St.material.restitution>=0&&Ct.material.restitution>=0&&(It.restitution=St.material.restitution*Ct.material.restitution)),O.addEquation(It),St.allowSleep&&St.type===j.DYNAMIC&&St.sleepState===j.SLEEPING&&Ct.sleepState===j.AWAKE&&Ct.type!==j.STATIC&&Ct.velocity.norm2()+Ct.angularVelocity.norm2()>=2*Math.pow(Ct.sleepSpeedLimit,2)&&(St._wakeUpAfterNarrowphase=!0),Ct.allowSleep&&Ct.type===j.DYNAMIC&&Ct.sleepState===j.SLEEPING&&St.sleepState===j.AWAKE&&St.type!==j.STATIC&&St.velocity.norm2()+St.angularVelocity.norm2()>=2*Math.pow(St.sleepSpeedLimit,2)&&(Ct._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(St,Ct,!0),this.collisionMatrixPrevious.get(St,Ct)||(rt.body=Ct,rt.contact=It,St.dispatchEvent(rt),rt.body=St,Ct.dispatchEvent(rt))}for(W&&(H.makeContactConstraints=performance.now()-A,A=performance.now()),nt=0;nt!==z;nt++)(St=M[nt])._wakeUpAfterNarrowphase&&(St.wakeUp(),St._wakeUpAfterNarrowphase=!1);for(gt=Z.length,nt=0;nt!==gt;nt++){var It;(It=Z[nt]).update(),vt=0;for(var Rt=It.equations.length;vt!==Rt;vt++){var _t=It.equations[vt];O.addEquation(_t)}}O.solve(v,this),W&&(H.solve=performance.now()-A),O.removeAllEquations();var Pt=Math.pow;for(nt=0;nt!==z;nt++)if((St=M[nt]).type&X){var Bt=Pt(1-St.linearDamping,v),zt=St.velocity;zt.mult(Bt,zt);var Ot=St.angularVelocity;if(Ot){var Nt=Pt(1-St.angularDamping,v);Ot.mult(Nt,Ot)}}for(this.dispatchEvent(ot),nt=0;nt!==z;nt++)(St=M[nt]).preStep&&St.preStep.call(St);W&&(A=performance.now());var Lt=ht,Ft=ut,kt=this.stepnumber,Vt=j.DYNAMIC|j.KINEMATIC,qt=kt%(this.quatNormalizeSkip+1)==0,Ut=this.quatNormalizeFast,Wt=.5*v;for(T.types.PLANE,T.types.CONVEXPOLYHEDRON,nt=0;nt!==z;nt++){var Ht=M[nt],Gt=Ht.force,Yt=Ht.torque;if(Ht.type&Vt&&Ht.sleepState!==j.SLEEPING){var Qt=Ht.velocity,Zt=Ht.angularVelocity,Kt=Ht.position,Jt=Ht.quaternion,$t=Ht.invMass,ee=Ht.invInertiaWorld;Qt.x+=Gt.x*$t*v,Qt.y+=Gt.y*$t*v,Qt.z+=Gt.z*$t*v,Ht.angularVelocity&&(ee.vmult(Yt,pt),pt.mult(v,pt),pt.vadd(Zt,Zt)),Kt.x+=Qt.x*v,Kt.y+=Qt.y*v,Kt.z+=Qt.z*v,Ht.angularVelocity&&(Lt.set(Zt.x,Zt.y,Zt.z,0),Lt.mult(Jt,Ft),Jt.x+=Wt*Ft.x,Jt.y+=Wt*Ft.y,Jt.z+=Wt*Ft.z,Jt.w+=Wt*Ft.w,qt&&(Ut?Jt.normalizeFast():Jt.normalize())),Ht.aabb&&(Ht.aabbNeedsUpdate=!0),Ht.updateInertiaWorld&&Ht.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,W&&(H.integrate=performance.now()-A),this.time+=v,this.stepnumber+=1,this.dispatchEvent(it),nt=0;nt!==z;nt++){var ne=(St=M[nt]).postStep;ne&&ne.call(St)}if(this.allowSleep)for(nt=0;nt!==z;nt++)M[nt].sleepTick(this.time)},n.prototype.clearForces=function(){for(var v=this.bodies,A=v.length,T=0;T!==A;T++){var E=v[T];E.force,E.torque,E.force.set(0,0,0),E.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})),define("node_modules/decentraland-builder-scripts/channel",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.createChannel=void 0;var T="__request_value__",E="__reply_value__";A.createChannel=function(v,A,C){var R={},z={},M={};return C.on(A.name,(function(v){var A=R[v.actionId];A&&A(v),z={}})),C.on(T,(function(T){if(T.sender!==v&&T.entityName===A.name){var R=T.key,O=M[R];if(O){var V=O(),W={entityName:A.name,key:R,sender:v,value:V};C.emit(E,W)}delete z[R]}})),C.on(E,(function(T){if(T.sender!==v&&T.entityName===A.name){var E=T.key,C=T.value,R=z[E];R&&R(C),delete z[E]}})),{id:v,bus:C,createAction:function(v,T){return{entityName:A.name,actionId:v,values:T}},sendActions:function(A){var T,E;void 0===A&&(A=[]);try{for(var R=__values(A),z=R.next();!z.done;z=R.next()){var M=z.value,O=__assign(__assign({},M),{sender:v});C.emit(O.entityName,O)}}catch(v){T={error:v}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(T)throw T.error}}},handleAction:function(v,A){R[v]=A},request:function(E,R){z[E]=R;var M={entityName:A.name,key:E,sender:v},O=setInterval((function(){E in z?C.emit(T,M):clearInterval(O)}),5e3)},reply:function(v,A){M[v]=A}}}})),define("node_modules/decentraland-builder-scripts/inventory",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.createInventory=void 0,A.createInventory=function(v,A,T){var E=null,C=null,R={};return{add:function(z,M){var O=R[z]||new T((E||(E=new v),C||((C=new A(E)).isPointerBlocker=!1,C.vAlign="bottom",C.hAlign="right",C.stackOrientation=0,C.spacing=0,C.positionY=75,C.positionX=-25),C),M);O.width=128,O.height=128,O.sourceTop=0,O.sourceLeft=0,O.sourceHeight=256,O.sourceWidth=256,O.isPointerBlocker=!1,O.visible=!0,R[z]=O},remove:function(v){var A=R[v];A&&(A.visible=!1,A.height=0,A.width=0)},has:function(v){return v in R&&R[v].visible}}}})),define("src/messageBus",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.sceneMessageBus=void 0,A.sceneMessageBus=new MessageBus})),define("imagePanel/src/item",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0});var T=function(){function SignPost(){}return SignPost.prototype.init=function(){},SignPost.prototype.spawn=function(v,A,T){var E=new Entity;E.setParent(v),E.addComponent(new Transform({}));var C=A.image,R=new Texture(C),z=new BasicMaterial;z.texture=R;var M=new Entity;M.setParent(v),M.addComponent(new PlaneShape),M.addComponent(z),M.addComponent(new Transform({position:new Vector3(0,.5,0),rotation:Quaternion.Euler(180,0,0),scale:new Vector3(1,1,1)})),M.addComponentOrReplace(new OnPointerDown((function(v){openExternalURL(A.url?A.url:"https://purplebee.org/")}),{hoverText:"Learn More"}))},SignPost}();A.default=T})),define("videoStream/src/item",["require","exports","@decentraland/RestrictedActions"],(function(v,A,T){Object.defineProperty(A,"__esModule",{value:!0});var E=function(){function Button(){this.channel="",this.video={},this.materials={},this.active={},this.volume={},this.sign={}}return Button.prototype.init=function(){},Button.prototype.toggle=function(v,A){if(log("all screens: ",this.video," setting: ",v.name," to ",A),A){if(this.activeScreen&&this.activeScreen==v)return;this.activeScreen&&this.toggle(this.activeScreen,!1),this.activeScreen=v,this.active[v.name]=!0,this.video[v.name].volume=this.volume[v.name],this.video[v.name].playing=!0,engine.removeEntity(this.sign[v.name])}else{if(!this.activeScreen||this.activeScreen!=v)return;this.activeScreen=null,this.active[v.name]=!1,this.video[v.name].playing=!1}},Button.prototype.spawn=function(v,A,E){var C=this,R=new Entity(v.name+"-screen");R.setParent(v);R.addComponent(new PlaneShape),R.addComponent(new Transform({scale:new Vector3(2.976,1.08*1.55,15.5),position:new Vector3(0,.8494,0)})),A.customStation?this.channel=A.customStation:A.station?this.channel=A.station:this.channel="https://d3kt99p6ty4t3h.cloudfront.net/20210623_jagtronica_xAy1c/tVyNQJ.m3u8",this.video[R.name]=new VideoTexture(new VideoClip(this.channel)),this.materials[R.name]=new Material,this.materials[R.name].albedoTexture=this.video[R.name],this.materials[R.name].specularIntensity=0,this.materials[R.name].roughness=1,this.materials[R.name].metallic=0,this.materials[R.name].emissiveTexture=this.video[R.name],this.materials[R.name].emissiveIntensity=.8,this.materials[R.name].emissiveColor=new Color3(1,1,1),R.addComponent(this.materials[R.name]),this.sign[R.name]=new Entity(v.name+"-sign"),this.sign[R.name].setParent(R),this.sign[R.name].addComponent(new PlaneShape),this.sign[R.name].addComponent(new Transform({position:new Vector3(0,0,.002),rotation:Quaternion.Euler(180,0,0)})),this.volume[R.name]=A.volume;var z=new BasicMaterial;z.texture=new Texture(A.image?A.image:"videoStream/images/stream.png"),this.sign[R.name].addComponent(z),A.onClick&&(this.sign[R.name].addComponent(new OnPointerDown((function(){E.sendActions(A.onClick)}),{button:ActionButton.POINTER,hoverText:A.onClickText,distance:A.controlDist?A.controlDist:10})),R.addComponent(new OnPointerDown((function(){log("clicked"),E.sendActions(A.onClick)}),{button:ActionButton.POINTER,hoverText:A.onClickText,distance:A.controlDist?A.controlDist:10}))),A.startOn?this.toggle(R,!0):this.toggle(R,!1),E.handleAction("activate",(function(v){var T=v.sender;C.toggle(R,!0),T===E.id&&E.sendActions(A.onActivate)})),E.handleAction("deactivate",(function(v){var T=v.sender;C.toggle(R,!1),T===E.id&&E.sendActions(A.onDeactivate)})),E.handleAction("toggle",(function(v){var z=v.sender,M=!C.active[R.name];C.toggle(R,M),z===E.id&&(M?(E.sendActions(A.onActivate),(0,T.triggerEmote)({predefined:"handsair"})):E.sendActions(A.onDeactivate))})),E.request("isActive",(function(v){return C.toggle(R,v)})),E.reply("isActive",(function(){return C.active[R.name]}))},Button}();A.default=E})),define("src/game",["require","exports","@dcl/ecs-scene-utils","node_modules/decentraland-builder-scripts/channel","node_modules/decentraland-builder-scripts/inventory","@decentraland/RestrictedActions","imagePanel/src/item","videoStream/src/item"],(function(v,A,T,E,C,R,z,M){Object.defineProperty(A,"__esModule",{value:!0});var O=Math.random().toString(16).slice(2),V=new MessageBus,W=((0,C.createInventory)(UICanvas,UIContainerStack,UIImage),Math.floor(1e4*Math.random())),j=new Entity("_scene");engine.addEntity(j);var H=new Transform({position:new Vector3(0,0,0),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});j.addComponentOrReplace(H);var X=new Entity("mainStructure ");engine.addEntity(X),X.setParent(j);var Z=new Transform({position:new Vector3(8,0,16),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(1,1,1)});X.addComponentOrReplace(Z);var K=new GLTFShape("GLB/Decentraland Arena7dboz.glb");K.withCollisions=!0,K.isPointerBlocker=!0,K.visible=!0,X.addComponentOrReplace(K);var J=new Entity("blimp");engine.addEntity(J),J.setParent(j);var $=new Transform({position:new Vector3(8,16,16),scale:new Vector3(1,1,1)});J.addComponentOrReplace($);var et=new GLTFShape("GLB/Blimp.glb");et.withCollisions=!0,et.isPointerBlocker=!0,et.visible=!0,J.addComponentOrReplace(et);var nt=new Entity("videoStream");engine.addEntity(nt),nt.setParent(j);var it=new Transform({position:new Vector3(8,4.15,.5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(4.5,4.5,4.5)});nt.addComponentOrReplace(it);var ot=new M.default;ot.init(),ot.spawn(nt,{startOn:!0,volume:1,controlDist:20,onClickText:"Play/Pause",image:"https://purplebee.org/wp-content/uploads/DCL-Screen-Main.jpg",station:"https://dimhp4sranvy3.cloudfront.net/out/v1/97ed27876e70411685f551766ae1cec4/index.m3u8"},(0,E.createChannel)(O,nt,V));var rt=new Entity("blackwall");engine.addEntity(rt),rt.setParent(j);var st=new Transform({position:new Vector3(8,2.2,.5),rotation:new Quaternion(0,.5,0,.5),scale:new Vector3(1.3,2,1.8)});rt.addComponentOrReplace(st);var at=new GLTFShape("GLB/screenwall.glb");at.withCollisions=!1,at.isPointerBlocker=!0,at.visible=!0,rt.addComponentOrReplace(at);var lt=new Entity("imageFromURL");engine.addEntity(lt),lt.setParent(j);var ct=new Transform({position:new Vector3(12.85,1,.75),rotation:new Quaternion(0,0,0,0),scale:new Vector3(3.25,3.25,1)});lt.addComponentOrReplace(ct);var ht=new z.default;ht.init(),ht.spawn(lt,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-5.png?"+W,url:"https://purplebee.org/?dclpanel=5",basic:!0},(0,E.createChannel)(O,lt,V));var ut=new Entity("imageFromURL");engine.addEntity(ut),ut.setParent(lt);var pt=new Transform({position:new Vector3(-1,0,0)});ut.addComponentOrReplace(pt);var dt=new z.default;dt.init(),dt.spawn(ut,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-6.png?"+W,url:"https://purplebee.org/?dclpanel=6",basic:!0},(0,E.createChannel)(O,ut,V));var yt=new Entity("imageFromURL");engine.addEntity(yt),yt.setParent(lt);var ft=new Transform({position:new Vector3(-2,0,0)});yt.addComponentOrReplace(ft);var gt=new z.default;gt.init(),gt.spawn(yt,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-7.png?"+W,url:"https://purplebee.org/?dclpanel=7",basic:!0},(0,E.createChannel)(O,yt,V));var vt=new Entity("imageFromURL");engine.addEntity(vt),vt.setParent(lt);var bt=new Transform({position:new Vector3(-3,0,0)});vt.addComponentOrReplace(bt);var wt=new z.default;wt.init(),wt.spawn(vt,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-8.png?"+W,url:"https://purplebee.org/?dclpanel=8",basic:!0},(0,E.createChannel)(O,vt,V));var xt=new Entity("blackhole1");engine.addEntity(xt),xt.setParent(j);var At=new Transform({position:new Vector3(8,.93,7.6),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(.85,.85,.85)});xt.addComponentOrReplace(At);var Tt=new GLTFShape("GLB/BlackholeLayers/BH03.glb");Tt.withCollisions=!1,Tt.isPointerBlocker=!0,Tt.visible=!0,xt.addComponentOrReplace(Tt);var St=new Entity("blackhole2");engine.addEntity(St),St.setParent(xt);var Ct=new Transform({position:new Vector3(0,-.1,0)});St.addComponentOrReplace(Ct);var It=new GLTFShape("GLB/BlackholeLayers/BH04.glb");It.visible=!0,St.addComponentOrReplace(It);var Rt=new Entity("blackhole3");engine.addEntity(Rt),Rt.setParent(xt);var _t=new Transform({position:new Vector3(0,-.2,0)});Rt.addComponentOrReplace(_t);var Pt=new GLTFShape("GLB/BlackholeLayers/BH02.glb");Pt.visible=!0,Rt.addComponentOrReplace(Pt);var Bt=new Entity("blackhole4");engine.addEntity(Bt),Bt.setParent(xt);var zt=new Transform({position:new Vector3(0,-.3,0)});Bt.addComponentOrReplace(zt);var Ot=new GLTFShape("GLB/BlackholeLayers/BH01.glb");Ot.visible=!0,Bt.addComponentOrReplace(Ot);var Nt=new Entity("blackhole5");engine.addEntity(Nt),Nt.setParent(xt);var Lt=new Transform({position:new Vector3(0,-.4,0)});Nt.addComponentOrReplace(Lt);var Ft=new GLTFShape("GLB/BlackholeLayers/BH05.glb");Ft.visible=!0,Nt.addComponentOrReplace(Ft);var kt=new Entity("redlight");engine.addEntity(kt),kt.setParent(j);var Vt=new Transform({position:new Vector3(8,0,16),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(1,1,1)});kt.addComponentOrReplace(Vt);var qt=new GLTFShape("GLB/RedLight.glb");qt.withCollisions=!0,qt.visible=!0,kt.addComponentOrReplace(qt);var Ut=new Entity("redlight2");engine.addEntity(Ut),Ut.setParent(kt);var Wt=new Transform({position:new Vector3(14,0,0)});Ut.addComponentOrReplace(Wt);var Ht=new GLTFShape("GLB/RedLight.glb");Ht.visible=!0,Ut.addComponentOrReplace(Ht);var Gt=!1;function dance(){var v=["robot","tik","hammer","tektonik","disco"],A=Math.floor(Math.random()*v.length);(0,R.triggerEmote)({predefined:v[A]})}var Yt=new T.TriggerComponent(new T.TriggerBoxShape(new Vector3(7.4,5,7.4),Vector3.Zero()),{onCameraEnter:function(){setTimeout((function(){dance()}),1e3),Gt=setInterval((function(){dance()}),1e4)},onCameraExit:function(){clearInterval(Gt)}});xt.addComponentOrReplace(Yt);var Qt=new T.TriggerComponent(new T.TriggerBoxShape(new Vector3(14,8,6),new Vector3(0,9,-1.5)),{onCameraEnter:function(){setTimeout((function(){dance()}),1e3),Gt=setInterval((function(){dance()}),1e4)},onCameraExit:function(){clearInterval(Gt)}});X.addComponentOrReplace(Qt);var Zt=new Entity("imageFromURL");engine.addEntity(Zt),Zt.setParent(j);var Kt=new Transform({position:new Vector3(3,3.01,31.5),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(3.4,3.4,3.4)});Zt.addComponentOrReplace(Kt);var Jt=new z.default;Jt.init(),Jt.spawn(Zt,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-1.png?"+W,url:"https://purplebee.org/?dclpanel=1"},(0,E.createChannel)(O,Zt,V));var $t=new Entity("imageFromURL");engine.addEntity($t),$t.setParent(Zt);var ee=new Transform({position:new Vector3(-1,0,0)});$t.addComponentOrReplace(ee);var ne=new z.default;ne.init(),ne.spawn($t,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-2.png?"+W,url:"https://purplebee.org/?dclpanel=2",basic:!0},(0,E.createChannel)(O,$t,V));var ie=new Entity("imageFromURL");engine.addEntity(ie),ie.setParent(Zt);var oe=new Transform({position:new Vector3(-2,0,0)});ie.addComponentOrReplace(oe);var se=new z.default;se.init(),se.spawn(ie,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-3.png?"+W,url:"https://purplebee.org/?dclpanel=3",basic:!0},(0,E.createChannel)(O,ie,V));var ae=new Entity("imageFromURL");engine.addEntity(ae),ae.setParent(Zt);var le=new Transform({position:new Vector3(-3,0,0)});ae.addComponentOrReplace(le);var ce=new z.default;ce.init(),ce.spawn(ae,{image:"https://purplebee.org/wp-content/uploads/DCL-Panel-4.png?"+W,url:"https://purplebee.org/?dclpanel=4",basic:!0},(0,E.createChannel)(O,ae,V))}));