"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(A){let T=0,E=[],R=[];const z={baseUrl:""},O={};function d(A,E,R){let z=null,V={},U=null;"function"==typeof A?V=A:"string"==typeof A?(z=A,"function"==typeof E?V=E:E instanceof Array&&(U=E,V=R)):A instanceof Array&&(U=A,"function"==typeof E&&(V=E)),U=U||["require","exports","module"],null===z&&(z="unnamed-module-"+T++),z=g(z),U=(U||[]).map((A=>function(A,T){return A?b(T,A):T}(z,A))),O[z]||(O[z]={name:z,parent:null,dclamd:1,dependencies:U,handlers:[],exports:{},dependants:new Set}),O[z].dependencies=U,p(U,(function(A){const T=O[z];if(!T)throw new Error("Could not access registered module "+z);let E=T.exports;E="function"==typeof V?V.apply(globalObject,A)||E:V,T.exports=E,u(z)}),(A=>{if("function"!=typeof onerror)throw A;onerror(A)}),z)}function u(A){const T=O[A];if(!T)throw new Error("Could not access registered module "+A);T.dclamd=2;let E=T.handlers;if(E&&E.length)for(let T=0;T<E.length;T++)E[T](O[A])}function c(A,T,E){if(!O[A])return null;if(A==T||50==E)return[A];const R=O[A].dependencies;for(let z=0,O=R.length;z<O;z++){let O=c(R[z],T,E+1);if(null!==O)return O.push(A),O}return null}function a(A,T){let E=O[A];if(!E)return!1;let R={};for(let A in O)R[A]=!1;let z=[];for(z.push(E),R[A]=!0;z.length>0;){let A=z.shift().dependencies;if(A)for(let E=0,V=A.length;E<V;E++){let V=A[E];if(V===T)return!0;let U=O[V];U&&!R[V]&&(R[V]=!0,z.push(U))}}return!1}function p(A,T,E,z){let V=new Array(A.length).fill(null),U=0,H=!1;if("string"==typeof A){if(O[A]){if(1===O[A].dclamd)throw new Error(`Trying to load ${A} from ${z}. The first module is still loading.`);return O[A]}throw new Error(A+" has not been defined. Please include it as a dependency in "+z+"'s define()")}const G=A.length;for(let X=0;X<G;X++)switch(A[X]){case"require":let h=function(A,T,E){return p(A,T,E,z)};h.toUrl=function(A){return b(A,z)},V[X]=h,U++;break;case"exports":if(!O[z])throw new Error("Parent module "+z+" not registered yet");V[X]=O[z].exports,U++;break;case"module":V[X]={id:z,uri:b(z)},U++;break;default:{const Q=A[X],m=()=>{V[X]=O[Q].exports,U++,U===G&&T&&(H=!0,T(V))};if(a(Q,z)){const A=c(Q,z,0);A&&(A.reverse(),A.push(Q),R.push(A)),w(Q,(()=>{}),E,z),m()}else w(Q,m,E,z);break}}!H&&U===G&&T&&T(V)}function h(A,T){return function(){return dcl.callRpc(A,T.name,E.slice.call(arguments,0))}}function w(A,T,E,R){if(O[A])return O[A].dependants.add(R),void(1===O[A].dclamd?T&&O[A].handlers.push(T):T&&T(O[A]));if(O[A]={name:A,parent:R,dclamd:1,handlers:[T],dependencies:[],dependants:new Set([R]),exports:{}},0===A.indexOf("@")){let T=O[A].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(A,T).then((E=>{for(let A in E.methods){const R=E.methods[A];T[R.name]=h(E.rpcHandle,R)}u(A)})).catch((A=>{E(A)}))}}function g(A){let T,E=A;for(T=/\/\.\//;T.test(E);)E=E.replace(T,"/");for(E=E.replace(/^\.\//g,""),T=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;T.test(E);)E=E.replace(T,"/");return E=E.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),E=E.replace(/^\//g,""),E}function b(A,T){switch(A){case"require":case"exports":case"module":return A}return T?function(A,T){let E=A;if(!E.startsWith("@")&&(E.startsWith("./")||E.startsWith("../"))){const A=T.split("/");A.pop(),E=g(A.join("/")+"/"+E)}return E}(A,T):g(A)}A.config=function(A){if("object"==typeof A)for(let T in A)A.hasOwnProperty(T)&&(z[T]=A[T])},A.define=d,function(A){A.amd={},A.modules=O}(d=A.define||(A.define={})),A.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const A=new Set,T=[];for(let E in O)O[E]&&(1===O[E].dclamd&&T.push(O[E]),O[E].dependencies.forEach((T=>{"require"!=T&&"exports"!=T&&"module"!=T&&(O[T]||A.add(T))})));const E=[];if(R.length&&E.push(`\n> Cyclic dependencies: ${R.map((A=>"\n  - "+A.join(" -> "))).join("")}`),A.size&&E.push(`\n> Undeclared/unknown modules: ${Array.from(A).map((A=>"\n  - "+A)).join("")}`),T.length&&E.push(`\n> These modules didn't load: ${T.map((A=>"\n  - "+A.name)).join("")}.\n`),E.length)throw new Error(E.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(A){var T=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(A){return A.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(A){return A.firstPersonCameraEntity}},t}(),n=function(A,T){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,T){A.__proto__=T}||function(A,T){for(var E in T)Object.prototype.hasOwnProperty.call(T,E)&&(A[E]=T[E])})(A,T)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function o(A,T){if("function"!=typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function o(){this.constructor=A}n(A,T),A.prototype=null===T?Object.create(T):(o.prototype=T.prototype,new o)}var i=function(){return(i=Object.assign||function(A){for(var T,E=1,R=arguments.length;E<R;E++)for(var z in T=arguments[E])Object.prototype.hasOwnProperty.call(T,z)&&(A[z]=T[z]);return A}).apply(this,arguments)};function r(A,T,E,R){var z,O=arguments.length,V=O<3?T:null===R?R=Object.getOwnPropertyDescriptor(T,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(A,T,E,R);else for(var U=A.length-1;U>=0;U--)(z=A[U])&&(V=(O<3?z(V):O>3?z(T,E,V):z(T,E))||V);return O>3&&V&&Object.defineProperty(T,E,V),V}function u(A){var T="function"==typeof Symbol&&Symbol.iterator,E=T&&A[T],R=0;if(E)return E.call(A);if(A&&"number"==typeof A.length)return{next:function(){return A&&R>=A.length&&(A=void 0),{value:A&&A[R++],done:!A}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(A,T){var E="function"==typeof Symbol&&A[Symbol.iterator];if(!E)return A;var R,z,O=E.call(A),V=[];try{for(;(void 0===T||T-- >0)&&!(R=O.next()).done;)V.push(R.value)}catch(A){z={error:A}}finally{try{R&&!R.done&&(E=O.return)&&E.call(O)}finally{if(z)throw z.error}}return V}function h(A,T){for(var E=0,R=T.length,z=A.length;E<R;E++,z++)A[z]=T[E];return A}var E=0;function l(){for(var A=[],T=0;T<arguments.length;T++)A[T]=arguments[T];"undefined"!=typeof dcl?dcl.log.apply(dcl,h([],p(A))):console.log.apply(console,h(["DEBUG:"],p(A)))}function d(A,T){"undefined"!=typeof dcl?dcl.error(A,T):console.error("ERROR:",A,T)}function f(A){if(E++,0===A.length)throw new Error("newId(type: string): type cannot be empty");return A+E.toString(36)}function y(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(A){var T=16*Math.random()|0;return("x"===A?T:3&T|8).toString(16)}))}function v(A,T){for(var E=[],R=0;R<A;++R)E.push(T());return E}var R=[];function _(A){if(!("__event_name__"in A)||"string"!=typeof A.__event_name__)throw new Error("The EventConstructor is not registered");return A.__event_name__}var z=function(){function t(){this.listeners={}}return t.prototype.addListener=function(A,T,E){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var R=_(A),z=this.listeners[R];z||(z=this.listeners[R]=[]);for(var O=0;O<z.length;O++)if(z[O].listener===T)throw new Error("The provided listener is already registered");return z.push({listener:T,fn:E}),this},t.prototype.removeListener=function(A,T){if(!T||"function"!=typeof T)throw new Error("Invalid EventConstructor");var E=_(T),R=this.listeners[E];if(!R)return!1;for(var z=0;z<R.length;z++)if(R[z].listener===A)return R.splice(z,1),!0;return!1},t.prototype.fireEvent=function(A){var T=_(A.constructor),E=this.listeners[T];if(E)for(var R=0;R<E.length;R++)try{var z=E[R];z.fn.call(z.listener,A)}catch(A){d(A)}return this},t}();function x(){var A=f("EV");if(-1!==R.indexOf(A))throw new Error("The event name "+A+" is already taken");return R.push(A),function(T){return T.__event_name__=A,T}}var O,V=r([x()],(function(A,T,E){this.entity=A,this.componentName=T,this.component=E})),U=r([x()],(function(A,T,E){this.entity=A,this.componentName=T,this.classId=E})),H=r([x()],(function(A,T){this.entity=A,this.parent=T}));A.UIValueType=void 0,(O=A.UIValueType||(A.UIValueType={}))[O.PERCENT=0]="PERCENT",O[O.PIXELS=1]="PIXELS";var G=function(){function e(T){if(this.type=A.UIValueType.PIXELS,"string"==typeof T){var E=T;E.indexOf("px")>-1?this.type=A.UIValueType.PIXELS:E.indexOf("%")>-1&&(this.type=A.UIValueType.PERCENT),this.value=parseFloat(E)}else this.value=T}return e.prototype.toString=function(){var T=this.value.toString();return this.type===A.UIValueType.PERCENT?T+="%":T+="px",T},e}(),X="__name__symbol_",Q="__classId__symbol_",Z="__component__id_",K=r([x()],(function(A,T,E){this.componentId=A,this.componentName=T,this.classId=E})),J=r([x()],(function(A){this.componentId=A})),$=r([x()],(function(A,T){this.componentId=A,this.component=T}));function M(A,T){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+A);var R=E,i=function(){var E=Array.prototype.slice.call(arguments),z=new(R.bind.apply(R,h([void 0],p(E))));return Object.defineProperty(z,X,{enumerable:!1,writable:!1,configurable:!1,value:A}),void 0!==T&&Object.defineProperty(z,Q,{enumerable:!1,writable:!1,configurable:!1,value:T}),z};return void 0!==T&&(i.__classId__symbol_=T),i.__name__symbol_=A,i.isComponent=!0,i.originalClassName=A,(i.prototype=E.prototype).constructor=E,i}}function F(A,T){return function(E){if(E.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+E.originalClassName+" with: "+A);if("number"!=typeof T||isNaN(T))throw new Error("classId: "+T+" is an invalid integer");var R=E,i=function(){if(!F.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var E=Array.prototype.slice.call(arguments),z=new(R.bind.apply(R,h([void 0],p(E)))),O=f("C");return Object.defineProperty(z,X,{enumerable:!1,writable:!1,configurable:!1,value:A}),Object.defineProperty(z,Z,{enumerable:!1,writable:!1,configurable:!1,value:O}),void 0!==T&&Object.defineProperty(z,Q,{enumerable:!1,writable:!1,configurable:!1,value:T}),F.engine&&F.engine.registerComponent(z),z};return void 0!==T&&(i.__classId__symbol_=T),i.__name__symbol_=A,i.isComponent=!0,i.isDisposableComponent=!0,i.originalClassName=A,(i.prototype=E.prototype).constructor=E,i}}function L(A){if(!A)throw new TypeError(A+" is not a component.");if(A.__name__symbol_)return A.__name__symbol_;throw new TypeError(A+" is not a registered component.")}function N(A){if(!A)throw new TypeError(A+" is not a component.");if(A.__classId__symbol_)return A.__classId__symbol_;if(!A.__name__symbol_)throw new TypeError(A+" is not a registered component.");return null}function D(A){if(!A)throw new TypeError(A+" is not a component.");if(A.__component__id_)return A.__component__id_;throw new TypeError(A+" is not a registered disposable component.")}!function(A){A.engine=null}(F||(F={}));var et=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(A,T){if(delete A[T]){var E=T+"_"+Math.random();A[E]=void 0,Object.defineProperty(A,E,i(i({},Object.getOwnPropertyDescriptor(A,E)),{enumerable:!1})),Object.defineProperty(A,T.toString(),{get:function(){return this[E]},set:function(A){var R=this[E];if(this.data[T]=A?D(A):null,this[E]=A,A!==R){this.dirty=!0;for(var z=0;z<this.subscriptions.length;z++)this.subscriptions[z](T,A,R)}},enumerable:!0})}},t.field=function(A,T){delete A[T]&&Object.defineProperty(A,T.toString(),{get:function(){return this.data[T]},set:function(A){var E=this.data[T];if(this.data[T]=A,A!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](T,A,E)}},enumerable:!0})},t.uiValue=function(A,T){delete A[T]&&Object.defineProperty(A,T.toString(),{get:function(){return this.data[T].toString()},set:function(A){var E=this.data[T],R=new G(A);if(this.data[T]=R,R!==E){this.dirty=!0;for(var z=0;z<this.subscriptions.length;z++)this.subscriptions[z](T,R,E)}},enumerable:!0})},t.readonly=function(A,T){delete A[T]&&Object.defineProperty(A,T.toString(),{get:function(){if(T in this.data==0)throw new Error("The field "+T+" is uninitialized");return this.data[T]},set:function(A){if(T in this.data)throw new Error("The field "+T+" is readonly");this.data[T]=A,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(A){return this.subscriptions.push(A),this},t.prototype.toJSON=function(){return this.data},t}();function B(A){return Z in A}var nt=function(){function t(){for(var A=[],T=0;T<arguments.length;T++)A[T]=arguments[T];if(this.entities=[],this.active=!1,this._requiresNames=[],!A)throw new Error("ComponentGroup: Could not load the requires list");if(!(A instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return A.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(T){var R=A[T],z=null;if(!R)throw new Error("ComponentGroup: the required component at location "+T+" is invalid");try{z=L(R)}catch(A){throw new Error("ComponentGroup: the required component at location "+T+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(E._requiresNames.some((function(A){return A===z})))throw new Error("ComponentGroup: the required component list has a repeated name "+z);E._requiresNames.push(z)},E=this,R=0;R<A.length;R++)n(R)}return t.prototype.hasEntity=function(A){return!!A.isAddedToEngine()&&-1!==this.entities.indexOf(A)},t.prototype.addEntity=function(A){if(!A.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(A)&&this.entities.push(A)},t.prototype.removeEntity=function(A){var T=this.entities.indexOf(A);-1!==T&&this.entities.splice(T,1)},t.prototype.componentRemoved=function(A,T){-1!==this._requiresNames.indexOf(T)&&this.removeEntity(A)},t.prototype.meetsRequirements=function(A){for(var T=0;T<this._requiresNames.length;T++)if(!(this._requiresNames[T]in A.components))return!1;return!0},t}(),ot=function(){function t(A){this.name=A,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(A){if("function"==typeof A)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof A)throw new Error("You passed a "+typeof A+", an instance of component is expected");var T=L(A);if(this.components[T]){if(this.components[T]===A)return A;this.removeComponent(this.components[T],!1)}return this.addComponent(A)},t.prototype.hasComponent=function(A){var T=typeof A;if("string"!==T&&"object"!==T&&"function"!==T)throw new Error("Entity#has(component): component is not a class, name or instance");if(null==A)return!1;var E="string"===T?A:L(A),R=this.components[E];return!!R&&("object"===T?R===A:"function"!==T||R instanceof A)},t.prototype.getComponent=function(A){var T=typeof A;if("string"!==T&&"function"!==T)throw new Error("Entity#get(component): component is not a class or name");var E="string"===T?A:L(A),R=this.components[E];if(!R)throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'"');if("function"===T){if(R instanceof A)return R;throw new Error('Can not get component "'+E+'" from entity "'+this.identifier+'" (by instance)')}return R},t.prototype.getComponentOrNull=function(A){var T=typeof A;if("string"!==T&&"function"!==T)throw new Error("Entity#getOrNull(component): component is not a class or name");var E="string"===T?A:L(A),R=this.components[E];return R?"function"===T?R instanceof A?R:null:R:null},t.prototype.getComponentOrCreate=function(A){if("function"!=typeof A)throw new Error("Entity#getOrCreate(component): component is not a class");var T=this.getComponentOrNull(A);return T||(L(T=new A),this.addComponentOrReplace(T)),T},t.prototype.addComponent=function(A){if("object"!=typeof A)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var T=L(A),E=N(A);if(this.components[T])throw new Error('A component of type "'+T+'" is already present in entity "'+this.identifier+'"');this.components[T]=A,this.eventManager&&this.eventManager.fireEvent(new U(this,T,E));var R=A;return"function"==typeof R.addedToEntity&&R.addedToEntity(this),A},t.prototype.removeComponent=function(A,T){void 0===T&&(T=!0);var E=typeof A;if("string"!==E&&"function"!==E&&"object"!==E)throw new Error("Entity#remove(component): component is not a class, class or name");var R="string"===E?A:L(A),z=this.components[R];if(z){if("function"===E)return z instanceof A?(delete this.components[R],void(z&&(T&&this.eventManager&&this.eventManager.fireEvent(new V(this,R,z)),"function"==typeof z.removedFromEntity&&z.removedFromEntity(this)))):void l('Entity Warning: Trying to remove wrong (by constructor) component "'+R+'" from entity "'+this.identifier+'"');delete this.components[R],z&&(T&&this.eventManager&&this.eventManager.fireEvent(new V(this,R,z)),"function"==typeof z.removedFromEntity&&z.removedFromEntity(this))}else l('Entity Warning: Trying to remove inexisting component "'+R+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(A){var T;if(A&&"getEntityRepresentation"in A){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");T=A.getEntityRepresentation(this.engine)}else T=!A&&this.engine?this.engine.rootEntity:A;var E=this.getParent();if(T===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(T===E)return this;var R=this.getCircularAncestor(T);if(R)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+R+'")');return E&&delete E.children[this.uuid],null!==T&&"0"!==T.uuid&&(!T.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),T.isAddedToEngine()&&!this.isAddedToEngine()&&T.engine.addEntity(this)),this._parent=T||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new H(this,T)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(A){for(var T=this.engine?this.engine.rootEntity:null,E=A;E&&E!==T;){var R=E.getParent();if(R===this)return E.uuid;E=R}return null},t.prototype.registerAsChild=function(){var A=this.getParent();this.uuid&&A&&(A.children[this.uuid]=this)},t}(),it=function(){function t(A){this.eventManager=new z,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(U,this,this.componentAddedHandler),this.eventManager.addListener(V,this,this.componentRemovedHandler),this.rootEntity=A,this.firstPersonCameraEntity=new ot,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new ot,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(A){var T=A.getParent();if(A.isAddedToEngine())return A;for(var E in A.eventManager=this.eventManager,A.engine=this,this._entities[A.uuid]=A,this.checkRequirementsAndAdd(A),T?T.isAddedToEngine()||T===this.rootEntity||l("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+T.uuid):A.setParent(this.rootEntity),A.alive=!0,A.children){var R=A.children[E];R&&(R.isAddedToEngine()||this.addEntity(R))}return A},t.prototype.removeEntity=function(A){var T=A.uuid;if(A.isAddedToEngine()){for(var E in A.components){var R=this._componentGroups[E];if(R)for(var z in R)R[z].removeEntity(A);delete this.entityLists[E][T]}for(var O=0;O<this.simpleSystems.length;O++){var V=this.simpleSystems[O];V.onRemoveEntity&&V.onRemoveEntity(A)}for(var O in A.children){var U=A.children[O];U&&this.removeEntity(U)}return A.alive=!1,A.eventManager=null,delete this._entities[T],!0}for(var E in l("Engine: Trying to remove non existent entity from engine."),A.isAddedToEngine()?l("Engine: Entity id: "+T):l('Engine: Entity "'+A.uuid+'" has not been added to any engine yet.'),l("Engine: Entity's components:"),A.components)l(E);return!1},t.prototype.addSystem=function(A,T){if(void 0===T&&(T=0),-1!==this.addedSystems.indexOf(A))return l("Engine: Trying to add a system that is already added. Aborting"),A;if(this.systems.length>0)for(var E=0;E<this.systems.length;E++){var R=this.systems[E],z=E===this.systems.length-1;if(R.priority>T){this.addedSystems.push(A),this.systems.splice(E,0,{system:A,priority:T});break}if(z){this.addedSystems.push(A),this.systems.splice(E+1,0,{system:A,priority:T});break}}else this.addedSystems.push(A),this.systems.splice(1,0,{system:A,priority:T});return this.registerSystem(A),A},t.prototype.removeSystem=function(A){var T=this.addedSystems.indexOf(A);if(-1!==T){A.active=!1,A.deactivate&&A.deactivate(),this.addedSystems.splice(T,1);for(var E=0;E<this.systems.length;E++)this.systems[E].system===A&&this.systems.splice(E,1);return!0}return!1},t.prototype.update=function(A){for(var T in this.systems){var E=this.systems[T].system;if(E.active&&E.update)try{E.update(A)}catch(A){d(A)}}return this},t.prototype.getEntitiesWithComponent=function(A){var T="string"==typeof A?A:L(A);return T in this.entityLists?this.entityLists[T]:this.entityLists[T]={}},t.prototype.registerComponent=function(A){var T=D(A),E=L(A),R=N(A);this._disposableComponents[T]=A,null!==R&&(this.eventManager.fireEvent(new K(T,E,R)),this.eventManager.fireEvent(new $(T,A)))},t.prototype.disposeComponent=function(A){var T=D(A);return delete this._disposableComponents[T]&&(this.eventManager.fireEvent(new J(T)),A.onDispose&&A.onDispose(),!0)},t.prototype.updateComponent=function(A){this.eventManager.fireEvent(new $(D(A),A))},t.prototype.getComponentGroup=function(){for(var A=[],T=0;T<arguments.length;T++)A[T]=arguments[T];var E=void 0;if(A.length>0&&(H=this._componentGroups[L(A[0])]))for(var R=A.slice(),z=0;z<H.length;z++){var O=H[z];if(R.length===O.requires.length){for(var V=0;V<R.length&&-1!==O.requires.indexOf(R[V]);V++)V===R.length-1&&(E=O);if(E)break}}if(E)return E;(E=new(nt.bind.apply(nt,h([void 0],p(A))))).active=!0;var U=E.requiresNames;for(z=0;z<U.length;z++){var H,G=U[z];(H=this._componentGroups[G])||(this._componentGroups[G]=H=[]),-1===H.indexOf(E)&&H.push(E)}for(var X in this._entities)this.checkRequirements(this._entities[X],E);return E},t.prototype.removeComponentGroup=function(A){if(A.active){A.active=!1;for(var T=A.requiresNames,E=0;E<T.length;E++){var R=T[E],z=this._componentGroups[R];if(z){var O=z.indexOf(A);-1!==O&&z.splice(O,1)}}return!0}return!1},t.prototype.registerSystem=function(A){A.active=!0,A.activate&&A.activate(this),this.simpleSystems.push(A)},t.prototype.checkRequirementsAndAdd=function(A){if(A.isAddedToEngine()){for(var T in A.components){T in this.entityLists||(this.entityLists[T]={}),this.entityLists[T][A.uuid]=A;var E=this._componentGroups[T];if(E)for(var R in E)this.checkRequirements(A,E[R])}for(var z=0;z<this.simpleSystems.length;z++){var O=this.simpleSystems[z];O.onAddEntity&&O.onAddEntity(A)}}},t.prototype.checkRequirements=function(A,T){T.meetsRequirements(A)?T.hasEntity(A)||T.addEntity(A):T.hasEntity(A)&&T.removeEntity(A)},t.prototype.componentAddedHandler=function(A){var T,E=A.entity,R=A.componentName;if(E.isAddedToEngine()){this.entityLists[R]?this.entityLists[R][E.uuid]=E:this.entityLists[R]=((T={})[E.uuid]=E,T);var z=this._componentGroups[R];if(z)for(var O in z)this.checkRequirements(E,z[O])}},t.prototype.componentRemovedHandler=function(A){var T=A.entity,E=A.componentName;if(T.isAddedToEngine()){delete this.entityLists[E][T.uuid];var R=this._componentGroups[E];if(R)for(var z in R)this.checkRequirements(T,R[z])}},t}(),rt=Promise.resolve().then.bind(Promise.resolve());function W(A){var T=rt(A);return T.isComplete=!1,T.then((function(A){T.isComplete=!0,T.result=A,T.didFail=!1})).catch((function(A){T.isComplete=!0,T.error=A,T.didFail=!0,d("executeTask: FAILED "+A.toString(),A)})),T}var st,at,ut=function(){function t(A,T,E,R){void 0===T&&(T=!1),this.initalize(A,T,E,R)}return t.prototype.initalize=function(A,T,E,R){return void 0===T&&(T=!1),this.mask=A,this.skipNextObservers=T,this.target=E,this.currentTarget=R,this},t}(),Y=function(A,T,E){void 0===E&&(E=null),this.callback=A,this.mask=T,this.scope=E,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},lt=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(A,T,E,R){var z,O;void 0===E&&(E=-1),void 0===R&&(R=null);var V=new t;V._observers=new Array,V._observables=A;try{for(var U=u(A),H=U.next();!H.done;H=U.next()){var G=H.value.add(T,E,!1,R);G&&V._observers.push(G)}}catch(A){z={error:A}}finally{try{H&&!H.done&&(O=U.return)&&O.call(U)}finally{if(z)throw z.error}}return V},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var A=0;A<this._observers.length;A++)this._observables[A].remove(this._observers[A]);this._observers=null,this._observables=null},t}(),ht=function(){function t(A){this._observers=new Array,this._onObserverAdded=null,this._eventState=new ut(0),A&&(this._onObserverAdded=A)}return t.prototype.add=function(A,T,E,R,z){if(void 0===T&&(T=-1),void 0===E&&(E=!1),void 0===R&&(R=null),void 0===z&&(z=!1),!A)return null;var O=new Y(A,T,R);return O.unregisterOnNextCall=z,E?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},t.prototype.addOnce=function(A){return this.add(A,void 0,void 0,void 0,!0)},t.prototype.remove=function(A){return!!A&&-1!==this._observers.indexOf(A)&&(this._deferUnregister(A),!0)},t.prototype.removeCallback=function(A,T){for(var E=0;E<this._observers.length;E++)if(this._observers[E].callback===A&&(!T||T===this._observers[E].scope))return this._deferUnregister(this._observers[E]),!0;return!1},t.prototype.notifyObservers=function(A,T,E,R){var z,O;if(void 0===T&&(T=-1),!this._observers.length)return!0;var V=this._eventState;V.mask=T,V.target=E,V.currentTarget=R,V.skipNextObservers=!1,V.lastReturnValue=A;try{for(var U=u(this._observers),H=U.next();!H.done;H=U.next()){var G=H.value;if(!G._willBeUnregistered&&(G.mask&T&&(G.scope?V.lastReturnValue=G.callback.apply(G.scope,[A,V]):V.lastReturnValue=G.callback(A,V),G.unregisterOnNextCall&&this._deferUnregister(G)),V.skipNextObservers))return!1}}catch(A){z={error:A}}finally{try{H&&!H.done&&(O=U.return)&&O.call(U)}finally{if(z)throw z.error}}return!0},t.prototype.notifyObserversWithPromise=function(A,T,E,R){var z=this;void 0===T&&(T=-1);var O=Promise.resolve(A);if(!this._observers.length)return O;var V=this._eventState;return V.mask=T,V.target=E,V.currentTarget=R,V.skipNextObservers=!1,this._observers.forEach((function(E){V.skipNextObservers||E._willBeUnregistered||E.mask&T&&(O=E.scope?O.then((function(T){return V.lastReturnValue=T,E.callback.apply(E.scope,[A,V])})):O.then((function(T){return V.lastReturnValue=T,E.callback(A,V)})),E.unregisterOnNextCall&&z._deferUnregister(E))})),O.then((function(){return A}))},t.prototype.notifyObserver=function(A,T,E){void 0===E&&(E=-1);var R=this._eventState;R.mask=E,R.skipNextObservers=!1,A.callback(T,R)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var A=new t;return A._observers=this._observers.slice(0),A},t.prototype.hasSpecificMask=function(A){var T,E;void 0===A&&(A=-1);try{for(var R=u(this._observers),z=R.next();!z.done;z=R.next()){var O=z.value;if(O.mask&A||O.mask===A)return!0}}catch(A){T={error:A}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(T)throw T.error}}return!1},t.prototype._deferUnregister=function(A){var T=this;A.unregisterOnNextCall=!1,A._willBeUnregistered=!0,W((function(){return function(A,T,E,R){return new(E||(E=Promise))((function(T,z){function s(A){try{u(R.next(A))}catch(A){z(A)}}function a(A){try{u(R.throw(A))}catch(A){z(A)}}function u(A){var R;A.done?T(A.value):(R=A.value,R instanceof E?R:new E((function(A){A(R)}))).then(s,a)}u((R=R.apply(A,[])).next())}))}(T,0,void 0,(function(){return function(A,T){var E,R,z,O,V={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(U){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(z=2&O[0]?R.return:O[0]?R.throw||((z=R.return)&&z.call(R),0):R.next)&&!(z=z.call(R,O[1])).done)return z;switch(R=0,z&&(O=[2&O[0],z.value]),O[0]){case 0:case 1:z=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((z=(z=V.trys).length>0&&z[z.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!z||O[1]>z[0]&&O[1]<z[3])){V.label=O[1];break}if(6===O[0]&&V.label<z[1]){V.label=z[1],z=O;break}if(z&&V.label<z[2]){V.label=z[2],V.ops.push(O);break}z[2]&&V.ops.pop(),V.trys.pop();continue}O=T.call(A,V)}catch(A){O=[6,A],R=0}finally{E=z=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,U])}}}(this,(function(T){return[2,this._remove(A)]}))}))}))},t.prototype._remove=function(A){if(!A)return!1;var T=this._observers.indexOf(A);return-1!==T&&(this._observers.splice(T,1),!0)},t}(),ct=r([x()],(function(A,T){this.uuid=A,this.payload=T})),pt=r([x()],(function(A){this.payload=A})),dt=r([x()],(function(A){this.payload=A}));function tt(A){return function(){at&&at.subscribe(A)}}var ft=new ht(tt("cameraModeChanged")),vt=new ht(tt("idleStateChanged")),mt=new ht(tt("onEnterScene")),gt=mt,wt=new ht(tt("onLeaveScene")),bt=wt,xt=new ht(tt("sceneStart")),At=new ht(tt("playerExpression")),Tt=new ht(tt("onPointerLock")),St=new ht(tt("videoEvent")),Et=new ht(tt("profileChanged")),Ct=new ht(tt("playerConnected")),It=new ht(tt("playerDisconnected")),Rt=new ht(tt("onRealmChanged"));function yt(A){(at=A)&&at.onEvent((function(A){switch(A.type){case"onEnterScene":return void mt.notifyObservers(A.data);case"onLeaveScene":return void wt.notifyObservers(A.data);case"cameraModeChanged":return void ft.notifyObservers(A.data);case"idleStateChanged":return void vt.notifyObservers(A.data);case"sceneStart":return void xt.notifyObservers(A.data);case"playerExpression":return void At.notifyObservers(A.data);case"videoEvent":var T=A.data,E=F.engine.disposableComponents[T.componentId];return E&&E.update(T),void St.notifyObservers(T);case"profileChanged":return void Et.notifyObservers(A.data);case"onPointerLock":return void Tt.notifyObservers(A.data);case"playerConnected":return void Ct.notifyObservers(A.data);case"playerDisconnected":return void It.notifyObservers(A.data);case"onRealmChanged":return void Rt.notifyObservers(A.data)}}))}var _t,zt,Pt=function(){function t(A){this.dcl=A,this.cachedComponents={}}return t.prototype.activate=function(A){var T=this;this.engine=A,A.eventManager.addListener(U,this,this.componentAdded),A.eventManager.addListener(V,this,this.componentRemoved),A.eventManager.addListener(K,this,this.disposableComponentCreated),A.eventManager.addListener(J,this,this.disposableComponentRemoved),A.eventManager.addListener($,this,this.disposableComponentUpdated),A.eventManager.addListener(H,this,this.parentChanged);var E=A.rootEntity.uuid;this.dcl.addEntity(E),this.dcl.onUpdate((function(E){A.update(E),T.presentEntities()})),this.dcl.onEvent((function(T){var E=T.data;switch(T.type){case"uuidEvent":A.eventManager.fireEvent(new ct(E.uuid,E.payload));break;case"raycastResponse":("HitFirst"===E.queryType||"HitAll"===E.queryType)&&A.eventManager.fireEvent(new pt(E));break;case"actionButtonEvent":A.eventManager.fireEvent(new dt(E.payload))}}))},t.prototype.onAddEntity=function(A){if(A&&A.isAddedToEngine()){var T=A.uuid,E=A.getParent();for(var R in this.dcl.addEntity(T),E&&this.dcl.setParent(T,E.uuid),this.cachedComponents[T]={},A.components){var z=A.components[R],O=N(z);if(null!==O)if(B(z))this.dcl.attachEntityComponent(A.uuid,R,D(z));else{var V=JSON.stringify(z);this.dcl.updateEntityComponent(T,R,O,V),this.cachedComponents[T][R]=V}}}},t.prototype.onRemoveEntity=function(A){if(A.isAddedToEngine()){var T=A.uuid;this.dcl.removeEntity(T),delete this.cachedComponents[T]}},t.prototype.presentEntities=function(){for(var A in this.engine.entities){var T=this.engine.entities[A];for(var E in T.components){var R=N(V=T.components[E]);if(null!==R&&!B(V)){var z=this.getJsonIfDirty(T.uuid,E,V);z&&(this.dcl.updateEntityComponent(T.uuid,E,R,z),this.clearDirty(T.uuid,E,V,z))}}}for(var O in this.engine.disposableComponents){var V;(V=this.engine.disposableComponents[O])instanceof et&&V.dirty&&(this.dcl.componentUpdated(O,JSON.stringify(V)),V.dirty=!1)}},t.prototype.componentAdded=function(A){if(A.entity.isAddedToEngine()){var T=A.entity.components[A.componentName];if(B(T))this.dcl.attachEntityComponent(A.entity.uuid,A.componentName,D(T));else if(null!==A.classId){var E=JSON.stringify(T);this.dcl.updateEntityComponent(A.entity.uuid,A.componentName,A.classId,E),this.cachedComponents[A.entity.uuid][A.componentName]=E}}},t.prototype.componentRemoved=function(A){A.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(A.entity.uuid,A.componentName),delete this.cachedComponents[A.entity.uuid][A.componentName])},t.prototype.disposableComponentCreated=function(A){this.dcl.componentCreated(A.componentId,A.componentName,A.classId)},t.prototype.disposableComponentRemoved=function(A){this.dcl.componentDisposed(A.componentId)},t.prototype.disposableComponentUpdated=function(A){this.dcl.componentUpdated(A.componentId,JSON.stringify(A.component))},t.prototype.parentChanged=function(A){this.dcl.setParent(A.entity.uuid,A.parent?A.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(A,T,E){var R=JSON.stringify(E);return R!==this.cachedComponents[A][T]&&R},t.prototype.clearDirty=function(A,T,E,R){this.cachedComponents[A][T]=R},t}();A.Orientation=void 0,(_t=A.Orientation||(A.Orientation={}))[_t.CW=0]="CW",_t[_t.CCW=1]="CCW",A.Space=void 0,(zt=A.Space||(A.Space={}))[zt.LOCAL=0]="LOCAL",zt[zt.WORLD=1]="WORLD",zt[zt.BONE=2]="BONE";var Bt,Mt,Ot,Lt,Nt=1/2.2,kt=2.2,qt=1e-6,Wt=Math.PI/180,Dt=360/(2*Math.PI),Vt=function(){function t(){}return t.WithinEpsilon=function(A,T,E){void 0===E&&(E=1401298e-51);var R=A-T;return-E<=R&&R<=E},t.ToHex=function(A){var T=A.toString(16);return A<=15?("0"+T).toUpperCase():T.toUpperCase()},t.Sign=function(A){var T=+A;return 0===T||isNaN(T)?T:T>0?1:-1},t.Clamp=function(A,T,E){return void 0===T&&(T=0),void 0===E&&(E=1),Math.min(E,Math.max(T,A))},t.Log2=function(A){return Math.log(A)*Math.LOG2E},t.Repeat=function(A,T){return A-Math.floor(A/T)*T},t.Normalize=function(A,T,E){return(A-T)/(E-T)},t.Denormalize=function(A,T,E){return A*(E-T)+T},t.DeltaAngle=function(A,T){var E=t.Repeat(T-A,360);return E>180&&(E-=360),E},t.PingPong=function(A,T){var E=t.Repeat(A,2*T);return T-Math.abs(E-T)},t.SmoothStep=function(A,T,E){var R=t.Clamp(E);return T*(R=-2*R*R*R+3*R*R)+A*(1-R)},t.MoveTowards=function(A,T,E){return Math.abs(T-A)<=E?T:A+t.Sign(T-A)*E},t.MoveTowardsAngle=function(A,T,E){var R=t.DeltaAngle(A,T);return-E<R&&R<E?T:t.MoveTowards(A,A+R,E)},t.Lerp=function(A,T,E){return A+(T-A)*E},t.LerpAngle=function(A,T,E){var R=t.Repeat(T-A,360);return R>180&&(R-=360),A+R*t.Clamp(E)},t.InverseLerp=function(A,T,E){return A!==T?t.Clamp((E-A)/(T-A)):0},t.Hermite=function(A,T,E,R,z){var O=z*z,V=z*O;return A*(2*V-3*O+1)+E*(-2*V+3*O)+T*(V-2*O+z)+R*(V-O)},t.RandomRange=function(A,T){return A===T?A:Math.random()*(T-A)+A},t.RangeToPercent=function(A,T,E){return(A-T)/(E-T)},t.PercentToRange=function(A,T,E){return(E-T)*A+T},t.NormalizeRadians=function(A){return A-t.TwoPi*Math.floor((A+Math.PI)/t.TwoPi)},t.TwoPi=2*Math.PI,t}(),Ut=function(){function t(A,T,E,R){this.x=A,this.y=T,this.z=E,this.w=R}return t.Add=function(A,T){return new t(A.x,A.y,A.z,A.w).addInPlace(T)},t.FromArray=function(A,T){return void 0===T&&(T=0),new t(A[T],A[T+1],A[T+2],A[T+3])},t.FromArrayToRef=function(A,T,E){E.x=A[T],E.y=A[T+1],E.z=A[T+2],E.w=A[T+3]},t.FromFloatArrayToRef=function(A,T,E){t.FromArrayToRef(A,T,E)},t.FromFloatsToRef=function(A,T,E,R,z){z.x=A,z.y=T,z.z=E,z.w=R},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(A){var T=t.Zero();return t.NormalizeToRef(A,T),T},t.NormalizeToRef=function(A,T){T.copyFrom(A),T.normalize()},t.Minimize=function(A,T){var E=new t(A.x,A.y,A.z,A.w);return E.minimizeInPlace(T),E},t.Maximize=function(A,T){var E=new t(A.x,A.y,A.z,A.w);return E.maximizeInPlace(T),E},t.Distance=function(A,T){return Math.sqrt(t.DistanceSquared(A,T))},t.DistanceSquared=function(A,T){var E=A.x-T.x,R=A.y-T.y,z=A.z-T.z,O=A.w-T.w;return E*E+R*R+z*z+O*O},t.Center=function(A,T){var E=t.Add(A,T);return E.scaleInPlace(.5),E},t.TransformNormal=function(A,T){var E=t.Zero();return t.TransformNormalToRef(A,T,E),E},t.TransformNormalToRef=function(A,T,E){var R=T.m,z=A.x*R[0]+A.y*R[4]+A.z*R[8],O=A.x*R[1]+A.y*R[5]+A.z*R[9],V=A.x*R[2]+A.y*R[6]+A.z*R[10];E.x=z,E.y=O,E.z=V,E.w=A.w},t.TransformNormalFromFloatsToRef=function(A,T,E,R,z,O){var V=z.m;O.x=A*V[0]+T*V[4]+E*V[8],O.y=A*V[1]+T*V[5]+E*V[9],O.z=A*V[2]+T*V[6]+E*V[10],O.w=R},t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var A=this.x||0;return 397*(A=397*(A=397*A^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.toArray=function(A,T){return void 0===T&&(T=0),A[T]=this.x,A[T+1]=this.y,A[T+2]=this.z,A[T+3]=this.w,this},t.prototype.addInPlace=function(A){return this.x+=A.x,this.y+=A.y,this.z+=A.z,this.w+=A.w,this},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y,this.z+A.z,this.w+A.w)},t.prototype.addToRef=function(A,T){return T.x=this.x+A.x,T.y=this.y+A.y,T.z=this.z+A.z,T.w=this.w+A.w,this},t.prototype.subtractInPlace=function(A){return this.x-=A.x,this.y-=A.y,this.z-=A.z,this.w-=A.w,this},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y,this.z-A.z,this.w-A.w)},t.prototype.subtractToRef=function(A,T){return T.x=this.x-A.x,T.y=this.y-A.y,T.z=this.z-A.z,T.w=this.w-A.w,this},t.prototype.subtractFromFloats=function(A,T,E,R){return new t(this.x-A,this.y-T,this.z-E,this.w-R)},t.prototype.subtractFromFloatsToRef=function(A,T,E,R,z){return z.x=this.x-A,z.y=this.y-T,z.z=this.z-E,z.w=this.w-R,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},t.prototype.scale=function(A){return new t(this.x*A,this.y*A,this.z*A,this.w*A)},t.prototype.scaleToRef=function(A,T){return T.x=this.x*A,T.y=this.y*A,T.z=this.z*A,T.w=this.w*A,this},t.prototype.scaleAndAddToRef=function(A,T){return T.x+=this.x*A,T.y+=this.y*A,T.z+=this.z*A,T.w+=this.w*A,this},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y&&this.z===A.z&&this.w===A.w},t.prototype.equalsWithEpsilon=function(A,T){return void 0===T&&(T=qt),A&&Vt.WithinEpsilon(this.x,A.x,T)&&Vt.WithinEpsilon(this.y,A.y,T)&&Vt.WithinEpsilon(this.z,A.z,T)&&Vt.WithinEpsilon(this.w,A.w,T)},t.prototype.equalsToFloats=function(A,T,E,R){return this.x===A&&this.y===T&&this.z===E&&this.w===R},t.prototype.multiplyInPlace=function(A){return this.x*=A.x,this.y*=A.y,this.z*=A.z,this.w*=A.w,this},t.prototype.multiply=function(A){return new t(this.x*A.x,this.y*A.y,this.z*A.z,this.w*A.w)},t.prototype.multiplyToRef=function(A,T){return T.x=this.x*A.x,T.y=this.y*A.y,T.z=this.z*A.z,T.w=this.w*A.w,this},t.prototype.multiplyByFloats=function(A,T,E,R){return new t(this.x*A,this.y*T,this.z*E,this.w*R)},t.prototype.divide=function(A){return new t(this.x/A.x,this.y/A.y,this.z/A.z,this.w/A.w)},t.prototype.divideToRef=function(A,T){return T.x=this.x/A.x,T.y=this.y/A.y,T.z=this.z/A.z,T.w=this.w/A.w,this},t.prototype.divideInPlace=function(A){return this.divideToRef(A,this)},t.prototype.minimizeInPlace=function(A){return A.x<this.x&&(this.x=A.x),A.y<this.y&&(this.y=A.y),A.z<this.z&&(this.z=A.z),A.w<this.w&&(this.w=A.w),this},t.prototype.maximizeInPlace=function(A){return A.x>this.x&&(this.x=A.x),A.y>this.y&&(this.y=A.y),A.z>this.z&&(this.z=A.z),A.w>this.w&&(this.w=A.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var A=this.length();return 0===A?this:this.scaleInPlace(1/A)},t.prototype.toVector3=function(){return new Gt(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this.w=A.w,this},t.prototype.copyFromFloats=function(A,T,E,R){return this.x=A,this.y=T,this.z=E,this.w=R,this},t.prototype.set=function(A,T,E,R){return this.copyFromFloats(A,T,E,R)},t.prototype.setAll=function(A){return this.x=this.y=this.z=this.w=A,this},t}(),Ht=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}return Object.defineProperty(t.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!1,configurable:!0}),t.FromArray=function(A,T){void 0===T&&(T=0);var E=new t;return t.FromArrayToRef(A,T,E),E},t.FromArrayToRef=function(A,T,E){for(var R=0;R<16;R++)E._m[R]=A[R+T];E._markAsUpdated()},t.FromFloatArrayToRefScaled=function(A,T,E,R){for(var z=0;z<16;z++)R._m[z]=A[z+T]*E;R._markAsUpdated()},t.FromValuesToRef=function(A,T,E,R,z,O,V,U,H,G,X,Q,Z,K,J,$,et){var nt=et._m;nt[0]=A,nt[1]=T,nt[2]=E,nt[3]=R,nt[4]=z,nt[5]=O,nt[6]=V,nt[7]=U,nt[8]=H,nt[9]=G,nt[10]=X,nt[11]=Q,nt[12]=Z,nt[13]=K,nt[14]=J,nt[15]=$,et._markAsUpdated()},t.FromValues=function(A,T,E,R,z,O,V,U,H,G,X,Q,Z,K,J,$){var et=new t,nt=et._m;return nt[0]=A,nt[1]=T,nt[2]=E,nt[3]=R,nt[4]=z,nt[5]=O,nt[6]=V,nt[7]=U,nt[8]=H,nt[9]=G,nt[10]=X,nt[11]=Q,nt[12]=Z,nt[13]=K,nt[14]=J,nt[15]=$,et._markAsUpdated(),et},t.Compose=function(A,T,E){var R=new t;return t.ComposeToRef(A,T,E,R),R},t.ComposeToRef=function(A,T,E,R){t.ScalingToRef(A.x,A.y,A.z,Xt.Matrix[1]),T.toRotationMatrix(Xt.Matrix[0]),Xt.Matrix[1].multiplyToRef(Xt.Matrix[0],R),R.setTranslation(E)},t.Identity=function(){var A=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return A._updateIdentityStatus(!0),A},t.IdentityToRef=function(A){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(!0)},t.Zero=function(){var A=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return A._updateIdentityStatus(!1),A},t.RotationX=function(A){var T=new t;return t.RotationXToRef(A,T),T},t.Invert=function(A){var T=new t;return A.invertToRef(T),T},t.RotationXToRef=function(A,T){var E=Math.sin(A),R=Math.cos(A);t.FromValuesToRef(1,0,0,0,0,R,E,0,0,-E,R,0,0,0,0,1,T),T._updateIdentityStatus(1===R&&0===E)},t.RotationY=function(A){var T=new t;return t.RotationYToRef(A,T),T},t.RotationYToRef=function(A,T){var E=Math.sin(A),R=Math.cos(A);t.FromValuesToRef(R,0,-E,0,0,1,0,0,E,0,R,0,0,0,0,1,T),T._updateIdentityStatus(1===R&&0===E)},t.RotationZ=function(A){var T=new t;return t.RotationZToRef(A,T),T},t.RotationZToRef=function(A,T){var E=Math.sin(A),R=Math.cos(A);t.FromValuesToRef(R,E,0,0,-E,R,0,0,0,0,1,0,0,0,0,1,T),T._updateIdentityStatus(1===R&&0===E)},t.RotationAxis=function(A,T){var E=new t;return t.RotationAxisToRef(A,T,E),E},t.RotationAxisToRef=function(A,T,E){var R=Math.sin(-T),z=Math.cos(-T),O=1-z;A.normalize();var V=E._m;V[0]=A.x*A.x*O+z,V[1]=A.x*A.y*O-A.z*R,V[2]=A.x*A.z*O+A.y*R,V[3]=0,V[4]=A.y*A.x*O+A.z*R,V[5]=A.y*A.y*O+z,V[6]=A.y*A.z*O-A.x*R,V[7]=0,V[8]=A.z*A.x*O-A.y*R,V[9]=A.z*A.y*O+A.x*R,V[10]=A.z*A.z*O+z,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,E._markAsUpdated()},t.RotationYawPitchRoll=function(A,T,E){var R=new t;return t.RotationYawPitchRollToRef(A,T,E,R),R},t.RotationYawPitchRollToRef=function(A,T,E,R){jt.RotationYawPitchRollToRef(A,T,E,Xt.Quaternion[0]),Xt.Quaternion[0].toRotationMatrix(R)},t.Scaling=function(A,T,E){var R=new t;return t.ScalingToRef(A,T,E,R),R},t.ScalingToRef=function(A,T,E,R){t.FromValuesToRef(A,0,0,0,0,T,0,0,0,0,E,0,0,0,0,1,R),R._updateIdentityStatus(1===A&&1===T&&1===E)},t.Translation=function(A,T,E){var R=new t;return t.TranslationToRef(A,T,E,R),R},t.TranslationToRef=function(A,T,E,R){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,A,T,E,1,R),R._updateIdentityStatus(0===A&&0===T&&0===E)},t.Lerp=function(A,T,E){var R=new t;return t.LerpToRef(A,T,E,R),R},t.LerpToRef=function(A,T,E,R){for(var z=0;z<16;z++)R._m[z]=A._m[z]*(1-E)+T._m[z]*E;R._markAsUpdated()},t.DecomposeLerp=function(A,T,E){var R=new t;return t.DecomposeLerpToRef(A,T,E,R),R},t.DecomposeLerpToRef=function(A,T,E,R){var z=Xt.Vector3[0],O=Xt.Quaternion[0],V=Xt.Vector3[1];A.decompose(z,O,V);var U=Xt.Vector3[2],H=Xt.Quaternion[1],G=Xt.Vector3[3];T.decompose(U,H,G);var X=Xt.Vector3[4];Gt.LerpToRef(z,U,E,X);var Q=Xt.Quaternion[2];jt.SlerpToRef(O,H,E,Q);var Z=Xt.Vector3[5];Gt.LerpToRef(V,G,E,Z),t.ComposeToRef(X,Q,Z,R)},t.LookAtLH=function(A,T,E){var R=new t;return t.LookAtLHToRef(A,T,E,R),R},t.LookAtLHToRef=function(A,T,E,R){var z=Xt.Vector3[0],O=Xt.Vector3[1],V=Xt.Vector3[2];T.subtractToRef(A,V),V.normalize(),Gt.CrossToRef(E,V,z);var U=z.lengthSquared();0===U?z.x=1:z.normalizeFromLength(Math.sqrt(U)),Gt.CrossToRef(V,z,O),O.normalize();var H=-Gt.Dot(z,A),G=-Gt.Dot(O,A),X=-Gt.Dot(V,A);t.FromValuesToRef(z.x,O.x,V.x,0,z.y,O.y,V.y,0,z.z,O.z,V.z,0,H,G,X,1,R)},t.LookAtRH=function(A,T,E){var R=new t;return t.LookAtRHToRef(A,T,E,R),R},t.LookAtRHToRef=function(A,T,E,R){var z=Xt.Vector3[0],O=Xt.Vector3[1],V=Xt.Vector3[2];A.subtractToRef(T,V),V.normalize(),Gt.CrossToRef(E,V,z);var U=z.lengthSquared();0===U?z.x=1:z.normalizeFromLength(Math.sqrt(U)),Gt.CrossToRef(V,z,O),O.normalize();var H=-Gt.Dot(z,A),G=-Gt.Dot(O,A),X=-Gt.Dot(V,A);t.FromValuesToRef(z.x,O.x,V.x,0,z.y,O.y,V.y,0,z.z,O.z,V.z,0,H,G,X,1,R)},t.OrthoLH=function(A,T,E,R){var z=new t;return t.OrthoLHToRef(A,T,E,R,z),z},t.OrthoLHToRef=function(A,T,E,R,z){var O=2/A,V=2/T,U=2/(R-E),H=-(R+E)/(R-E);t.FromValuesToRef(O,0,0,0,0,V,0,0,0,0,U,0,0,0,H,1,z),z._updateIdentityStatus(1===O&&1===V&&1===U&&0===H)},t.OrthoOffCenterLH=function(A,T,E,R,z,O){var V=new t;return t.OrthoOffCenterLHToRef(A,T,E,R,z,O,V),V},t.OrthoOffCenterLHToRef=function(A,T,E,R,z,O,V){var U=2/(T-A),H=2/(R-E),G=2/(O-z),X=-(O+z)/(O-z),Q=(A+T)/(A-T),Z=(R+E)/(E-R);t.FromValuesToRef(U,0,0,0,0,H,0,0,0,0,G,0,Q,Z,X,1,V),V._markAsUpdated()},t.OrthoOffCenterRH=function(A,T,E,R,z,O){var V=new t;return t.OrthoOffCenterRHToRef(A,T,E,R,z,O,V),V},t.OrthoOffCenterRHToRef=function(A,T,E,R,z,O,V){t.OrthoOffCenterLHToRef(A,T,E,R,z,O,V),V._m[10]*=-1},t.PerspectiveLH=function(A,T,E,R){var z=new t,O=2*E/A,V=2*E/T,U=(R+E)/(R-E),H=-2*R*E/(R-E);return t.FromValuesToRef(O,0,0,0,0,V,0,0,0,0,U,1,0,0,H,0,z),z._updateIdentityStatus(!1),z},t.PerspectiveFovLH=function(A,T,E,R){var z=new t;return t.PerspectiveFovLHToRef(A,T,E,R,z),z},t.PerspectiveFovLHToRef=function(A,T,E,R,z,O){void 0===O&&(O=!0);var V=E,U=R,H=1/Math.tan(.5*A),G=O?H/T:H,X=O?H:H*T,Q=(U+V)/(U-V),Z=-2*U*V/(U-V);t.FromValuesToRef(G,0,0,0,0,X,0,0,0,0,Q,1,0,0,Z,0,z),z._updateIdentityStatus(!1)},t.PerspectiveFovRH=function(A,T,E,R){var z=new t;return t.PerspectiveFovRHToRef(A,T,E,R,z),z},t.PerspectiveFovRHToRef=function(A,T,E,R,z,O){void 0===O&&(O=!0);var V=E,U=R,H=1/Math.tan(.5*A),G=O?H/T:H,X=O?H:H*T,Q=-(U+V)/(U-V),Z=-2*U*V/(U-V);t.FromValuesToRef(G,0,0,0,0,X,0,0,0,0,Q,-1,0,0,Z,0,z),z._updateIdentityStatus(!1)},t.PerspectiveFovWebVRToRef=function(A,T,E,R,z){void 0===z&&(z=!1);var O=z?-1:1,V=Math.tan(A.upDegrees*Math.PI/180),U=Math.tan(A.downDegrees*Math.PI/180),H=Math.tan(A.leftDegrees*Math.PI/180),G=Math.tan(A.rightDegrees*Math.PI/180),X=2/(H+G),Q=2/(V+U),Z=R._m;Z[0]=X,Z[1]=Z[2]=Z[3]=Z[4]=0,Z[5]=Q,Z[6]=Z[7]=0,Z[8]=(H-G)*X*.5,Z[9]=-(V-U)*Q*.5,Z[10]=-E/(T-E),Z[11]=1*O,Z[12]=Z[13]=Z[15]=0,Z[14]=-2*E*T/(E-T),R._markAsUpdated()},t.GetAsMatrix2x2=function(A){return[A._m[0],A._m[1],A._m[4],A._m[5]]},t.GetAsMatrix3x3=function(A){return[A._m[0],A._m[1],A._m[2],A._m[4],A._m[5],A._m[6],A._m[8],A._m[9],A._m[10]]},t.Transpose=function(A){var T=new t;return t.TransposeToRef(A,T),T},t.TransposeToRef=function(A,T){var E=T._m,R=A._m;E[0]=R[0],E[1]=R[4],E[2]=R[8],E[3]=R[12],E[4]=R[1],E[5]=R[5],E[6]=R[9],E[7]=R[13],E[8]=R[2],E[9]=R[6],E[10]=R[10],E[11]=R[14],E[12]=R[3],E[13]=R[7],E[14]=R[11],E[15]=R[15],T._updateIdentityStatus(A._isIdentity,A._isIdentityDirty)},t.Reflection=function(A){var T=new t;return t.ReflectionToRef(A,T),T},t.ReflectionToRef=function(A,T){A.normalize();var E=A.normal.x,R=A.normal.y,z=A.normal.z,O=-2*E,V=-2*R,U=-2*z;t.FromValuesToRef(O*E+1,V*E,U*E,0,O*R,V*R+1,U*R,0,O*z,V*z,U*z+1,0,O*A.d,V*A.d,U*A.d,1,T)},t.FromXYZAxesToRef=function(A,T,E,R){t.FromValuesToRef(A.x,A.y,A.z,0,T.x,T.y,T.z,0,E.x,E.y,E.z,0,0,0,0,1,R)},t.FromQuaternionToRef=function(A,T){var E=A.x*A.x,R=A.y*A.y,z=A.z*A.z,O=A.x*A.y,V=A.z*A.w,U=A.z*A.x,H=A.y*A.w,G=A.y*A.z,X=A.x*A.w;T._m[0]=1-2*(R+z),T._m[1]=2*(O+V),T._m[2]=2*(U-H),T._m[3]=0,T._m[4]=2*(O-V),T._m[5]=1-2*(z+E),T._m[6]=2*(G+X),T._m[7]=0,T._m[8]=2*(U+H),T._m[9]=2*(G-X),T._m[10]=1-2*(R+E),T._m[11]=0,T._m[12]=0,T._m[13]=0,T._m[14]=0,T._m[15]=1,T._markAsUpdated()},t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},t.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var A=this._m;this._isIdentity=1===A[0]&&0===A[1]&&0===A[2]&&0===A[3]&&0===A[4]&&1===A[5]&&0===A[6]&&0===A[7]&&0===A[8]&&0===A[9]&&1===A[10]&&0===A[11]&&0===A[12]&&0===A[13]&&0===A[14]&&1===A[15]}return this._isIdentity},t.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},t.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var A=this._m,T=A[0],E=A[1],R=A[2],z=A[3],O=A[4],V=A[5],U=A[6],H=A[7],G=A[8],X=A[9],Q=A[10],Z=A[11],K=A[12],J=A[13],$=A[14],et=A[15],nt=Q*et-$*Z,ot=X*et-J*Z,it=X*$-J*Q,rt=G*et-K*Z,st=G*$-Q*K,at=G*J-K*X;return T*+(V*nt-U*ot+H*it)+E*-(O*nt-U*rt+H*st)+R*+(O*ot-V*rt+H*at)+z*-(O*it-V*st+U*at)},t.prototype.toArray=function(){return this._m},t.prototype.asArray=function(){return this._m},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},t.prototype.add=function(A){var T=new t;return this.addToRef(A,T),T},t.prototype.addToRef=function(A,T){for(var E=0;E<16;E++)T._m[E]=this._m[E]+A._m[E];return T._markAsUpdated(),this},t.prototype.addToSelf=function(A){for(var T=0;T<16;T++)this._m[T]+=A._m[T];return this._markAsUpdated(),this},t.prototype.invertToRef=function(A){if(!0===this._isIdentity)return t.IdentityToRef(A),this;var T=this._m,E=T[0],R=T[1],z=T[2],O=T[3],V=T[4],U=T[5],H=T[6],G=T[7],X=T[8],Q=T[9],Z=T[10],K=T[11],J=T[12],$=T[13],et=T[14],nt=T[15],ot=Z*nt-et*K,it=Q*nt-$*K,rt=Q*et-$*Z,st=X*nt-J*K,at=X*et-Z*J,ut=X*$-J*Q,lt=+(U*ot-H*it+G*rt),ht=-(V*ot-H*st+G*at),ct=+(V*it-U*st+G*ut),pt=-(V*rt-U*at+H*ut),dt=E*lt+R*ht+z*ct+O*pt;if(0===dt)return A.copyFrom(this),this;var ft=1/dt,vt=H*nt-et*G,mt=U*nt-$*G,gt=U*et-$*H,wt=V*nt-J*G,bt=V*et-J*H,xt=V*$-J*U,At=H*K-Z*G,Tt=U*K-Q*G,St=U*Z-Q*H,Et=V*K-X*G,Ct=V*Z-X*H,It=V*Q-X*U,Rt=-(R*ot-z*it+O*rt),_t=+(E*ot-z*st+O*at),zt=-(E*it-R*st+O*ut),Pt=+(E*rt-R*at+z*ut),Bt=+(R*vt-z*mt+O*gt),Mt=-(E*vt-z*wt+O*bt),Ot=+(E*mt-R*wt+O*xt),Lt=-(E*gt-R*bt+z*xt),Nt=-(R*At-z*Tt+O*St),kt=+(E*At-z*Et+O*Ct),qt=-(E*Tt-R*Et+O*It),Wt=+(E*St-R*Ct+z*It);return t.FromValuesToRef(lt*ft,Rt*ft,Bt*ft,Nt*ft,ht*ft,_t*ft,Mt*ft,kt*ft,ct*ft,zt*ft,Ot*ft,qt*ft,pt*ft,Pt*ft,Lt*ft,Wt*ft,A),this},t.prototype.addAtIndex=function(A,T){return this._m[A]+=T,this._markAsUpdated(),this},t.prototype.multiplyAtIndex=function(A,T){return this._m[A]*=T,this._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(A,T,E){return this._m[12]=A,this._m[13]=T,this._m[14]=E,this._markAsUpdated(),this},t.prototype.setTranslation=function(A){return this.setTranslationFromFloats(A.x,A.y,A.z)},t.prototype.getTranslation=function(){return new Gt(this._m[12],this._m[13],this._m[14])},t.prototype.getTranslationToRef=function(A){return A.x=this._m[12],A.y=this._m[13],A.z=this._m[14],this},t.prototype.removeRotationAndScaling=function(){var A=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,A[12],A[13],A[14],A[15],this),this._updateIdentityStatus(0===A[12]&&0===A[13]&&0===A[14]&&1===A[15]),this},t.prototype.multiply=function(A){var T=new t;return this.multiplyToRef(A,T),T},t.prototype.copyFrom=function(A){A.copyToArray(this._m);var T=A;return this._updateIdentityStatus(T._isIdentity,T._isIdentityDirty,T._isIdentity3x2,T._isIdentity3x2Dirty),this},t.prototype.copyToArray=function(A,T){void 0===T&&(T=0);for(var E=0;E<16;E++)A[T+E]=this._m[E];return this},t.prototype.multiplyToRef=function(A,T){return this._isIdentity?(T.copyFrom(A),this):A._isIdentity?(T.copyFrom(this),this):(this.multiplyToArray(A,T._m,0),T._markAsUpdated(),this)},t.prototype.multiplyToArray=function(A,T,E){var R=this._m,z=A.m,O=R[0],V=R[1],U=R[2],H=R[3],G=R[4],X=R[5],Q=R[6],Z=R[7],K=R[8],J=R[9],$=R[10],et=R[11],nt=R[12],ot=R[13],it=R[14],rt=R[15],st=z[0],at=z[1],ut=z[2],lt=z[3],ht=z[4],ct=z[5],pt=z[6],dt=z[7],ft=z[8],vt=z[9],mt=z[10],gt=z[11],wt=z[12],bt=z[13],xt=z[14],At=z[15];return T[E]=O*st+V*ht+U*ft+H*wt,T[E+1]=O*at+V*ct+U*vt+H*bt,T[E+2]=O*ut+V*pt+U*mt+H*xt,T[E+3]=O*lt+V*dt+U*gt+H*At,T[E+4]=G*st+X*ht+Q*ft+Z*wt,T[E+5]=G*at+X*ct+Q*vt+Z*bt,T[E+6]=G*ut+X*pt+Q*mt+Z*xt,T[E+7]=G*lt+X*dt+Q*gt+Z*At,T[E+8]=K*st+J*ht+$*ft+et*wt,T[E+9]=K*at+J*ct+$*vt+et*bt,T[E+10]=K*ut+J*pt+$*mt+et*xt,T[E+11]=K*lt+J*dt+$*gt+et*At,T[E+12]=nt*st+ot*ht+it*ft+rt*wt,T[E+13]=nt*at+ot*ct+it*vt+rt*bt,T[E+14]=nt*ut+ot*pt+it*mt+rt*xt,T[E+15]=nt*lt+ot*dt+it*gt+rt*At,this},t.prototype.equals=function(A){var T=A;if(!T)return!1;if((this._isIdentity||T._isIdentity)&&!this._isIdentityDirty&&!T._isIdentityDirty)return this._isIdentity&&T._isIdentity;var E=this.m,R=T.m;return E[0]===R[0]&&E[1]===R[1]&&E[2]===R[2]&&E[3]===R[3]&&E[4]===R[4]&&E[5]===R[5]&&E[6]===R[6]&&E[7]===R[7]&&E[8]===R[8]&&E[9]===R[9]&&E[10]===R[10]&&E[11]===R[11]&&E[12]===R[12]&&E[13]===R[13]&&E[14]===R[14]&&E[15]===R[15]},t.prototype.clone=function(){var A=new t;return A.copyFrom(this),A},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var A=this._m[0]||0,T=1;T<16;T++)A=397*A^(this._m[T]||0);return A},t.prototype.decompose=function(A,T,E){if(this._isIdentity)return E&&E.setAll(0),A&&A.setAll(1),T&&T.copyFromFloats(0,0,0,1),!0;var R=this._m;E&&E.copyFromFloats(R[12],R[13],R[14]);var z=A||Xt.Vector3[0];if(z.x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),z.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),z.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),this.determinant()<=0&&(z.y*=-1),0===z.x||0===z.y||0===z.z)return T&&T.copyFromFloats(0,0,0,1),!1;if(T){var O=1/z.x,V=1/z.y,U=1/z.z;t.FromValuesToRef(R[0]*O,R[1]*O,R[2]*O,0,R[4]*V,R[5]*V,R[6]*V,0,R[8]*U,R[9]*U,R[10]*U,0,0,0,0,1,Xt.Matrix[0]),jt.FromRotationMatrixToRef(Xt.Matrix[0],T)}return!0},t.prototype.getRow=function(A){if(A<0||A>3)return null;var T=4*A;return new Ut(this._m[T+0],this._m[T+1],this._m[T+2],this._m[T+3])},t.prototype.setRow=function(A,T){return this.setRowFromFloats(A,T.x,T.y,T.z,T.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(A){return t.TransposeToRef(this,A),this},t.prototype.setRowFromFloats=function(A,T,E,R,z){if(A<0||A>3)return this;var O=4*A;return this._m[O+0]=T,this._m[O+1]=E,this._m[O+2]=R,this._m[O+3]=z,this._markAsUpdated(),this},t.prototype.scale=function(A){var T=new t;return this.scaleToRef(A,T),T},t.prototype.scaleToRef=function(A,T){for(var E=0;E<16;E++)T._m[E]=this._m[E]*A;return T._markAsUpdated(),this},t.prototype.scaleAndAddToRef=function(A,T){for(var E=0;E<16;E++)T._m[E]+=this._m[E]*A;return T._markAsUpdated(),this},t.prototype.toNormalMatrix=function(A){var T=Xt.Matrix[0];this.invertToRef(T),T.transposeToRef(A);var E=A._m;t.FromValuesToRef(E[0],E[1],E[2],0,E[4],E[5],E[6],0,E[8],E[9],E[10],0,0,0,0,1,A)},t.prototype.getRotationMatrix=function(){var A=new t;return this.getRotationMatrixToRef(A),A},t.prototype.getRotationMatrixToRef=function(A){var T=Xt.Vector3[0];if(!this.decompose(T))return t.IdentityToRef(A),this;var E=this._m,R=1/T.x,z=1/T.y,O=1/T.z;return t.FromValuesToRef(E[0]*R,E[1]*R,E[2]*R,0,E[4]*z,E[5]*z,E[6]*z,0,E[8]*O,E[9]*O,E[10]*O,0,0,0,0,1,A),this},t.prototype.toggleModelMatrixHandInPlace=function(){var A=this._m;A[2]*=-1,A[6]*=-1,A[8]*=-1,A[9]*=-1,A[14]*=-1,this._markAsUpdated()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var A=this._m;A[8]*=-1,A[9]*=-1,A[10]*=-1,A[11]*=-1,this._markAsUpdated()},t.prototype._updateIdentityStatus=function(A,T,E,R){void 0===T&&(T=!1),void 0===E&&(E=!1),void 0===R&&(R=!0),this.updateFlag=t._updateFlagSeed++,this._isIdentity=A,this._isIdentity3x2=A||E,this._isIdentityDirty=!this._isIdentity&&T,this._isIdentity3x2Dirty=!this._isIdentity3x2&&R},t._updateFlagSeed=0,t._identityReadOnly=t.Identity(),t}(),jt=function(){function t(A,T,E,R){void 0===A&&(A=0),void 0===T&&(T=0),void 0===E&&(E=0),void 0===R&&(R=1),this.x=A,this.y=T,this.z=E,this.w=R}return t.FromRotationMatrix=function(A){var T=new t;return t.FromRotationMatrixToRef(A,T),T},t.FromRotationMatrixToRef=function(A,T){var E,R=A.m,z=R[0],O=R[4],V=R[8],U=R[1],H=R[5],G=R[9],X=R[2],Q=R[6],Z=R[10],K=z+H+Z;K>0?(E=.5/Math.sqrt(K+1),T.w=.25/E,T.x=(Q-G)*E,T.y=(V-X)*E,T.z=(U-O)*E):z>H&&z>Z?(E=2*Math.sqrt(1+z-H-Z),T.w=(Q-G)/E,T.x=.25*E,T.y=(O+U)/E,T.z=(V+X)/E):H>Z?(E=2*Math.sqrt(1+H-z-Z),T.w=(V-X)/E,T.x=(O+U)/E,T.y=.25*E,T.z=(G+Q)/E):(E=2*Math.sqrt(1+Z-z-H),T.w=(U-O)/E,T.x=(V+X)/E,T.y=(G+Q)/E,T.z=.25*E)},t.Dot=function(A,T){return A.x*T.x+A.y*T.y+A.z*T.z+A.w*T.w},t.AreClose=function(A,T){return t.Dot(A,T)>=0},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(A){return new t(-A.x,-A.y,-A.z,A.w)},t.IsIdentity=function(A){return A&&0===A.x&&0===A.y&&0===A.z&&1===A.w},t.RotationAxis=function(A,T){var E=T*Wt;return t.RotationAxisToRef(A,E,new t)},t.RotationAxisToRef=function(A,T,E){var R=T*Wt,z=Math.sin(R/2);return A.normalize(),E.w=Math.cos(R/2),E.x=A.x*z,E.y=A.y*z,E.z=A.z*z,E},t.FromArray=function(A,T){return void 0===T&&(T=0),new t(A[T],A[T+1],A[T+2],A[T+3])},t.FromEulerAnglesRef=function(A,T,E,R){return t.RotationYawPitchRollToRef(T*Wt,A*Wt,E*Wt,R)},t.RotationYawPitchRoll=function(A,T,E){var R=new t;return t.RotationYawPitchRollToRef(A,T,E,R),R},t.RotationYawPitchRollToRef=function(A,T,E,R){var z=.5*T,O=.5*A,V=.5*E,U=Math.cos(z),H=Math.cos(O),G=Math.cos(V),X=Math.sin(z),Q=Math.sin(O),Z=Math.sin(V);R.x=H*X*G+Q*U*Z,R.y=Q*U*G-H*X*Z,R.z=H*U*Z-Q*X*G,R.w=H*U*G+Q*X*Z},t.RotationAlphaBetaGamma=function(A,T,E){var R=new t;return t.RotationAlphaBetaGammaToRef(A,T,E,R),R},t.RotationAlphaBetaGammaToRef=function(A,T,E,R){var z=.5*(E+A),O=.5*(E-A),V=.5*T;R.x=Math.cos(O)*Math.sin(V),R.y=Math.sin(O)*Math.sin(V),R.z=Math.sin(z)*Math.cos(V),R.w=Math.cos(z)*Math.cos(V)},t.RotationQuaternionFromAxis=function(A,T,E){var R=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(A,T,E,R),R},t.RotationQuaternionFromAxisToRef=function(A,T,E,R){var z=Xt.Matrix[0];Ht.FromXYZAxesToRef(A.normalize(),T.normalize(),E.normalize(),z),t.FromRotationMatrixToRef(z,R)},t.Slerp=function(A,T,E){var R=t.Identity;return t.SlerpToRef(A,T,E,R),R},t.SlerpToRef=function(A,T,E,R){var z,O,V=A.x*T.x+A.y*T.y+A.z*T.z+A.w*T.w,U=!1;if(V<0&&(U=!0,V=-V),V>.999999)O=1-E,z=U?-E:E;else{var H=Math.acos(V),G=1/Math.sin(H);O=Math.sin((1-E)*H)*G,z=U?-Math.sin(E*H)*G:Math.sin(E*H)*G}R.x=O*A.x+z*T.x,R.y=O*A.y+z*T.y,R.z=O*A.z+z*T.z,R.w=O*A.w+z*T.w},t.Hermite=function(A,T,E,R,z){var O=z*z,V=z*O,U=2*V-3*O+1,H=-2*V+3*O,G=V-2*O+z,X=V-O;return new t(A.x*U+E.x*H+T.x*G+R.x*X,A.y*U+E.y*H+T.y*G+R.y*X,A.z*U+E.z*H+T.z*G+R.z*X,A.w*U+E.w*H+T.w*G+R.w*X)},Object.defineProperty(t,"Identity",{get:function(){return new t(0,0,0,1)},enumerable:!1,configurable:!0}),t.Angle=function(A,T){var E=t.Dot(A,T);return 2*Math.acos(Math.min(Math.abs(E),1))*Dt},t.Euler=function(A,T,E){return t.RotationYawPitchRoll(T*Wt,A*Wt,E*Wt)},t.LookRotation=function(A,T){void 0===T&&(T=Xt.staticUp);var E=Gt.Normalize(A),R=Gt.Normalize(Gt.Cross(T,E)),z=Gt.Cross(E,R),O=R.x,V=R.y,U=R.z,H=z.x,G=z.y,X=z.z,Q=E.x,Z=E.y,K=E.z,J=O+G+K,$=new t;if(J>0){var et=Math.sqrt(J+1);return $.w=.5*et,et=.5/et,$.x=(X-Z)*et,$.y=(Q-U)*et,$.z=(V-H)*et,$}if(O>=G&&O>=K){var nt=Math.sqrt(1+O-G-K),ot=.5/nt;return $.x=.5*nt,$.y=(V+H)*ot,$.z=(U+Q)*ot,$.w=(X-Z)*ot,$}if(G>K){var it=Math.sqrt(1+G-O-K),rt=.5/it;return $.x=(H+V)*rt,$.y=.5*it,$.z=(Z+X)*rt,$.w=(Q-U)*rt,$}var st=Math.sqrt(1+K-O-G),at=.5/st;return $.x=(Q+U)*at,$.y=(Z+X)*at,$.z=.5*st,$.w=(V-H)*at,$},t.RotateTowards=function(A,T,E){var R=t.Angle(A,T);if(0===R)return T;var z=Math.min(1,E/R);return t.Slerp(A,T,z)},t.FromToRotation=function(A,T,E){void 0===E&&(E=Xt.staticUp);var R=A.normalize(),z=T.normalize(),O=Gt.Cross(R,z),V=Math.sqrt(R.lengthSquared()*z.lengthSquared())+Gt.Dot(R,z);return O.lengthSquared()<1e-4?Math.abs(V)<1e-4?new t(E.x,E.y,E.z,0).normalized:t.Identity:new t(O.x,O.y,O.z,V).normalized},Object.defineProperty(t.prototype,"normalized",{get:function(){return this.normalize()},enumerable:!1,configurable:!0}),t.prototype.setFromToRotation=function(A,T,E){void 0===E&&(E=Xt.staticUp);var R=t.FromToRotation(A,T,E);this.x=R.x,this.y=R.y,this.z=R.z,this.w=R.w},Object.defineProperty(t.prototype,"eulerAngles",{get:function(){var A=new Gt,T=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,E=this.x*this.w-this.y*this.z;return E>.4995*T?(A.x=Math.PI/2,A.y=2*Math.atan2(this.y,this.x),A.z=0):E<-.4995*T?(A.x=-Math.PI/2,A.y=-2*Math.atan2(this.y,this.x),A.z=0):(A.x=Math.asin(2*(this.w*this.x-this.y*this.z)),A.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),A.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),A.x*=Dt,A.y*=Dt,A.z*=Dt,A.x=Vt.Repeat(A.x,360),A.y=Vt.Repeat(A.y,360),A.z=Vt.Repeat(A.z,360),A},set:function(A){this.setEuler(A.x,A.y,A.z)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var A=this.x||0;return 397*(A=397*(A=397*A^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y&&this.z===A.z&&this.w===A.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this.w=A.w,this},t.prototype.copyFromFloats=function(A,T,E,R){return this.x=A,this.y=T,this.z=E,this.w=R,this},t.prototype.set=function(A,T,E,R){return this.copyFromFloats(A,T,E,R)},t.prototype.setEuler=function(A,T,E){return t.RotationYawPitchRollToRef(T*Wt,A*Wt,E*Wt,this),this},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y,this.z+A.z,this.w+A.w)},t.prototype.addInPlace=function(A){return this.x+=A.x,this.y+=A.y,this.z+=A.z,this.w+=A.w,this},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y,this.z-A.z,this.w-A.w)},t.prototype.scale=function(A){return new t(this.x*A,this.y*A,this.z*A,this.w*A)},t.prototype.scaleToRef=function(A,T){return T.x=this.x*A,T.y=this.y*A,T.z=this.z*A,T.w=this.w*A,this},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},t.prototype.scaleAndAddToRef=function(A,T){return T.x+=this.x*A,T.y+=this.y*A,T.z+=this.z*A,T.w+=this.w*A,this},t.prototype.multiply=function(A){var T=new t(0,0,0,1);return this.multiplyToRef(A,T),T},t.prototype.multiplyToRef=function(A,T){var E=this.x*A.w+this.y*A.z-this.z*A.y+this.w*A.x,R=-this.x*A.z+this.y*A.w+this.z*A.x+this.w*A.y,z=this.x*A.y-this.y*A.x+this.z*A.w+this.w*A.z,O=-this.x*A.x-this.y*A.y-this.z*A.z+this.w*A.w;return T.copyFromFloats(E,R,z,O),this},t.prototype.multiplyInPlace=function(A){return this.multiplyToRef(A,this),this},t.prototype.conjugateToRef=function(A){return A.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){return new t(-this.x,-this.y,-this.z,this.w)},t.prototype.normalize=function(){var A=1/this.length;return this.x*=A,this.y*=A,this.z*=A,this.w*=A,this},t.prototype.angleAxis=function(A,T){if(0===T.lengthSquared())return t.Identity;var E=t.Identity,R=A*Wt;R*=.5;var z=T.normalize();return z=T.scaleInPlace(Math.sin(R)),E.x=z.x,E.y=z.y,E.z=z.z,E.w=Math.cos(R),E.normalize()},t.prototype.toRotationMatrix=function(A){return Ht.FromQuaternionToRef(this,A),this},t.prototype.fromRotationMatrix=function(A){return t.FromRotationMatrixToRef(A,this),this},t}(),Gt=function(){function t(A,T,E){void 0===A&&(A=0),void 0===T&&(T=0),void 0===E&&(E=0),this.x=A,this.y=T,this.z=E}return Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var A=Math.abs(this.x),T=Math.abs(this.y);if(A!==T)return!0;var E=Math.abs(this.z);return A!==E||T!==E},enumerable:!1,configurable:!0}),t.Add=function(A,T){return new t(A.x,A.y,A.z).addInPlace(T)},t.GetClipFactor=function(A,T,E,R){var z=t.Dot(A,E)-R;return z/(z-(t.Dot(T,E)-R))},t.GetAngleBetweenVectors=function(A,T,E){var R=A.normalizeToRef(Xt.Vector3[1]),z=T.normalizeToRef(Xt.Vector3[2]),O=t.Dot(R,z),V=Xt.Vector3[3];return t.CrossToRef(R,z,V),t.Dot(V,E)>0?Math.acos(O):-Math.acos(O)},t.FromArray=function(A,T){return void 0===T&&(T=0),new t(A[T],A[T+1],A[T+2])},t.FromFloatArray=function(A,T){return t.FromArray(A,T)},t.FromArrayToRef=function(A,T,E){E.x=A[T],E.y=A[T+1],E.z=A[T+2]},t.FromFloatArrayToRef=function(A,T,E){return t.FromArrayToRef(A,T,E)},t.FromFloatsToRef=function(A,T,E,R){R.copyFromFloats(A,T,E)},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},t.Down=function(){return new t(0,-1,0)},t.Forward=function(){return new t(0,0,1)},t.Backward=function(){return new t(0,0,-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(A,T){var E=t.Zero();return t.TransformCoordinatesToRef(A,T,E),E},t.TransformCoordinatesToRef=function(A,T,E){return t.TransformCoordinatesFromFloatsToRef(A.x,A.y,A.z,T,E)},t.TransformCoordinatesFromFloatsToRef=function(A,T,E,R,z){var O=R.m,V=A*O[0]+T*O[4]+E*O[8]+O[12],U=A*O[1]+T*O[5]+E*O[9]+O[13],H=A*O[2]+T*O[6]+E*O[10]+O[14],G=1/(A*O[3]+T*O[7]+E*O[11]+O[15]);z.x=V*G,z.y=U*G,z.z=H*G},t.TransformNormal=function(A,T){var E=t.Zero();return t.TransformNormalToRef(A,T,E),E},t.TransformNormalToRef=function(A,T,E){this.TransformNormalFromFloatsToRef(A.x,A.y,A.z,T,E)},t.TransformNormalFromFloatsToRef=function(A,T,E,R,z){var O=R.m;z.x=A*O[0]+T*O[4]+E*O[8],z.y=A*O[1]+T*O[5]+E*O[9],z.z=A*O[2]+T*O[6]+E*O[10]},t.CatmullRom=function(A,T,E,R,z){var O=z*z,V=z*O;return new t(.5*(2*T.x+(-A.x+E.x)*z+(2*A.x-5*T.x+4*E.x-R.x)*O+(-A.x+3*T.x-3*E.x+R.x)*V),.5*(2*T.y+(-A.y+E.y)*z+(2*A.y-5*T.y+4*E.y-R.y)*O+(-A.y+3*T.y-3*E.y+R.y)*V),.5*(2*T.z+(-A.z+E.z)*z+(2*A.z-5*T.z+4*E.z-R.z)*O+(-A.z+3*T.z-3*E.z+R.z)*V))},t.Clamp=function(A,T,E){var R=new t;return t.ClampToRef(A,T,E,R),R},t.ClampToRef=function(A,T,E,R){var z=A.x;z=(z=z>E.x?E.x:z)<T.x?T.x:z;var O=A.y;O=(O=O>E.y?E.y:O)<T.y?T.y:O;var V=A.z;V=(V=V>E.z?E.z:V)<T.z?T.z:V,R.copyFromFloats(z,O,V)},t.Hermite=function(A,T,E,R,z){var O=z*z,V=z*O,U=2*V-3*O+1,H=-2*V+3*O,G=V-2*O+z,X=V-O;return new t(A.x*U+E.x*H+T.x*G+R.x*X,A.y*U+E.y*H+T.y*G+R.y*X,A.z*U+E.z*H+T.z*G+R.z*X)},t.Lerp=function(A,T,E){var R=new t(0,0,0);return t.LerpToRef(A,T,E,R),R},t.LerpToRef=function(A,T,E,R){R.x=A.x+(T.x-A.x)*E,R.y=A.y+(T.y-A.y)*E,R.z=A.z+(T.z-A.z)*E},t.Dot=function(A,T){return A.x*T.x+A.y*T.y+A.z*T.z},t.Cross=function(A,T){var E=t.Zero();return t.CrossToRef(A,T,E),E},t.CrossToRef=function(A,T,E){var R=A.y*T.z-A.z*T.y,z=A.z*T.x-A.x*T.z,O=A.x*T.y-A.y*T.x;E.copyFromFloats(R,z,O)},t.Normalize=function(A){var T=t.Zero();return t.NormalizeToRef(A,T),T},t.NormalizeToRef=function(A,T){A.normalizeToRef(T)},t.Minimize=function(A,T){var E=new t(A.x,A.y,A.z);return E.minimizeInPlace(T),E},t.Maximize=function(A,T){var E=new t(A.x,A.y,A.z);return E.maximizeInPlace(T),E},t.Distance=function(A,T){return Math.sqrt(t.DistanceSquared(A,T))},t.DistanceSquared=function(A,T){var E=A.x-T.x,R=A.y-T.y,z=A.z-T.z;return E*E+R*R+z*z},t.Center=function(A,T){var E=t.Add(A,T);return E.scaleInPlace(.5),E},t.RotationFromAxis=function(A,T,E){var R=t.Zero();return t.RotationFromAxisToRef(A,T,E,R),R},t.RotationFromAxisToRef=function(A,T,E,R){var z=Xt.Quaternion[0];jt.RotationQuaternionFromAxisToRef(A,T,E,z),R.copyFrom(z.eulerAngles)},t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var A=this.x||0;return 397*(A=397*A^(this.y||0))^(this.z||0)},t.prototype.asArray=function(){var A=[];return this.toArray(A,0),A},t.prototype.toArray=function(A,T){return void 0===T&&(T=0),A[T]=this.x,A[T+1]=this.y,A[T+2]=this.z,this},t.prototype.toQuaternion=function(){return jt.Identity.setEuler(this.y,this.x,this.z)},t.prototype.addInPlace=function(A){return this.addInPlaceFromFloats(A.x,A.y,A.z)},t.prototype.addInPlaceFromFloats=function(A,T,E){return this.x+=A,this.y+=T,this.z+=E,this},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y,this.z+A.z)},t.prototype.addToRef=function(A,T){return T.copyFromFloats(this.x+A.x,this.y+A.y,this.z+A.z)},t.prototype.subtractInPlace=function(A){return this.x-=A.x,this.y-=A.y,this.z-=A.z,this},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y,this.z-A.z)},t.prototype.subtractToRef=function(A,T){return this.subtractFromFloatsToRef(A.x,A.y,A.z,T)},t.prototype.subtractFromFloats=function(A,T,E){return new t(this.x-A,this.y-T,this.z-E)},t.prototype.subtractFromFloatsToRef=function(A,T,E,R){return R.copyFromFloats(this.x-A,this.y-T,this.z-E)},t.prototype.applyMatrix4=function(A){this.applyMatrix4ToRef(A,this)},t.prototype.applyMatrix4ToRef=function(A,T){var E=this,R=E.x,z=E.y,O=E.z,V=A.m,U=1/(V[3]*R+V[7]*z+V[11]*O+V[15]);return T.x=(V[0]*R+V[4]*z+V[8]*O+V[12])*U,T.y=(V[1]*R+V[5]*z+V[9]*O+V[13])*U,T.z=(V[2]*R+V[6]*z+V[10]*O+V[14])*U,T},t.prototype.rotate=function(A){return this.rotateToRef(A,this)},t.prototype.rotateToRef=function(A,T){var E=this,R=E.x,z=E.y,O=E.z,V=A.x,U=A.y,H=A.z,G=A.w,X=G*R+U*O-H*z,Q=G*z+H*R-V*O,Z=G*O+V*z-U*R,K=-V*R-U*z-H*O;return T.x=X*G+K*-V+Q*-H-Z*-U,T.y=Q*G+K*-U+Z*-V-X*-H,T.z=Z*G+K*-H+X*-U-Q*-V,T},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this.z*=A,this},t.prototype.scale=function(A){return new t(this.x*A,this.y*A,this.z*A)},t.prototype.scaleToRef=function(A,T){return T.copyFromFloats(this.x*A,this.y*A,this.z*A)},t.prototype.scaleAndAddToRef=function(A,T){return T.addInPlaceFromFloats(this.x*A,this.y*A,this.z*A)},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y&&this.z===A.z},t.prototype.equalsWithEpsilon=function(A,T){return void 0===T&&(T=qt),A&&Vt.WithinEpsilon(this.x,A.x,T)&&Vt.WithinEpsilon(this.y,A.y,T)&&Vt.WithinEpsilon(this.z,A.z,T)},t.prototype.equalsToFloats=function(A,T,E){return this.x===A&&this.y===T&&this.z===E},t.prototype.multiplyInPlace=function(A){return this.x*=A.x,this.y*=A.y,this.z*=A.z,this},t.prototype.multiply=function(A){return this.multiplyByFloats(A.x,A.y,A.z)},t.prototype.multiplyToRef=function(A,T){return T.copyFromFloats(this.x*A.x,this.y*A.y,this.z*A.z)},t.prototype.multiplyByFloats=function(A,T,E){return new t(this.x*A,this.y*T,this.z*E)},t.prototype.divide=function(A){return new t(this.x/A.x,this.y/A.y,this.z/A.z)},t.prototype.divideToRef=function(A,T){return T.copyFromFloats(this.x/A.x,this.y/A.y,this.z/A.z)},t.prototype.divideInPlace=function(A){return this.divideToRef(A,this)},t.prototype.minimizeInPlace=function(A){return this.minimizeInPlaceFromFloats(A.x,A.y,A.z)},t.prototype.maximizeInPlace=function(A){return this.maximizeInPlaceFromFloats(A.x,A.y,A.z)},t.prototype.minimizeInPlaceFromFloats=function(A,T,E){return A<this.x&&(this.x=A),T<this.y&&(this.y=T),E<this.z&&(this.z=E),this},t.prototype.maximizeInPlaceFromFloats=function(A,T,E){return A>this.x&&(this.x=A),T>this.y&&(this.y=T),E>this.z&&(this.z=E),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){return this.normalizeFromLength(this.length())},t.prototype.normalizeFromLength=function(A){return 0===A||1===A?this:this.scaleInPlace(1/A)},t.prototype.normalizeToNew=function(){var A=new t(0,0,0);return this.normalizeToRef(A),A},t.prototype.normalizeToRef=function(A){var T=this.length();return 0===T||1===T?A.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/T,A)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(A){return this.copyFromFloats(A.x,A.y,A.z)},t.prototype.copyFromFloats=function(A,T,E){return this.x=A,this.y=T,this.z=E,this},t.prototype.set=function(A,T,E){return this.copyFromFloats(A,T,E)},t.prototype.setAll=function(A){return this.x=this.y=this.z=A,this},t}(),Xt={Vector3:v(6,Gt.Zero),Matrix:v(2,Ht.Identity),Quaternion:v(3,jt.Zero),staticUp:Gt.Up(),tmpMatrix:Ht.Zero()},Yt=function(){function t(A){this._radians=A,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(A,T){var E=T.subtract(A);return new t(Math.atan2(E.y,E.x))},t.FromRadians=function(A){return new t(A)},t.FromDegrees=function(A){return new t(A*Math.PI/180)},t.prototype.degrees=function(){return 180*this._radians/Math.PI},t.prototype.radians=function(){return this._radians},t}(),Qt=function(){function t(A,T){void 0===A&&(A=0),void 0===T&&(T=0),this.x=A,this.y=T}return t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.Add=function(A,T){return new t(A.x,A.y).addInPlace(T)},t.FromArray=function(A,T){return void 0===T&&(T=0),new t(A[T],A[T+1])},t.FromArrayToRef=function(A,T,E){E.x=A[T],E.y=A[T+1]},t.CatmullRom=function(A,T,E,R,z){var O=z*z,V=z*O;return new t(.5*(2*T.x+(-A.x+E.x)*z+(2*A.x-5*T.x+4*E.x-R.x)*O+(-A.x+3*T.x-3*E.x+R.x)*V),.5*(2*T.y+(-A.y+E.y)*z+(2*A.y-5*T.y+4*E.y-R.y)*O+(-A.y+3*T.y-3*E.y+R.y)*V))},t.Clamp=function(A,T,E){var R=A.x;R=(R=R>E.x?E.x:R)<T.x?T.x:R;var z=A.y;return new t(R,z=(z=z>E.y?E.y:z)<T.y?T.y:z)},t.Hermite=function(A,T,E,R,z){var O=z*z,V=z*O,U=2*V-3*O+1,H=-2*V+3*O,G=V-2*O+z,X=V-O;return new t(A.x*U+E.x*H+T.x*G+R.x*X,A.y*U+E.y*H+T.y*G+R.y*X)},t.Lerp=function(A,T,E){return new t(A.x+(T.x-A.x)*E,A.y+(T.y-A.y)*E)},t.Dot=function(A,T){return A.x*T.x+A.y*T.y},t.Normalize=function(A){var T=new t(A.x,A.y);return T.normalize(),T},t.Minimize=function(A,T){return new t(A.x<T.x?A.x:T.x,A.y<T.y?A.y:T.y)},t.Maximize=function(A,T){return new t(A.x>T.x?A.x:T.x,A.y>T.y?A.y:T.y)},t.Transform=function(A,T){var E=t.Zero();return t.TransformToRef(A,T,E),E},t.TransformToRef=function(A,T,E){var R=T.m,z=A.x*R[0]+A.y*R[4]+R[12],O=A.x*R[1]+A.y*R[5]+R[13];E.x=z,E.y=O},t.PointInTriangle=function(A,T,E,R){var z=.5*(-E.y*R.x+T.y*(-E.x+R.x)+T.x*(E.y-R.y)+E.x*R.y),O=z<0?-1:1,V=(T.y*R.x-T.x*R.y+(R.y-T.y)*A.x+(T.x-R.x)*A.y)*O,U=(T.x*E.y-T.y*E.x+(T.y-E.y)*A.x+(E.x-T.x)*A.y)*O;return V>0&&U>0&&V+U<2*z*O},t.Distance=function(A,T){return Math.sqrt(t.DistanceSquared(A,T))},t.DistanceSquared=function(A,T){var E=A.x-T.x,R=A.y-T.y;return E*E+R*R},t.Center=function(A,T){var E=t.Add(A,T);return E.scaleInPlace(.5),E},t.DistanceOfPointFromSegment=function(A,T,E){var R=t.DistanceSquared(T,E);if(0===R)return t.Distance(A,T);var z=E.subtract(T),O=Math.max(0,Math.min(1,t.Dot(A.subtract(T),z)/R)),V=T.add(z.multiplyByFloats(O,O));return t.Distance(A,V)},t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){return 397*(this.x||0)^(this.y||0)},t.prototype.toArray=function(A,T){return void 0===T&&(T=0),A[T]=this.x,A[T+1]=this.y,this},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.copyFrom=function(A){return this.x=A.x,this.y=A.y,this},t.prototype.copyFromFloats=function(A,T){return this.x=A,this.y=T,this},t.prototype.set=function(A,T){return this.copyFromFloats(A,T)},t.prototype.add=function(A){return new t(this.x+A.x,this.y+A.y)},t.prototype.addToRef=function(A,T){return T.x=this.x+A.x,T.y=this.y+A.y,this},t.prototype.addInPlace=function(A){return this.x+=A.x,this.y+=A.y,this},t.prototype.addVector3=function(A){return new t(this.x+A.x,this.y+A.y)},t.prototype.subtract=function(A){return new t(this.x-A.x,this.y-A.y)},t.prototype.subtractToRef=function(A,T){return T.x=this.x-A.x,T.y=this.y-A.y,this},t.prototype.subtractInPlace=function(A){return this.x-=A.x,this.y-=A.y,this},t.prototype.multiplyInPlace=function(A){return this.x*=A.x,this.y*=A.y,this},t.prototype.multiply=function(A){return new t(this.x*A.x,this.y*A.y)},t.prototype.multiplyToRef=function(A,T){return T.x=this.x*A.x,T.y=this.y*A.y,this},t.prototype.multiplyByFloats=function(A,T){return new t(this.x*A,this.y*T)},t.prototype.divide=function(A){return new t(this.x/A.x,this.y/A.y)},t.prototype.divideToRef=function(A,T){return T.x=this.x/A.x,T.y=this.y/A.y,this},t.prototype.divideInPlace=function(A){return this.divideToRef(A,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(A){return this.x*=A,this.y*=A,this},t.prototype.scale=function(A){var T=new t(0,0);return this.scaleToRef(A,T),T},t.prototype.scaleToRef=function(A,T){return T.x=this.x*A,T.y=this.y*A,this},t.prototype.scaleAndAddToRef=function(A,T){return T.x+=this.x*A,T.y+=this.y*A,this},t.prototype.equals=function(A){return A&&this.x===A.x&&this.y===A.y},t.prototype.equalsWithEpsilon=function(A,T){return void 0===T&&(T=qt),A&&Vt.WithinEpsilon(this.x,A.x,T)&&Vt.WithinEpsilon(this.y,A.y,T)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var A=this.length();if(0===A)return this;var T=1/A;return this.x*=T,this.y*=T,this},t.prototype.clone=function(){return new t(this.x,this.y)},t}(),Ft=function(T,E,R){this.startPoint=T,this.midPoint=E,this.endPoint=R;var z=Math.pow(E.x,2)+Math.pow(E.y,2),O=(Math.pow(T.x,2)+Math.pow(T.y,2)-z)/2,V=(z-Math.pow(R.x,2)-Math.pow(R.y,2))/2,U=(T.x-E.x)*(E.y-R.y)-(E.x-R.x)*(T.y-E.y);this.centerPoint=new Qt((O*(E.y-R.y)-V*(T.y-E.y))/U,((T.x-E.x)*V-(E.x-R.x)*O)/U),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=Yt.BetweenTwoPoints(this.centerPoint,this.startPoint);var H=this.startAngle.degrees(),G=Yt.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),X=Yt.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();G-H>180&&(G-=360),G-H<-180&&(G+=360),X-G>180&&(X-=360),X-G<-180&&(X+=360),this.orientation=G-H<0?A.Orientation.CW:A.Orientation.CCW,this.angle=Yt.FromDegrees(this.orientation===A.Orientation.CW?H-X:X-H)},Zt=function(){function t(){}return t.X=new Gt(1,0,0),t.Y=new Gt(0,1,0),t.Z=new Gt(0,0,1),t}(),Jt=function(){function t(){}return t.Interpolate=function(A,T,E,R,z){for(var O=1-3*R+3*T,V=3*R-6*T,U=3*T,H=A,G=0;G<5;G++){var X=H*H;H-=1/(3*O*X+2*V*H+U)*(O*(X*H)+V*X+U*H-A),H=Math.min(1,Math.max(0,H))}return 3*Math.pow(1-H,2)*H*E+3*(1-H)*Math.pow(H,2)*z+Math.pow(H,3)},t}(),$t=function(){function t(A,T,E,R){void 0===A&&(A=0),void 0===T&&(T=0),void 0===E&&(E=0),void 0===R&&(R=1),this.r=A,this.g=T,this.b=E,this.a=R}return t.FromHexString=function(A){if("#"!==A.substring(0,1)||9!==A.length)return new t(0,0,0,0);var T=parseInt(A.substring(1,3),16),E=parseInt(A.substring(3,5),16),R=parseInt(A.substring(5,7),16),z=parseInt(A.substring(7,9),16);return t.FromInts(T,E,R,z)},t.Lerp=function(A,T,E){var R=new t(0,0,0,0);return t.LerpToRef(A,T,E,R),R},t.LerpToRef=function(A,T,E,R){R.r=A.r+(T.r-A.r)*E,R.g=A.g+(T.g-A.g)*E,R.b=A.b+(T.b-A.b)*E,R.a=A.a+(T.a-A.a)*E},t.Red=function(){return new t(1,0,0,1)},t.Green=function(){return new t(0,1,0,1)},t.Blue=function(){return new t(0,0,1,1)},t.Black=function(){return new t(0,0,0,1)},t.White=function(){return new t(1,1,1,1)},t.Purple=function(){return new t(.5,0,.5,1)},t.Magenta=function(){return new t(1,0,1,1)},t.Yellow=function(){return new t(1,1,0,1)},t.Gray=function(){return new t(.5,.5,.5,1)},t.Teal=function(){return new t(0,1,1,1)},t.Clear=function(){return new t(0,0,0,0)},t.FromColor3=function(A,T){return void 0===T&&(T=1),new t(A.r,A.g,A.b,T)},t.FromArray=function(A,T){return void 0===T&&(T=0),new t(A[T],A[T+1],A[T+2],A[T+3])},t.FromInts=function(A,T,E,R){return new t(A/255,T/255,E/255,R/255)},t.CheckColors4=function(A,T){if(A.length===3*T){for(var E=[],R=0;R<A.length;R+=3){var z=R/3*4;E[z]=A[R],E[z+1]=A[R+1],E[z+2]=A[R+2],E[z+3]=1}return E}return A},t.prototype.addInPlace=function(A){return this.r+=A.r,this.g+=A.g,this.b+=A.b,this.a+=A.a,this},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.toArray=function(A,T){return void 0===T&&(T=0),A[T]=this.r,A[T+1]=this.g,A[T+2]=this.b,A[T+3]=this.a,this},t.prototype.add=function(A){return new t(this.r+A.r,this.g+A.g,this.b+A.b,this.a+A.a)},t.prototype.subtract=function(A){return new t(this.r-A.r,this.g-A.g,this.b-A.b,this.a-A.a)},t.prototype.subtractToRef=function(A,T){return T.r=this.r-A.r,T.g=this.g-A.g,T.b=this.b-A.b,T.a=this.a-A.a,this},t.prototype.scale=function(A){return new t(this.r*A,this.g*A,this.b*A,this.a*A)},t.prototype.scaleToRef=function(A,T){return T.r=this.r*A,T.g=this.g*A,T.b=this.b*A,T.a=this.a*A,this},t.prototype.scaleAndAddToRef=function(A,T){return T.r+=this.r*A,T.g+=this.g*A,T.b+=this.b*A,T.a+=this.a*A,this},t.prototype.clampToRef=function(A,T,E){return void 0===A&&(A=0),void 0===T&&(T=1),E.r=Vt.Clamp(this.r,A,T),E.g=Vt.Clamp(this.g,A,T),E.b=Vt.Clamp(this.b,A,T),E.a=Vt.Clamp(this.a,A,T),this},t.prototype.multiply=function(A){return new t(this.r*A.r,this.g*A.g,this.b*A.b,this.a*A.a)},t.prototype.multiplyToRef=function(A,T){return T.r=this.r*A.r,T.g=this.g*A.g,T.b=this.b*A.b,T.a=this.a*A.a,T},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var A=this.r||0;return 397*(A=397*(A=397*A^(this.g||0))^(this.b||0))^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(A){return this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a,this},t.prototype.copyFromFloats=function(A,T,E,R){return this.r=A,this.g=T,this.b=E,this.a=R,this},t.prototype.set=function(A,T,E,R){return this.copyFromFloats(A,T,E,R)},t.prototype.toHexString=function(){var A=255*this.r|0,T=255*this.g|0,E=255*this.b|0,R=255*this.a|0;return"#"+Vt.ToHex(A)+Vt.ToHex(T)+Vt.ToHex(E)+Vt.ToHex(R)},t.prototype.toLinearSpace=function(){var A=new t;return this.toLinearSpaceToRef(A),A},t.prototype.toLinearSpaceToRef=function(A){return A.r=Math.pow(this.r,kt),A.g=Math.pow(this.g,kt),A.b=Math.pow(this.b,kt),A.a=this.a,this},t.prototype.toGammaSpace=function(){var A=new t;return this.toGammaSpaceToRef(A),A},t.prototype.toGammaSpaceToRef=function(A){return A.r=Math.pow(this.r,Nt),A.g=Math.pow(this.g,Nt),A.b=Math.pow(this.b,Nt),A.a=this.a,this},t}(),ee=function(){function t(A,T,E){void 0===A&&(A=0),void 0===T&&(T=0),void 0===E&&(E=0),this.r=A,this.g=T,this.b=E}return t.FromHexString=function(A){if("#"!==A.substring(0,1)||7!==A.length)return new t(0,0,0);var T=parseInt(A.substring(1,3),16),E=parseInt(A.substring(3,5),16),R=parseInt(A.substring(5,7),16);return t.FromInts(T,E,R)},t.FromArray=function(A,T){return void 0===T&&(T=0),new t(A[T],A[T+1],A[T+2])},t.FromInts=function(A,T,E){return new t(A/255,T/255,E/255)},t.Lerp=function(A,T,E){var R=new t(0,0,0);return t.LerpToRef(A,T,E,R),R},t.LerpToRef=function(A,T,E,R){R.r=A.r+(T.r-A.r)*E,R.g=A.g+(T.g-A.g)*E,R.b=A.b+(T.b-A.b)*E},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var A=this.r||0;return 397*(A=397*A^(this.g||0))^(this.b||0)},t.prototype.toArray=function(A,T){return void 0===T&&(T=0),A[T]=this.r,A[T+1]=this.g,A[T+2]=this.b,this},t.prototype.toColor4=function(A){return void 0===A&&(A=1),new $t(this.r,this.g,this.b,A)},t.prototype.asArray=function(){var A=new Array;return this.toArray(A,0),A},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(A){return new t(this.r*A.r,this.g*A.g,this.b*A.b)},t.prototype.multiplyToRef=function(A,T){return T.r=this.r*A.r,T.g=this.g*A.g,T.b=this.b*A.b,this},t.prototype.equals=function(A){return A&&this.r===A.r&&this.g===A.g&&this.b===A.b},t.prototype.equalsFloats=function(A,T,E){return this.r===A&&this.g===T&&this.b===E},t.prototype.scale=function(A){return new t(this.r*A,this.g*A,this.b*A)},t.prototype.scaleToRef=function(A,T){return T.r=this.r*A,T.g=this.g*A,T.b=this.b*A,this},t.prototype.scaleAndAddToRef=function(A,T){return T.r+=this.r*A,T.g+=this.g*A,T.b+=this.b*A,this},t.prototype.clampToRef=function(A,T,E){return void 0===A&&(A=0),void 0===T&&(T=1),E.r=Vt.Clamp(this.r,A,T),E.g=Vt.Clamp(this.g,A,T),E.b=Vt.Clamp(this.b,A,T),this},t.prototype.add=function(A){return new t(this.r+A.r,this.g+A.g,this.b+A.b)},t.prototype.addToRef=function(A,T){return T.r=this.r+A.r,T.g=this.g+A.g,T.b=this.b+A.b,this},t.prototype.subtract=function(A){return new t(this.r-A.r,this.g-A.g,this.b-A.b)},t.prototype.subtractToRef=function(A,T){return T.r=this.r-A.r,T.g=this.g-A.g,T.b=this.b-A.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(A){return this.r=A.r,this.g=A.g,this.b=A.b,this},t.prototype.copyFromFloats=function(A,T,E){return this.r=A,this.g=T,this.b=E,this},t.prototype.set=function(A,T,E){return this.copyFromFloats(A,T,E)},t.prototype.toHexString=function(){var A=255*this.r|0,T=255*this.g|0,E=255*this.b|0;return"#"+Vt.ToHex(A)+Vt.ToHex(T)+Vt.ToHex(E)},t.prototype.toLinearSpace=function(){var A=new t;return this.toLinearSpaceToRef(A),A},t.prototype.toLinearSpaceToRef=function(A){return A.r=Math.pow(this.r,kt),A.g=Math.pow(this.g,kt),A.b=Math.pow(this.b,kt),this},t.prototype.toGammaSpace=function(){var A=new t;return this.toGammaSpaceToRef(A),A},t.prototype.toGammaSpaceToRef=function(A){return A.r=Math.pow(this.r,Nt),A.g=Math.pow(this.g,Nt),A.b=Math.pow(this.b,Nt),this},t.prototype.toJSON=function(){return{r:this.r,g:this.g,b:this.b}},t}(),ne=function(){function t(A){this._length=0,this._points=A,this._length=this._computeLength(A)}return t.CreateQuadraticBezier=function(A,T,E,R){R=R>2?R:3;for(var z=new Array,s=function(A,T,E,R){return(1-A)*(1-A)*T+2*A*(1-A)*E+A*A*R},O=0;O<=R;O++)z.push(new Gt(s(O/R,A.x,T.x,E.x),s(O/R,A.y,T.y,E.y),s(O/R,A.z,T.z,E.z)));return new t(z)},t.CreateCubicBezier=function(A,T,E,R,z){z=z>3?z:4;for(var O=new Array,a=function(A,T,E,R,z){return(1-A)*(1-A)*(1-A)*T+3*A*(1-A)*(1-A)*E+3*A*A*(1-A)*R+A*A*A*z},V=0;V<=z;V++)O.push(new Gt(a(V/z,A.x,T.x,E.x,R.x),a(V/z,A.y,T.y,E.y,R.y),a(V/z,A.z,T.z,E.z,R.z)));return new t(O)},t.CreateHermiteSpline=function(A,T,E,R,z){for(var O=new Array,V=1/z,U=0;U<=z;U++)O.push(Gt.Hermite(A,T,E,R,U*V));return new t(O)},t.CreateCatmullRomSpline=function(A,T,E){var R=new Array,z=1/T,O=0;if(E){for(var V=A.length,U=0;U<V;U++){O=0;for(var H=0;H<T;H++)R.push(Gt.CatmullRom(A[U%V],A[(U+1)%V],A[(U+2)%V],A[(U+3)%V],O)),O+=z}R.push(R[0])}else{var G=new Array;for(G.push(A[0].clone()),Array.prototype.push.apply(G,A),G.push(A[A.length-1].clone()),U=0,U=0;U<G.length-3;U++)for(O=0,H=0;H<T;H++)R.push(Gt.CatmullRom(G[U],G[U+1],G[U+2],G[U+3],O)),O+=z;U--,R.push(Gt.CatmullRom(G[U],G[U+1],G[U+2],G[U+3],O))}return new t(R)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype.continue=function(A){for(var T=this._points[this._points.length-1],E=this._points.slice(),R=A.getPoints(),z=1;z<R.length;z++)E.push(R[z].subtract(R[0]).add(T));return new t(E)},t.prototype._computeLength=function(A){for(var T=0,E=1;E<A.length;E++)T+=A[E].subtract(A[E-1]).length();return T},t}(),oe=function(){function t(A,T,E,R){this.normal=new Gt(A,T,E),this.d=R}return t.FromArray=function(A){return new t(A[0],A[1],A[2],A[3])},t.FromPoints=function(A,T,E){var R=new t(0,0,0,0);return R.copyFromPoints(A,T,E),R},t.FromPositionAndNormal=function(A,T){var E=new t(0,0,0,0);return T.normalize(),E.normal=T,E.d=-(T.x*A.x+T.y*A.y+T.z*A.z),E},t.SignedDistanceToPlaneFromPositionAndNormal=function(A,T,E){var R=-(T.x*A.x+T.y*A.y+T.z*A.z);return Gt.Dot(E,T)+R},t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){return 397*this.normal.getHashCode()^(this.d||0)},t.prototype.normalize=function(){var A=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),T=0;return 0!==A&&(T=1/A),this.normal.x*=T,this.normal.y*=T,this.normal.z*=T,this.d*=T,this},t.prototype.transform=function(A){var T=Xt.Matrix[0];Ht.TransposeToRef(A,T);var E=T.m,R=this.normal.x,z=this.normal.y,O=this.normal.z,V=this.d;return new t(R*E[0]+z*E[1]+O*E[2]+V*E[3],R*E[4]+z*E[5]+O*E[6]+V*E[7],R*E[8]+z*E[9]+O*E[10]+V*E[11],R*E[12]+z*E[13]+O*E[14]+V*E[15])},t.prototype.dotCoordinate=function(A){return this.normal.x*A.x+this.normal.y*A.y+this.normal.z*A.z+this.d},t.prototype.copyFromPoints=function(A,T,E){var R,z=T.x-A.x,O=T.y-A.y,V=T.z-A.z,U=E.x-A.x,H=E.y-A.y,G=E.z-A.z,X=O*G-V*H,Q=V*U-z*G,Z=z*H-O*U,K=Math.sqrt(X*X+Q*Q+Z*Z);return R=0!==K?1/K:0,this.normal.x=X*R,this.normal.y=Q*R,this.normal.z=Z*R,this.d=-(this.normal.x*A.x+this.normal.y*A.y+this.normal.z*A.z),this},t.prototype.isFrontFacingTo=function(A,T){return Gt.Dot(this.normal,A)<=T},t.prototype.signedDistanceTo=function(A){return Gt.Dot(A,this.normal)+this.d},t}(),ie=function(){function t(){}return t.GetPlanes=function(A){for(var T=[],E=0;E<6;E++)T.push(new oe(0,0,0,0));return t.GetPlanesToRef(A,T),T},t.GetNearPlaneToRef=function(A,T){var E=A.m;T.normal.x=E[3]+E[2],T.normal.y=E[7]+E[6],T.normal.z=E[11]+E[10],T.d=E[15]+E[14],T.normalize()},t.GetFarPlaneToRef=function(A,T){var E=A.m;T.normal.x=E[3]-E[2],T.normal.y=E[7]-E[6],T.normal.z=E[11]-E[10],T.d=E[15]-E[14],T.normalize()},t.GetLeftPlaneToRef=function(A,T){var E=A.m;T.normal.x=E[3]+E[0],T.normal.y=E[7]+E[4],T.normal.z=E[11]+E[8],T.d=E[15]+E[12],T.normalize()},t.GetRightPlaneToRef=function(A,T){var E=A.m;T.normal.x=E[3]-E[0],T.normal.y=E[7]-E[4],T.normal.z=E[11]-E[8],T.d=E[15]-E[12],T.normalize()},t.GetTopPlaneToRef=function(A,T){var E=A.m;T.normal.x=E[3]-E[1],T.normal.y=E[7]-E[5],T.normal.z=E[11]-E[9],T.d=E[15]-E[13],T.normalize()},t.GetBottomPlaneToRef=function(A,T){var E=A.m;T.normal.x=E[3]+E[1],T.normal.y=E[7]+E[5],T.normal.z=E[11]+E[9],T.d=E[15]+E[13],T.normalize()},t.GetPlanesToRef=function(A,T){t.GetNearPlaneToRef(A,T[0]),t.GetFarPlaneToRef(A,T[1]),t.GetLeftPlaneToRef(A,T[2]),t.GetRightPlaneToRef(A,T[3]),t.GetTopPlaneToRef(A,T[4]),t.GetBottomPlaneToRef(A,T[5])},t}(),re=function(){function e(A,T){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Qt(A,T))}return e.StartingAt=function(A,T){return new e(A,T)},e.prototype.addLineTo=function(A,T){if(this.closed)return this;var E=new Qt(A,T),R=this._points[this._points.length-1];return this._points.push(E),this._length+=E.subtract(R).length(),this},e.prototype.addArcTo=function(T,E,R,z,O){if(void 0===O&&(O=36),this.closed)return this;var V=this._points[this._points.length-1],U=new Qt(T,E),H=new Qt(R,z),G=new Ft(V,U,H),X=G.angle.radians()/O;G.orientation===A.Orientation.CW&&(X*=-1);for(var Q=G.startAngle.radians()+X,Z=0;Z<O;Z++){var K=Math.cos(Q)*G.radius+G.centerPoint.x,J=Math.sin(Q)*G.radius+G.centerPoint.y;this.addLineTo(K,J),Q+=X}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var A=this._length;if(!this.closed){var T=this._points[this._points.length-1];A+=this._points[0].subtract(T).length()}return A},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(A){if(A<0||A>1)return Qt.Zero();for(var T=A*this.length(),E=0,R=0;R<this._points.length;R++){var z=(R+1)%this._points.length,O=this._points[R],V=this._points[z].subtract(O),U=V.length()+E;if(T>=E&&T<=U){var H=V.normalize(),G=T-E;return new Qt(O.x+H.x*G,O.y+H.y*G)}E=U}return Qt.Zero()},e}(),se=function(){function t(A,T,E){void 0===T&&(T=null),this.path=A,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var R=0;R<A.length;R++)this._curve[R]=A[R].clone();this._raw=E||!1,this._compute(T)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(A,T){void 0===T&&(T=null);for(var E=0;E<A.length;E++)this._curve[E].x=A[E].x,this._curve[E].y=A[E].y,this._curve[E].z=A[E].z;return this._compute(T),this},t.prototype._compute=function(A){var T=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[T-1]=this._curve[T-1].subtract(this._curve[T-2]),this._raw||this._tangents[T-1].normalize();var E,R,z,O,V=this._tangents[0],U=this._normalVector(this._curve[0],V,A);this._normals[0]=U,this._raw||this._normals[0].normalize(),this._binormals[0]=Gt.Cross(V,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var H=1;H<T;H++)E=this._getLastNonNullVector(H),H<T-1&&(R=this._getFirstNonNullVector(H),this._tangents[H]=E.add(R),this._tangents[H].normalize()),this._distances[H]=this._distances[H-1]+E.length(),z=this._tangents[H],O=this._binormals[H-1],this._normals[H]=Gt.Cross(O,z),this._raw||this._normals[H].normalize(),this._binormals[H]=Gt.Cross(z,this._normals[H]),this._raw||this._binormals[H].normalize()},t.prototype._getFirstNonNullVector=function(A){for(var T=1,E=this._curve[A+T].subtract(this._curve[A]);0===E.length()&&A+T+1<this._curve.length;)T++,E=this._curve[A+T].subtract(this._curve[A]);return E},t.prototype._getLastNonNullVector=function(A){for(var T=1,E=this._curve[A].subtract(this._curve[A-T]);0===E.length()&&A>T+1;)T++,E=this._curve[A].subtract(this._curve[A-T]);return E},t.prototype._normalVector=function(A,T,E){var R,z,O=T.length();(0===O&&(O=1),null==E)?(z=Vt.WithinEpsilon(Math.abs(T.y)/O,1,qt)?Vt.WithinEpsilon(Math.abs(T.x)/O,1,qt)?Vt.WithinEpsilon(Math.abs(T.z)/O,1,qt)?Gt.Zero():new Gt(0,0,1):new Gt(1,0,0):new Gt(0,-1,0),R=Gt.Cross(T,z)):(R=Gt.Cross(T,E),Gt.CrossToRef(R,T,R));return R.normalize(),R},t}(),ae=function(){function t(A,T){this.width=A,this.height=T}return Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),t.Zero=function(){return new t(0,0)},t.Lerp=function(A,T,E){return new t(A.width+(T.width-A.width)*E,A.height+(T.height-A.height)*E)},t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){return 397*(this.width||0)^(this.height||0)},t.prototype.copyFrom=function(A){this.width=A.width,this.height=A.height},t.prototype.copyFromFloats=function(A,T){return this.width=A,this.height=T,this},t.prototype.set=function(A,T){return this.copyFromFloats(A,T)},t.prototype.multiplyByFloats=function(A,T){return new t(this.width*A,this.height*T)},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(A){return!!A&&this.width===A.width&&this.height===A.height},t.prototype.add=function(A){return new t(this.width+A.width,this.height+A.height)},t.prototype.subtract=function(A){return new t(this.width-A.width,this.height-A.height)},t}(),ue={looping:!0,speed:1,weight:1,layer:0},le=function(A){function e(T,E){void 0===E&&(E=ue);var R=A.call(this)||this;return R.isAnimationClip=!0,R.looping=ue.looping,R.weight=ue.weight,R.playing=!1,R.shouldReset=!1,R.speed=ue.speed,R.name=f("AnimClip"),R.layer=ue.layer,R.clip=T,R.setParams(i({},E)),R}return o(e,A),e.prototype.setParams=function(A){return this.looping=void 0!==A.looping?A.looping:this.looping,this.speed=A.speed||this.speed,this.weight=A.weight||this.weight,this.layer=A.layer||this.layer,this},e.prototype.toJSON=function(){var T=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),T},e.prototype.play=function(A){var T;void 0===A&&(A=!1),null===(T=this.owner)||void 0===T||T.play(this,A)},e.prototype.pause=function(){var A;null===(A=this.owner)||void 0===A||A.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var A;null===(A=this.owner)||void 0===A||A.stop(this)},r([et.readonly],e.prototype,"clip",void 0),r([et.field],e.prototype,"looping",void 0),r([et.field],e.prototype,"weight",void 0),r([et.field],e.prototype,"playing",void 0),r([et.field],e.prototype,"shouldReset",void 0),r([et.field],e.prototype,"speed",void 0),r([et.readonly],e.prototype,"name",void 0),e}(et);A.InputEventType=void 0,(Bt=A.InputEventType||(A.InputEventType={}))[Bt.DOWN=0]="DOWN",Bt[Bt.UP=1]="UP",A.CameraMode=void 0,(Mt=A.CameraMode||(A.CameraMode={}))[Mt.FirstPerson=0]="FirstPerson",Mt[Mt.ThirdPerson=1]="ThirdPerson",Mt[Mt.BuildingToolGodMode=2]="BuildingToolGodMode",A.LandRole=void 0,(Ot=A.LandRole||(A.LandRole={})).OWNER="owner",Ot.OPERATOR="operator",A.ActionButton=void 0,(Lt=A.ActionButton||(A.ActionButton={})).POINTER="POINTER",Lt.PRIMARY="PRIMARY",Lt.SECONDARY="SECONDARY",Lt.ANY="ANY",Lt.FORWARD="FORWARD",Lt.BACKWARD="BACKWARD",Lt.RIGHT="RIGHT",Lt.LEFT="LEFT",Lt.JUMP="JUMP",Lt.WALK="WALK",Lt.ACTION_3="ACTION_3",Lt.ACTION_4="ACTION_4",Lt.ACTION_5="ACTION_5",Lt.ACTION_6="ACTION_6";var he,ce,Kt=function(A){if(this.callback=A,!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");fe.ensureInstance()},pe=function(A){function e(){return null!==A&&A.apply(this,arguments)||this}return o(e,A),r([M("pointerDown")],e)}(Kt),de=function(A){function e(){return null!==A&&A.apply(this,arguments)||this}return o(e,A),r([M("pointerUp")],e)}(Kt),te=function(A,T){this.fn=A,this.useRaycast=T},fe=function(){function e(){this.buttonIdMapping=[A.ActionButton.POINTER,A.ActionButton.PRIMARY,A.ActionButton.SECONDARY,A.ActionButton.ANY,A.ActionButton.FORWARD,A.ActionButton.BACKWARD,A.ActionButton.RIGHT,A.ActionButton.LEFT,A.ActionButton.JUMP,A.ActionButton.WALK,A.ActionButton.ACTION_3,A.ActionButton.ACTION_4,A.ActionButton.ACTION_5,A.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(A,T){var E;return i(i({},A),((E={})[T]={BUTTON_DOWN:[],BUTTON_UP:[]},E))}),{}),this.internalState=this.buttonIdMapping.reduce((function(A,T){var E;return i(i({},A),((E={})[T]={BUTTON_DOWN:!1},E))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(A){return this.internalState[A]},e.prototype.subscribe=function(A,T,E,R){var z=this;return this.subscriptions[T][A].push(new te(R,E)),function(){z.unsubscribe(A,T,R)}},e.prototype.unsubscribe=function(A,T,E){var R=this.getSubscriptionId(A,T,E);return R>-1&&this.subscriptions[T][A].splice(R,1)},e.prototype.handlePointerEvent=function(T){var E=this.getPointerById(T.buttonId);if(E){var R=i(i({},T),{button:E,direction:(new Gt).copyFrom(T.direction),origin:(new Gt).copyFrom(T.origin),hit:void 0}),z=T.hit?i(i({},T.hit),{hitPoint:(new Gt).copyFrom(T.hit.hitPoint),normal:(new Gt).copyFrom(T.hit.normal),worldNormal:(new Gt).copyFrom(T.hit.worldNormal)}):void 0;if(T.type===A.InputEventType.DOWN){this.internalState[E].BUTTON_DOWN=!0;for(var O=0;O<this.subscriptions[E].BUTTON_DOWN.length;O++)(V=this.subscriptions[E].BUTTON_DOWN[O]).useRaycast?R.hit=z:R.hit=void 0,V.fn(R);z&&z.entityId&&F.engine&&(H=(U=F.engine.entities[z.entityId])&&U.getComponentOrNull(pe))&&(R.hit=z,H.callback(R))}else{for(this.internalState[E].BUTTON_DOWN=!1,O=0;O<this.subscriptions[E].BUTTON_UP.length;O++){var V;(V=this.subscriptions[E].BUTTON_UP[O]).useRaycast?R.hit=z:R.hit=void 0,V.fn(R)}var U,H;z&&z.entityId&&F.engine&&(H=(U=F.engine.entities[z.entityId])&&U.getComponentOrNull(de))&&(R.hit=z,H.callback(R))}}},e.prototype.getSubscriptionId=function(A,T,E){for(var R=0;R<this.subscriptions[T][A].length;R++)if(this.subscriptions[T][A][R].fn===E)return R;return-1},e.prototype.getPointerById=function(T){if(T<0||T>=this.buttonIdMapping.length)return null;var E=this.buttonIdMapping[T];return E===A.ActionButton.ANY?null:E},e}();A.CLASS_ID=void 0,(he=A.CLASS_ID||(A.CLASS_ID={}))[he.TRANSFORM=1]="TRANSFORM",he[he.UUID_CALLBACK=8]="UUID_CALLBACK",he[he.BOX_SHAPE=16]="BOX_SHAPE",he[he.SPHERE_SHAPE=17]="SPHERE_SHAPE",he[he.PLANE_SHAPE=18]="PLANE_SHAPE",he[he.CONE_SHAPE=19]="CONE_SHAPE",he[he.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",he[he.TEXT_SHAPE=21]="TEXT_SHAPE",he[he.NFT_SHAPE=22]="NFT_SHAPE",he[he.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",he[he.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",he[he.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",he[he.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",he[he.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",he[he.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",he[he.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",he[he.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",he[he.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",he[he.BILLBOARD=32]="BILLBOARD",he[he.ANIMATION=33]="ANIMATION",he[he.FONT=34]="FONT",he[he.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",he[he.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",he[he.GLTF_SHAPE=54]="GLTF_SHAPE",he[he.OBJ_SHAPE=55]="OBJ_SHAPE",he[he.AVATAR_SHAPE=56]="AVATAR_SHAPE",he[he.BASIC_MATERIAL=64]="BASIC_MATERIAL",he[he.PBR_MATERIAL=65]="PBR_MATERIAL",he[he.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",he[he.SOUND=67]="SOUND",he[he.TEXTURE=68]="TEXTURE",he[he.VIDEO_CLIP=70]="VIDEO_CLIP",he[he.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",he[he.AUDIO_CLIP=200]="AUDIO_CLIP",he[he.AUDIO_SOURCE=201]="AUDIO_SOURCE",he[he.AUDIO_STREAM=202]="AUDIO_STREAM",he[he.GIZMOS=203]="GIZMOS",he[he.SMART_ITEM=204]="SMART_ITEM",he[he.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",he[he.NAME=300]="NAME",he[he.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",he[he.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",A.AvatarModifiers=void 0,(ce=A.AvatarModifiers||(A.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",ce.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var ye,ve=function(T){function n(A){var E=T.call(this)||this;return E.area=A.area,E.modifiers=A.modifiers,E}return o(n,T),r([et.field],n.prototype,"area",void 0),r([et.field],n.prototype,"modifiers",void 0),r([M("engine.avatarModifierArea",A.CLASS_ID.AVATAR_MODIFIER_AREA)],n)}(et),me=function(T){function n(A){void 0===A&&(A={});var E=T.call(this)||this;return E.position=A.position||Gt.Zero(),E.rotation=A.rotation||jt.Identity,E.scale=A.scale||new Gt(1,1,1),E}return o(n,T),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(A,T){void 0===T&&(T=Xt.staticUp);var E=new Ht;return Ht.LookAtLHToRef(this.position,A,T,E),E.invert(),jt.FromRotationMatrixToRef(E,this.rotation),this},n.prototype.rotate=function(A,T){return this.rotation.multiplyInPlace(this.rotation.angleAxis(T,A)),this},n.prototype.translate=function(A){return this.position.addInPlace(A),this},r([et.field],n.prototype,"position",void 0),r([et.field],n.prototype,"rotation",void 0),r([et.field],n.prototype,"scale",void 0),r([M("engine.transform",A.CLASS_ID.TRANSFORM)],n)}(et),ge=function(T){function n(A,E,R){void 0===A&&(A=!0),void 0===E&&(E=!0),void 0===R&&(R=!0);var z=T.call(this)||this;return z.x=!0,z.y=!0,z.z=!0,z.x=A,z.y=E,z.z=R,z}return o(n,T),r([et.field],n.prototype,"x",void 0),r([et.field],n.prototype,"y",void 0),r([et.field],n.prototype,"z",void 0),r([M("engine.billboard",A.CLASS_ID.BILLBOARD)],n)}(et),we=function(A){function e(){var T=null!==A&&A.apply(this,arguments)||this;return T.withCollisions=!0,T.isPointerBlocker=!0,T.visible=!0,T}return o(e,A),r([et.field],e.prototype,"withCollisions",void 0),r([et.field],e.prototype,"isPointerBlocker",void 0),r([et.field],e.prototype,"visible",void 0),e}(et),be=function(T){function n(){return null!==T&&T.apply(this,arguments)||this}return o(n,T),r([et.field],n.prototype,"uvs",void 0),r([F("engine.shape",A.CLASS_ID.BOX_SHAPE)],n)}(we),xe=function(T){function n(){return null!==T&&T.apply(this,arguments)||this}return o(n,T),r([F("engine.shape",A.CLASS_ID.SPHERE_SHAPE)],n)}(we),Ae=function(T){function n(){return null!==T&&T.apply(this,arguments)||this}return o(n,T),r([et.field],n.prototype,"segments",void 0),r([et.field],n.prototype,"arc",void 0),r([F("engine.shape",A.CLASS_ID.CIRCLE_SHAPE)],n)}(we),Te=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.width=1,A.height=1,A}return o(n,T),r([et.field],n.prototype,"width",void 0),r([et.field],n.prototype,"height",void 0),r([et.field],n.prototype,"uvs",void 0),r([F("engine.shape",A.CLASS_ID.PLANE_SHAPE)],n)}(we),Se=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.radiusTop=0,A.radiusBottom=1,A.segmentsHeight=1,A.segmentsRadial=36,A.openEnded=!1,A.radius=null,A.arc=360,A}return o(n,T),r([et.field],n.prototype,"radiusTop",void 0),r([et.field],n.prototype,"radiusBottom",void 0),r([et.field],n.prototype,"segmentsHeight",void 0),r([et.field],n.prototype,"segmentsRadial",void 0),r([et.field],n.prototype,"openEnded",void 0),r([et.field],n.prototype,"radius",void 0),r([et.field],n.prototype,"arc",void 0),r([F("engine.shape",A.CLASS_ID.CONE_SHAPE)],n)}(we),Ee=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.radiusTop=1,A.radiusBottom=1,A.segmentsHeight=1,A.segmentsRadial=36,A.openEnded=!1,A.radius=null,A.arc=360,A}return o(n,T),r([et.field],n.prototype,"radiusTop",void 0),r([et.field],n.prototype,"radiusBottom",void 0),r([et.field],n.prototype,"segmentsHeight",void 0),r([et.field],n.prototype,"segmentsRadial",void 0),r([et.field],n.prototype,"openEnded",void 0),r([et.field],n.prototype,"radius",void 0),r([et.field],n.prototype,"arc",void 0),r([F("engine.shape",A.CLASS_ID.CYLINDER_SHAPE)],n)}(we),Ce=function(T){function n(A){var E=T.call(this)||this;return E.src=A,E}return o(n,T),r([we.readonly],n.prototype,"src",void 0),r([F("engine.shape",A.CLASS_ID.GLTF_SHAPE)],n)}(we);A.PictureFrameStyle=void 0,(ye=A.PictureFrameStyle||(A.PictureFrameStyle={}))[ye.Classic=0]="Classic",ye[ye.Baroque_Ornament=1]="Baroque_Ornament",ye[ye.Diamond_Ornament=2]="Diamond_Ornament",ye[ye.Minimal_Wide=3]="Minimal_Wide",ye[ye.Minimal_Grey=4]="Minimal_Grey",ye[ye.Blocky=5]="Blocky",ye[ye.Gold_Edges=6]="Gold_Edges",ye[ye.Gold_Carved=7]="Gold_Carved",ye[ye.Gold_Wide=8]="Gold_Wide",ye[ye.Gold_Rounded=9]="Gold_Rounded",ye[ye.Metal_Medium=10]="Metal_Medium",ye[ye.Metal_Wide=11]="Metal_Wide",ye[ye.Metal_Slim=12]="Metal_Slim",ye[ye.Metal_Rounded=13]="Metal_Rounded",ye[ye.Pins=14]="Pins",ye[ye.Minimal_Black=15]="Minimal_Black",ye[ye.Minimal_White=16]="Minimal_White",ye[ye.Tape=17]="Tape",ye[ye.Wood_Slim=18]="Wood_Slim",ye[ye.Wood_Wide=19]="Wood_Wide",ye[ye.Wood_Twigs=20]="Wood_Twigs",ye[ye.Canvas=21]="Canvas",ye[ye.None=22]="None";var Ie,Re=function(T){function n(E,R){void 0===R&&(R={});var z=T.call(this)||this;z.src=E;var O=new ee(.6404918,.611472,.8584906),V=A.PictureFrameStyle.Classic;return"r"in R?O=R:null!=R&&(R.color&&(O=R.color),R.style&&(V=R.style)),z.color=O,z.style=V,z}return o(n,T),r([we.readonly],n.prototype,"src",void 0),r([we.readonly],n.prototype,"style",void 0),r([et.field],n.prototype,"color",void 0),r([F("engine.shape",A.CLASS_ID.NFT_SHAPE)],n)}(we),_e=function(T){function n(A,E){var R=T.call(this)||this;if(R.src=A,E)for(var z in E)R[z]=E[z];return R}return o(n,T),r([et.readonly],n.prototype,"src",void 0),r([et.readonly],n.prototype,"samplingMode",void 0),r([et.readonly],n.prototype,"wrap",void 0),r([et.readonly],n.prototype,"hasAlpha",void 0),r([F("engine.texture",A.CLASS_ID.TEXTURE)],n)}(et),ze=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.states=[],A}return o(n,T),n.prototype.addClip=function(A){var T=this;return this.states.push(A),A.onChange((function(){T.dirty=!0})),A.owner=this,this},n.prototype.getClip=function(A){for(var T=0;T<this.states.length;T++){var E=this.states[T];if(E.clip===A)return E}var R=new le(A);return this.addClip(R),R},n.prototype.stop=function(A){if(A)A.playing=!1,A.shouldReset=!0;else for(var T=0;T<this.states.length;T++){var E=this.states[T];this.stop(E)}},n.prototype.play=function(A,T){void 0===T&&(T=!1);for(var E=0;E<this.states.length;E++){var R=this.states[E];R.layer===A.layer&&A!==R&&this.pause(R)}T&&(A.shouldReset=!0),A.playing=!0,A.dirty=!0,A.data.nonce=Math.random()},n.prototype.pause=function(A){if(A)A.playing=!1;else for(var T=0;T<this.states.length;T++){var E=this.states[T];this.pause(E)}},r([et.readonly],n.prototype,"states",void 0),r([M("engine.animator",A.CLASS_ID.ANIMATION)],n)}(we),Pe=function(T){function n(A){var E=T.call(this)||this;return E.src=A,E}return o(n,T),r([et.readonly],n.prototype,"src",void 0),r([F("engine.shape",A.CLASS_ID.OBJ_SHAPE)],n)}(we),Be=function(T){function n(A){void 0===A&&(A="");var E=T.call(this)||this;return E.src=A,E}return o(n,T),r([et.readonly],n.prototype,"src",void 0),r([F("engine.font",A.CLASS_ID.FONT)],n)}(et);A.Fonts=void 0,(Ie=A.Fonts||(A.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",Ie.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",Ie.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",Ie.LiberationSans="builtin:LiberationSans SDF",Ie.SansSerif="SansSerif",Ie.SansSerif_Heavy="SansSerif_Heavy",Ie.SansSerif_Bold="SansSerif_Bold",Ie.SansSerif_SemiBold="SansSerif_SemiBold";var Fe,Me=function(T){function n(A){var E=T.call(this)||this;return E.outlineWidth=0,E.outlineColor=new ee(1,1,1),E.color=new ee(1,1,1),E.fontSize=10,E.opacity=1,E.value="",E.lineSpacing="0px",E.lineCount=0,E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=new ee(1,1,1),E.hTextAlign="center",E.vTextAlign="center",E.width=1,E.height=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.billboard=!1,E.visible=!0,A&&(E.value=A),E}return o(n,T),r([et.field],n.prototype,"outlineWidth",void 0),r([et.field],n.prototype,"outlineColor",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"fontSize",void 0),r([et.component],n.prototype,"font",void 0),r([et.field],n.prototype,"opacity",void 0),r([et.field],n.prototype,"value",void 0),r([et.field],n.prototype,"lineSpacing",void 0),r([et.field],n.prototype,"lineCount",void 0),r([et.field],n.prototype,"textWrapping",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"hTextAlign",void 0),r([et.field],n.prototype,"vTextAlign",void 0),r([et.field],n.prototype,"width",void 0),r([et.field],n.prototype,"height",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([et.field],n.prototype,"billboard",void 0),r([et.field],n.prototype,"visible",void 0),r([M("engine.text",A.CLASS_ID.TEXT_SHAPE)],n)}(et);A.TransparencyMode=void 0,(Fe=A.TransparencyMode||(A.TransparencyMode={}))[Fe.OPAQUE=0]="OPAQUE",Fe[Fe.ALPHA_TEST=1]="ALPHA_TEST",Fe[Fe.ALPHA_BLEND=2]="ALPHA_BLEND",Fe[Fe.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Fe[Fe.AUTO=4]="AUTO";var Oe,Le=function(T){function n(){var E=null!==T&&T.apply(this,arguments)||this;return E.alphaTest=.5,E.castShadows=!0,E.transparencyMode=A.TransparencyMode.AUTO,E}return o(n,T),r([et.field],n.prototype,"alphaTest",void 0),r([et.field],n.prototype,"albedoColor",void 0),r([et.field],n.prototype,"emissiveColor",void 0),r([et.field],n.prototype,"metallic",void 0),r([et.field],n.prototype,"roughness",void 0),r([et.field],n.prototype,"reflectivityColor",void 0),r([et.field],n.prototype,"directIntensity",void 0),r([et.field],n.prototype,"microSurface",void 0),r([et.field],n.prototype,"emissiveIntensity",void 0),r([et.field],n.prototype,"specularIntensity",void 0),r([et.component],n.prototype,"albedoTexture",void 0),r([et.component],n.prototype,"alphaTexture",void 0),r([et.component],n.prototype,"emissiveTexture",void 0),r([et.component],n.prototype,"bumpTexture",void 0),r([et.field],n.prototype,"castShadows",void 0),r([et.field],n.prototype,"transparencyMode",void 0),r([F("engine.material",A.CLASS_ID.PBR_MATERIAL)],n)}(et),Ne=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.alphaTest=.5,A.castShadows=!0,A}return o(n,T),r([et.component],n.prototype,"texture",void 0),r([et.field],n.prototype,"alphaTest",void 0),r([et.field],n.prototype,"castShadows",void 0),r([F("engine.material",A.CLASS_ID.BASIC_MATERIAL)],n)}(et),ke=function(A){function e(T){var E=A.call(this)||this;if(E.uuid=f("UUID"),!T||!("apply"in T)||!("call"in T))throw new Error("Callback is not a function");return E.callback=T,E}return o(e,A),e.uuidEvent=function(A,T){if(delete A[T]){var E=T+"_"+Math.random();A[E]=void 0,Object.defineProperty(A,E,i(i({},Object.getOwnPropertyDescriptor(A,E)),{enumerable:!1})),Object.defineProperty(A,T.toString(),{get:function(){return this[E]},set:function(A){var R=this[E];if(A){if(!(A instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[T]=A.uuid}else this.data[T]=null;if(this[E]=A,A!==R){this.dirty=!0;for(var z=0;z<this.subscriptions.length;z++)this.subscriptions[z](T,A,R)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([et.field],e.prototype,"callback",void 0),e}(et),qe=function(T){function n(){var E=null!==T&&T.apply(this,arguments)||this;return E.button=A.ActionButton.ANY,E.hoverText="Interact",E.distance=10,E.showFeedback=!0,E}return o(n,T),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([et.field],n.prototype,"button",void 0),r([et.field],n.prototype,"hoverText",void 0),r([et.field],n.prototype,"distance",void 0),r([et.field],n.prototype,"showFeedback",void 0),n}(ke),We=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.type="onPointerLock",A}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onPointerLock",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),De=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.type="onAnimationEnd",A}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onAnimationEnd",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),Ve=function(T){function n(){return null!==T&&T.apply(this,arguments)||this}return o(n,T),r([M("engine.smartItem",A.CLASS_ID.SMART_ITEM)],n)}(et),Ue=function(T){function n(A){var E=T.call(this)||this;return E.url=A,E}return o(n,T),r([et.readonly],n.prototype,"url",void 0),r([F("engine.VideoClip",A.CLASS_ID.VIDEO_CLIP)],n)}(et);A.VideoStatus=void 0,(Oe=A.VideoStatus||(A.VideoStatus={}))[Oe.NONE=0]="NONE",Oe[Oe.ERROR=1]="ERROR",Oe[Oe.LOADING=2]="LOADING",Oe[Oe.READY=3]="READY",Oe[Oe.PLAYING=4]="PLAYING",Oe[Oe.BUFFERING=5]="BUFFERING";var He,je=function(T){function n(E,R){var z=T.call(this)||this;if(z.volume=1,z.playbackRate=1,z.loop=!1,z.seek=-1,z._position=-1,z._videoLength=-1,z._status=A.VideoStatus.NONE,z.playing=!1,!(E instanceof Ue))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(z.videoClipId=D(E),R)for(var O in R)z[O]=R[O];return z}return o(n,T),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(A){this.seek=A,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var A=JSON.parse(JSON.stringify(T.prototype.toJSON.call(this)));return this.seek=-1,A}return T.prototype.toJSON.call(this)},n.prototype.update=function(T){T.videoClipId==this.videoClipId&&(this._status=T.videoStatus||A.VideoStatus.NONE,this._videoLength=T.totalVideoLength,this._position=T.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([et.readonly],n.prototype,"videoClipId",void 0),r([et.readonly],n.prototype,"samplingMode",void 0),r([et.readonly],n.prototype,"wrap",void 0),r([et.field],n.prototype,"volume",void 0),r([et.field],n.prototype,"playbackRate",void 0),r([et.field],n.prototype,"loop",void 0),r([et.field],n.prototype,"seek",void 0),r([et.field],n.prototype,"playing",void 0),r([F("engine.VideoTexture",A.CLASS_ID.VIDEO_TEXTURE)],n)}(et),Ge=function(){function e(){var T=this;this.position=new Gt,this.rotation=new jt,this.feetPosition=new Gt,this.worldPosition=new Gt,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=A.CameraMode.FirstPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(A){switch(A.type){case"positionChanged":T.positionChanged(A.data);break;case"rotationChanged":T.rotationChanged(A.data);break;case"cameraModeChanged":T.cameraModeChanged(A.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return T.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return T.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return T.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return T.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return T.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return T.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return T.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return T.lastEventPosition.y-T.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return T.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return T.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return T.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return T.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return T.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(A){this.lastEventPosition=A.position,this.lastEventWorldPosition=A.cameraPosition,this._playerHeight=A.playerHeight},e.prototype.rotationChanged=function(A){this.lastEventRotation=A.quaternion},e.prototype.cameraModeChanged=function(A){this._cameraMode=A.cameraMode},e}();!function(A){A.HitFirst="rqhf",A.HitAll="rqha"}(He||(He={}));var Xe,Ye=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(A){var T=Ge.instance.rotation,E=Ht.Identity();T.toRotationMatrix(E);var R=Gt.TransformCoordinates(Gt.Forward(),E);return{origin:Ge.instance.position,direction:R,distance:A}},t.prototype.getRayFromPositions=function(A,T){var E=T.subtract(A),R=E.length();return{origin:A,direction:E.normalize(),distance:R}},t.prototype.hitFirst=function(A,T,E){var R="number"==typeof E?He.HitFirst+E:y();this.queries[R]=T,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitFirst",ray:A})},t.prototype.hitAll=function(A,T,E){var R="number"==typeof E?He.HitAll+E:y();this.queries[R]=T,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:R,queryType:"HitAll",ray:A})},t.prototype.hitFirstAvatar=function(A,T){l("not implemented yet")},t.prototype.hitAllAvatars=function(A,T){l("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(A){this.queries[A.payload.queryId](A.payload.payload),delete this.queries[A.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(A){this.queries[A.payload.queryId](A.payload.payload),delete this.queries[A.payload.queryId]},t}(),Qe=function(){function t(){}return t.prototype.activate=function(A){A.eventManager.addListener(pt,this,(function(A){"HitFirst"===A.payload.queryType?Ye.instance.handleRaycastHitFirstResponse(A):"HitAll"===A.payload.queryType&&Ye.instance.handleRaycastHitAllResponse(A)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),Ze=function(){function t(){}return t.prototype.activate=function(A){A.eventManager.addListener(dt,this,(function(A){fe.instance.handlePointerEvent(A.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),Ke=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(A){A.eventManager.addListener(ct,this,this.handleEvent),A.eventManager.addListener(U,this,this.componentAdded),A.eventManager.addListener(V,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(A){for(var T in A.components){var E=A.components[T];E instanceof ke&&(this.handlerMap[E.uuid]=E)}},t.prototype.onRemoveEntity=function(A){for(var T in A.components){var E=A.components[T];E instanceof ke&&delete this.handlerMap[E.uuid]}},t.prototype.componentAdded=function(A){if(A.entity.isAddedToEngine()){var T=A.entity.components[A.componentName];T instanceof ke&&(this.handlerMap[T.uuid]=T)}},t.prototype.componentRemoved=function(A){A.entity.isAddedToEngine()&&A.component instanceof ke&&delete this.handlerMap[A.component.uuid]},t.prototype.handleEvent=function(A){if(A.uuid in this.handlerMap){var T=this.handlerMap[A.uuid];T&&T.callback&&"call"in T.callback&&T.callback(A.payload)}},t}(),Je=new Qe,$e=new Ze,tn=new Ke,en=function(T){function n(A){var E=T.call(this)||this;return E.loop=!1,E.volume=1,E.url=A,E}return o(n,T),r([et.readonly],n.prototype,"url",void 0),r([et.field],n.prototype,"loop",void 0),r([et.field],n.prototype,"loadingCompleteEventId",void 0),r([et.field],n.prototype,"volume",void 0),r([F("engine.AudioClip",A.CLASS_ID.AUDIO_CLIP)],n)}(et),nn=function(T){function n(A){var E=T.call(this)||this;if(E.audioClip=A,E.loop=!1,E.volume=1,E.playing=!1,E.pitch=1,E.playedAtTimestamp=Date.now(),!(A instanceof en))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return E.audioClipId=D(A),E}return o(n,T),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([et.readonly],n.prototype,"audioClipId",void 0),r([et.field],n.prototype,"loop",void 0),r([et.field],n.prototype,"volume",void 0),r([et.field],n.prototype,"playing",void 0),r([et.field],n.prototype,"pitch",void 0),r([et.field],n.prototype,"playedAtTimestamp",void 0),r([M("engine.AudioSource",A.CLASS_ID.AUDIO_SOURCE)],n)}(et),on=function(T){function n(A){var E=T.call(this)||this;return E.playing=!1,E.volume=1,E.url=A,E.playing=!0,E}return o(n,T),r([et.readonly],n.prototype,"url",void 0),r([et.field],n.prototype,"playing",void 0),r([et.field],n.prototype,"volume",void 0),r([M("engine.AudioStream",A.CLASS_ID.AUDIO_STREAM)],n)}(et);A.Gizmo=void 0,(Xe=A.Gizmo||(A.Gizmo={})).MOVE="MOVE",Xe.ROTATE="ROTATE",Xe.SCALE="SCALE",Xe.NONE="NONE";var rn,sn=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.type="gizmoEvent",A}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.gizmoEvent",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),an=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.position=!0,A.rotation=!0,A.scale=!0,A.cycle=!0,A.localReference=!1,A}return o(n,T),r([et.field],n.prototype,"position",void 0),r([et.field],n.prototype,"rotation",void 0),r([et.field],n.prototype,"scale",void 0),r([et.field],n.prototype,"cycle",void 0),r([et.field],n.prototype,"selectedGizmo",void 0),r([et.field],n.prototype,"localReference",void 0),r([M("engine.gizmos",A.CLASS_ID.GIZMOS)],n)}(et),un=function(T){function n(A){var E=T.call(this,A)||this;return E.type="onFocus",tn.handlerMap[E.uuid]=E,E}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onFocus",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),ln=function(T){function n(A){var E=T.call(this,A)||this;return E.type="onTextSubmit",tn.handlerMap[E.uuid]=E,E}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onTextSubmit",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),hn=function(T){function n(A){var E=T.call(this,A)||this;return E.type="onBlur",tn.handlerMap[E.uuid]=E,E}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onBlur",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),cn=function(T){function n(A){var E=T.call(this,A)||this;return E.type="onEnter",tn.handlerMap[E.uuid]=E,E}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onEnter",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),pn=function(T){function n(A){var E=T.call(this,A)||this;return E.type="onChange",tn.handlerMap[E.uuid]=E,E}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onChange",A.CLASS_ID.UUID_CALLBACK)],n)}(ke),dn=function(T){function n(A,E){var R=T.call(this,A)||this;return R.type="onClick",tn.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.onClick",A.CLASS_ID.UUID_CALLBACK)],n)}(qe),fn=function(T){function n(A,E){var R=T.call(this,A)||this;return R.type="pointerDown",tn.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.pointerDown",A.CLASS_ID.UUID_CALLBACK)],n)}(qe),yn=function(T){function n(A,E){var R=T.call(this,A)||this;return R.type="pointerUp",tn.handlerMap[R.uuid]=R,E&&(R.showFeedback=!(!1===E.showFeedback),E.button&&(R.button=E.button),E.hoverText&&(R.hoverText=E.hoverText),E.distance&&(R.distance=E.distance)),R}return o(n,T),r([et.readonly],n.prototype,"type",void 0),r([M("engine.pointerUp",A.CLASS_ID.UUID_CALLBACK)],n)}(qe),vn=function(A){function e(T){var E=A.call(this)||this;return E.name=null,E.visible=!0,E.opacity=1,E.hAlign="center",E.vAlign="center",E.width="100px",E.height="50px",E.positionX="0px",E.positionY="0px",E.isPointerBlocker=!0,T&&(E._parent=T,E.data.parentComponent=D(T)),E}return o(e,A),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([et.field],e.prototype,"name",void 0),r([et.field],e.prototype,"visible",void 0),r([et.field],e.prototype,"opacity",void 0),r([et.field],e.prototype,"hAlign",void 0),r([et.field],e.prototype,"vAlign",void 0),r([et.uiValue],e.prototype,"width",void 0),r([et.uiValue],e.prototype,"height",void 0),r([et.uiValue],e.prototype,"positionX",void 0),r([et.uiValue],e.prototype,"positionY",void 0),r([et.field],e.prototype,"isPointerBlocker",void 0),e}(et),mn=function(T){function n(){return T.call(this,null)||this}return o(n,T),r([F("engine.shape",A.CLASS_ID.UI_FULLSCREEN_SHAPE)],n)}(vn),wn=function(T){function n(){return T.call(this,null)||this}return o(n,T),r([F("engine.shape",A.CLASS_ID.UI_WORLD_SPACE_SHAPE)],n)}(vn),bn=function(T){function n(){return T.call(this,null)||this}return o(n,T),r([F("engine.shape",A.CLASS_ID.UI_SCREEN_SPACE_SHAPE)],n)}(vn),xn=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.thickness=0,A.color=$t.Clear(),A.alignmentUsesSize=!0,A}return o(n,T),r([et.field],n.prototype,"thickness",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"alignmentUsesSize",void 0),r([F("engine.shape",A.CLASS_ID.UI_CONTAINER_RECT)],n)}(vn);A.UIStackOrientation=void 0,(rn=A.UIStackOrientation||(A.UIStackOrientation={}))[rn.VERTICAL=0]="VERTICAL",rn[rn.HORIZONTAL=1]="HORIZONTAL";var An=function(T){function n(){var E=null!==T&&T.apply(this,arguments)||this;return E.adaptWidth=!0,E.adaptHeight=!0,E.color=$t.Clear(),E.stackOrientation=A.UIStackOrientation.VERTICAL,E.spacing=0,E}return o(n,T),r([et.field],n.prototype,"adaptWidth",void 0),r([et.field],n.prototype,"adaptHeight",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"stackOrientation",void 0),r([et.field],n.prototype,"spacing",void 0),r([F("engine.shape",A.CLASS_ID.UI_CONTAINER_STACK)],n)}(vn),Tn=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.fontSize=10,A.fontWeight="normal",A.thickness=0,A.cornerRadius=0,A.color=$t.White(),A.background=$t.White(),A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=$t.Black(),A.text="button",A}return o(n,T),r([et.field],n.prototype,"fontSize",void 0),r([et.field],n.prototype,"fontWeight",void 0),r([et.field],n.prototype,"thickness",void 0),r([et.field],n.prototype,"cornerRadius",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"background",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"text",void 0),r([F("engine.shape",A.CLASS_ID.UI_BUTTON_SHAPE)],n)}(vn),Sn=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.outlineWidth=0,A.outlineColor=$t.White(),A.color=$t.White(),A.fontSize=10,A.fontAutoSize=!1,A.value="",A.lineSpacing=0,A.lineCount=0,A.adaptWidth=!1,A.adaptHeight=!1,A.textWrapping=!1,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=$t.Black(),A.hTextAlign="left",A.vTextAlign="bottom",A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A}return o(n,T),r([et.field],n.prototype,"outlineWidth",void 0),r([et.field],n.prototype,"outlineColor",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"fontSize",void 0),r([et.field],n.prototype,"fontAutoSize",void 0),r([et.component],n.prototype,"font",void 0),r([et.field],n.prototype,"value",void 0),r([et.field],n.prototype,"lineSpacing",void 0),r([et.field],n.prototype,"lineCount",void 0),r([et.field],n.prototype,"adaptWidth",void 0),r([et.field],n.prototype,"adaptHeight",void 0),r([et.field],n.prototype,"textWrapping",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"hTextAlign",void 0),r([et.field],n.prototype,"vTextAlign",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([F("engine.shape",A.CLASS_ID.UI_TEXT_SHAPE)],n)}(vn),En=function(T){function n(A){var E=T.call(this,A)||this;return E.outlineWidth=0,E.outlineColor=$t.Black(),E.color=$t.Clear(),E.fontSize=10,E.value="",E.placeholder="",E.margin=10,E.hTextAlign="left",E.vTextAlign="bottom",E.focusedBackground=$t.Black(),E.textWrapping=!1,E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0,E.shadowColor=$t.White(),E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.onTextSubmit=null,E.onChanged=null,E.onFocus=null,E.onBlur=null,E.onTextChanged=new pn((function(A){var T=A.value,R=T.value,z=T.isSubmit,O=E.dirty;if(E.value=R,E.dirty=O,z&&E.onTextSubmit){var V={text:R};E.onTextSubmit.callback(V)}else if(!z&&E.onChanged){var U={value:R,pointerId:A.pointerId};E.onChanged.callback(U)}})),E}return o(n,T),r([et.field],n.prototype,"outlineWidth",void 0),r([et.field],n.prototype,"outlineColor",void 0),r([et.field],n.prototype,"color",void 0),r([et.field],n.prototype,"fontSize",void 0),r([et.component],n.prototype,"font",void 0),r([et.field],n.prototype,"value",void 0),r([et.field],n.prototype,"placeholder",void 0),r([et.field],n.prototype,"margin",void 0),r([et.field],n.prototype,"hTextAlign",void 0),r([et.field],n.prototype,"vTextAlign",void 0),r([et.field],n.prototype,"focusedBackground",void 0),r([et.field],n.prototype,"textWrapping",void 0),r([et.field],n.prototype,"shadowBlur",void 0),r([et.field],n.prototype,"shadowOffsetX",void 0),r([et.field],n.prototype,"shadowOffsetY",void 0),r([et.field],n.prototype,"shadowColor",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([ke.uuidEvent],n.prototype,"onTextChanged",void 0),r([ke.uuidEvent],n.prototype,"onFocus",void 0),r([ke.uuidEvent],n.prototype,"onBlur",void 0),r([F("engine.shape",A.CLASS_ID.UI_INPUT_TEXT_SHAPE)],n)}(vn),Cn=function(T){function n(A,E){var R=T.call(this,A)||this;return R.sourceLeft=0,R.sourceTop=0,R.sourceWidth=1,R.sourceHeight=1,R.paddingTop=0,R.paddingRight=0,R.paddingBottom=0,R.paddingLeft=0,R.sizeInPixels=!0,R.onClick=null,R.source=E,R}return o(n,T),r([et.field],n.prototype,"sourceLeft",void 0),r([et.field],n.prototype,"sourceTop",void 0),r([et.field],n.prototype,"sourceWidth",void 0),r([et.field],n.prototype,"sourceHeight",void 0),r([et.component],n.prototype,"source",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([et.field],n.prototype,"sizeInPixels",void 0),r([ke.uuidEvent],n.prototype,"onClick",void 0),r([F("engine.shape",A.CLASS_ID.UI_IMAGE_SHAPE)],n)}(vn),In=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.valueX=0,A.valueY=0,A.backgroundColor=$t.Clear(),A.isHorizontal=!1,A.isVertical=!1,A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.onChanged=null,A}return o(n,T),r([et.field],n.prototype,"valueX",void 0),r([et.field],n.prototype,"valueY",void 0),r([et.field],n.prototype,"backgroundColor",void 0),r([et.field],n.prototype,"isHorizontal",void 0),r([et.field],n.prototype,"isVertical",void 0),r([et.field],n.prototype,"paddingTop",void 0),r([et.field],n.prototype,"paddingRight",void 0),r([et.field],n.prototype,"paddingBottom",void 0),r([et.field],n.prototype,"paddingLeft",void 0),r([ke.uuidEvent],n.prototype,"onChanged",void 0),r([F("engine.shape",A.CLASS_ID.UI_SLIDER_SHAPE)],n)}(vn),Rn=function(T){function n(){var A=null!==T&&T.apply(this,arguments)||this;return A.useDummyModel=!1,A.talking=!1,A}var E;return o(n,T),E=n,n.Dummy=function(){var A=new E;return A.useDummyModel=!0,A},r([et.field],n.prototype,"id",void 0),r([et.field],n.prototype,"name",void 0),r([et.field],n.prototype,"expressionTriggerId",void 0),r([et.field],n.prototype,"expressionTriggerTimestamp",void 0),r([et.field],n.prototype,"bodyShape",void 0),r([et.field],n.prototype,"wearables",void 0),r([et.field],n.prototype,"skinColor",void 0),r([et.field],n.prototype,"hairColor",void 0),r([et.field],n.prototype,"eyeColor",void 0),r([et.field],n.prototype,"useDummyModel",void 0),r([et.field],n.prototype,"talking",void 0),E=r([M("engine.avatarShape",A.CLASS_ID.AVATAR_SHAPE)],n)}(et),_n=null,zn=null,Pn=null;function gn(){return Pn||(Pn=new ht),Pn}var Bn=function(){function t(){var A=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!zn){(zn=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(A){_n=A}));var A=gn();dcl.subscribe("comms"),dcl.onEvent((function(T){"comms"===T.type&&A.notifyObservers(T.data)}))}return zn}().then((function(T){A.connected=!0,A.flush()}))}return t.prototype.on=function(A,T){return gn().add((function(E){try{var R=JSON.parse(E.message);R.message===A&&T(R.payload,E.sender)}catch(E){dcl.error("Error parsing comms message "+(E.message||""),E)}}))},t.prototype.sendRaw=function(A){this.messageQueue.push(A),this.connected&&this.flush()},t.prototype.emit=function(A,T){var E=JSON.stringify({message:A,payload:T});this.sendRaw(E),gn().notifyObservers({message:E,sender:"self"})},t.prototype.flush=function(){var A=this;if(0!==this.messageQueue.length&&this.connected&&_n&&!this.flushing){var T=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(_n.rpcHandle,"send",[T]).then((function(T){A.flushing=!1,A.flush()}),(function(T){A.flushing=!1,d("Error flushing MessageBus",T)}))}},t}(),Fn=new ot("scene");Fn.uuid="0";var Mn=new it(Fn);F.engine=Mn,"undefined"!=typeof dcl&&(Mn.addSystem(new Pt(dcl),1/0),yt(dcl)),Mn.addSystem(tn),Mn.addSystem($e),Mn.addSystem(Je),A.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",A.Angle=Yt,A.AnimationState=le,A.Animator=ze,A.Arc2=Ft,A.Attachable=T,A.AudioClip=en,A.AudioSource=nn,A.AudioStream=on,A.AvatarModifierArea=ve,A.AvatarShape=Rn,A.Axis=Zt,A.BasicMaterial=Ne,A.BezierCurve=Jt,A.Billboard=ge,A.BoxShape=be,A.Camera=Ge,A.CircleShape=Ae,A.Color3=ee,A.Color4=$t,A.Component=M,A.ComponentAdded=U,A.ComponentGroup=nt,A.ComponentRemoved=V,A.ConeShape=Se,A.Curve3=ne,A.CylinderShape=Ee,A.DEG2RAD=Wt,A.DisposableComponent=F,A.DisposableComponentCreated=K,A.DisposableComponentRemoved=J,A.DisposableComponentUpdated=$,A.Engine=it,A.Entity=ot,A.Epsilon=qt,A.EventConstructor=x,A.EventManager=z,A.Font=Be,A.Frustum=ie,A.GLTFShape=Ce,A.Gizmos=an,A.GlobalPointerDown=pe,A.GlobalPointerUp=de,A.Input=fe,A.Material=Le,A.MathTmp=Xt,A.Matrix=Ht,A.MessageBus=Bn,A.MultiObserver=lt,A.NFTShape=Re,A.OBJShape=Pe,A.Observable=ht,A.ObservableComponent=et,A.Observer=Y,A.ObserverEventState=ut,A.OnAnimationEnd=De,A.OnBlur=hn,A.OnChanged=pn,A.OnClick=dn,A.OnEnter=cn,A.OnFocus=un,A.OnGizmoEvent=sn,A.OnPointerDown=fn,A.OnPointerLock=We,A.OnPointerUUIDEvent=qe,A.OnPointerUp=yn,A.OnTextSubmit=ln,A.OnUUIDEvent=ke,A.ParentChanged=H,A.Path2=re,A.Path3D=se,A.PhysicsCast=Ye,A.Plane=oe,A.PlaneShape=Te,A.PointerEvent=dt,A.PointerEventComponent=Kt,A.PointerEventSystem=Ze,A.Quaternion=jt,A.RAD2DEG=Dt,A.RaycastEventSystem=Qe,A.RaycastResponse=pt,A.Scalar=Vt,A.Shape=we,A.Size=ae,A.SmartItem=Ve,A.SphereShape=xe,A.Subscription=te,A.TextShape=Me,A.Texture=_e,A.ToGammaSpace=Nt,A.ToLinearSpace=kt,A.Transform=me,A.UIButton=Tn,A.UICanvas=bn,A.UIContainerRect=xn,A.UIContainerStack=An,A.UIFullScreen=mn,A.UIImage=Cn,A.UIInputText=En,A.UIScrollRect=In,A.UIShape=vn,A.UIText=Sn,A.UIValue=G,A.UIWorldSpace=wn,A.UUIDEvent=ct,A.UUIDEventSystem=Ke,A.Vector2=Qt,A.Vector3=Gt,A.Vector4=Ut,A.VideoClip=Ue,A.VideoTexture=je,A._initEventObservables=yt,A.buildArray=v,A.engine=Mn,A.error=d,A.executeTask=W,A.getComponentClassId=N,A.getComponentId=D,A.getComponentName=L,A.getMessageObserver=gn,A.isDisposableComponent=B,A.log=l,A.newId=f,A.onCameraModeChangedObservable=ft,A.onEnterScene=gt,A.onEnterSceneObservable=mt,A.onIdleStateChangedObservable=vt,A.onLeaveScene=bt,A.onLeaveSceneObservable=wt,A.onPlayerConnectedObservable=Ct,A.onPlayerDisconnectedObservable=It,A.onPlayerExpressionObservable=At,A.onPointerLockedStateChange=Tt,A.onProfileChanged=Et,A.onRealmChangedObservable=Rt,A.onSceneReadyObservable=xt,A.onVideoEvent=St,A.openExternalURL=function(A){"undefined"!=typeof dcl?dcl.openExternalUrl(A):d("ERROR: openExternalURL dcl is undefined")},A.openNFTDialog=function(A,T){if(void 0===T&&(T=null),"undefined"!=typeof dcl){var E=A.match(/ethereum:\/\/(.+)\/(.+)/);if(!E||E.length<3)return;dcl.openNFTDialog(E[1],E[2],T)}else d("ERROR: openNFTDialog dcl is undefined")},A.pointerEventSystem=$e,A.raycastEventSystem=Je,A.teleportTo=function(A){var T;T=[A],void 0===st&&"undefined"!=typeof dcl&&(st=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==st&&"undefined"!=typeof dcl&&st.then((function(A){dcl.callRpc(A.rpcHandle,"requestTeleport",T)}))},A.uuid=y,A.uuidEventSystem=tn,Object.defineProperty(A,"__esModule",{value:!0})}(this.self=this.self||{}),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(A,T){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(A,T){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,T){A.__proto__=T}||function(A,T){for(var E in T)Object.prototype.hasOwnProperty.call(T,E)&&(A[E]=T[E])})(A,T)};function i(A,T){function i(){this.constructor=A}n(A,T),A.prototype=null===T?Object.create(T):(i.prototype=T.prototype,new i)}function r(A,T,E,R){var z,O=arguments.length,V=O<3?T:null===R?R=Object.getOwnPropertyDescriptor(T,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(A,T,E,R);else for(var U=A.length-1;U>=0;U--)(z=A[U])&&(V=(O<3?z(V):O>3?z(T,E,V):z(T,E))||V);return O>3&&V&&Object.defineProperty(T,E,V),V}function o(A,T,E,R){return new(E||(E=Promise))((function(z,O){function a(A){try{u(R.next(A))}catch(A){O(A)}}function s(A){try{u(R.throw(A))}catch(A){O(A)}}function u(A){var T;A.done?z(A.value):(T=A.value,T instanceof E?T:new E((function(A){A(T)}))).then(a,s)}u((R=R.apply(A,T||[])).next())}))}function a(A,T){var E,R,z,O,V={label:0,sent:function(){if(1&z[0])throw z[1];return z[1]},trys:[],ops:[]};return O={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function s(O){return function(U){return function(O){if(E)throw new TypeError("Generator is already executing.");for(;V;)try{if(E=1,R&&(z=2&O[0]?R.return:O[0]?R.throw||((z=R.return)&&z.call(R),0):R.next)&&!(z=z.call(R,O[1])).done)return z;switch(R=0,z&&(O=[2&O[0],z.value]),O[0]){case 0:case 1:z=O;break;case 4:return V.label++,{value:O[1],done:!1};case 5:V.label++,R=O[1],O=[0];continue;case 7:O=V.ops.pop(),V.trys.pop();continue;default:if(!((z=(z=V.trys).length>0&&z[z.length-1])||6!==O[0]&&2!==O[0])){V=0;continue}if(3===O[0]&&(!z||O[1]>z[0]&&O[1]<z[3])){V.label=O[1];break}if(6===O[0]&&V.label<z[1]){V.label=z[1],z=O;break}if(z&&V.label<z[2]){V.label=z[2],V.ops.push(O);break}z[2]&&V.ops.pop(),V.trys.pop();continue}O=T.call(A,V)}catch(A){O=[6,A],R=0}finally{E=z=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,U])}}}function s(A){var T="function"==typeof Symbol&&Symbol.iterator,E=T&&A[T],R=0;if(E)return E.call(A);if(A&&"number"==typeof A.length)return{next:function(){return A&&R>=A.length&&(A=void 0),{value:A&&A[R++],done:!A}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")}var E,R=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(A){this.createAndAddToEngine()._components.push(A)},e.prototype.addComponentType=function(A){var T,E;try{for(var R=s(this._components),z=R.next();!z.done;z=R.next())if(A==z.value)return}catch(A){T={error:A}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(T)throw T.error}}this._components.push(A),this._componentGroups.push(engine.getComponentGroup(A,Transform))},e.prototype.update=function(A){for(var T=0;T<this._components.length;T++)this.updateComponent(A,this._components[T],this._componentGroups[T])},e.prototype.updateComponent=function(A,T,E){E.entities.forEach((function(E){var R=E.getComponent(Transform),z=E.getComponent(T);z.update(A),z.assignValueToTransform(R),z.hasFinished()&&(E.removeComponent(z),null!=z.onFinishCallback&&z.onFinishCallback())}))},e._instance=null,e}();function h(T,E){switch(T){case A.InterpolationType.LINEAR:return E;case A.InterpolationType.EASEINQUAD:return function(A){return A*A}(E);case A.InterpolationType.EASEOUTQUAD:return function(A){return A*(2-A)}(E);case A.InterpolationType.EASEQUAD:return function(A){return A*A/(2*(A*A-A)+1)}(E);case A.InterpolationType.EASEINSINE:return function(A){return 1-Math.cos(A*Math.PI/2)}(E);case A.InterpolationType.EASEOUTSINE:return function(A){return Math.sin(A*Math.PI/2)}(E);case A.InterpolationType.EASESINE:return function(A){return-(Math.cos(Math.PI*A)-1)/2}(E);case A.InterpolationType.EASEINEXPO:return function(A){return 0===A?0:Math.pow(2,10*A-10)}(E);case A.InterpolationType.EASEOUTEXPO:return function(A){return 1===A?1:1-Math.pow(2,-10*A)}(E);case A.InterpolationType.EASEEXPO:return function(A){return 0===A?0:1===A?1:A<.5?Math.pow(2,20*A-10)/2:(2-Math.pow(2,-20*A+10))/2}(E);case A.InterpolationType.EASEINELASTIC:return function(A){var T=2*Math.PI/3;return 0===A?0:1===A?1:-Math.pow(2,10*A-10)*Math.sin((10*A-10.75)*T)}(E);case A.InterpolationType.EASEOUTELASTIC:return function(A){var T=2*Math.PI/3;return 0===A?0:1===A?1:Math.pow(2,-10*A)*Math.sin((10*A-.75)*T)+1}(E);case A.InterpolationType.EASEELASTIC:return function(A){var T=2*Math.PI/4.5;return 0===A?0:1===A?1:A<.5?-Math.pow(2,20*A-10)*Math.sin((20*A-11.125)*T)/2:Math.pow(2,-20*A+10)*Math.sin((20*A-11.125)*T)/2+1}(E);case A.InterpolationType.EASEINBOUNCE:return function(A){return 1-l(1-A)}(E);case A.InterpolationType.EASEOUTEBOUNCE:return function(A){return l(A)}(E);case A.InterpolationType.EASEBOUNCE:return function(A){return A<.5?(1-l(1-2*A))/2:(1+l(2*A-1))/2}(E);default:return E}}function l(A){var T=7.5625,E=2.75;return A<1/E?T*A*A:A<2/E?T*(A-=1.5/E)*A+.75:A<2.5/E?T*(A-=2.25/E)*A+.9375:T*(A-=2.625/E)*A+.984375}A.InterpolationType=void 0,(E=A.InterpolationType||(A.InterpolationType={}))[E.LINEAR=0]="LINEAR",E[E.EASEINQUAD=1]="EASEINQUAD",E[E.EASEOUTQUAD=2]="EASEOUTQUAD",E[E.EASEQUAD=3]="EASEQUAD",E.EASEINSINE="easeinsine",E.EASEOUTSINE="easeoutsine",E.EASESINE="easeinoutsine",E.EASEINEXPO="easeinexpo",E.EASEOUTEXPO="easeoutexpo",E.EASEEXPO="easeinoutexpo",E.EASEINELASTIC="easeinelastic",E.EASEOUTELASTIC="easeoutelastic",E.EASEELASTIC="easeinoutelastic",E.EASEINBOUNCE="easeinbounce",E.EASEOUTEBOUNCE="easeoutbounce",E.EASEBOUNCE="easeinoutbounce";var z,O=function(){function t(E,z,O,V,U){void 0===U&&(U=A.InterpolationType.LINEAR),this.start=E,this.end=z,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=U,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(T)}var T;return T=t,t.prototype.update=function(A){this.normalizedTime=Scalar.Clamp(this.normalizedTime+A*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(A){A.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},T=r([Component("moveTransformComponent")],t)}(),V=function(){function t(E,z,O,V,U){void 0===U&&(U=A.InterpolationType.LINEAR),this.start=E,this.end=z,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=U,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(T)}var T;return T=t,t.prototype.update=function(A){this.normalizedTime=Scalar.Clamp(this.normalizedTime+A*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(A){A.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},T=r([Component("rotateTransformComponent")],t)}(),U=function(){function t(E,z,O,V,U){void 0===U&&(U=A.InterpolationType.LINEAR),this.start=E,this.end=z,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=V,this.interpolationType=U,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),R.createAndAddToEngine().addComponentType(T)}var T;return T=t,t.prototype.update=function(A){this.normalizedTime=Scalar.Clamp(this.normalizedTime+A*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(A){A.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},T=r([Component("scaleTransformComponent")],t)}(),H=function(){function e(T,E,z,O){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=T,this.onFinishCallback=z,this.onPointReachedCallback=O,T.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var V=0,U=[],H=0;H<T.length-1;H++){var G=Vector3.Distance(T[H],T[H+1]);V+=G,U.push(G)}for(H=0;H<U.length;H++)this.speed.push(1/(U[H]/V*E))}else this.normalizedTime=1,this.currentIndex=T.length-2;R.createAndAddToEngine().addComponentType(A)}var A;return A=e,e.prototype.update=function(A){this.normalizedTime=Scalar.Clamp(this.normalizedTime+A*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(A){A.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},A=r([Component("followPathComponent")],e)}(),G=function(){function e(T,E,z,O,V,U){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(T,z,!!V).getPoints(),this.onFinishCallback=U,this.turnToFaceNext=O||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(E>0){for(var H=0,G=[],X=0;X<this.points.length-1;X++){var Q=Vector3.Distance(this.points[X],this.points[X+1]);H+=Q,G.push(Q)}for(X=0;X<G.length;X++)this.speed.push(1/(G[X]/H*E))}else this.normalizedTime=1,this.currentIndex=T.length-2;R.createAndAddToEngine().addComponentType(A)}var A;return A=e,e.prototype.update=function(A){this.normalizedTime=Scalar.Clamp(this.normalizedTime+A*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(A){A.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?A.lookAt(this.points[this.currentIndex+1]):A.lookAt(this.points[0]))},A=r([Component("followCurvedPathComponent")],e)}(),X=function(){function e(T,E){this.rotationVelocity=T,this.onFinishCallback=E,this.rotation=Quaternion.Identity,this.finished=!1,R.createAndAddToEngine().addComponentType(A)}var A;return A=e,e.prototype.update=function(A){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,A)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(A){A.rotation=A.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},A=r([Component("keepRotatingComponent")],e)}();A.ToggleState=void 0,(z=A.ToggleState||(A.ToggleState={}))[z.Off=0]="Off",z[z.On=1]="On";var Q=function(){function t(T,E){void 0===T&&(T=A.ToggleState.On),this.enabled=!0,this.state=A.ToggleState.Off,this.set(T),E&&this.setCallback(E)}return t.prototype.set=function(A){this.state=A,this.onValueChangedCallback&&this.onValueChangedCallback(A)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==A.ToggleState.On},t.prototype.setCallback=function(A){this.onValueChangedCallback=A},r([Component("toggle")],t)}(),Z=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(A){this.createAndAddToEngine()._components.push(A)},e.prototype.addComponentType=function(A){var T,E;try{for(var R=s(this._components),z=R.next();!z.done;z=R.next())if(A==z.value)return}catch(A){T={error:A}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(T)throw T.error}}this._components.push(A)},e.prototype.update=function(A){var T=this;this._components.forEach((function(E){T.updateComponent(A,E)}))},e.prototype.updateComponent=function(A,T){var E=engine.getEntitiesWithComponent(T);for(var R in E)if(E.hasOwnProperty(R)){var z=E[R],O=z.getComponent(T);O.elapsedTime+=A,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(z)}},e._instance=null,e}(),K=function(){function e(T,E){var R=this;Z.createAndAddToEngine().addComponentType(A),this.elapsedTime=0,this.targetTime=T/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){R.onTimeReachedCallback&&R.onTimeReachedCallback(),A.removeComponent(R)}}var A;return A=e,e.prototype.setCallback=function(A){this.onTimeReachedCallback=A},A=r([Component("timerDelay")],e)}(),J=function(){function e(T,E){var R=this;Z.createAndAddToEngine().addComponentType(A),this.elapsedTime=0,this.targetTime=T/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(A){R.onTimeReachedCallback&&R.onTimeReachedCallback(),A.removeComponent(R),engine.removeEntity(A)}}var A;return A=e,e.prototype.setCallback=function(A){this.onTimeReachedCallback=A},A=r([Component("timerExpireIn")],e)}(),$=function(){function e(T,E){var R=this;Z.createAndAddToEngine().addComponentType(A),this.elapsedTime=0,this.targetTime=T/1e3,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(){R.elapsedTime=0,R.onTimeReachedCallback&&R.onTimeReachedCallback()}}var A;return A=e,e.prototype.setCallback=function(A){this.onTimeReachedCallback=A},A=r([Component("timerInterval")],e)}();function I(A,T,E,R,z,O){var V=new Entity;V.addComponent(new Transform(O||{position:new Vector3(0,1.5,0)})),V.setParent(T);var U=new TextShape(A);return U.fontSize=z||3,U.color=R||Color3.Black(),V.addComponent(U),E&&V.addComponent(new Billboard),engine.addEntity(V),V}var et,nt,ot=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new rt(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(st)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(A){this._cameraTriggerWrapper.setShape(A)},e.prototype.update=function(){var A=this,T=this._componentGroup.entities;for(var E in T.forEach((function(T){A.shouldWrapTriggerEntity(T)&&A.wrapTriggerEntity(T)})),this._triggers)if(this._triggers.hasOwnProperty(E)){var R=this._triggers[E];R.isDebugging()&&R.updateDebugEntity(),R.isInEngine()?null!=R.trigger&&R.trigger.enabled?(R.wasEnabled||R.isDebugging()&&R.addDebugEntity(),R.wasEnabled=!0,(R.trigger.onCameraEnter||R.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(R),(R.trigger.onTriggerEnter||R.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(R)):R.wasEnabled&&(R.wasEnabled=!1,R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R)):(R.isDebugging()&&R.removeDebugEntity(),e.removeTriggerFromSystem(R),delete this._triggers[E])}},e.prototype.shouldWrapTriggerEntity=function(A){return null==this._triggers[A.uuid]||null==this._triggers[A.uuid]},e.prototype.wrapTriggerEntity=function(A){this._triggers[A.uuid]=new it(A)},e.removeTriggerFromSystem=function(A){for(var T,E=A.getActiveCollisions(),R=0;R<E.length;R++)!(E[R]===(null===(T=e._instance)||void 0===T?void 0:T._cameraTriggerWrapper)||null==E[R].trigger)&&E[R].trigger.onTriggerExit&&A.entity&&E[R].trigger.onTriggerExit(A.entity),E[R].disengageActiveCollision(A),A.disengageActiveCollision(E[R])},e.disengageCollision=function(A,T){A.disengageActiveCollision(T),T.disengageActiveCollision(A),A.trigger.onTriggerExit&&T.entity&&A.trigger.onTriggerExit(T.entity),T.trigger.onTriggerExit&&A.entity&&T.trigger.onTriggerExit(A.entity)},e.engageCollision=function(A,T){A.engageCollision(T),T.engageCollision(A),A.trigger.onTriggerEnter&&T.entity&&A.trigger.onTriggerEnter(T.entity),T.trigger.onTriggerEnter&&A.entity&&T.trigger.onTriggerEnter(A.entity)},e.prototype.checkCollisionAgainstCamera=function(A){var T=A.hasActiveCollision(this._cameraTriggerWrapper),E=e.areColliding(A,this._cameraTriggerWrapper);T&&!E?(A.disengageActiveCollision(this._cameraTriggerWrapper),A.trigger.onCameraExit&&A.trigger.onCameraExit()):!T&&E&&(A.engageCollision(this._cameraTriggerWrapper),A.trigger.onCameraEnter&&A.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(A){for(var T in this._triggers)if(this._triggers.hasOwnProperty(T)&&T!=A.uuid&&this._triggers[T].trigger.enabled&&e.canTriggersCollide(A,this._triggers[T])){var E=A.hasActiveCollision(this._triggers[T]),R=e.areColliding(A,this._triggers[T]);E&&!R?e.disengageCollision(A,this._triggers[T]):!E&&R&&e.engageCollision(A,this._triggers[T])}},e.canTriggersCollide=function(A,T){return 0==A.trigger.triggeredByLayer||0!=(T.trigger.layer&A.trigger.triggeredByLayer)},e.areColliding=function(A,T){return A.getShape()instanceof P&&T.getShape()instanceof P?e.areCollidingAABB(A.getGlobalPosition(),A.getShape(),T.getGlobalPosition(),T.getShape()):A.getShape()instanceof k&&T.getShape()instanceof k?e.areCollidingSphere(A.getGlobalPosition(),A.getShape(),T.getGlobalPosition(),T.getShape()):A.getShape()instanceof P&&T.getShape()instanceof k?e.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),T.getGlobalPosition(),T.getShape()):A.getShape()instanceof k&&T.getShape()instanceof P&&e.areCollidingAABBSphere(T.getGlobalPosition(),T.getShape(),A.getGlobalPosition(),A.getShape())},e.areCollidingAABB=function(A,T,E,R){var z=e.getBoxShapeValues(A,T),O=e.getBoxShapeValues(E,R);return z.min.x<=O.max.x&&z.max.x>=O.min.x&&z.min.y<=O.max.y&&z.max.y>=O.min.y&&z.min.z<=O.max.z&&z.max.z>=O.min.z},e.areCollidingSphere=function(A,T,E,R){return Vector3.DistanceSquared(A.add(T.position),E.add(R.position))<T.radius*T.radius+R.radius*R.radius},e.areCollidingAABBSphere=function(A,T,E,R){var z=e.getBoxShapeValues(A,T),O=E.add(R.position),V=R.radius,U=0;return O.x<z.min.x&&(U+=(z.min.x-O.x)*(z.min.x-O.x)),O.x>z.max.x&&(U+=(O.x-z.max.x)*(O.x-z.max.x)),O.y<z.min.y&&(U+=(z.min.y-O.y)*(z.min.y-O.y)),O.y>z.max.y&&(U+=(O.y-z.max.y)*(O.y-z.max.y)),O.z<z.min.z&&(U+=(z.min.z-O.z)*(z.min.z-O.z)),O.z>z.max.z&&(U+=(O.z-z.max.z)*(O.z-z.max.z)),U<V*V},e.getBoxShapeValues=function(A,T){var E=A.add(T.position);return{center:E,min:E.subtract(T.size.scale(.5)),max:E.add(T.size.scale(.5))}},e._instance=null,e}(),it=function(){function e(A){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=A,A&&(this._trigger=A.getComponent(st),this._uuid=A.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var A=[];for(var T in this._collidingWith)this._collidingWith.hasOwnProperty(T)&&A.push(this._collidingWith[T]);return A},e.prototype.hasActiveCollision=function(A){return null!=this._collidingWith[A.uuid]&&null!=this._collidingWith[A.uuid]},e.prototype.disengageActiveCollision=function(A){delete this._collidingWith[A.uuid]},e.prototype.engageCollision=function(A){this._collidingWith[A.uuid]=A},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var A,E,R;return a(this,(function(z){switch(z.label){case 0:return[4,!T.isPreviewMode()];case 1:return z.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,A=new Transform,this._debugEntity.addComponent(A),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((E=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(E),A.scale=this.getShape().size),this.getShape()instanceof k&&((E=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(E),R=this.getShape().radius,A.scale=new Vector3(R,R,R))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(A){var T=A.hasComponent(Transform)?A.getComponent(Transform).position.clone():Vector3.Zero(),E=A.getParent();if(null!=E){var R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(E).add(T.rotate(R))}return T},e._debugMaterial=null,e}(),rt=function(A){function t(T){var E=A.call(this)||this;return E._shape=T,E._uuid="cameraTrigger",E}return i(t,A),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(A){this._shape=A},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(A){return!1},t.prototype.disengageActiveCollision=function(A){},t.prototype.engageCollision=function(A){},t.prototype.isDebugging=function(){return!1},t}(it),st=function(){function e(A,T){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,ot.createAndAddToEngine(),this.shape=A,T&&(T.layer&&(this.layer=T.layer),T.triggeredByLayer&&(this.triggeredByLayer=T.triggeredByLayer),T.onTriggerEnter&&(this.onTriggerEnter=T.onTriggerEnter),T.onTriggerExit&&(this.onTriggerExit=T.onTriggerExit),T.onCameraEnter&&(this.onCameraEnter=T.onCameraEnter),T.onCameraExit&&(this.onCameraExit=T.onCameraExit),T.enableDebug&&(this._debugEnabled=T.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(A,T){void 0===A&&(A=Vector3.One().scale(2)),void 0===T&&(T=Vector3.Zero()),this.size=A,this.position=T},k=function(A,T){void 0===A&&(A=2),void 0===T&&(T=Vector3.Zero()),this.radius=A,this.position=T};A.ActionsSequenceSystem=function(){function e(A){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,A&&this.startSequence(A)}return e.prototype.startSequence=function(A){this.beginSequenceNode=A.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(A){this.onFinishCallback=A},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var A=this.currentSequenceNode;if(this.currentSequenceNode instanceof ut)do{A=A.currentInnerSequence}while(A instanceof ut);return A.action},e.prototype.update=function(A){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(A):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),et=A.ActionsSequenceSystem||(A.ActionsSequenceSystem={}),nt=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(A){if(null==this.currentSequenceNode)this.currentSequenceNode=new at,this.currentSequenceNode.action=A,this.beginSequenceNode=this.currentSequenceNode;else{var T=new at;T.action=A,this.currentSequenceNode=this.currentSequenceNode.then(T)}return this},e.prototype.if=function(A){var T=new lt(A);return null==this.currentSequenceNode?(this.currentSequenceNode=T,this.beginSequenceNode=T):this.currentSequenceNode=this.currentSequenceNode.then(T),this},e.prototype.else=function(){var A=this.currentSequenceNode.getSequence();if(!(A instanceof lt))throw new Error("IF statement is needed to be called before ELSE statement.");A.closed=!0;var T=new ht(A);return this.currentSequenceNode=this.currentSequenceNode.then(T),this},e.prototype.endIf=function(){var A=this.currentSequenceNode.getSequence();if(!(A instanceof lt||A instanceof ht))throw new Error("IF statement is needed to be called before ENDIF statement.");return A.closed=!0,this},e.prototype.while=function(A){var T=new ct(A);return null==this.currentSequenceNode?(this.currentSequenceNode=T,this.beginSequenceNode=T):this.currentSequenceNode=this.currentSequenceNode.then(T),this.whileNodeStack.push(T),this},e.prototype.endWhile=function(){var A=this.currentSequenceNode.getSequence();if(!(A instanceof ct))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return A.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new pt(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),et.SequenceBuilder=nt;var at=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(A){return this.next=A,A},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(A){this.action&&this.action.update(A)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),ut=function(A){function t(){var T=null!==A&&A.apply(this,arguments)||this;return T.currentInnerSequence=null,T.startingInnerSequence=null,T.closed=!1,T}return i(t,A),t.prototype.then=function(A){if(null==this.currentInnerSequence)this.currentInnerSequence=A,this.startingInnerSequence=A;else{if(this.closed)return this.next=A,A;this.currentInnerSequence=this.currentInnerSequence.then(A)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(A){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(A))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var A=this.currentInnerSequence.getSequence();if(A instanceof t&&!A.closed)return A}return this},t}(at),lt=function(A){function t(T){var E=A.call(this)||this;return E.result=!1,E.condition=T,E}return i(t,A),t.prototype.onStart=function(){this.result=this.condition(),this.result?A.prototype.onStart.call(this):this.currentInnerSequence=null},t}(ut),ht=function(A){function t(T){var E=A.call(this)||this;return E.ifSequence=null,E.ifSequence=T,E}return i(t,A),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?A.prototype.onStart.call(this):this.currentInnerSequence=null},t}(ut),ct=function(A){function t(T){var E=A.call(this)||this;return E.breakWhile=!1,E.condition=T,E}return i(t,A),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?A.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(A){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(A))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(ut),pt=function(A){function t(T){var E=A.call(this)||this;return E.whileNode=T,E}return i(t,A),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(at);A.Delay=K,A.ExpireIn=J,A.FollowCurvedPathComponent=G,A.FollowPathComponent=H,A.Interpolate=h,A.Interval=$,A.KeepRotatingComponent=X,A.MoveTransformComponent=O,A.RotateTransformComponent=V,A.ScaleTransformComponent=U,A.SequenceNode=at,A.ToggleComponent=Q,A.TransformSystem=R,A.TriggerBoxShape=P,A.TriggerComponent=st,A.TriggerSphereShape=k,A.TriggerSystem=ot,A.addLabel=I,A.addOneTimeTrigger=function(A,T,E){var R=!1,z=!1,O=new Entity;O.addComponent(new Transform({}));var V={};return T.layer&&(V.layer=T.layer),T.triggeredByLayer&&(V.triggeredByLayer=T.triggeredByLayer),T.onCameraEnter&&(V.onCameraEnter=function(){R||(R=!0,T.onCameraEnter()),!R&&T.onCameraEnter||!z&&T.onCameraExit||engine.removeEntity(O)}),T.onCameraExit&&(V.onCameraExit=function(){z||(z=!0,T.onCameraExit()),!R&&T.onCameraEnter||!z&&T.onCameraExit||engine.removeEntity(O)}),T.enableDebug&&(V.enableDebug=T.enableDebug),O.addComponent(new st(A,V)),E&&O.setParent(E),engine.addEntity(O),O},A.addTestCube=function(A,E,R,z,O,V,U){return o(this,void 0,void 0,(function(){var H,G,X;return a(this,(function(Q){switch(Q.label){case 0:return(H=!U)?[4,!T.isPreviewMode()]:[3,2];case 1:H=Q.sent(),Q.label=2;case 2:return H?[2]:((G=new Entity).addComponent(new Transform(A)),O?(G.addComponent(new SphereShape),G.getComponent(Transform).scale.setAll(.5)):G.addComponent(new BoxShape),engine.addEntity(G),G.addComponent(new OnPointerDown(E,{hoverText:R||"click",button:ActionButton.POINTER})),z&&((X=new Material).albedoColor=z,G.addComponent(X)),V&&(G.getComponent(BoxShape).withCollisions=!1),R&&I(R,G,!0),[2,G])}}))}))},A.clamp=function(A,T,E){var R=A;return A>E?R=E:A<T&&(R=T),R},A.getEntityWorldPosition=function e(A){var T=A.hasComponent(Transform)?A.getComponent(Transform).position.clone():Vector3.Zero(),E=A.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(T.rotate(R))}if("AvatarEntityReference"==E.uuid){var z=Camera.instance.rotation;return R=Quaternion.Euler(0,z.eulerAngles.y,0),Camera.instance.position.clone().add(T.rotate(R)).add(new Vector3(0,-.875,0))}return R=E.hasComponent(Transform)?E.getComponent(Transform).rotation:Quaternion.Identity,e(E).add(T.rotate(R))}return T},A.getEntityWorldRotation=function e(A){var T=A.hasComponent(Transform)?A.getComponent(Transform).rotation.clone():Quaternion.Zero(),E=A.getParent();if(null!=E&&"0"!=E.uuid){if("FirstPersonCameraEntityReference"==E.uuid){var R=Camera.instance.rotation.clone();return T.multiply(R)}return"AvatarEntityReference"==E.uuid?(R=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),T.multiply(R)):(R=e(E),T.multiply(R))}return T},A.map=function(A,T,E,R,z){return(A-T)/(E-T)*(z-R)+R},A.sendRequest=function(A,T,E,R){return o(this,void 0,void 0,(function(){var z,O,V;return a(this,(function(U){switch(U.label){case 0:return U.trys.push([0,6,,7]),z={method:T||"GET"},E&&(z.headers=E),R&&(z.body=JSON.stringify(R)),[4,fetch(A,z)];case 1:O=U.sent(),U.label=2;case 2:return U.trys.push([2,4,,5]),[4,O.json()];case 3:return[2,U.sent()];case 4:return U.sent(),[2,O];case 5:return[3,7];case 6:return V=U.sent(),log("error fetching from ",A," : ",V),[3,7];case 7:return[2]}}))}))},A.setTimeout=function(A,T){var E=new Entity;return E.addComponent(new K(A,(function(){T(),engine.removeEntity(E)}))),engine.addEntity(E),E},Object.defineProperty(A,"__esModule",{value:!0})})),function(A,T){"object"==typeof exports&&"undefined"!=typeof module?T(exports):"function"==typeof define&&define.amd?define("@dcl/ui-scene-utils",["exports"],T):T((A="undefined"!=typeof globalThis?globalThis:A||self)["ui-utils"]={})}(this,(function(A){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(A,T){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,T){A.__proto__=T}||function(A,T){for(var E in T)Object.prototype.hasOwnProperty.call(T,E)&&(A[E]=T[E])})(A,T)};function i(A,T){function o(){this.constructor=A}e(A,T),A.prototype=null===T?Object.create(T):(o.prototype=T.prototype,new o)}var o=function(){return(o=Object.assign||function(A){for(var T,E=1,R=arguments.length;E<R;E++)for(var z in T=arguments[E])Object.prototype.hasOwnProperty.call(T,z)&&(A[z]=T[z]);return A}).apply(this,arguments)};function n(A,T){var E={};for(var R in A)Object.prototype.hasOwnProperty.call(A,R)&&T.indexOf(R)<0&&(E[R]=A[R]);if(null!=A&&"function"==typeof Object.getOwnPropertySymbols){var z=0;for(R=Object.getOwnPropertySymbols(A);z<R.length;z++)T.indexOf(R[z])<0&&Object.prototype.propertyIsEnumerable.call(A,R[z])&&(E[R[z]]=A[R[z]])}return E}function r(A){var T="function"==typeof Symbol&&Symbol.iterator,E=T&&A[T],R=0;if(E)return E.call(A);if(A&&"number"==typeof A.length)return{next:function(){return A&&R>=A.length&&(A=void 0),{value:A&&A[R++],done:!A}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")}var T=function(){function t(T,E){var z=this;R.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=T,this.onTimeReachedCallback=E,this.onTargetTimeReached=function(T){z.onTimeReachedCallback(),T.removeComponent(A)}}var A;return A=t,t.prototype.setCallback=function(A){this.onTimeReachedCallback=A},A=function(A,T,E,R){var z,O=arguments.length,V=O<3?T:null===R?R=Object.getOwnPropertyDescriptor(T,E):R;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)V=Reflect.decorate(A,T,E,R);else for(var U=A.length-1;U>=0;U--)(z=A[U])&&(V=(O<3?z(V):O>3?z(T,E,V):z(T,E))||V);return O>3&&V&&Object.defineProperty(T,E,V),V}([Component("UItimerDelay")],t)}(),E=engine.getComponentGroup(T),R=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(A){var R,z;try{for(var O=r(E.entities),V=O.next();!V.done;V=O.next()){var U=V.value,H=U.getComponent(T);H.elapsedTime+=A,H.elapsedTime>=H.targetTime&&H.onTargetTimeReached(U)}}catch(A){R={error:A}}finally{try{V&&!V.done&&(z=O.return)&&z.call(O)}finally{if(R)throw R.error}}},t._instance=null,t}(),z=new UICanvas;z.visible=!0;var O=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),U=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),H=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),G=new UIText(z);G.vAlign="center",G.hAlign="center",G.hTextAlign="center",G.vTextAlign="center",G.font=O,G.fontSize=60,G.color=new Color4(0,0,0,1),G.visible=!1,G.positionY=80;var X=new UIImage(z,U);X.hAlign="center",X.vAlign="center",X.width=400,X.height=250,X.visible=!1;var Q,Z,K,J,$=function(A){function e(T,E,R,V,U,H,G){var X=A.call(this)||this;return X.canvas=z,X.valueAsNum=T,X.uiText=new UIText(z),X.fixedDigits=G||null,X.uiText.value=X.toFixedLengthString(T),X.uiText.hAlign="right",X.uiText.vAlign="bottom",X.uiText.positionX=E||0,X.uiText.positionY=R||0,X.uiText.fontSize=U||25,X.uiText.font=O,X.uiText.vTextAlign="center",X.uiText.hTextAlign="center",X.uiText.color=V||Color4.White(),X.uiText.outlineColor=Color4.Black(),X.uiText.outlineWidth=H?0:.1,X}return i(e,A),e.prototype.read=function(){return this.valueAsNum},e.prototype.increase=function(A){this.valueAsNum+=A||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.decrease=function(A){this.valueAsNum-=A||1,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.set=function(A){this.valueAsNum=A,this.uiText.value=this.toFixedLengthString(this.valueAsNum)},e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.toFixedLengthString=function(A){var T=A.toString();if(!this.fixedDigits)return T;for(var E=T.length-this.fixedDigits;E<0;)T="0".concat(T),E+=1;return E>0&&(T=A.toPrecision(this.fixedDigits)),T},e}(Entity);(Q=A.PromptStyles||(A.PromptStyles={})).LIGHT="light",Q.DARK="dark",Q.LIGHTLARGE="lightlarge",Q.DARKLARGE="darklarge",Q.LIGHTSLANTED="lightslanted",Q.DARKSLANTED="darkslanted",(Z=A.BarStyles||(A.BarStyles={})).ROUNDBLACK="roundblack",Z.ROUNDWHITE="roundwhite",Z.ROUNDSILVER="roundsilver",Z.ROUNDGOLD="roundgold",Z.SQUAREBLACK="squareblack",Z.SQUAREWHITE="squarewhite",Z.SQUARESILVER="squaresilver",Z.SQUAREGOLD="squaregold",(K=A.ButtonStyles||(A.ButtonStyles={})).E="e",K.F="f",K.DARK="dark",K.RED="red",K.ROUNDBLACK="roundblack",K.ROUNDWHITE="roundwhite",K.ROUNDSILVER="roundsilver",K.ROUNDGOLD="roundgold",K.SQUAREBLACK="squareblack",K.SQUAREWHITE="squarewhite",K.SQUARESILVER="squaresilver",K.SQUAREGOLD="squaregold",(J=A.SwitchStyles||(A.SwitchStyles={})).ROUNDGREEN="roundgreen",J.ROUNDRED="roundred",J.SQUAREGREEN="squaregreen",J.SQUARERED="squarered";var et={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},nt={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},ot={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},it={sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},rt={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},st={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},at={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},ut={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},lt={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},ht={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},ct={sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},pt={sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567},dt={sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},ft={sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},vt={sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},mt={sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},gt={sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},wt={closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},bt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},xt={sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},At={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},Tt={sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},St={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},Et={sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},Ct={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},It={sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168},Rt={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},_t={sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},zt={sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},Pt={sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},Bt={sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},Mt={sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501};function S(A,T){A.sourceWidth=T.sourceWidth,A.sourceHeight=T.sourceHeight,A.sourceLeft=T.sourceLeft?T.sourceLeft:0,A.sourceTop=T.sourceTop?T.sourceTop:0}function C(A){var T=-10-4*A;return T>-65?T:-65}var Ot=function(T){function o(E,R,O,V,H,G,X){var Q=T.call(this)||this;if(Q.canvas=z,Q.valueAsNum=E>1?1:E,Q.fullWidth=G?128*G:128,Q.background=new UIImage(z,U),Q.background.width=G?128*G:128,Q.background.height=G?32*G:32,Q.background.hAlign="right",Q.background.vAlign="bottom",Q.background.positionX=R||0,Q.background.positionY=O||0,H)switch(H){case A.BarStyles.ROUNDBLACK:S(Q.background,rt);break;case A.BarStyles.ROUNDWHITE:S(Q.background,at);break;case A.BarStyles.ROUNDSILVER:S(Q.background,lt);break;case A.BarStyles.ROUNDGOLD:S(Q.background,ct);break;case A.BarStyles.SQUAREBLACK:S(Q.background,st);break;case A.BarStyles.SQUAREWHITE:S(Q.background,ut);break;case A.BarStyles.SQUARESILVER:S(Q.background,ht);break;case A.BarStyles.SQUAREGOLD:S(Q.background,pt)}else S(Q.background,lt);return Q.background.sourceWidth=128,Q.background.sourceHeight=32,Q.background.visible=!0,Q.bar=new UIContainerRect(Q.background),Q.bar.color=V||Color4.Red(),Q.bar.thickness=0,Q.bar.hAlign="left",Q.bar.vAlign="center",Q.bar.positionX=G?2.55*G:2.55,Q.bar.positionY=0,Q.bar.height=G?32*G-7.5*G:24.5,Q.bar.width=G?Q.fullWidth*Q.valueAsNum-5.1*G:Q.fullWidth*Q.valueAsNum-5.1,X&&Q.hide(),Q}return i(o,T),o.prototype.read=function(){return this.valueAsNum},o.prototype.increase=function(A){this.valueAsNum+=A||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.decrease=function(A){this.valueAsNum-=A||.1,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.set=function(A){this.valueAsNum=A,this.bar.width=this.fullWidth*this.valueAsNum-6},o.prototype.hide=function(){this.background.visible=!1,this.bar.visible=!1},o.prototype.show=function(){this.background.visible=!0,this.bar.visible=!0},o}(Entity),Lt=function(A){function e(T,E,R,O,V,U){var H=A.call(this)||this;H.canvas=z;var G=new Texture(T);return H.image=new UIImage(z,G),H.image.hAlign="right",H.image.vAlign="bottom",H.image.positionX=E||0,H.image.positionY=R||0,H.image.width=O||64,H.image.height=V||64,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U&&U.sourceWidth?U.sourceWidth:O||64,H.image.sourceHeight=U&&U.sourceHeight?U.sourceHeight:V||64,H}return i(e,A),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(A){var E=this;if(this.image.visible=!0,A){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new T(A,(function(){E.hide()})))}},e}(Entity),Nt=function(A){function e(T,E,R,O,V,U){var H=A.call(this)||this;H.canvas=z;var G=new Texture(T);return H.image=new UIImage(z,G),H.image.hAlign="right",H.image.vAlign="bottom",H.image.positionX=E||0,H.image.positionY=R||0,H.image.width=O||32,H.image.height=V||32,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U?U.sourceWidth:O||32,H.image.sourceHeight=U?U.sourceHeight:V||32,H}return i(e,A),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(A){var E=this;if(this.image.visible=!0,A){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new T(A,(function(){E.hide()})))}},e}(Entity),kt=function(A){function e(T,E,R,O,V,U){var H=A.call(this)||this;H.canvas=z;var G=new Texture(T);return H.image=new UIImage(z,G),H.image.hAlign="right",H.image.vAlign="bottom",H.image.positionX=E||0,H.image.positionY=R||0,H.image.width=O||128,H.image.height=V||128,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U?U.sourceWidth:O||128,H.image.sourceHeight=U?U.sourceHeight:V||128,H}return i(e,A),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(A){var E=this;if(this.image.visible=!0,A){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new T(A,(function(){E.hide()})))}},e}(Entity),qt=function(A){function e(E,R,O,V,U,H,G,X){var Q=A.call(this)||this;Q.canvas=z;var Z=new Texture(E);if(Q.image=new UIImage(z,Z),Q.image.hAlign="center",Q.image.vAlign="center",Q.image.positionX=V||0,Q.image.positionY=U||0,Q.image.width=H||512,Q.image.height=G||512,Q.image.sourceLeft=X&&X.sourceLeft?X.sourceLeft:0,Q.image.sourceTop=X&&X.sourceTop?X.sourceTop:0,Q.image.sourceWidth=X?X.sourceWidth:H||512,Q.image.sourceHeight=X?X.sourceHeight:G||512,Q.image.visible=!O,-1!=R){var K=new Entity;engine.addEntity(K),K.addComponentOrReplace(new T(R||3,(function(){Q.hide()})))}return Q}return i(e,A),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(A){var E=this;if(this.image.visible=!0,A){var R=new Entity;engine.addEntity(R),R.addComponentOrReplace(new T(A,(function(){E.hide()})))}},e}(Entity),Wt=function(A){function e(T,E,R,V){var G=A.call(this)||this;G.canvas=z,G.background=X,G.UIOpenTime=+Date.now(),G.onAccept=E||null;var Q=V?H:U;return X.source=Q,X.width=400,X.height=250,X.positionY=0,S(X,vt),X.visible=!0,G.closeIcon=new UIImage(X,Q),G.closeIcon.positionX=175,G.closeIcon.positionY=100,G.closeIcon.width=32,G.closeIcon.height=32,S(G.closeIcon,V?wt.closeW:wt.closeD),G.closeIcon.onClick=new OnClick((function(){G.close()})),G.text=new UIText(X),G.text.value=T,G.text.adaptWidth=!1,G.text.textWrapping=!0,G.text.width=380,G.text.hAlign="center",G.text.vAlign="top",G.text.positionX=0,G.text.positionY=-65,G.text.fontSize=24,G.text.font=O,G.text.vTextAlign="center",G.text.hTextAlign="center",G.text.color=V?Color4.White():Color4.Black(),G.button=new UIImage(X,Q),G.button.positionX=0,G.button.positionY=-60,G.button.width=174,G.button.height=46,S(G.button,et),G.icon=new UIImage(G.button,1==V?H:U),G.icon.width=26,G.icon.height=26,G.icon.hAlign="center",G.icon.vAlign="center",G.icon.isPointerBlocker=!1,S(G.icon,dt),G.icon.positionX=C(R?R.length:2),G.buttonLabel=new UIText(G.button),G.buttonLabel.value=R||"Ok",G.buttonLabel.hTextAlign="center",G.buttonLabel.vTextAlign="center",G.buttonLabel.positionX=30,G.buttonLabel.fontSize=18,G.buttonLabel.font=O,G.buttonLabel.color=Color4.White(),G.buttonLabel.isPointerBlocker=!1,G.button.onClick=new OnClick((function(){G.accept()})),G.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(A){G.button.visible&&+Date.now()-G.UIOpenTime>100&&G.accept()})),G}return i(e,A),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.close()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0},e}(Entity),Dt=function(A){function e(T,E,R,G,Q,Z,K){var J=A.call(this)||this;J.canvas=z,J.background=X,J.UIOpenTime=+Date.now(),J.onAccept=R,J.onReject=G||null;var $=K?H:U;return X.source=$,X.width=480,X.height=384,S(X,mt),X.visible=!0,J.closeIcon=new UIImage(X,$),J.closeIcon.positionX=215,J.closeIcon.positionY=164,J.closeIcon.width=32,J.closeIcon.height=32,S(J.closeIcon,K?wt.closeW:wt.closeD),J.closeIcon.onClick=new OnClick((function(){J.close()})),J.title=new UIText(X),J.title.value=T,J.title.adaptWidth=!1,J.title.textWrapping=!0,J.title.width=380,J.title.hAlign="center",J.title.vAlign="top",J.title.positionX=0,J.title.positionY=-20,J.title.font=V,J.title.fontSize=24,J.title.vTextAlign="center",J.title.hTextAlign="center",J.title.color=K?Color4.White():Color4.Black(),J.text=new UIText(X),J.text.value=E,J.text.adaptWidth=!1,J.text.textWrapping=!0,J.text.width=380,J.text.hAlign="center",J.text.vAlign="top",J.text.positionX=0,J.text.positionY=-145,J.text.fontSize=24,J.text.font=O,J.text.vTextAlign="center",J.text.hTextAlign="center",J.text.color=K?Color4.White():Color4.Black(),J.buttonE=new UIImage(X,$),J.buttonE.positionX=-100,J.buttonE.positionY=-120,J.buttonE.width=174,J.buttonE.height=46,S(J.buttonE,et),J.buttonEIcon=new UIImage(J.buttonE,1==K?H:U),J.buttonEIcon.width=26,J.buttonEIcon.height=26,J.buttonEIcon.hAlign="center",J.buttonEIcon.vAlign="center",J.buttonEIcon.isPointerBlocker=!1,S(J.buttonEIcon,dt),J.buttonEIcon.positionX=C(Q?Q.length:2),J.buttonELabel=new UIText(J.buttonE),J.buttonELabel.value=Q||"Ok",J.buttonELabel.hTextAlign="center",J.buttonELabel.vTextAlign="center",J.buttonELabel.positionX=30,J.buttonELabel.fontSize=18,J.buttonELabel.font=O,J.buttonELabel.color=Color4.White(),J.buttonELabel.isPointerBlocker=!1,J.buttonE.onClick=new OnClick((function(){J.accept()})),J.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(A){J.buttonE.visible&&+Date.now()-J.UIOpenTime>100&&J.accept()})),J.buttonF=new UIImage(X,$),J.buttonF.positionX=100,J.buttonF.positionY=-120,J.buttonF.width=174,J.buttonF.height=46,S(J.buttonF,nt),J.buttonFIcon=new UIImage(J.buttonF,1==K?H:U),J.buttonFIcon.width=26,J.buttonFIcon.height=26,J.buttonFIcon.hAlign="center",J.buttonFIcon.vAlign="center",J.buttonFIcon.isPointerBlocker=!1,S(J.buttonFIcon,ft),J.buttonFIcon.positionX=C(Z?Z.length:6),J.buttonFLabel=new UIText(J.buttonF),J.buttonFLabel.value=Z||"Cancel",J.buttonFLabel.hTextAlign="center",J.buttonFLabel.vTextAlign="center",J.buttonFLabel.positionX=30,J.buttonFLabel.fontSize=18,J.buttonFLabel.font=O,J.buttonFLabel.color=Color4.White(),J.buttonFLabel.isPointerBlocker=!1,J.buttonF.onClick=new OnClick((function(){J.reject()})),J.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(A){J.buttonF.visible&&+Date.now()-J.UIOpenTime>100&&J.reject()})),J}return i(e,A),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.title.visible=!1},e.prototype.accept=function(){this.onAccept&&this.onAccept(),this.close()},e.prototype.reject=function(){this.onReject&&this.onReject(),this.close()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.buttonE.visible=!1,this.buttonF.visible=!1,this.text.visible=!1,this.buttonELabel.visible=!1,this.buttonFLabel.visible=!1,this.buttonEIcon.visible=!1,this.buttonFIcon.visible=!1},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.buttonE.visible=!0,this.buttonF.visible=!0,this.text.visible=!0,this.buttonELabel.visible=!0,this.buttonFLabel.visible=!0,this.buttonEIcon.visible=!0,this.buttonFIcon.visible=!0},e}(Entity),Vt=function(A){function e(T,E,R,G,Q){var Z=A.call(this)||this;Z.canvas=z,Z.background=X,Z.UIOpenTime=+Date.now(),Z.onAccept=E;var K=Q?H:U;X.source=K,X.width=400,X.height=250,S(X,vt),X.visible=!0,Z.text=new UIText(X),Z.text.value=T,Z.text.adaptWidth=!1,Z.text.textWrapping=!0,Z.text.width=320,Z.text.hAlign="center",Z.text.vAlign="top",Z.text.positionX=0,Z.text.positionY=-20,Z.text.fontSize=24,Z.text.font=V,Z.text.vTextAlign="center",Z.text.hTextAlign="center",Z.text.color=Q?Color4.White():Color4.Black(),Z.closeIcon=new UIImage(X,K),Z.closeIcon.positionX=175,Z.closeIcon.positionY=100,Z.closeIcon.width=32,Z.closeIcon.height=32,S(Z.closeIcon,Q?wt.closeW:wt.closeD),Z.closeIcon.onClick=new OnClick((function(){Z.hide()})),Z.button=new UIImage(X,K),Z.button.positionX=0,Z.button.positionY=-60,Z.button.width=174,Z.button.height=46,S(Z.button,et),Z.icon=new UIImage(Z.button,1==Q?H:U),Z.icon.width=26,Z.icon.height=26,Z.icon.hAlign="center",Z.icon.vAlign="center",Z.icon.isPointerBlocker=!1,S(Z.icon,dt),Z.icon.positionX=C(R?R.length:6),Z.buttonLabel=new UIText(Z.button),Z.buttonLabel.value=R||"Submit",Z.buttonLabel.hTextAlign="center",Z.buttonLabel.vTextAlign="center",Z.buttonLabel.positionX=30,Z.buttonLabel.fontSize=18,Z.buttonLabel.font=O,Z.buttonLabel.color=Color4.White(),Z.buttonLabel.isPointerBlocker=!1,Z.fillInBox=new UIInputText(X),Z.fillInBox.color=Color4.Black(),Z.fillInBox.font=O,Z.fillInBox.width=312,Z.fillInBox.height=46,Z.fillInBox.positionX=0,Z.fillInBox.positionY=15,Z.fillInBox.placeholder=G||"Fill in",Z.fillInBox.hTextAlign="center",Z.fillInBox.vTextAlign="center",Z.fillInBox.fontSize=22;var J="";return Z.fillInBox.onChanged=new OnChanged((function(A){J=A.value})),Z.fillInBox.onTextSubmit=new OnTextSubmit((function(A){Z.accept(J)})),Z.button.onClick=new OnClick((function(){Z.accept(J)})),Z.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(A){Z.button.visible&&+Date.now()-Z.UIOpenTime>100&&Z.accept(J)})),Z}return i(e,A),e.prototype.close=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.accept=function(A){this.onAccept(A),this.close()},e.prototype.hide=function(){X.visible=!1,this.closeIcon.visible=!1,this.button.visible=!1,this.text.visible=!1,this.buttonLabel.visible=!1,this.fillInBox.visible=!1},e.prototype.show=function(){X.visible=!0,this.closeIcon.visible=!0,this.button.visible=!0,this.text.visible=!0,this.buttonLabel.visible=!0,this.fillInBox.visible=!0},e}(Entity),Ut=function(T){function o(E,R,O,V){var G=T.call(this)||this;switch(G.elements=[],G.texture=U,G.darkTheme=!1,G.background=new UIImage(z,U),G.closeIcon=new UIImage(G.background,G.texture),G.UIOpenTime=0,G.canvas=z,G.UIOpenTime=+Date.now(),G.background=new UIImage(z,U),G.background.hAlign="center",G.background.vAlign="center",E||(E=A.PromptStyles.LIGHT),E){case A.PromptStyles.LIGHT:G.texture=U,S(G.background,vt),S(G.closeIcon,wt.closeD),G.closeIcon.positionX=R?R/2-25:175,G.closeIcon.positionY=O?O/2-25:145;break;case A.PromptStyles.DARK:G.texture=H,G.darkTheme=!0,S(G.background,vt),S(G.closeIcon,wt.closeW),G.closeIcon.positionX=R?R/2-25:175,G.closeIcon.positionY=O?O/2-25:145;break;case A.PromptStyles.LIGHTLARGE:G.texture=U,S(G.background,mt),S(G.closeIcon,wt.closeD),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:165;break;case A.PromptStyles.DARKLARGE:G.texture=H,G.darkTheme=!0,S(G.background,mt),S(G.closeIcon,wt.closeW),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:165;break;case A.PromptStyles.LIGHTSLANTED:G.texture=U,S(G.background,gt),S(G.closeIcon,wt.closeD),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:138;break;case A.PromptStyles.DARKSLANTED:G.texture=H,G.darkTheme=!0,S(G.background,gt),S(G.closeIcon,wt.closeW),G.closeIcon.positionX=R?R/2-25:215,G.closeIcon.positionY=O?O/2-25:138;break;default:G.texture=new Texture(E),G.closeIcon.visible=!1}return G.background.source=G.texture,G.background.width=R||G.background.sourceWidth,G.background.height=O||G.background.sourceHeight,G.background.visible=!0,G.closeIcon.width=32,G.closeIcon.height=32,G.closeIcon.source=G.texture,G.closeIcon.onClick=new OnClick((function(){G.hide()})),V&&G.hide(),G}return i(o,T),o.prototype.hide=function(){var A,T;this.background.visible=!1,this.closeIcon.visible=!1;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.hide()}catch(T){A={error:T}}finally{try{R&&!R.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}},o.prototype.show=function(){var A,T;this.background.visible=!0,this.closeIcon.visible=!0;try{for(var E=r(this.elements),R=E.next();!R.done;R=E.next())R.value.show()}catch(T){A={error:T}}finally{try{R&&!R.done&&(T=E.return)&&T.call(E)}finally{if(A)throw A.error}}},o.prototype.addText=function(A,T,E,R,z){var O=new Yt(this,A,T,E,this.darkTheme,R||void 0,z||void 0);return this.elements.push(O),O},o.prototype.addButton=function(A,T,E,R,z){var O=new Ht(this,this.texture,this.UIOpenTime,A,T,E,R,z||void 0);return this.elements.push(O),O},o.prototype.addCheckbox=function(A,T,E,R,z,O,V){var U=new jt(this,this.texture,this.darkTheme,A,T,E,R||void 0,z||void 0,O||void 0,V||void 0);return this.elements.push(U),U},o.prototype.addSwitch=function(A,T,E,R,z,O,V){var U=new Gt(this,this.texture,this.darkTheme,A,T,E,R||void 0,z||void 0,O||void 0,V||void 0);return this.elements.push(U),U},o.prototype.addIcon=function(A,T,E,R,z,O){var V=new Texture(A),U=new Xt(this,V,T,E,R||void 0,z||void 0,O||void 0);return this.elements.push(U),U},o.prototype.addTextBox=function(A,T,E,R){var z=new Qt(this,A,T,E||void 0,R||void 0);return this.elements.push(z),z},o}(Entity),Ht=function(T){function o(E,R,z,V,U,H,G,X){var Q=T.call(this)||this;if(Q.icon=null,Q.image=new UIImage(E.background,R),Q.image.positionX=U,Q.image.positionY=H,Q.image.width=174,Q.image.height=46,Q.label=new UIText(Q.image),X)switch(X){case A.ButtonStyles.E:S(Q.image,et),Q.label.positionX=25,Q.icon=new UIImage(Q.image,R),Q.icon.width=26,Q.icon.height=26,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,S(Q.icon,dt),Q.icon.positionX=C(V.length);break;case A.ButtonStyles.F:S(Q.image,nt),Q.label.positionX=25,Q.icon=new UIImage(Q.image,R),Q.icon.width=26,Q.icon.height=26,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,S(Q.icon,ft),Q.icon.positionX=C(V.length);break;case A.ButtonStyles.RED:S(Q.image,ot);break;case A.ButtonStyles.DARK:S(Q.image,it);break;case A.ButtonStyles.ROUNDBLACK:S(Q.image,rt);break;case A.ButtonStyles.ROUNDWHITE:S(Q.image,at);break;case A.ButtonStyles.ROUNDSILVER:S(Q.image,lt);break;case A.ButtonStyles.ROUNDGOLD:S(Q.image,ct);break;case A.ButtonStyles.SQUAREBLACK:S(Q.image,st);break;case A.ButtonStyles.SQUAREWHITE:S(Q.image,ut);break;case A.ButtonStyles.SQUARESILVER:S(Q.image,ht);break;case A.ButtonStyles.SQUAREGOLD:S(Q.image,pt);break;default:S(Q.image,lt)}else S(Q.image,lt);return Q.label.value=V,Q.label.hTextAlign="center",Q.label.vTextAlign="center",Q.label.fontSize=20,Q.label.font=O,Q.label.color=X==A.ButtonStyles.ROUNDWHITE||X==A.ButtonStyles.SQUAREWHITE?Color4.Black():Color4.White(),Q.label.isPointerBlocker=!1,Q.image.onClick=new OnClick((function(){G()})),X==A.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(A){Q.image.visible&&+Date.now()-z>100&&G()})):X==A.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(A){Q.image.visible&&+Date.now()-z>100&&G()})),Q}return i(o,T),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1,this.icon&&(this.icon.visible=!1)},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0,this.icon&&(this.icon.visible=!0)},o}(Entity),jt=function(A){function e(T,E,R,z,V,U,H,G,X,Q){var Z=A.call(this)||this;return Z.checked=!!Q,Z.darkTheme=R,Z.large=X||!1,Z.image=new UIImage(T.background,E),Z.image.positionX=V,Z.image.positionY=U,Z.image.width=X?32:24,Z.image.height=X?32:24,0==Z.checked?Z.uncheck():Z.check(),Z.label=new UIText(Z.image),Z.label.positionX=X?40:30,Z.label.color=R?Color4.White():Color4.Black(),Z.label.value=z,Z.label.hTextAlign="left",Z.label.vTextAlign="center",Z.label.fontSize=20,Z.label.font=O,Z.label.isPointerBlocker=!1,Z.image.onClick=new OnClick((function(){0==Z.checked?Z.check():Z.uncheck(),Z.checked?H&&H():G&&G()})),Z}return i(e,A),e.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},e.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},e.prototype.uncheck=function(){this.checked=!1,this.darkTheme?this.large?S(this.image,St):S(this.image,bt):this.large?S(this.image,Ct):S(this.image,At)},e.prototype.check=function(){this.checked=!0,this.darkTheme?this.large?S(this.image,Et):S(this.image,xt):this.large?S(this.image,It):S(this.image,Tt)},e}(Entity),Gt=function(T){function o(E,R,z,V,U,H,G,X,Q,Z){var K=T.call(this)||this;return K.checked=!!Z,K.darkTheme=z,K.style=Q||A.SwitchStyles.ROUNDGREEN,K.image=new UIImage(E.background,R),K.image.positionX=U,K.image.positionY=H,K.image.width=64,K.image.height=32,0==K.checked?K.check():K.uncheck(),K.label=new UIText(K.image),K.label.positionX=80,K.label.color=z?Color4.White():Color4.Black(),K.label.value=V,K.label.hTextAlign="left",K.label.vTextAlign="center",K.label.fontSize=20,K.label.font=O,K.label.isPointerBlocker=!1,K.image.onClick=new OnClick((function(){0==K.checked?K.check():K.uncheck(),K.checked?G&&G():X&&X()})),K}return i(o,T),o.prototype.hide=function(){this.image.visible=!1,this.label.visible=!1},o.prototype.show=function(){this.image.visible=!0,this.label.visible=!0},o.prototype.check=function(){switch(this.checked=!0,this.style){case A.SwitchStyles.ROUNDGREEN:S(this.image,zt);break;case A.SwitchStyles.ROUNDRED:S(this.image,_t);break;case A.SwitchStyles.SQUAREGREEN:S(this.image,Mt);break;case A.SwitchStyles.SQUARERED:S(this.image,Bt)}},o.prototype.uncheck=function(){this.checked=!1,this.style==A.SwitchStyles.ROUNDGREEN||this.style==A.SwitchStyles.ROUNDRED?S(this.image,Rt):S(this.image,Pt)},o}(Entity),Xt=function(A){function e(T,E,R,z,O,V,U){var H=A.call(this)||this;return H.image=new UIImage(T.background,E),H.image.positionX=R,H.image.positionY=z,H.image.width=O||128,H.image.height=V||128,H.image.sourceLeft=U&&U.sourceLeft?U.sourceLeft:0,H.image.sourceTop=U&&U.sourceTop?U.sourceTop:0,H.image.sourceWidth=U&&U.sourceWidth?U.sourceWidth:O||128,H.image.sourceHeight=U&&U.sourceHeight?U.sourceHeight:V||128,H}return i(e,A),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity),Yt=function(A){function e(T,E,R,z,O,V,U){var H=A.call(this)||this;return H.text=new UIText(T.background),H.text.value=E,H.text.positionX=R||0,H.text.positionY=z||0,H.text.hTextAlign="center",H.text.color=V||(O?Color4.White():Color4.Black()),H.text.fontSize=U||15,H}return i(e,A),e.prototype.hide=function(){this.text.visible=!1},e.prototype.show=function(){this.text.visible=!0},e}(Entity),Qt=function(A){function e(T,E,R,z,V){var U=A.call(this)||this;return U.currentText="",U.fillInBox=new UIInputText(T.background),U.fillInBox.color=Color4.Black(),U.fillInBox.font=O,U.fillInBox.width=312,U.fillInBox.height=46,U.fillInBox.positionX=E,U.fillInBox.positionY=R,U.fillInBox.placeholder=z||"Fill in",U.fillInBox.hTextAlign="center",U.fillInBox.vTextAlign="center",U.fillInBox.fontSize=22,U.fillInBox.onChanged=new OnChanged((function(A){U.fillInBox&&!U.fillInBox.visible||(U.currentText=A.value,V&&V(U.currentText))})),U.fillInBox.onTextSubmit=new OnTextSubmit((function(A){U.fillInBox&&!U.fillInBox.visible||(U.currentText=A.text,V&&V(U.currentText))})),U}return i(e,A),e.prototype.hide=function(){this.fillInBox.visible=!1},e.prototype.show=function(){this.fillInBox.visible=!0},e}(Entity),Zt=function(A){function e(T,E,R,V,U,H){var G=A.call(this)||this;return G.canvas=z,G.uiText=new UIText(z),G.uiText.value=T,G.uiText.hAlign="right",G.uiText.vAlign="bottom",G.uiText.positionX=E||0,G.uiText.positionY=R||0,G.uiText.fontSize=U||25,G.uiText.font=O,G.uiText.vTextAlign="center",G.uiText.hTextAlign="center",G.uiText.color=V||Color4.White(),G.uiText.outlineColor=Color4.Black(),G.uiText.outlineWidth=H?0:.1,G}return i(e,A),e.prototype.hide=function(){this.uiText.visible=!1},e.prototype.show=function(){this.uiText.visible=!0},e.prototype.set=function(A){this.uiText.value=A,this.uiText.visible=!0},e}(Entity),Jt=function(A){function e(E,R,O,V){var H=A.call(this)||this;if(H.canvas=z,H.image=new UIImage(z,U),H.image.hAlign="center",H.image.vAlign="center",H.image.positionX=R||0,H.image.positionY=O?O+80:80,H.image.width=V?48*V:48,H.image.height=V?64*V:64,S(H.image,wt.TimerLarge),E&&0!=E){var G=new Entity;engine.addEntity(G),G.addComponentOrReplace(new T(E||3,(function(){H.hide()})))}return H}return i(e,A),e.prototype.hide=function(){this.image.visible=!1},e.prototype.show=function(){this.image.visible=!0},e}(Entity);function q(A){return A&&"object"==typeof A&&!Array.isArray(A)}function j(A,T){var E=o({},A);return q(A)&&q(T)&&Object.keys(T).forEach((function(R){var z,O;q(T[R])?R in A?E[R]=j(A[R],T[R]):E=o(o({},E),((z={})[R]=T[R],z)):E=o(o({},E),((O={})[R]=T[R],O))})),E}var $t=function(){function t(A,T){this.shape=A,T&&this.setProperties(T)}return t.prototype.setProperties=function(A){var T,E;try{for(var R=r(Object.keys(A)),z=R.next();!z.done;z=R.next()){var O=z.value;this.shape[O]=A[O]}}catch(A){T={error:A}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(T)throw T.error}}},t.prototype.getProperty=function(A){return this.shape[A]},t}(),ee=function(A){function e(T,E){var R,z,O,V,U=A.call(this,new UIInputText(T),o(o({},E),{placeholder:null!==(R=null==E?void 0:E.placeholder)&&void 0!==R?R:null==E?void 0:E.value,placeholderColor:null!==(z=null==E?void 0:E.placeholderColor)&&void 0!==z?z:null==E?void 0:E.color,onFocus:new OnFocus((function(){var A;U.isInputFocused=!0,null===(A=null==E?void 0:E.onFocus)||void 0===A||A.call(E)})),onBlur:new OnBlur((function(){var A,T;U.isInputFocused=!1,""===U.inputValue&&void 0!==U.placeholder?(U.setInputValue(U.placeholder),null===(A=null==E?void 0:E.onBlur)||void 0===A||A.call(E,!0)):null===(T=null==E?void 0:E.onBlur)||void 0===T||T.call(E,!1)})),onChanged:new OnChanged((function(A){var T,R=A.value;if(U.shape.visible)if(U.inputValue=R,R===U.placeholder)U.shape.placeholderColor=U.placeholderColor;else if(""===R&&(U.shape.placeholderColor=U.color,U.shape.placeholder=""),U.isInputFocused||""===R){var z=null!==(T=null==E?void 0:E.waitTime)&&void 0!==T?T:e.DEFAULT_WAIT_TIME;setTimeout((function(){var A;U.inputValue===R&&(null===(A=null==E?void 0:E.onChanged)||void 0===A||A.call(E,R))}),z)}})),onTextSubmit:new OnTextSubmit((function(A){var T=A.text,R=T.substr(0,T.length-1),z=null==E?void 0:E.onTextSubmit;z?z(R):setTimeout((function(){return U.shape.placeholder=R}),0)}))}))||this;return U.inputValue="",U.isInputFocused=!1,U.placeholder=U.shape.placeholder,U.color=U.shape.color,U.placeholderColor=U.shape.placeholderColor,U.inputValue=null!==(O=null==E?void 0:E.value)&&void 0!==O?O:null!==(V=null==E?void 0:E.placeholder)&&void 0!==V?V:"",U.isInputFocused=!1,U}return i(e,A),e.prototype.getValue=function(){return this.inputValue},e.prototype.isFocused=function(){return this.isInputFocused},e.prototype.setInputValue=function(A){var T=this.isInputFocused;this.isInputFocused=!1,this.shape.placeholder="",this.inputValue=this.shape.placeholder=A,this.isInputFocused=T},e.prototype.reset=function(){this.setInputValue(this.placeholder)},e.prototype.hide=function(){this.setProperties({visible:!1})},e.prototype.show=function(){this.setProperties({visible:!0}),this.setInputValue(this.inputValue)},e.DEFAULT_WAIT_TIME=650,e}($t),ne=function(A){function e(T,E){var R=A.call(this,new UIContainerRect(T),o({isPointerBlocker:!0},E))||this,z=new UIImage(R.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));return z.width="100%",z.height="100%",z.sourceWidth=1,z.sourceHeight=1,z.isPointerBlocker=!0,R.image=z,(null==E?void 0:E.onClick)&&R.setOnClick(E.onClick),R}return i(e,A),e.prototype.performClick=function(){var A;null===(A=this.image.onClick)||void 0===A||A.callback({})},e.prototype.setOnClick=function(A){this.image.onClick=new OnClick(A)},e.prototype.clearOnClick=function(){this.image.onClick=null},e}($t),oe=function(A){function e(T,E){var R=A.call(this,new UIContainerRect(T),o({width:"100%",vAlign:"top",visible:!1},E))||this;R.config=o(o({},e.DEFAULTS),E);var z=new ne(R.shape,{width:"100%",height:"100%",color:Color4.Clear()});R.clickableContainer=z;var O=new UIImage(z.shape,new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="));O.width=O.height=R.config.imageSize,O.hAlign="left",O.positionX=10,O.vAlign="center",R.image=O;var V=new UIText(z.shape);V.vAlign="top",V.hAlign="left",V.vTextAlign="top",V.fontSize=R.config.topFontSize,V.color=R.config.topTextColor,V.positionX=55,V.positionY=-10,V.isPointerBlocker=!1,R.topLeftText=V;var U=new UIText(z.shape);U.vAlign="top",U.hAlign="right",U.vTextAlign="top",U.hTextAlign="right",U.fontSize=V.fontSize,U.color=V.color,U.isPointerBlocker=!1,U.positionX=-10,U.positionY=V.positionY,R.topRightText=U;var H=new UIText(z.shape);H.vAlign="bottom",H.hAlign="left",H.vTextAlign="bottom",H.fontSize=R.config.bottomFontSize,H.color=R.config.bottomTextColor,H.positionX=V.positionX,H.positionY=10,H.isPointerBlocker=!1,R.bottomLeftText=H;var G=new UIText(z.shape);return G.vAlign="bottom",G.hAlign="right",G.vTextAlign="bottom",G.hTextAlign="right",G.fontSize=H.fontSize,G.color=H.color,G.isPointerBlocker=!1,G.positionX=U.positionX,G.positionY=H.positionY,R.bottomRightText=G,R}return i(e,A),e.prototype.setOption=function(A,T){this.image.visible=!1,this.topRightText.visible=!1,this.bottomLeftText.visible=!1,this.bottomRightText.visible=!1,A.image?(this.image.source=new Texture(A.image.src),this.image.sourceWidth=A.image.sourceWidth,this.image.sourceHeight=A.image.sourceHeight,this.image.visible=!0,this.topLeftText.positionX=this.config.imageSize+20):this.topLeftText.positionX=10,"string"==typeof A.visualText?(this.topLeftText.value=A.visualText,this.topLeftText.vAlign=this.topLeftText.vTextAlign="center",this.topLeftText.positionY=0):"text"in A.visualText?(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=A.visualText.text,this.bottomLeftText.value=A.visualText.subText,this.bottomLeftText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX):"bottomLeft"in A.visualText&&(this.topLeftText.vAlign=this.topLeftText.vTextAlign="top",this.topLeftText.positionY=-10,this.topLeftText.value=A.visualText.topLeft,this.topRightText.value=A.visualText.topRight,this.bottomLeftText.value=A.visualText.bottomLeft,this.bottomRightText.value=A.visualText.bottomRight,this.topRightText.visible=!0,this.bottomLeftText.visible=!0,this.bottomRightText.visible=!0,this.bottomLeftText.positionX=this.topLeftText.positionX),T?this.clickableContainer.setOnClick(T):this.clickableContainer.clearOnClick()},e.prototype.setProperties=function(T){A.prototype.setProperties.call(this,T)},e.prototype.getProperty=function(T){return A.prototype.getProperty.call(this,T)},e.prototype.performClick=function(){this.clickableContainer.performClick()},e.DEFAULTS={topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},e}($t),ie=function(A){function e(T,E,R,z){var O=A.call(this,new UIContainerRect(T),o({},R))||this;O.onSuccessfulSelection=z,O.uiOptions=[],O.options={},R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var V=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=j(e.DEFAULTS,V),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor}),O.setItems(E.items,E.dropdownDefaultItemIds);var H=new UIContainerRect(O.shape);H.color=O.config.backgroundColor,H.width=O.config.width-2*O.config.borderSize,H.height=O.config.initialHeight-2*O.config.borderSize,O.insideContainer=H;var G=new ee(H,{vAlign:"top",hTextAlign:"left",vTextAlign:"center",width:"92%",fontSize:O.config.search.fontSize,placeholder:O.config.search.placeholder.defaultText,placeholderColor:O.config.search.placeholder.textColor,color:O.config.search.textColor,focusedBackground:Color4.Clear(),background:Color4.Clear(),height:.95*O.config.initialHeight,onBlur:function(){return O.close()},onTextSubmit:function(){O.uiOptions[0].getProperty("visible")?O.uiOptions[0].performClick():O.close()},onChanged:function(A){if(O.hideAllOptions(),A===O.config.search.placeholder.defaultText||""===A)O.showDefaultOptions();else{var T=A.toLowerCase(),E=[];for(var R in O.options){var z=O.options[R];if(z.searchBy.toLowerCase().indexOf(T)>=0&&(E.push(z),E.length===O.config.options.maxVisibleOptions))break}E.length>0?O.showOptions(E):O.showErrorMessage("Sorry, we can't find \""+A+'"')}}});O.inputText=G;for(var X=0;X<O.config.options.maxVisibleOptions;X++){var Q=new oe(H,o(o({},O.config.options),{height:O.config.initialHeight,positionY:-O.config.initialHeight-O.config.initialHeight*X,color:X%2==0?O.config.options.oddBackgroundColor:H.color}));O.uiOptions.push(Q)}var Z=new UIImage(H,U);Z.onClick=new OnClick((function(){return O.close()})),Z.sourceTop=305,Z.sourceLeft=985,Z.sourceWidth=Z.sourceHeight=35,Z.width=Z.height=18,Z.hAlign="right",Z.vAlign="top",Z.positionX=-12,Z.positionY=-12,Z.visible=Z.isPointerBlocker=!0;var K=new UIText(H);return K.height=20,K.visible=!1,K.width="92%",K.hTextAlign="center",K.vAlign="bottom",K.positionY=20,K.fontSize=O.config.errorMessage.fontSize,K.color=O.config.errorMessage.textColor,O.errorMessage=K,O}return i(e,A),e.prototype.open=function(){this.setProperties({visible:!0}),this.showDefaultOptions()},e.prototype.close=function(){this.setProperties({visible:!1}),this.inputText.reset()},e.prototype.setItems=function(A,T){this.options=A.reduce((function(A,T){var E;return T.searchBy=null!==(E=T.searchBy)&&void 0!==E?E:"string"==typeof T.visualText?T.visualText:"text"in T.visualText?T.visualText.text:T.visualText.topLeft,A[T.id]=T,A}),{}),T?this.setDropdownDefaults(T):this.defaultOptions=T,this.hideAllOptions()},e.prototype.setDropdownDefaults=function(A){var T,E;try{for(var R=r(A),z=R.next();!z.done;z=R.next()){var O=z.value;if(!(O in this.options))return void error("Couldn't find an option with id '"+O+"'. Will not set new defaults")}}catch(A){T={error:A}}finally{try{z&&!z.done&&(E=R.return)&&E.call(R)}finally{if(T)throw T.error}}this.defaultOptions=A},e.prototype.showDefaultOptions=function(){var A,T=this;if(this.defaultOptions)A=this.defaultOptions.map((function(A){return T.options[A]})).slice(0,this.config.options.maxVisibleOptions);else for(var E in A=[],this.options)if(A.push(this.options[E]),A.length===this.config.options.maxVisibleOptions)break;this.showOptions(A)},e.prototype.showOptions=function(A){var T=this;this.resizeHeight(this.config.initialHeight*A.length+2*this.config.borderSize),A.forEach((function(A,E){var R=T.uiOptions[E];R.setOption(A,(function(){T.onSuccessfulSelection(A),T.setProperties({visible:!1})})),R.setProperties({visible:!0})})),this.errorMessage.visible=!1},e.prototype.hideAllOptions=function(){this.uiOptions.forEach((function(A){return A.setProperties({visible:!1})}))},e.prototype.showErrorMessage=function(A){this.errorMessage.visible=!0,this.errorMessage.value=A,this.resizeHeight(60)},e.prototype.resizeHeight=function(A){this.setProperties({height:this.config.initialHeight+A}),this.insideContainer.height=this.config.initialHeight+A-2*this.config.borderSize},e.DEFAULTS={borderColor:Color4.FromInts(232,236,253,255),backgroundColor:Color4.White(),borderSize:2,width:300,initialHeight:60,search:{fontSize:16,textColor:Color4.FromInts(24,26,70,255),placeholder:{defaultText:"Click to search",textColor:Color4.FromInts(118,120,181,200)}},options:{maxVisibleOptions:5,oddBackgroundColor:Color4.FromInts(246,246,255,255),topFontSize:14,bottomFontSize:14,imageSize:36,topTextColor:Color4.FromInts(14,16,60,255),bottomTextColor:Color4.FromInts(117,120,181,255)},errorMessage:{fontSize:13,textColor:Color4.FromInts(125,127,157,255)}},e}($t),re=function(A){function e(T,E,R,z){var O=A.call(this,new UIContainerRect(T),o({},R))||this;O.onSuccessfulSelection=z,R.visible,R.opacity,R.hAlign,R.vAlign,R.positionX,R.positionY;var V=n(R,["visible","opacity","hAlign","vAlign","positionX","positionY"]);O.config=j(ie.DEFAULTS,V),O.setProperties({width:O.config.width,height:O.config.initialHeight,color:O.config.borderColor});var U=new ne(O.shape,{color:O.config.backgroundColor,width:O.config.width-2*O.config.borderSize,height:O.config.initialHeight-2*O.config.borderSize,onClick:function(){return O.uiSearchPrompt.open()}}),H=new oe(U.shape,o(o({},O.config.options),{height:O.config.initialHeight,color:Color4.Clear(),width:O.config.width-2*O.config.borderSize-20,visible:!0,hAlign:"left",isPointerBlocker:!1})),G=new UIText(U.shape);if(G.value="Click to select an option",G.fontSize=O.config.search.fontSize,G.color=O.config.search.placeholder.textColor,G.vTextAlign=G.hTextAlign="center",G.positionX=-O.config.borderSize-10,G.isPointerBlocker=!1,G.opacity=G.color.a,O.initialText=G,null==E?void 0:E.initialItemId){var X=E.items.filter((function(A){return A.id===E.initialItemId}))[0];X&&(H.setOption(X),O.initialText.visible=!1)}var Q=new Texture("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAN5AAADeQELGyzWAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlQTFRF////AAAAAAAAflGpXQAAAAJ0Uk5TAICbK04YAAAAeklEQVQ4je3PsRXEMAgE0VFCEapG9agaiiDRVXkJxlpq8IYT/AfwTbZ/ssPUEJgGZ2hYDTmgSIAiDoqsdskBRQIUcVBktXdO/jeVuBDPMBpRyEMUEhVMiUKKSOQlEokrmBKJXARsJWAqAaYEjEbAVgJmtGDewmjEt9wfISOqAUzY2sAAAAAASUVORK5CYII="),Z=new UIImage(U.shape,Q);return Z.sourceWidth=Z.sourceHeight=64,Z.height=15,Z.width=12,Z.hAlign="right",Z.vAlign="center",Z.positionX=-10,Z.visible=!0,Z.isPointerBlocker=!1,O.uiSearchPrompt=new ie(O.shape,E,o(o({},R),{visible:!1,vAlign:"top",initialHeight:O.config.initialHeight-2*O.config.borderSize}),(function(A){H.setOption(A),O.initialText.visible=!1,O.onSuccessfulSelection(A)})),O}return i(e,A),e.prototype.open=function(){this.setProperties({visible:!0})},e.prototype.close=function(){this.setProperties({visible:!1})},e.prototype.setSearchItems=function(A,T){this.uiSearchPrompt.setItems(A,T)},e.prototype.setSearchDropdownDefaults=function(A){this.uiSearchPrompt.setDropdownDefaults(A)},e}($t);A.CenterImage=qt,A.CornerLabel=Zt,A.CustomPrompt=Ut,A.CustomPromptButton=Ht,A.CustomPromptCheckBox=jt,A.CustomPromptIcon=Xt,A.CustomPromptSwitch=Gt,A.CustomPromptText=Yt,A.CustomPromptTextBox=Qt,A.FillInPrompt=Vt,A.LargeIcon=kt,A.LoadingIcon=Jt,A.MediumIcon=Lt,A.OkPrompt=Wt,A.OptionPrompt=Dt,A.SFFont=O,A.SFHeavyFont=V,A.SmallIcon=Nt,A.UIBar=Ot,A.UICounter=$,A.UISearchPrompt=ie,A.UISelectBox=re,A.canvas=z,A.darkTheme=H,A.displayAnnouncement=function(A,E,R,z,O){G.visible=!0,G.value=A,G.color=R||Color4.Yellow(),G.fontSize=z||50,G.font=V,G.outlineColor=Color4.Black(),G.outlineWidth=O?0:.1,G.adaptWidth=!1,G.textWrapping=!0,G.width=900;var U=new Entity;engine.addEntity(U),-1!=E&&U.addComponentOrReplace(new T(E||3,(function(){G.visible=!1})))},A.hideAnnouncements=function(){G.visible=!1},A.lightTheme=U,Object.defineProperty(A,"__esModule",{value:!0})}));var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(A){for(var T,E=1,R=arguments.length;E<R;E++)for(var z in T=arguments[E])Object.prototype.hasOwnProperty.call(T,z)&&(A[z]=T[z]);return A},__assign.apply(this,arguments)},__values=this&&this.__values||function(A){var T="function"==typeof Symbol&&Symbol.iterator,E=T&&A[T],R=0;if(E)return E.call(A);if(A&&"number"==typeof A.length)return{next:function(){return A&&R>=A.length&&(A=void 0),{value:A&&A[R++],done:!A}}};throw new TypeError(T?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(A){var T;"object"==typeof exports&&"undefined"!=typeof module?module.exports=A():("undefined"!=typeof window?T=window:"undefined"!=typeof global?T=global:"undefined"!=typeof self&&(T=self),T.CANNON=A())}((function(){return function e(A,T,E){function d(z,O){if(!T[z]){if(!A[z]){var V="function"==typeof require&&require;if(!O&&V)return V(z,!0);if(R)return R(z,!0);throw new Error("Cannot find module '"+z+"'")}var U=T[z]={exports:{}};A[z][0].call(U.exports,(function(T){return d(A[z][1][T]||T)}),U,U.exports,e,A,T,E)}return T[z].exports}for(var R="function"==typeof require&&require,z=0;z<E.length;z++)d(E[z]);return d}({1:[function(A,T){T.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(A,T){T.exports={version:A("../package.json").version,AABB:A("./collision/AABB"),ArrayCollisionMatrix:A("./collision/ArrayCollisionMatrix"),Body:A("./objects/Body"),Box:A("./shapes/Box"),Broadphase:A("./collision/Broadphase"),Constraint:A("./constraints/Constraint"),ContactEquation:A("./equations/ContactEquation"),Narrowphase:A("./world/Narrowphase"),ConeTwistConstraint:A("./constraints/ConeTwistConstraint"),ContactMaterial:A("./material/ContactMaterial"),ConvexPolyhedron:A("./shapes/ConvexPolyhedron"),Cylinder:A("./shapes/Cylinder"),DistanceConstraint:A("./constraints/DistanceConstraint"),Equation:A("./equations/Equation"),EventTarget:A("./utils/EventTarget"),FrictionEquation:A("./equations/FrictionEquation"),GSSolver:A("./solver/GSSolver"),GridBroadphase:A("./collision/GridBroadphase"),Heightfield:A("./shapes/Heightfield"),HingeConstraint:A("./constraints/HingeConstraint"),LockConstraint:A("./constraints/LockConstraint"),Mat3:A("./math/Mat3"),Material:A("./material/Material"),NaiveBroadphase:A("./collision/NaiveBroadphase"),ObjectCollisionMatrix:A("./collision/ObjectCollisionMatrix"),Pool:A("./utils/Pool"),Particle:A("./shapes/Particle"),Plane:A("./shapes/Plane"),PointToPointConstraint:A("./constraints/PointToPointConstraint"),Quaternion:A("./math/Quaternion"),Ray:A("./collision/Ray"),RaycastVehicle:A("./objects/RaycastVehicle"),RaycastResult:A("./collision/RaycastResult"),RigidVehicle:A("./objects/RigidVehicle"),RotationalEquation:A("./equations/RotationalEquation"),RotationalMotorEquation:A("./equations/RotationalMotorEquation"),SAPBroadphase:A("./collision/SAPBroadphase"),SPHSystem:A("./objects/SPHSystem"),Shape:A("./shapes/Shape"),Solver:A("./solver/Solver"),Sphere:A("./shapes/Sphere"),SplitSolver:A("./solver/SplitSolver"),Spring:A("./objects/Spring"),Trimesh:A("./shapes/Trimesh"),Vec3:A("./math/Vec3"),Vec3Pool:A("./utils/Vec3Pool"),World:A("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(A,T){function n(A){A=A||{},this.lowerBound=new E,A.lowerBound&&this.lowerBound.copy(A.lowerBound),this.upperBound=new E,A.upperBound&&this.upperBound.copy(A.upperBound)}var E=A("../math/Vec3");A("../utils/Utils"),T.exports=n;var R=new E;n.prototype.setFromPoints=function(A,T,E,z){var O=this.lowerBound,V=this.upperBound,U=E;O.copy(A[0]),U&&U.vmult(O,O),V.copy(O);for(var H=1;H<A.length;H++){var G=A[H];U&&(U.vmult(G,R),G=R),G.x>V.x&&(V.x=G.x),G.x<O.x&&(O.x=G.x),G.y>V.y&&(V.y=G.y),G.y<O.y&&(O.y=G.y),G.z>V.z&&(V.z=G.z),G.z<O.z&&(O.z=G.z)}return T&&(T.vadd(O,O),T.vadd(V,V)),z&&(O.x-=z,O.y-=z,O.z-=z,V.x+=z,V.y+=z,V.z+=z),this},n.prototype.copy=function(A){return this.lowerBound.copy(A.lowerBound),this.upperBound.copy(A.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(A){var T=A.lowerBound.x;this.lowerBound.x>T&&(this.lowerBound.x=T);var E=A.upperBound.x;this.upperBound.x<E&&(this.upperBound.x=E),T=A.lowerBound.y,this.lowerBound.y>T&&(this.lowerBound.y=T),E=A.upperBound.y,this.upperBound.y<E&&(this.upperBound.y=E),T=A.lowerBound.z,this.lowerBound.z>T&&(this.lowerBound.z=T),E=A.upperBound.z,this.upperBound.z<E&&(this.upperBound.z=E)},n.prototype.overlaps=function(A){var T=this.lowerBound,E=this.upperBound,R=A.lowerBound,z=A.upperBound;return(R.x<=E.x&&E.x<=z.x||T.x<=z.x&&z.x<=E.x)&&(R.y<=E.y&&E.y<=z.y||T.y<=z.y&&z.y<=E.y)&&(R.z<=E.z&&E.z<=z.z||T.z<=z.z&&z.z<=E.z)},n.prototype.contains=function(A){var T=this.lowerBound,E=this.upperBound,R=A.lowerBound,z=A.upperBound;return T.x<=R.x&&E.x>=z.x&&T.y<=R.y&&E.y>=z.y&&T.z<=R.z&&E.z>=z.z},n.prototype.getCorners=function(A,T,E,R,z,O,V,U){var H=this.lowerBound,G=this.upperBound;A.copy(H),T.set(G.x,H.y,H.z),E.set(G.x,G.y,H.z),R.set(H.x,G.y,G.z),z.set(G.x,H.y,H.z),O.set(H.x,G.y,H.z),V.set(H.x,H.y,G.z),U.copy(G)};var z=[new E,new E,new E,new E,new E,new E,new E,new E];n.prototype.toLocalFrame=function(A,T){var E=z,R=E[0],O=E[1],V=E[2],U=E[3],H=E[4],G=E[5],X=E[6],Q=E[7];this.getCorners(R,O,V,U,H,G,X,Q);for(var Z=0;8!==Z;Z++){var K=E[Z];A.pointToLocal(K,K)}return T.setFromPoints(E)},n.prototype.toWorldFrame=function(A,T){var E=z,R=E[0],O=E[1],V=E[2],U=E[3],H=E[4],G=E[5],X=E[6],Q=E[7];this.getCorners(R,O,V,U,H,G,X,Q);for(var Z=0;8!==Z;Z++){var K=E[Z];A.pointToWorld(K,K)}return T.setFromPoints(E)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(A,T){function n(){this.matrix=[]}T.exports=n,n.prototype.get=function(A,T){if(A=A.index,(T=T.index)>A){var E=T;T=A,A=E}return this.matrix[(A*(A+1)>>1)+T-1]},n.prototype.set=function(A,T,E){if(A=A.index,(T=T.index)>A){var R=T;T=A,A=R}this.matrix[(A*(A+1)>>1)+T-1]=E?1:0},n.prototype.reset=function(){for(var A=0,T=this.matrix.length;A!==T;A++)this.matrix[A]=0},n.prototype.setNumObjects=function(A){this.matrix.length=A*(A-1)>>1}},{}],5:[function(A,T){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var E=A("../objects/Body"),R=A("../math/Vec3"),z=A("../math/Quaternion");A("../shapes/Shape"),A("../shapes/Plane"),T.exports=n,n.prototype.collisionPairs=function(){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var O=E.STATIC|E.KINEMATIC;n.prototype.needBroadphaseCollision=function(A,T){return 0!=(A.collisionFilterGroup&T.collisionFilterMask)&&0!=(T.collisionFilterGroup&A.collisionFilterMask)&&(0==(A.type&O)&&A.sleepState!==E.SLEEPING||0==(T.type&O)&&T.sleepState!==E.SLEEPING)},n.prototype.intersectionTest=function(A,T,E,R){this.useBoundingBoxes?this.doBoundingBoxBroadphase(A,T,E,R):this.doBoundingSphereBroadphase(A,T,E,R)};var V=new R;new R,new z,new R,n.prototype.doBoundingSphereBroadphase=function(A,T,E,R){var z=V;T.position.vsub(A.position,z),Math.pow(A.boundingRadius+T.boundingRadius,2)>z.norm2()&&(E.push(A),R.push(T))},n.prototype.doBoundingBoxBroadphase=function(A,T,E,R){A.aabbNeedsUpdate&&A.computeAABB(),T.aabbNeedsUpdate&&T.computeAABB(),A.aabb.overlaps(T.aabb)&&(E.push(A),R.push(T))};var U={keys:[]},H=[],G=[];n.prototype.makePairsUnique=function(A,T){for(var E=U,R=H,z=G,O=A.length,V=0;V!==O;V++)R[V]=A[V],z[V]=T[V];for(A.length=0,T.length=0,V=0;V!==O;V++){var X=R[V].id,Q=z[V].id;E[Z=Q>X?X+","+Q:Q+","+X]=V,E.keys.push(Z)}for(V=0;V!==E.keys.length;V++){var Z=E.keys.pop(),K=E[Z];A.push(R[K]),T.push(z[K]),delete E[Z]}},n.prototype.setWorld=function(){};var X=new R;n.boundingSphereCheck=function(A,T){var E=X;return A.position.vsub(T.position,E),Math.pow(A.shape.boundingSphereRadius+T.shape.boundingSphereRadius,2)>E.norm2()},n.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(A,T){function n(A,T,z,O,V){E.apply(this),this.nx=z||10,this.ny=O||10,this.nz=V||10,this.aabbMin=A||new R(100,100,100),this.aabbMax=T||new R(-100,-100,-100);var U=this.nx*this.ny*this.nz;if(0>=U)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=U,this.binLengths.length=U;for(var H=0;U>H;H++)this.bins[H]=[],this.binLengths[H]=0}T.exports=n;var E=A("./Broadphase"),R=A("../math/Vec3"),z=A("../shapes/Shape");n.prototype=new E,n.prototype.constructor=n;var O=new R;new R,n.prototype.collisionPairs=function(A,T,E){function o(A,T,E,R,z,O,V){var U=(A-ot)*st|0,H=(T-it)*at|0,$=(E-rt)*ut|0,et=xt((R-ot)*st),nt=xt((z-it)*at),lt=xt((O-rt)*ut);0>U?U=0:U>=G&&(U=G-1),0>H?H=0:H>=X&&(H=X-1),0>$?$=0:$>=Q&&($=Q-1),0>et?et=0:et>=G&&(et=G-1),0>nt?nt=0:nt>=X&&(nt=X-1),0>lt?lt=0:lt>=Q&&(lt=Q-1),H*=K,$*=J,et*=Z,nt*=K,lt*=J;for(var ht=U*=Z;et>=ht;ht+=Z)for(var ct=H;nt>=ct;ct+=K)for(var pt=$;lt>=pt;pt+=J){var dt=ht+ct+pt;mt[dt][gt[dt]++]=V}}for(var R=A.numObjects(),V=A.bodies,U=this.aabbMax,H=this.aabbMin,G=this.nx,X=this.ny,Q=this.nz,Z=X*Q,K=Q,J=1,$=U.x,et=U.y,nt=U.z,ot=H.x,it=H.y,rt=H.z,st=G/($-ot),at=X/(et-it),ut=Q/(nt-rt),lt=($-ot)/G,ht=(et-it)/X,ct=(nt-rt)/Q,pt=.5*Math.sqrt(lt*lt+ht*ht+ct*ct),dt=z.types,ft=dt.SPHERE,vt=dt.PLANE,mt=(dt.BOX,dt.COMPOUND,dt.CONVEXPOLYHEDRON,this.bins),gt=this.binLengths,wt=this.bins.length,bt=0;bt!==wt;bt++)gt[bt]=0;var xt=Math.ceil;for(H=Math.min,U=Math.max,bt=0;bt!==R;bt++){var At=(Vt=V[bt]).shape;switch(At.type){case ft:var Tt=Vt.position.x,St=Vt.position.y,Et=Vt.position.z,Ct=At.radius;o(Tt-Ct,St-Ct,Et-Ct,Tt+Ct,St+Ct,Et+Ct,Vt);break;case vt:At.worldNormalNeedsUpdate&&At.computeWorldNormal(Vt.quaternion);var It=At.worldNormal,Rt=ot+.5*lt-Vt.position.x,_t=it+.5*ht-Vt.position.y,zt=rt+.5*ct-Vt.position.z,Pt=O;Pt.set(Rt,_t,zt);for(var Bt=0,Mt=0;Bt!==G;Bt++,Mt+=Z,Pt.y=_t,Pt.x+=lt)for(var Ot=0,Lt=0;Ot!==X;Ot++,Lt+=K,Pt.z=zt,Pt.y+=ht)for(var Nt=0,kt=0;Nt!==Q;Nt++,kt+=J,Pt.z+=ct)if(Pt.dot(It)<pt){var qt=Mt+Lt+kt;mt[qt][gt[qt]++]=Vt}break;default:Vt.aabbNeedsUpdate&&Vt.computeAABB(),o(Vt.aabb.lowerBound.x,Vt.aabb.lowerBound.y,Vt.aabb.lowerBound.z,Vt.aabb.upperBound.x,Vt.aabb.upperBound.y,Vt.aabb.upperBound.z,Vt)}}for(bt=0;bt!==wt;bt++){var Wt=gt[bt];if(Wt>1){var Dt=mt[bt];for(Bt=0;Bt!==Wt;Bt++){var Vt=Dt[Bt];for(Ot=0;Ot!==Bt;Ot++){var Ut=Dt[Ot];this.needBroadphaseCollision(Vt,Ut)&&this.intersectionTest(Vt,Ut,T,E)}}}}this.makePairsUnique(T,E)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(A,T){function n(){E.apply(this)}T.exports=n;var E=A("./Broadphase"),R=A("./AABB");n.prototype=new E,n.prototype.constructor=n,n.prototype.collisionPairs=function(A,T,E){var R,z,O,V,U=A.bodies,H=U.length;for(R=0;R!==H;R++)for(z=0;z!==R;z++)O=U[R],V=U[z],this.needBroadphaseCollision(O,V)&&this.intersectionTest(O,V,T,E)},new R,n.prototype.aabbQuery=function(A,T,E){E=E||[];for(var R=0;R<A.bodies.length;R++){var z=A.bodies[R];z.aabbNeedsUpdate&&z.computeAABB(),z.aabb.overlaps(T)&&E.push(z)}return E}},{"./AABB":3,"./Broadphase":5}],8:[function(A,T){function n(){this.matrix={}}T.exports=n,n.prototype.get=function(A,T){if(A=A.id,(T=T.id)>A){var E=T;T=A,A=E}return A+"-"+T in this.matrix},n.prototype.set=function(A,T,E){if(A=A.id,(T=T.id)>A){var R=T;T=A,A=R}E?this.matrix[A+"-"+T]=!0:delete this.matrix[A+"-"+T]},n.prototype.reset=function(){this.matrix={}},n.prototype.setNumObjects=function(){}},{}],9:[function(A,T){function n(A,T){this.from=A?A.clone():new E,this.to=T?T.clone():new E,this._direction=new E,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new O,this.hasHit=!1,this.callback=function(){}}function o(A,T,E,R){R.vsub(T,mt),E.vsub(T,X),A.vsub(T,Q);var z,O,V=mt.dot(mt),U=mt.dot(X),H=mt.dot(Q),G=X.dot(X),Z=X.dot(Q);return(z=G*H-U*Z)>=0&&(O=V*Z-U*H)>=0&&V*G-U*U>z+O}T.exports=n;var E=A("../math/Vec3"),R=A("../math/Quaternion"),z=A("../math/Transform"),O=(A("../shapes/ConvexPolyhedron"),A("../shapes/Box"),A("../collision/RaycastResult")),V=A("../shapes/Shape"),U=A("../collision/AABB");n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var H=new U,G=[];n.prototype.intersectWorld=function(A,T){return this.mode=T.mode||n.ANY,this.result=T.result||new O,this.skipBackfaces=!!T.skipBackfaces,this.collisionFilterMask=void 0!==T.collisionFilterMask?T.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==T.collisionFilterGroup?T.collisionFilterGroup:-1,T.from&&this.from.copy(T.from),T.to&&this.to.copy(T.to),this.callback=T.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(H),G.length=0,A.broadphase.aabbQuery(A,H,G),this.intersectBodies(G),this.hasHit};var X=new E,Q=new E;n.pointInTriangle=o;var Z=new E,K=new R;n.prototype.intersectBody=function(A,T){T&&(this.result=T,this._updateDirection());var E=this.checkCollisionResponse;if((!E||A.collisionResponse)&&0!=(this.collisionFilterGroup&A.collisionFilterMask)&&0!=(A.collisionFilterGroup&this.collisionFilterMask))for(var R=Z,z=K,O=0,V=A.shapes.length;V>O;O++){var U=A.shapes[O];if((!E||U.collisionResponse)&&(A.quaternion.mult(A.shapeOrientations[O],z),A.quaternion.vmult(A.shapeOffsets[O],R),R.vadd(A.position,R),this.intersectShape(U,z,R,A),this.result._shouldStop))break}},n.prototype.intersectBodies=function(A,T){T&&(this.result=T,this._updateDirection());for(var E=0,R=A.length;!this.result._shouldStop&&R>E;E++)this.intersectBody(A[E])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(A,T,E,R){var z=function(A,T,E){E.vsub(A,mt);var R=mt.dot(T);return T.mult(R,gt),gt.vadd(A,gt),E.distanceTo(gt)}(this.from,this._direction,E);if(!(z>A.boundingSphereRadius)){var O=this[A.type];O&&O.call(this,A,T,E,R)}};var J=(new E,new E,new E),$=new E,et=new E,nt=new E;new E,new O,n.prototype.intersectBox=function(A,T,E,R){return this.intersectConvex(A.convexPolyhedronRepresentation,T,E,R)},n.prototype[V.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(A,T,R,z){var O=this.from,V=this.to,U=this._direction,H=new E(0,0,1);T.vmult(H,H);var G=new E;O.vsub(R,G);var X=G.dot(H);if(V.vsub(R,G),!(X*G.dot(H)>0||O.distanceTo(V)<X)){var Q=H.dot(U);if(!(Math.abs(Q)<this.precision)){var Z=new E,K=new E,J=new E;O.vsub(R,Z);var $=-H.dot(Z)/Q;U.scale($,K),O.vadd(K,J),this.reportIntersection(H,J,A,z,-1)}}},n.prototype[V.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(A){var T=this.to,E=this.from;A.lowerBound.x=Math.min(T.x,E.x),A.lowerBound.y=Math.min(T.y,E.y),A.lowerBound.z=Math.min(T.z,E.z),A.upperBound.x=Math.max(T.x,E.x),A.upperBound.y=Math.max(T.y,E.y),A.upperBound.z=Math.max(T.z,E.z)};var ot={faceList:[0]};n.prototype.intersectHeightfield=function(A,T,R,O){var V=(A.data,A.elementSize,new E),U=new n(this.from,this.to);z.pointToLocalFrame(R,T,U.from,U.from),z.pointToLocalFrame(R,T,U.to,U.to);var H=[],G=null,X=null,Q=null,Z=null,K=A.getIndexOfPosition(U.from.x,U.from.y,H,!1);if(K&&(G=H[0],X=H[1],Q=H[0],Z=H[1]),(K=A.getIndexOfPosition(U.to.x,U.to.y,H,!1))&&((null===G||H[0]<G)&&(G=H[0]),(null===Q||H[0]>Q)&&(Q=H[0]),(null===X||H[1]<X)&&(X=H[1]),(null===Z||H[1]>Z)&&(Z=H[1])),null!==G){A.getRectMinMax(G,X,Q,Z,[]);for(var J=G;Q>=J;J++)for(var $=X;Z>=$;$++){if(this.result._shouldStop)return;if(A.getConvexTrianglePillar(J,$,!1),z.pointToWorldFrame(R,T,A.pillarOffset,V),this.intersectConvex(A.pillarConvex,T,V,O,ot),this.result._shouldStop)return;A.getConvexTrianglePillar(J,$,!0),z.pointToWorldFrame(R,T,A.pillarOffset,V),this.intersectConvex(A.pillarConvex,T,V,O,ot)}}},n.prototype[V.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var it=new E,rt=new E;n.prototype.intersectSphere=function(A,T,E,R){var z=this.from,O=this.to,V=A.radius,U=Math.pow(O.x-z.x,2)+Math.pow(O.y-z.y,2)+Math.pow(O.z-z.z,2),H=2*((O.x-z.x)*(z.x-E.x)+(O.y-z.y)*(z.y-E.y)+(O.z-z.z)*(z.z-E.z)),G=Math.pow(z.x-E.x,2)+Math.pow(z.y-E.y,2)+Math.pow(z.z-E.z,2)-Math.pow(V,2),X=Math.pow(H,2)-4*U*G,Q=it,Z=rt;if(!(0>X))if(0===X)z.lerp(O,X,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,A,R,-1);else{var K=(-H-Math.sqrt(X))/(2*U),J=(-H+Math.sqrt(X))/(2*U);if(K>=0&&1>=K&&(z.lerp(O,K,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,A,R,-1)),this.result._shouldStop)return;J>=0&&1>=J&&(z.lerp(O,J,Q),Q.vsub(E,Z),Z.normalize(),this.reportIntersection(Z,Q,A,R,-1))}},n.prototype[V.types.SPHERE]=n.prototype.intersectSphere;var st=new E,at=(new E,new E,new E);n.prototype.intersectConvex=function(A,T,E,R,z){for(var O=st,V=at,U=z&&z.faceList||null,H=A.faces,G=A.vertices,X=A.faceNormals,Q=this._direction,Z=this.from,K=this.to,ot=Z.distanceTo(K),it=U?U.length:H.length,rt=this.result,ut=0;!rt._shouldStop&&it>ut;ut++){var lt=U?U[ut]:ut,ht=H[lt],ct=X[lt],pt=T,dt=E;V.copy(G[ht[0]]),pt.vmult(V,V),V.vadd(dt,V),V.vsub(Z,V),pt.vmult(ct,O);var ft=Q.dot(O);if(!(Math.abs(ft)<this.precision)){var vt=O.dot(V)/ft;if(!(0>vt)){Q.mult(vt,J),J.vadd(Z,J),$.copy(G[ht[0]]),pt.vmult($,$),dt.vadd($,$);for(var mt=1;!rt._shouldStop&&mt<ht.length-1;mt++){et.copy(G[ht[mt]]),nt.copy(G[ht[mt+1]]),pt.vmult(et,et),pt.vmult(nt,nt),dt.vadd(et,et),dt.vadd(nt,nt);var gt=J.distanceTo(Z);!o(J,$,et,nt)&&!o(J,et,$,nt)||gt>ot||this.reportIntersection(O,J,A,R,lt)}}}}},n.prototype[V.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var ut=new E,lt=new E,ht=new E,ct=new E,pt=new E,dt=new E,ft=(new U,[]),vt=new z;n.prototype.intersectTrimesh=function(A,T,E,R,O){var V=ut,U=ft,H=vt,G=at,X=lt,Q=ht,Z=ct,K=dt,ot=pt,it=(O&&O.faceList,A.indices),rt=(A.vertices,A.faceNormals,this.from),st=this.to,mt=this._direction;H.position.copy(E),H.quaternion.copy(T),z.vectorToLocalFrame(E,T,mt,X),z.pointToLocalFrame(E,T,rt,Q),z.pointToLocalFrame(E,T,st,Z);var gt=Q.distanceSquared(Z);A.tree.rayQuery(this,H,U);for(var wt=0,bt=U.length;!this.result._shouldStop&&wt!==bt;wt++){var xt=U[wt];A.getNormal(xt,V),A.getVertex(it[3*xt],$),$.vsub(Q,G);var At=X.dot(V),Tt=V.dot(G)/At;if(!(0>Tt)){X.scale(Tt,J),J.vadd(Q,J),A.getVertex(it[3*xt+1],et),A.getVertex(it[3*xt+2],nt);var St=J.distanceSquared(Q);!o(J,et,$,nt)&&!o(J,$,et,nt)||St>gt||(z.vectorToWorldFrame(T,V,ot),z.pointToWorldFrame(E,T,J,K),this.reportIntersection(ot,K,A,R,xt))}}U.length=0},n.prototype[V.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(A,T,E,R,z){var O=this.from,V=this.to,U=O.distanceTo(T),H=this.result;if(!(this.skipBackfaces&&A.dot(this._direction)>0))switch(H.hitFaceIndex=void 0!==z?z:-1,this.mode){case n.ALL:this.hasHit=!0,H.set(O,V,A,T,E,R,U),H.hasHit=!0,this.callback(H);break;case n.CLOSEST:(U<H.distance||!H.hasHit)&&(this.hasHit=!0,H.hasHit=!0,H.set(O,V,A,T,E,R,U));break;case n.ANY:this.hasHit=!0,H.hasHit=!0,H.set(O,V,A,T,E,R,U),H._shouldStop=!0}};var mt=new E,gt=new E},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(A,T){function n(){this.rayFromWorld=new E,this.rayToWorld=new E,this.hitNormalWorld=new E,this.hitPointWorld=new E,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var E=A("../math/Vec3");T.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(A,T,E,R,z,O,V){this.rayFromWorld.copy(A),this.rayToWorld.copy(T),this.hitNormalWorld.copy(E),this.hitPointWorld.copy(R),this.shape=z,this.body=O,this.distance=V}},{"../math/Vec3":30}],11:[function(A,T){function n(A){E.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var T=this.axisList;this._addBodyHandler=function(A){T.push(A.body)},this._removeBodyHandler=function(A){var E=T.indexOf(A.body);-1!==E&&T.splice(E,1)},A&&this.setWorld(A)}var E=(A("../shapes/Shape"),A("../collision/Broadphase"));T.exports=n,n.prototype=new E,n.prototype.setWorld=function(A){this.axisList.length=0;for(var T=0;T<A.bodies.length;T++)this.axisList.push(A.bodies[T]);A.removeEventListener("addBody",this._addBodyHandler),A.removeEventListener("removeBody",this._removeBodyHandler),A.addEventListener("addBody",this._addBodyHandler),A.addEventListener("removeBody",this._removeBodyHandler),this.world=A,this.dirty=!0},n.insertionSortX=function(A){for(var T=1,E=A.length;E>T;T++){for(var R=A[T],z=T-1;z>=0&&!(A[z].aabb.lowerBound.x<=R.aabb.lowerBound.x);z--)A[z+1]=A[z];A[z+1]=R}return A},n.insertionSortY=function(A){for(var T=1,E=A.length;E>T;T++){for(var R=A[T],z=T-1;z>=0&&!(A[z].aabb.lowerBound.y<=R.aabb.lowerBound.y);z--)A[z+1]=A[z];A[z+1]=R}return A},n.insertionSortZ=function(A){for(var T=1,E=A.length;E>T;T++){for(var R=A[T],z=T-1;z>=0&&!(A[z].aabb.lowerBound.z<=R.aabb.lowerBound.z);z--)A[z+1]=A[z];A[z+1]=R}return A},n.prototype.collisionPairs=function(A,T,E){var R,z,O=this.axisList,V=O.length,U=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),R=0;R!==V;R++){var H=O[R];for(z=R+1;V>z;z++){var G=O[z];if(this.needBroadphaseCollision(H,G)){if(!n.checkBounds(H,G,U))break;this.intersectionTest(H,G,T,E)}}}},n.prototype.sortList=function(){for(var A=this.axisList,T=this.axisIndex,E=A.length,R=0;R!==E;R++){var z=A[R];z.aabbNeedsUpdate&&z.computeAABB()}0===T?n.insertionSortX(A):1===T?n.insertionSortY(A):2===T&&n.insertionSortZ(A)},n.checkBounds=function(A,T,E){var R,z;return 0===E?(R=A.position.x,z=T.position.x):1===E?(R=A.position.y,z=T.position.y):2===E&&(R=A.position.z,z=T.position.z),R+A.boundingRadius>z-T.boundingRadius},n.prototype.autoDetectAxis=function(){for(var A=0,T=0,E=0,R=0,z=0,O=0,V=this.axisList,U=V.length,H=1/U,G=0;G!==U;G++){var X=V[G],Q=X.position.x;A+=Q,T+=Q*Q;var Z=X.position.y;E+=Z,R+=Z*Z;var K=X.position.z;z+=K,O+=K*K}var J=T-A*A*H,$=R-E*E*H,et=O-z*z*H;this.axisIndex=J>$?J>et?0:2:$>et?1:2},n.prototype.aabbQuery=function(A,T,E){E=E||[],this.dirty&&(this.sortList(),this.dirty=!1);var R=this.axisIndex,z="x";1===R&&(z="y"),2===R&&(z="z");for(var O=this.axisList,V=(T.lowerBound[z],T.upperBound[z],0);V<O.length;V++){var U=O[V];U.aabbNeedsUpdate&&U.computeAABB(),U.aabb.overlaps(T)&&E.push(U)}return E}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(A,T){function n(A,T,V){var U=void 0!==(V=V||{}).maxForce?V.maxForce:1e6,H=V.pivotA?V.pivotA.clone():new O,G=V.pivotB?V.pivotB.clone():new O;this.axisA=V.axisA?V.axisA.clone():new O,this.axisB=V.axisB?V.axisB.clone():new O,E.call(this,A,H,T,G,U),this.collideConnected=!!V.collideConnected,this.angle=void 0!==V.angle?V.angle:0;var X=this.coneEquation=new R(A,T,V),Q=this.twistEquation=new z(A,T,V);this.twistAngle=void 0!==V.twistAngle?V.twistAngle:0,X.maxForce=0,X.minForce=-U,Q.maxForce=0,Q.minForce=-U,this.equations.push(X,Q)}T.exports=n;var E=(A("./Constraint"),A("./PointToPointConstraint")),R=A("../equations/ConeEquation"),z=A("../equations/RotationalEquation"),O=(A("../equations/ContactEquation"),A("../math/Vec3"));n.prototype=new E,n.constructor=n,new O,new O,n.prototype.update=function(){var A=this.bodyA,T=this.bodyB,R=this.coneEquation,z=this.twistEquation;E.prototype.update.call(this),A.vectorToWorldFrame(this.axisA,R.axisA),T.vectorToWorldFrame(this.axisB,R.axisB),this.axisA.tangents(z.axisA,z.axisA),A.vectorToWorldFrame(z.axisA,z.axisA),this.axisB.tangents(z.axisB,z.axisB),T.vectorToWorldFrame(z.axisB,z.axisB),R.angle=this.angle,z.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(A,T){function n(A,T,R){R=E.defaults(R,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=A,this.bodyB=T,this.id=n.idCounter++,this.collideConnected=R.collideConnected,R.wakeUpBodies&&(A&&A.wakeUp(),T&&T.wakeUp())}T.exports=n;var E=A("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.prototype.enable=function(){for(var A=this.equations,T=0;T<A.length;T++)A[T].enabled=!0},n.prototype.disable=function(){for(var A=this.equations,T=0;T<A.length;T++)A[T].enabled=!1},n.idCounter=0},{"../utils/Utils":53}],14:[function(A,T){function n(A,T,z,O){E.call(this,A,T),void 0===z&&(z=A.position.distanceTo(T.position)),void 0===O&&(O=1e6),this.distance=z;var V=this.distanceEquation=new R(A,T);this.equations.push(V),V.minForce=-O,V.maxForce=O}T.exports=n;var E=A("./Constraint"),R=A("../equations/ContactEquation");n.prototype=new E,n.prototype.update=function(){var A=this.bodyA,T=this.bodyB,E=this.distanceEquation,R=.5*this.distance,z=E.ni;T.position.vsub(A.position,z),z.normalize(),z.mult(R,E.ri),z.mult(-R,E.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(A,T){function n(A,T,V){var U=void 0!==(V=V||{}).maxForce?V.maxForce:1e6,H=V.pivotA?V.pivotA.clone():new O,G=V.pivotB?V.pivotB.clone():new O;E.call(this,A,H,T,G,U),(this.axisA=V.axisA?V.axisA.clone():new O(1,0,0)).normalize(),(this.axisB=V.axisB?V.axisB.clone():new O(1,0,0)).normalize();var X=this.rotationalEquation1=new R(A,T,V),Q=this.rotationalEquation2=new R(A,T,V),Z=this.motorEquation=new z(A,T,U);Z.enabled=!1,this.equations.push(X,Q,Z)}T.exports=n;var E=(A("./Constraint"),A("./PointToPointConstraint")),R=A("../equations/RotationalEquation"),z=A("../equations/RotationalMotorEquation"),O=(A("../equations/ContactEquation"),A("../math/Vec3"));n.prototype=new E,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(A){this.motorEquation.targetVelocity=A},n.prototype.setMotorMaxForce=function(A){this.motorEquation.maxForce=A,this.motorEquation.minForce=-A};var V=new O,U=new O;n.prototype.update=function(){var A=this.bodyA,T=this.bodyB,R=this.motorEquation,z=this.rotationalEquation1,O=this.rotationalEquation2,H=V,G=U,X=this.axisA,Q=this.axisB;E.prototype.update.call(this),A.quaternion.vmult(X,H),T.quaternion.vmult(Q,G),H.tangents(z.axisA,O.axisA),z.axisB.copy(G),O.axisB.copy(G),this.motorEquation.enabled&&(A.quaternion.vmult(this.axisA,R.axisA),T.quaternion.vmult(this.axisB,R.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(A,T){function n(A,T,O){var V=void 0!==(O=O||{}).maxForce?O.maxForce:1e6,U=new z,H=new z,G=new z;A.position.vadd(T.position,G),G.scale(.5,G),T.pointToLocalFrame(G,H),A.pointToLocalFrame(G,U),E.call(this,A,U,T,H,V);var X=this.rotationalEquation1=new R(A,T,O),Q=this.rotationalEquation2=new R(A,T,O),Z=this.rotationalEquation3=new R(A,T,O);this.equations.push(X,Q,Z)}T.exports=n;var E=(A("./Constraint"),A("./PointToPointConstraint")),R=A("../equations/RotationalEquation"),z=(A("../equations/RotationalMotorEquation"),A("../equations/ContactEquation"),A("../math/Vec3"));n.prototype=new E,n.constructor=n,new z,new z,n.prototype.update=function(){var A=this.bodyA,T=this.bodyB,R=(this.motorEquation,this.rotationalEquation1),O=this.rotationalEquation2,V=this.rotationalEquation3;E.prototype.update.call(this),A.vectorToWorldFrame(z.UNIT_X,R.axisA),T.vectorToWorldFrame(z.UNIT_Y,R.axisB),A.vectorToWorldFrame(z.UNIT_Y,O.axisA),T.vectorToWorldFrame(z.UNIT_Z,O.axisB),A.vectorToWorldFrame(z.UNIT_Z,V.axisA),T.vectorToWorldFrame(z.UNIT_X,V.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(A,T){function n(A,T,O,V,U){E.call(this,A,O),U=void 0!==U?U:1e6,this.pivotA=T?T.clone():new z,this.pivotB=V?V.clone():new z;var H=this.equationX=new R(A,O),G=this.equationY=new R(A,O),X=this.equationZ=new R(A,O);this.equations.push(H,G,X),H.minForce=G.minForce=X.minForce=-U,H.maxForce=G.maxForce=X.maxForce=U,H.ni.set(1,0,0),G.ni.set(0,1,0),X.ni.set(0,0,1)}T.exports=n;var E=A("./Constraint"),R=A("../equations/ContactEquation"),z=A("../math/Vec3");n.prototype=new E,n.prototype.update=function(){var A=this.bodyA,T=this.bodyB,E=this.equationX,R=this.equationY,z=this.equationZ;A.quaternion.vmult(this.pivotA,E.ri),T.quaternion.vmult(this.pivotB,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),z.ri.copy(E.ri),z.rj.copy(E.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(A,T){function n(A,T,z){var O=void 0!==(z=z||{}).maxForce?z.maxForce:1e6;R.call(this,A,T,-O,O),this.axisA=z.axisA?z.axisA.clone():new E(1,0,0),this.axisB=z.axisB?z.axisB.clone():new E(0,1,0),this.angle=void 0!==z.angle?z.angle:0}T.exports=n;var E=A("../math/Vec3"),R=(A("../math/Mat3"),A("./Equation"));n.prototype=new R,n.prototype.constructor=n;var z=new E,O=new E;n.prototype.computeB=function(A){var T=this.a,E=this.b,R=this.axisA,V=this.axisB,U=z,H=O,G=this.jacobianElementA,X=this.jacobianElementB;return R.cross(V,U),V.cross(R,H),G.rotational.copy(H),X.rotational.copy(U),-(Math.cos(this.angle)-R.dot(V))*T-this.computeGW()*E-A*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(A,T){function n(A,T,z){z=void 0!==z?z:1e6,E.call(this,A,T,0,z),this.restitution=0,this.ri=new R,this.rj=new R,this.ni=new R}T.exports=n;var E=A("./Equation"),R=A("../math/Vec3");A("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var z=new R,O=new R,V=new R;n.prototype.computeB=function(A){var T=this.a,E=this.b,R=this.bi,U=this.bj,H=this.ri,G=this.rj,X=z,Q=O,Z=R.velocity,K=R.angularVelocity,J=(R.force,R.torque,U.velocity),$=U.angularVelocity,et=(U.force,U.torque,V),nt=this.jacobianElementA,ot=this.jacobianElementB,it=this.ni;H.cross(it,X),G.cross(it,Q),it.negate(nt.spatial),X.negate(nt.rotational),ot.spatial.copy(it),ot.rotational.copy(Q),et.copy(U.position),et.vadd(G,et),et.vsub(R.position,et),et.vsub(H,et);var rt=it.dot(et),st=this.restitution+1;return-rt*T-(st*J.dot(it)-st*Z.dot(it)+$.dot(Q)-K.dot(X))*E-A*this.computeGiMf()};var U=new R,H=new R,G=new R,X=new R,Q=new R;n.prototype.getImpactVelocityAlongNormal=function(){var A=U,T=H,E=G,R=X,z=Q;return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,R),this.bi.getVelocityAtWorldPoint(E,A),this.bj.getVelocityAtWorldPoint(R,T),A.vsub(T,z),this.ni.dot(z)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(A,T){function n(A,T,R,z){this.id=n.id++,this.minForce=void 0===R?-1e6:R,this.maxForce=void 0===z?1e6:z,this.bi=A,this.bj=T,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new E,this.jacobianElementB=new E,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}T.exports=n;var E=A("../math/JacobianElement"),R=A("../math/Vec3");n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(A,T,E){var R=T,z=A,O=E;this.a=4/(O*(1+4*R)),this.b=4*R/(1+4*R),this.eps=4/(O*O*z*(1+4*R))},n.prototype.computeB=function(A,T,E){var R=this.computeGW();return-this.computeGq()*A-R*T-this.computeGiMf()*E},n.prototype.computeGq=function(){var A=this.jacobianElementA,T=this.jacobianElementB,E=this.bi,R=this.bj,z=E.position,O=R.position;return A.spatial.dot(z)+T.spatial.dot(O)};var z=new R;n.prototype.computeGW=function(){var A=this.jacobianElementA,T=this.jacobianElementB,E=this.bi,R=this.bj,O=E.velocity,V=R.velocity,U=E.angularVelocity||z,H=R.angularVelocity||z;return A.multiplyVectors(O,U)+T.multiplyVectors(V,H)},n.prototype.computeGWlambda=function(){var A=this.jacobianElementA,T=this.jacobianElementB,E=this.bi,R=this.bj,O=E.vlambda,V=R.vlambda,U=E.wlambda||z,H=R.wlambda||z;return A.multiplyVectors(O,U)+T.multiplyVectors(V,H)};var O=new R,V=new R,U=new R,H=new R;n.prototype.computeGiMf=function(){var A=this.jacobianElementA,T=this.jacobianElementB,E=this.bi,R=this.bj,z=E.force,G=E.torque,X=R.force,Q=R.torque,Z=E.invMassSolve,K=R.invMassSolve;return E.invInertiaWorldSolve?E.invInertiaWorldSolve.vmult(G,U):U.set(0,0,0),R.invInertiaWorldSolve?R.invInertiaWorldSolve.vmult(Q,H):H.set(0,0,0),z.mult(Z,O),X.mult(K,V),A.multiplyVectors(O,U)+T.multiplyVectors(V,H)};var G=new R;n.prototype.computeGiMGt=function(){var A=this.jacobianElementA,T=this.jacobianElementB,E=this.bi,R=this.bj,z=E.invMassSolve,O=R.invMassSolve,V=E.invInertiaWorldSolve,U=R.invInertiaWorldSolve,H=z+O;return V&&(V.vmult(A.rotational,G),H+=G.dot(A.rotational)),U&&(U.vmult(T.rotational,G),H+=G.dot(T.rotational)),H};var X=new R;new R,new R,new R,new R,new R,n.prototype.addToWlambda=function(A){var T=this.jacobianElementA,E=this.jacobianElementB,R=this.bi,z=this.bj,O=X;T.spatial.mult(R.invMassSolve*A,O),R.vlambda.vadd(O,R.vlambda),E.spatial.mult(z.invMassSolve*A,O),z.vlambda.vadd(O,z.vlambda),R.invInertiaWorldSolve&&(R.invInertiaWorldSolve.vmult(T.rotational,O),O.mult(A,O),R.wlambda.vadd(O,R.wlambda)),z.invInertiaWorldSolve&&(z.invInertiaWorldSolve.vmult(E.rotational,O),O.mult(A,O),z.wlambda.vadd(O,z.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(A,T){function n(A,T,z){E.call(this,A,T,-z,z),this.ri=new R,this.rj=new R,this.t=new R}T.exports=n;var E=A("./Equation"),R=A("../math/Vec3");A("../math/Mat3"),n.prototype=new E,n.prototype.constructor=n;var z=new R,O=new R;n.prototype.computeB=function(A){var T=(this.a,this.b),E=(this.bi,this.bj,this.ri),R=this.rj,V=z,U=O,H=this.t;E.cross(H,V),R.cross(H,U);var G=this.jacobianElementA,X=this.jacobianElementB;return H.negate(G.spatial),V.negate(G.rotational),X.spatial.copy(H),X.rotational.copy(U),-this.computeGW()*T-A*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(A,T){function n(A,T,z){var O=void 0!==(z=z||{}).maxForce?z.maxForce:1e6;R.call(this,A,T,-O,O),this.axisA=z.axisA?z.axisA.clone():new E(1,0,0),this.axisB=z.axisB?z.axisB.clone():new E(0,1,0),this.maxAngle=Math.PI/2}T.exports=n;var E=A("../math/Vec3"),R=(A("../math/Mat3"),A("./Equation"));n.prototype=new R,n.prototype.constructor=n;var z=new E,O=new E;n.prototype.computeB=function(A){var T=this.a,E=this.b,R=this.axisA,V=this.axisB,U=z,H=O,G=this.jacobianElementA,X=this.jacobianElementB;return R.cross(V,U),V.cross(R,H),G.rotational.copy(H),X.rotational.copy(U),-(Math.cos(this.maxAngle)-R.dot(V))*T-this.computeGW()*E-A*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(A,T){function n(A,T,z){z=void 0!==z?z:1e6,R.call(this,A,T,-z,z),this.axisA=new E,this.axisB=new E,this.targetVelocity=0}T.exports=n;var E=A("../math/Vec3"),R=(A("../math/Mat3"),A("./Equation"));n.prototype=new R,n.prototype.constructor=n,n.prototype.computeB=function(A){var T=(this.a,this.b),E=(this.bi,this.bj,this.axisA),R=this.axisB,z=this.jacobianElementA,O=this.jacobianElementB;return z.rotational.copy(E),R.negate(O.rotational),-(this.computeGW()-this.targetVelocity)*T-A*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(A,T){function n(A,T,R){R=E.defaults(R,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[A,T],this.friction=R.friction,this.restitution=R.restitution,this.contactEquationStiffness=R.contactEquationStiffness,this.contactEquationRelaxation=R.contactEquationRelaxation,this.frictionEquationStiffness=R.frictionEquationStiffness,this.frictionEquationRelaxation=R.frictionEquationRelaxation}var E=A("../utils/Utils");T.exports=n,n.idCounter=0},{"../utils/Utils":53}],25:[function(A,T){function n(A){var T="";"string"==typeof(A=A||{})?(T=A,A={}):"object"==typeof A&&(T=""),this.name=T,this.id=n.idCounter++,this.friction=void 0!==A.friction?A.friction:-1,this.restitution=void 0!==A.restitution?A.restitution:-1}T.exports=n,n.idCounter=0},{}],26:[function(A,T){function n(){this.spatial=new E,this.rotational=new E}T.exports=n;var E=A("./Vec3");n.prototype.multiplyElement=function(A){return A.spatial.dot(this.spatial)+A.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(A,T){return A.dot(this.spatial)+T.dot(this.rotational)}},{"./Vec3":30}],27:[function(A,T){function n(A){this.elements=A||[0,0,0,0,0,0,0,0,0]}T.exports=n;var E=A("./Vec3");n.prototype.identity=function(){var A=this.elements;A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=1,A[5]=0,A[6]=0,A[7]=0,A[8]=1},n.prototype.setZero=function(){var A=this.elements;A[0]=0,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=0,A[6]=0,A[7]=0,A[8]=0},n.prototype.setTrace=function(A){var T=this.elements;T[0]=A.x,T[4]=A.y,T[8]=A.z},n.prototype.getTrace=function(A){A=A||new E;var T=this.elements;A.x=T[0],A.y=T[4],A.z=T[8]},n.prototype.vmult=function(A,T){T=T||new E;var R=this.elements,z=A.x,O=A.y,V=A.z;return T.x=R[0]*z+R[1]*O+R[2]*V,T.y=R[3]*z+R[4]*O+R[5]*V,T.z=R[6]*z+R[7]*O+R[8]*V,T},n.prototype.smult=function(A){for(var T=0;T<this.elements.length;T++)this.elements[T]*=A},n.prototype.mmult=function(A,T){for(var E=T||new n,R=0;3>R;R++)for(var z=0;3>z;z++){for(var O=0,V=0;3>V;V++)O+=A.elements[R+3*V]*this.elements[V+3*z];E.elements[R+3*z]=O}return E},n.prototype.scale=function(A,T){T=T||new n;for(var E=this.elements,R=T.elements,z=0;3!==z;z++)R[3*z+0]=A.x*E[3*z+0],R[3*z+1]=A.y*E[3*z+1],R[3*z+2]=A.z*E[3*z+2];return T},n.prototype.solve=function(A,T){T=T||new E;for(var R=[],z=0;12>z;z++)R.push(0);var O;for(z=0;3>z;z++)for(O=0;3>O;O++)R[z+4*O]=this.elements[z+3*O];R[3]=A.x,R[7]=A.y,R[11]=A.z;var V,U,H=3,G=H;do{if(0===R[(z=G-H)+4*z])for(O=z+1;G>O;O++)if(0!==R[z+4*O]){V=4;do{R[(U=4-V)+4*z]+=R[U+4*O]}while(--V);break}if(0!==R[z+4*z])for(O=z+1;G>O;O++){var X=R[z+4*O]/R[z+4*z];V=4;do{R[(U=4-V)+4*O]=z>=U?0:R[U+4*O]-R[U+4*z]*X}while(--V)}}while(--H);if(T.z=R[11]/R[10],T.y=(R[7]-R[6]*T.z)/R[5],T.x=(R[3]-R[2]*T.z-R[1]*T.y)/R[0],isNaN(T.x)||isNaN(T.y)||isNaN(T.z)||1/0===T.x||1/0===T.y||1/0===T.z)throw"Could not solve equation! Got x=["+T.toString()+"], b=["+A.toString()+"], A=["+this.toString()+"]";return T},n.prototype.e=function(A,T,E){return void 0===E?this.elements[T+3*A]:void(this.elements[T+3*A]=E)},n.prototype.copy=function(A){for(var T=0;T<A.elements.length;T++)this.elements[T]=A.elements[T];return this},n.prototype.toString=function(){for(var A="",T=0;9>T;T++)A+=this.elements[T]+",";return A},n.prototype.reverse=function(A){A=A||new n;for(var T=[],E=0;18>E;E++)T.push(0);var R;for(E=0;3>E;E++)for(R=0;3>R;R++)T[E+6*R]=this.elements[E+3*R];T[3]=1,T[9]=0,T[15]=0,T[4]=0,T[10]=1,T[16]=0,T[5]=0,T[11]=0,T[17]=1;var z,O,V=3,U=V;do{if(0===T[(E=U-V)+6*E])for(R=E+1;U>R;R++)if(0!==T[E+6*R]){z=6;do{T[(O=6-z)+6*E]+=T[O+6*R]}while(--z);break}if(0!==T[E+6*E])for(R=E+1;U>R;R++){var H=T[E+6*R]/T[E+6*E];z=6;do{T[(O=6-z)+6*R]=E>=O?0:T[O+6*R]-T[O+6*E]*H}while(--z)}}while(--V);E=2;do{R=E-1;do{H=T[E+6*R]/T[E+6*E],z=6;do{T[(O=6-z)+6*R]=T[O+6*R]-T[O+6*E]*H}while(--z)}while(R--)}while(--E);E=2;do{H=1/T[E+6*E],z=6;do{T[(O=6-z)+6*E]=T[O+6*E]*H}while(--z)}while(E--);E=2;do{R=2;do{if(O=T[3+R+6*E],isNaN(O)||1/0===O)throw"Could not reverse! A=["+this.toString()+"]";A.e(E,R,O)}while(R--)}while(E--);return A},n.prototype.setRotationFromQuaternion=function(A){var T=A.x,E=A.y,R=A.z,z=A.w,O=T+T,V=E+E,U=R+R,H=T*O,G=T*V,X=T*U,Q=E*V,Z=E*U,K=R*U,J=z*O,$=z*V,et=z*U,nt=this.elements;return nt[0]=1-(Q+K),nt[1]=G-et,nt[2]=X+$,nt[3]=G+et,nt[4]=1-(H+K),nt[5]=Z-J,nt[6]=X-$,nt[7]=Z+J,nt[8]=1-(H+Q),this},n.prototype.transpose=function(A){for(var T=(A=A||new n).elements,E=this.elements,R=0;3!==R;R++)for(var z=0;3!==z;z++)T[3*R+z]=E[3*z+R];return A}},{"./Vec3":30}],28:[function(A,T){function n(A,T,E,R){this.x=void 0!==A?A:0,this.y=void 0!==T?T:0,this.z=void 0!==E?E:0,this.w=void 0!==R?R:1}T.exports=n;var E=A("./Vec3");n.prototype.set=function(A,T,E,R){this.x=A,this.y=T,this.z=E,this.w=R},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(A,T){var E=Math.sin(.5*T);this.x=A.x*E,this.y=A.y*E,this.z=A.z*E,this.w=Math.cos(.5*T)},n.prototype.toAxisAngle=function(A){A=A||new E,this.normalize();var T=2*Math.acos(this.w),R=Math.sqrt(1-this.w*this.w);return.001>R?(A.x=this.x,A.y=this.y,A.z=this.z):(A.x=this.x/R,A.y=this.y/R,A.z=this.z/R),[A,T]};var R=new E,z=new E;n.prototype.setFromVectors=function(A,T){if(A.isAntiparallelTo(T)){var E=R,O=z;A.tangents(E,O),this.setFromAxisAngle(E,Math.PI)}else{var V=A.cross(T);this.x=V.x,this.y=V.y,this.z=V.z,this.w=Math.sqrt(Math.pow(A.norm(),2)*Math.pow(T.norm(),2))+A.dot(T),this.normalize()}};var O=new E,V=new E,U=new E;n.prototype.mult=function(A,T){T=T||new n;var E=this.w,R=O,z=V,H=U;return R.set(this.x,this.y,this.z),z.set(A.x,A.y,A.z),T.w=E*A.w-R.dot(z),R.cross(z,H),T.x=E*z.x+A.w*R.x+H.x,T.y=E*z.y+A.w*R.y+H.y,T.z=E*z.z+A.w*R.z+H.z,T},n.prototype.inverse=function(A){var T=this.x,E=this.y,R=this.z,z=this.w;A=A||new n,this.conjugate(A);var O=1/(T*T+E*E+R*R+z*z);return A.x*=O,A.y*=O,A.z*=O,A.w*=O,A},n.prototype.conjugate=function(A){return(A=A||new n).x=-this.x,A.y=-this.y,A.z=-this.z,A.w=this.w,A},n.prototype.normalize=function(){var A=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===A?(this.x=0,this.y=0,this.z=0,this.w=0):(A=1/A,this.x*=A,this.y*=A,this.z*=A,this.w*=A)},n.prototype.normalizeFast=function(){var A=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===A?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=A,this.y*=A,this.z*=A,this.w*=A)},n.prototype.vmult=function(A,T){T=T||new E;var R=A.x,z=A.y,O=A.z,V=this.x,U=this.y,H=this.z,G=this.w,X=G*R+U*O-H*z,Q=G*z+H*R-V*O,Z=G*O+V*z-U*R,K=-V*R-U*z-H*O;return T.x=X*G+K*-V+Q*-H-Z*-U,T.y=Q*G+K*-U+Z*-V-X*-H,T.z=Z*G+K*-H+X*-U-Q*-V,T},n.prototype.copy=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this.w=A.w,this},n.prototype.toEuler=function(A,T){T=T||"YZX";var E,R,z,O=this.x,V=this.y,U=this.z,H=this.w;if("YZX"!==T)throw new Error("Euler order "+T+" not supported yet.");var G=O*V+U*H;if(G>.499&&(E=2*Math.atan2(O,H),R=Math.PI/2,z=0),-.499>G&&(E=-2*Math.atan2(O,H),R=-Math.PI/2,z=0),isNaN(E)){var X=O*O,Q=V*V,Z=U*U;E=Math.atan2(2*V*H-2*O*U,1-2*Q-2*Z),R=Math.asin(2*G),z=Math.atan2(2*O*H-2*V*U,1-2*X-2*Z)}A.y=E,A.z=R,A.x=z},n.prototype.setFromEuler=function(A,T,E,R){R=R||"XYZ";var z=Math.cos(A/2),O=Math.cos(T/2),V=Math.cos(E/2),U=Math.sin(A/2),H=Math.sin(T/2),G=Math.sin(E/2);return"XYZ"===R?(this.x=U*O*V+z*H*G,this.y=z*H*V-U*O*G,this.z=z*O*G+U*H*V,this.w=z*O*V-U*H*G):"YXZ"===R?(this.x=U*O*V+z*H*G,this.y=z*H*V-U*O*G,this.z=z*O*G-U*H*V,this.w=z*O*V+U*H*G):"ZXY"===R?(this.x=U*O*V-z*H*G,this.y=z*H*V+U*O*G,this.z=z*O*G+U*H*V,this.w=z*O*V-U*H*G):"ZYX"===R?(this.x=U*O*V-z*H*G,this.y=z*H*V+U*O*G,this.z=z*O*G-U*H*V,this.w=z*O*V+U*H*G):"YZX"===R?(this.x=U*O*V+z*H*G,this.y=z*H*V+U*O*G,this.z=z*O*G-U*H*V,this.w=z*O*V-U*H*G):"XZY"===R&&(this.x=U*O*V-z*H*G,this.y=z*H*V-U*O*G,this.z=z*O*G+U*H*V,this.w=z*O*V+U*H*G),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(A,T){function n(A){A=A||{},this.position=new E,A.position&&this.position.copy(A.position),this.quaternion=new R,A.quaternion&&this.quaternion.copy(A.quaternion)}var E=A("./Vec3"),R=A("./Quaternion");T.exports=n;var z=new R;n.pointToLocalFrame=function(A,T,R,O){return O=O||new E,R.vsub(A,O),T.conjugate(z),z.vmult(O,O),O},n.prototype.pointToLocal=function(A,T){return n.pointToLocalFrame(this.position,this.quaternion,A,T)},n.pointToWorldFrame=function(A,T,R,z){return z=z||new E,T.vmult(R,z),z.vadd(A,z),z},n.prototype.pointToWorld=function(A,T){return n.pointToWorldFrame(this.position,this.quaternion,A,T)},n.prototype.vectorToWorldFrame=function(A,T){return T=T||new E,this.quaternion.vmult(A,T),T},n.vectorToWorldFrame=function(A,T,E){return A.vmult(T,E),E},n.vectorToLocalFrame=function(A,T,R,z){return z=z||new E,T.w*=-1,T.vmult(R,z),T.w*=-1,z}},{"./Quaternion":28,"./Vec3":30}],30:[function(A,T){function n(A,T,E){this.x=A||0,this.y=T||0,this.z=E||0}T.exports=n;var E=A("./Mat3");n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(A,T){var E=A.x,R=A.y,z=A.z,O=this.x,V=this.y,U=this.z;return(T=T||new n).x=V*z-U*R,T.y=U*E-O*z,T.z=O*R-V*E,T},n.prototype.set=function(A,T,E){return this.x=A,this.y=T,this.z=E,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(A,T){return T?(T.x=A.x+this.x,T.y=A.y+this.y,void(T.z=A.z+this.z)):new n(this.x+A.x,this.y+A.y,this.z+A.z)},n.prototype.vsub=function(A,T){return T?(T.x=this.x-A.x,T.y=this.y-A.y,void(T.z=this.z-A.z)):new n(this.x-A.x,this.y-A.y,this.z-A.z)},n.prototype.crossmat=function(){return new E([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var A=this.x,T=this.y,E=this.z,R=Math.sqrt(A*A+T*T+E*E);if(R>0){var z=1/R;this.x*=z,this.y*=z,this.z*=z}else this.x=0,this.y=0,this.z=0;return R},n.prototype.unit=function(A){A=A||new n;var T=this.x,E=this.y,R=this.z,z=Math.sqrt(T*T+E*E+R*R);return z>0?(z=1/z,A.x=T*z,A.y=E*z,A.z=R*z):(A.x=1,A.y=0,A.z=0),A},n.prototype.norm=function(){var A=this.x,T=this.y,E=this.z;return Math.sqrt(A*A+T*T+E*E)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(A){var T=this.x,E=this.y,R=this.z,z=A.x,O=A.y,V=A.z;return Math.sqrt((z-T)*(z-T)+(O-E)*(O-E)+(V-R)*(V-R))},n.prototype.distanceSquared=function(A){var T=this.x,E=this.y,R=this.z,z=A.x,O=A.y,V=A.z;return(z-T)*(z-T)+(O-E)*(O-E)+(V-R)*(V-R)},n.prototype.mult=function(A,T){T=T||new n;var E=this.x,R=this.y,z=this.z;return T.x=A*E,T.y=A*R,T.z=A*z,T},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(A){return this.x*A.x+this.y*A.y+this.z*A.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(A){return(A=A||new n).x=-this.x,A.y=-this.y,A.z=-this.z,A};var R=new n,z=new n;n.prototype.tangents=function(A,T){var E=this.norm();if(E>0){var O=R,V=1/E;O.set(this.x*V,this.y*V,this.z*V);var U=z;Math.abs(O.x)<.9?(U.set(1,0,0),O.cross(U,A)):(U.set(0,1,0),O.cross(U,A)),O.cross(A,T)}else A.set(1,0,0),T.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this},n.prototype.lerp=function(A,T,E){var R=this.x,z=this.y,O=this.z;E.x=R+(A.x-R)*T,E.y=z+(A.y-z)*T,E.z=O+(A.z-O)*T},n.prototype.almostEquals=function(A,T){return void 0===T&&(T=1e-6),!(Math.abs(this.x-A.x)>T||Math.abs(this.y-A.y)>T||Math.abs(this.z-A.z)>T)},n.prototype.almostZero=function(A){return void 0===A&&(A=1e-6),!(Math.abs(this.x)>A||Math.abs(this.y)>A||Math.abs(this.z)>A)};var O=new n;n.prototype.isAntiparallelTo=function(A,T){return this.negate(O),O.almostEquals(A,T)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(A,T){function n(A){A=A||{},E.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new R,this.collisionFilterGroup="number"==typeof A.collisionFilterGroup?A.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof A.collisionFilterMask?A.collisionFilterMask:1,this.collisionResponse=!0,this.position=new R,A.position&&this.position.copy(A.position),this.previousPosition=new R,this.initPosition=new R,this.velocity=new R,A.velocity&&this.velocity.copy(A.velocity),this.initVelocity=new R,this.force=new R;var T="number"==typeof A.mass?A.mass:0;this.mass=T,this.invMass=T>0?1/T:0,this.material=A.material||null,this.linearDamping="number"==typeof A.linearDamping?A.linearDamping:.01,this.type=0>=T?n.STATIC:n.DYNAMIC,typeof A.type==typeof n.STATIC&&(this.type=A.type),this.allowSleep=void 0===A.allowSleep||A.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==A.sleepSpeedLimit?A.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==A.sleepTimeLimit?A.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new R,this.quaternion=new O,A.quaternion&&this.quaternion.copy(A.quaternion),this.initQuaternion=new O,this.angularVelocity=new R,A.angularVelocity&&this.angularVelocity.copy(A.angularVelocity),this.initAngularVelocity=new R,this.interpolatedPosition=new R,this.interpolatedQuaternion=new O,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new R,this.invInertia=new R,this.invInertiaWorld=new z,this.invMassSolve=0,this.invInertiaSolve=new R,this.invInertiaWorldSolve=new z,this.fixedRotation=void 0!==A.fixedRotation&&A.fixedRotation,this.angularDamping=void 0!==A.angularDamping?A.angularDamping:.01,this.aabb=new V,this.aabbNeedsUpdate=!0,this.wlambda=new R,A.shape&&this.addShape(A.shape),this.updateMassProperties()}T.exports=n;var E=A("../utils/EventTarget"),R=(A("../shapes/Shape"),A("../math/Vec3")),z=A("../math/Mat3"),O=A("../math/Quaternion"),V=(A("../material/Material"),A("../collision/AABB")),U=A("../shapes/Box");n.prototype=new E,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var A=this.sleepState;this.sleepState=0,A===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(A){if(this.allowSleep){var T=this.sleepState,E=this.velocity.norm2()+this.angularVelocity.norm2(),R=Math.pow(this.sleepSpeedLimit,2);T===n.AWAKE&&R>E?(this.sleepState=n.SLEEPY,this.timeLastSleepy=A,this.dispatchEvent(n.sleepyEvent)):T===n.SLEEPY&&E>R?this.wakeUp():T===n.SLEEPY&&A-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(A,T){return T=T||new R,A.vsub(this.position,T),this.quaternion.conjugate().vmult(T,T),T},n.prototype.vectorToLocalFrame=function(A,T){return T=T||new R,this.quaternion.conjugate().vmult(A,T),T},n.prototype.pointToWorldFrame=function(A,T){return T=T||new R,this.quaternion.vmult(A,T),T.vadd(this.position,T),T},n.prototype.vectorToWorldFrame=function(A,T){return T=T||new R,this.quaternion.vmult(A,T),T};var H=new R,G=new O;n.prototype.addShape=function(A,T,E){var z=new R,V=new O;return T&&z.copy(T),E&&V.copy(E),this.shapes.push(A),this.shapeOffsets.push(z),this.shapeOrientations.push(V),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var A=this.shapes,T=this.shapeOffsets,E=A.length,R=0,z=0;z!==E;z++){var O=A[z];O.updateBoundingSphereRadius();var V=T[z].norm(),U=O.boundingSphereRadius;V+U>R&&(R=V+U)}this.boundingRadius=R};var X=new V;n.prototype.computeAABB=function(){for(var A=this.shapes,T=this.shapeOffsets,E=this.shapeOrientations,R=A.length,z=H,O=G,V=this.quaternion,U=this.aabb,Q=X,Z=0;Z!==R;Z++){var K=A[Z];E[Z].mult(V,O),O.vmult(T[Z],z),z.vadd(this.position,z),K.calculateWorldAABB(z,O,Q.lowerBound,Q.upperBound),0===Z?U.copy(Q):U.extend(Q)}this.aabbNeedsUpdate=!1};var Q=new z,Z=new z;new z,n.prototype.updateInertiaWorld=function(A){var T=this.invInertia;if(T.x!==T.y||T.y!==T.z||A){var E=Q,R=Z;E.setRotationFromQuaternion(this.quaternion),E.transpose(R),E.scale(T,E),E.mmult(R,this.invInertiaWorld)}};var K=new R,J=new R;n.prototype.applyForce=function(A,T){if(this.type===n.DYNAMIC){var E=K;T.vsub(this.position,E);var R=J;E.cross(A,R),this.force.vadd(A,this.force),this.torque.vadd(R,this.torque)}};var $=new R,et=new R;n.prototype.applyLocalForce=function(A,T){if(this.type===n.DYNAMIC){var E=$,R=et;this.vectorToWorldFrame(A,E),this.pointToWorldFrame(T,R),this.applyForce(E,R)}};var nt=new R,ot=new R,it=new R;n.prototype.applyImpulse=function(A,T){if(this.type===n.DYNAMIC){var E=nt;T.vsub(this.position,E);var R=ot;R.copy(A),R.mult(this.invMass,R),this.velocity.vadd(R,this.velocity);var z=it;E.cross(A,z),this.invInertiaWorld.vmult(z,z),this.angularVelocity.vadd(z,this.angularVelocity)}};var rt=new R,st=new R;n.prototype.applyLocalImpulse=function(A,T){if(this.type===n.DYNAMIC){var E=rt,R=st;this.vectorToWorldFrame(A,E),this.pointToWorldFrame(T,R),this.applyImpulse(E,R)}};var at=new R;n.prototype.updateMassProperties=function(){var A=at;this.invMass=this.mass>0?1/this.mass:0;var T=this.inertia,E=this.fixedRotation;this.computeAABB(),A.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),U.calculateInertia(A,this.mass,T),this.invInertia.set(T.x>0&&!E?1/T.x:0,T.y>0&&!E?1/T.y:0,T.z>0&&!E?1/T.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(A,T){var E=new R;return A.vsub(this.position,E),this.angularVelocity.cross(E,T),this.velocity.vadd(T,T),T}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(A,T){function n(A){this.chassisBody=A.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==A.indexRightAxis?A.indexRightAxis:1,this.indexForwardAxis=void 0!==A.indexForwardAxis?A.indexForwardAxis:0,this.indexUpAxis=void 0!==A.indexUpAxis?A.indexUpAxis:2}function o(A,T,E,R,z){var O=0,V=E,U=$,H=et,G=nt;return A.getVelocityAtWorldPoint(V,U),T.getVelocityAtWorldPoint(V,H),U.vsub(H,G),(O=-R.dot(G)*(1/(d(A,E,R)+d(T,E,R))))>z&&(O=z),-z>O&&(O=-z),O}function d(A,T,E){var R=ot,z=it,O=rt,V=st;return T.vsub(A.position,R),R.cross(E,z),A.invInertiaWorld.vmult(z,V),V.cross(R,O),A.invMass+E.dot(O)}function i(A,T,E,R,z,O){if(z.norm2()>1.1)return 0;var V=at,U=ut,H=lt;return A.getVelocityAtWorldPoint(T,V),E.getVelocityAtWorldPoint(R,U),V.vsub(U,H),-.2*z.dot(H)*(1/(A.invMass+E.invMass))}var E=(A("./Body"),A("../math/Vec3")),R=A("../math/Quaternion"),z=(A("../collision/RaycastResult"),A("../collision/Ray")),O=A("../objects/WheelInfo");T.exports=n;var V=(new E,new E,new E,new E),U=new E,H=new E;new z,n.prototype.addWheel=function(A){var T=new O(A=A||{}),E=this.wheelInfos.length;return this.wheelInfos.push(T),E},n.prototype.setSteeringValue=function(A,T){this.wheelInfos[T].steering=A},new E,n.prototype.applyEngineForce=function(A,T){this.wheelInfos[T].engineForce=A},n.prototype.setBrake=function(A,T){this.wheelInfos[T].brake=A},n.prototype.addToWorld=function(A){this.constraints,A.add(this.chassisBody);var T=this;this.preStepCallback=function(){T.updateVehicle(A.dt)},A.addEventListener("preStep",this.preStepCallback),this.world=A},n.prototype.getVehicleAxisWorld=function(A,T){T.set(0===A?1:0,1===A?1:0,2===A?1:0),this.chassisBody.vectorToWorldFrame(T,T)},n.prototype.updateVehicle=function(A){for(var T=this.wheelInfos,R=T.length,z=this.chassisBody,O=0;R>O;O++)this.updateWheelTransform(O);this.currentVehicleSpeedKmHour=3.6*z.velocity.norm();var V=new E;for(this.getVehicleAxisWorld(this.indexForwardAxis,V),V.dot(z.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),O=0;R>O;O++)this.castRay(T[O]);this.updateSuspension(A);var U=new E,H=new E;for(O=0;R>O;O++){var G=(K=T[O]).suspensionForce;G>K.maxSuspensionForce&&(G=K.maxSuspensionForce),K.raycastResult.hitNormalWorld.scale(G*A,U),K.raycastResult.hitPointWorld.vsub(z.position,H),z.applyImpulse(U,K.raycastResult.hitPointWorld)}this.updateFriction(A);var X=new E,Q=new E,Z=new E;for(O=0;R>O;O++){var K=T[O];z.getVelocityAtWorldPoint(K.chassisConnectionPointWorld,Z);var J=1;if(1===this.indexUpAxis&&(J=-1),K.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,Q);var $=Q.dot(K.raycastResult.hitNormalWorld);K.raycastResult.hitNormalWorld.scale($,X),Q.vsub(X,Q);var et=Q.dot(Z);K.deltaRotation=J*et*A/K.radius}!K.sliding&&K.isInContact||0===K.engineForce||!K.useCustomSlidingRotationalSpeed||(K.deltaRotation=(K.engineForce>0?1:-1)*K.customSlidingRotationalSpeed*A),Math.abs(K.brake)>Math.abs(K.engineForce)&&(K.deltaRotation=0),K.rotation+=K.deltaRotation,K.deltaRotation*=.99}},n.prototype.updateSuspension=function(){for(var A=this.chassisBody.mass,T=this.wheelInfos,E=T.length,R=0;E>R;R++){var z=T[R];if(z.isInContact){var O,V=z.suspensionRestLength-z.suspensionLength;O=z.suspensionStiffness*V*z.clippedInvContactDotSuspension;var U=z.suspensionRelativeVelocity;O-=(0>U?z.dampingCompression:z.dampingRelaxation)*U,z.suspensionForce=O*A,z.suspensionForce<0&&(z.suspensionForce=0)}else z.suspensionForce=0}},n.prototype.removeFromWorld=function(A){this.constraints,A.remove(this.chassisBody),A.removeEventListener("preStep",this.preStepCallback),this.world=null};var G=new E,X=new E;n.prototype.castRay=function(A){var T=G,R=X;this.updateWheelTransformWorld(A);var z=this.chassisBody,O=-1,V=A.suspensionRestLength+A.radius;A.directionWorld.scale(V,T);var U=A.chassisConnectionPointWorld;U.vadd(T,R);var H=A.raycastResult;H.reset();var Q=z.collisionResponse;z.collisionResponse=!1,this.world.rayTest(U,R,H),z.collisionResponse=Q;var Z=H.body;if(A.raycastResult.groundObject=0,Z){O=H.distance,A.raycastResult.hitNormalWorld=H.hitNormalWorld,A.isInContact=!0;var K=H.distance;A.suspensionLength=K-A.radius;var J=A.suspensionRestLength-A.maxSuspensionTravel,$=A.suspensionRestLength+A.maxSuspensionTravel;A.suspensionLength<J&&(A.suspensionLength=J),A.suspensionLength>$&&(A.suspensionLength=$,A.raycastResult.reset());var et=A.raycastResult.hitNormalWorld.dot(A.directionWorld),nt=new E;z.getVelocityAtWorldPoint(A.raycastResult.hitPointWorld,nt);var ot=A.raycastResult.hitNormalWorld.dot(nt);if(et>=-.1)A.suspensionRelativeVelocity=0,A.clippedInvContactDotSuspension=10;else{var it=-1/et;A.suspensionRelativeVelocity=ot*it,A.clippedInvContactDotSuspension=it}}else A.suspensionLength=A.suspensionRestLength+0*A.maxSuspensionTravel,A.suspensionRelativeVelocity=0,A.directionWorld.scale(-1,A.raycastResult.hitNormalWorld),A.clippedInvContactDotSuspension=1;return O},n.prototype.updateWheelTransformWorld=function(A){A.isInContact=!1;var T=this.chassisBody;T.pointToWorldFrame(A.chassisConnectionPointLocal,A.chassisConnectionPointWorld),T.vectorToWorldFrame(A.directionLocal,A.directionWorld),T.vectorToWorldFrame(A.axleLocal,A.axleWorld)},n.prototype.updateWheelTransform=function(A){var T=V,E=U,z=H,O=this.wheelInfos[A];this.updateWheelTransformWorld(O),O.directionLocal.scale(-1,T),E.copy(O.axleLocal),T.cross(E,z),z.normalize(),E.normalize();var G=O.steering,X=new R;X.setFromAxisAngle(T,G);var Q=new R;Q.setFromAxisAngle(E,O.rotation);var Z=O.worldTransform.quaternion;this.chassisBody.quaternion.mult(X,Z),Z.mult(Q,Z),Z.normalize();var K=O.worldTransform.position;K.copy(O.directionWorld),K.scale(O.suspensionLength,K),K.vadd(O.chassisConnectionPointWorld,K)};var Q=[new E(1,0,0),new E(0,1,0),new E(0,0,1)];n.prototype.getWheelTransformWorld=function(A){return this.wheelInfos[A].worldTransform};var Z=new E,K=[],J=[];n.prototype.updateFriction=function(A){for(var T=Z,R=this.wheelInfos,z=R.length,O=this.chassisBody,V=J,U=K,H=0;z>H;H++)et=(ht=R[H]).raycastResult.body,ht.sideImpulse=0,ht.forwardImpulse=0,V[H]||(V[H]=new E),U[H]||(U[H]=new E);for(H=0;z>H;H++)if(et=(ht=R[H]).raycastResult.body){var G=U[H];this.getWheelTransformWorld(H).vectorToWorldFrame(Q[this.indexRightAxis],G);var X=ht.raycastResult.hitNormalWorld,$=G.dot(X);X.scale($,T),G.vsub(T,G),G.normalize(),X.cross(G,V[H]),V[H].normalize(),ht.sideImpulse=i(O,ht.raycastResult.hitPointWorld,et,ht.raycastResult.hitPointWorld,G),ht.sideImpulse*=1}for(this.sliding=!1,H=0;z>H;H++){var et=(ht=R[H]).raycastResult.body,nt=0;if(ht.slipInfo=1,et){var ot=ht.brake?ht.brake:0;nt=o(O,et,ht.raycastResult.hitPointWorld,V[H],ot);var it=ot/(nt+=ht.engineForce*A);ht.slipInfo*=it}if(ht.forwardImpulse=0,ht.skidInfo=1,et){ht.skidInfo=1;var rt=ht.suspensionForce*A*ht.frictionSlip,st=rt*rt;ht.forwardImpulse=nt;var at=.5*ht.forwardImpulse,ut=1*ht.sideImpulse,lt=at*at+ut*ut;ht.sliding=!1,lt>st&&(this.sliding=!0,ht.sliding=!0,it=rt/Math.sqrt(lt),ht.skidInfo*=it)}}if(this.sliding)for(H=0;z>H;H++)0!==(ht=R[H]).sideImpulse&&ht.skidInfo<1&&(ht.forwardImpulse*=ht.skidInfo,ht.sideImpulse*=ht.skidInfo);for(H=0;z>H;H++){var ht=R[H],ct=new E;if(ct.copy(ht.raycastResult.hitPointWorld),0!==ht.forwardImpulse){var pt=new E;V[H].scale(ht.forwardImpulse,pt),O.applyImpulse(pt,ct)}if(0!==ht.sideImpulse){et=ht.raycastResult.body;var dt=new E;dt.copy(ht.raycastResult.hitPointWorld);var ft=new E;U[H].scale(ht.sideImpulse,ft),O.pointToLocalFrame(ct,ct),ct["xyz"[this.indexUpAxis]]*=ht.rollInfluence,O.pointToWorldFrame(ct,ct),O.applyImpulse(ft,ct),ft.scale(-1,ft),et.applyImpulse(ft,dt)}}};var $=new E,et=new E,nt=new E,ot=new E,it=new E,rt=new E,st=new E,at=new E,ut=new E,lt=new E},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(A,T){function n(A){if(this.wheelBodies=[],this.coordinateSystem=void 0===A.coordinateSystem?new O(1,2,3):A.coordinateSystem.clone(),this.chassisBody=A.chassisBody,!this.chassisBody){var T=new z(new O(5,2,.5));this.chassisBody=new E(1,T)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var E=A("./Body"),R=A("../shapes/Sphere"),z=A("../shapes/Box"),O=A("../math/Vec3"),V=A("../constraints/HingeConstraint");T.exports=n,n.prototype.addWheel=function(A){var T=(A=A||{}).body;T||(T=new E(1,new R(1.2))),this.wheelBodies.push(T),this.wheelForces.push(0);var z=(new O,void 0!==A.position?A.position.clone():new O),U=new O;this.chassisBody.pointToWorldFrame(z,U),T.position.set(U.x,U.y,U.z);var H=void 0!==A.axis?A.axis.clone():new O(0,1,0);this.wheelAxes.push(H);var G=new V(this.chassisBody,T,{pivotA:z,axisA:H,pivotB:O.ZERO,axisB:H,collideConnected:!1});return this.constraints.push(G),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(A,T){var E=this.wheelAxes[T],R=Math.cos(A),z=Math.sin(A),O=E.x,V=E.y;this.constraints[T].axisA.set(R*O-z*V,z*O+R*V,0)},n.prototype.setMotorSpeed=function(A,T){var E=this.constraints[T];E.enableMotor(),E.motorTargetVelocity=A},n.prototype.disableMotor=function(A){this.constraints[A].disableMotor()};var U=new O;n.prototype.setWheelForce=function(A,T){this.wheelForces[T]=A},n.prototype.applyWheelForce=function(A,T){var E=this.wheelAxes[T],R=this.wheelBodies[T],z=R.torque;E.scale(A,U),R.vectorToWorldFrame(U,U),z.vadd(U,z)},n.prototype.addToWorld=function(A){for(var T=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)A.add(E[R]);for(R=0;R<T.length;R++)A.addConstraint(T[R]);A.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var A=this.wheelForces,T=0;T<A.length;T++)this.applyWheelForce(A[T],T)},n.prototype.removeFromWorld=function(A){for(var T=this.constraints,E=this.wheelBodies.concat([this.chassisBody]),R=0;R<E.length;R++)A.remove(E[R]);for(R=0;R<T.length;R++)A.removeConstraint(T[R])};var H=new O;n.prototype.getWheelSpeed=function(A){var T=this.wheelAxes[A],E=this.wheelBodies[A].angularVelocity;return this.chassisBody.vectorToWorldFrame(T,H),E.dot(H)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(A,T){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}T.exports=n;var E=(A("../shapes/Shape"),A("../math/Vec3"));A("../math/Quaternion"),A("../shapes/Particle"),A("../objects/Body"),A("../material/Material"),n.prototype.add=function(A){this.particles.push(A),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(A){var T=this.particles.indexOf(A);-1!==T&&(this.particles.splice(T,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var R=new E;n.prototype.getNeighbors=function(A,T){for(var E=this.particles.length,z=A.id,O=this.smoothingRadius*this.smoothingRadius,V=R,U=0;U!==E;U++){var H=this.particles[U];H.position.vsub(A.position,V),z!==H.id&&V.norm2()<O&&T.push(H)}};var z=new E,O=new E,V=new E,U=new E,H=new E,G=new E;n.prototype.update=function(){for(var A=this.particles.length,T=z,E=this.speedOfSound,R=this.eps,X=0;X!==A;X++){var Q=this.particles[X];(lt=this.neighbors[X]).length=0,this.getNeighbors(Q,lt),lt.push(this.particles[X]);for(var Z=lt.length,K=0,J=0;J!==Z;J++){Q.position.vsub(lt[J].position,T);var $=T.norm(),et=this.w($);K+=lt[J].mass*et}this.densities[X]=K,this.pressures[X]=E*E*(this.densities[X]-this.density)}var nt=O,ot=V,it=U,rt=H,st=G;for(X=0;X!==A;X++){var at,ut,lt,ht=this.particles[X];for(nt.set(0,0,0),ot.set(0,0,0),Z=(lt=this.neighbors[X]).length,J=0;J!==Z;J++){var ct=lt[J];ht.position.vsub(ct.position,rt);var pt=rt.norm();at=-ct.mass*(this.pressures[X]/(this.densities[X]*this.densities[X]+R)+this.pressures[J]/(this.densities[J]*this.densities[J]+R)),this.gradw(rt,it),it.mult(at,it),nt.vadd(it,nt),ct.velocity.vsub(ht.velocity,st),st.mult(1/(1e-4+this.densities[X]*this.densities[J])*this.viscosity*ct.mass,st),ut=this.nablaw(pt),st.mult(ut,st),ot.vadd(st,ot)}ot.mult(ht.mass,ot),nt.mult(ht.mass,nt),ht.force.vadd(ot,ht.force),ht.force.vadd(nt,ht.force)}},n.prototype.w=function(A){var T=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(T,9))*Math.pow(T*T-A*A,3)},n.prototype.gradw=function(A,T){var E=A.norm(),R=this.smoothingRadius;A.mult(945/(32*Math.PI*Math.pow(R,9))*Math.pow(R*R-E*E,2),T)},n.prototype.nablaw=function(A){var T=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(T,9))*(T*T-A*A)*(7*A*A-3*T*T)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(A,T){function n(A,T,R){R=R||{},this.restLength="number"==typeof R.restLength?R.restLength:1,this.stiffness=R.stiffness||100,this.damping=R.damping||1,this.bodyA=A,this.bodyB=T,this.localAnchorA=new E,this.localAnchorB=new E,R.localAnchorA&&this.localAnchorA.copy(R.localAnchorA),R.localAnchorB&&this.localAnchorB.copy(R.localAnchorB),R.worldAnchorA&&this.setWorldAnchorA(R.worldAnchorA),R.worldAnchorB&&this.setWorldAnchorB(R.worldAnchorB)}var E=A("../math/Vec3");T.exports=n,n.prototype.setWorldAnchorA=function(A){this.bodyA.pointToLocalFrame(A,this.localAnchorA)},n.prototype.setWorldAnchorB=function(A){this.bodyB.pointToLocalFrame(A,this.localAnchorB)},n.prototype.getWorldAnchorA=function(A){this.bodyA.pointToWorldFrame(this.localAnchorA,A)},n.prototype.getWorldAnchorB=function(A){this.bodyB.pointToWorldFrame(this.localAnchorB,A)};var R=new E,z=new E,O=new E,V=new E,U=new E,H=new E,G=new E,X=new E,Q=new E,Z=new E,K=new E;n.prototype.applyForce=function(){var A=this.stiffness,T=this.damping,E=this.restLength,J=this.bodyA,$=this.bodyB,et=R,nt=z,ot=O,it=V,rt=K,st=U,at=H,ut=G,lt=X,ht=Q,ct=Z;this.getWorldAnchorA(st),this.getWorldAnchorB(at),st.vsub(J.position,ut),at.vsub($.position,lt),at.vsub(st,et);var pt=et.norm();nt.copy(et),nt.normalize(),$.velocity.vsub(J.velocity,ot),$.angularVelocity.cross(lt,rt),ot.vadd(rt,ot),J.angularVelocity.cross(ut,rt),ot.vsub(rt,ot),nt.mult(-A*(pt-E)-T*ot.dot(nt),it),J.force.vsub(it,J.force),$.force.vadd(it,$.force),ut.cross(it,ht),lt.cross(it,ct),J.torque.vsub(ht,J.torque),$.torque.vadd(ct,$.torque)}},{"../math/Vec3":30}],36:[function(A,T){function n(A){A=O.defaults(A,{chassisConnectionPointLocal:new E,chassisConnectionPointWorld:new E,directionLocal:new E,directionWorld:new E,axleLocal:new E,axleWorld:new E,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=A.maxSuspensionTravel,this.customSlidingRotationalSpeed=A.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=A.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=A.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=A.chassisConnectionPointWorld.clone(),this.directionLocal=A.directionLocal.clone(),this.directionWorld=A.directionWorld.clone(),this.axleLocal=A.axleLocal.clone(),this.axleWorld=A.axleWorld.clone(),this.suspensionRestLength=A.suspensionRestLength,this.suspensionMaxLength=A.suspensionMaxLength,this.radius=A.radius,this.suspensionStiffness=A.suspensionStiffness,this.dampingCompression=A.dampingCompression,this.dampingRelaxation=A.dampingRelaxation,this.frictionSlip=A.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=A.rollInfluence,this.maxSuspensionForce=A.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=A.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new z,this.worldTransform=new R,this.isInContact=!1}var E=A("../math/Vec3"),R=A("../math/Transform"),z=A("../collision/RaycastResult"),O=A("../utils/Utils");T.exports=n;var V=new E,U=new E;V=new E,n.prototype.updateWheel=function(A){var T=this.raycastResult;if(this.isInContact){var E=T.hitNormalWorld.dot(T.directionWorld);T.hitPointWorld.vsub(A.position,U),A.getVelocityAtWorldPoint(U,V);var R=T.hitNormalWorld.dot(V);if(E>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var z=-1/E;this.suspensionRelativeVelocity=R*z,this.clippedInvContactDotSuspension=z}}else T.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,T.directionWorld.scale(-1,T.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(A,T){function n(A){E.call(this),this.type=E.types.BOX,this.halfExtents=A,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3"),z=A("./ConvexPolyhedron");n.prototype=new E,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var A=this.halfExtents.x,T=this.halfExtents.y,E=this.halfExtents.z,O=R,V=[new O(-A,-T,-E),new O(A,-T,-E),new O(A,T,-E),new O(-A,T,-E),new O(-A,-T,E),new O(A,-T,E),new O(A,T,E),new O(-A,T,E)],U=(new O(0,0,1),new O(0,1,0),new O(1,0,0),new z(V,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=U,U.material=this.material},n.prototype.calculateLocalInertia=function(A,T){return T=T||new R,n.calculateInertia(this.halfExtents,A,T),T},n.calculateInertia=function(A,T,E){var R=A;E.x=1/12*T*(2*R.y*2*R.y+2*R.z*2*R.z),E.y=1/12*T*(2*R.x*2*R.x+2*R.z*2*R.z),E.z=1/12*T*(2*R.y*2*R.y+2*R.x*2*R.x)},n.prototype.getSideNormals=function(A,T){var E=A,R=this.halfExtents;if(E[0].set(R.x,0,0),E[1].set(0,R.y,0),E[2].set(0,0,R.z),E[3].set(-R.x,0,0),E[4].set(0,-R.y,0),E[5].set(0,0,-R.z),void 0!==T)for(var z=0;z!==E.length;z++)T.vmult(E[z],E[z]);return E},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var O=new R;new R,n.prototype.forEachWorldCorner=function(A,T,E){for(var R=this.halfExtents,z=[[R.x,R.y,R.z],[-R.x,R.y,R.z],[-R.x,-R.y,R.z],[-R.x,-R.y,-R.z],[R.x,-R.y,-R.z],[R.x,R.y,-R.z],[-R.x,R.y,-R.z],[R.x,-R.y,R.z]],V=0;V<z.length;V++)O.set(z[V][0],z[V][1],z[V][2]),T.vmult(O,O),A.vadd(O,O),E(O.x,O.y,O.z)};var V=[new R,new R,new R,new R,new R,new R,new R,new R];n.prototype.calculateWorldAABB=function(A,T,E,R){var z=this.halfExtents;V[0].set(z.x,z.y,z.z),V[1].set(-z.x,z.y,z.z),V[2].set(-z.x,-z.y,z.z),V[3].set(-z.x,-z.y,-z.z),V[4].set(z.x,-z.y,-z.z),V[5].set(z.x,z.y,-z.z),V[6].set(-z.x,z.y,-z.z),V[7].set(z.x,-z.y,z.z);var O=V[0];T.vmult(O,O),A.vadd(O,O),R.copy(O),E.copy(O);for(var U=1;8>U;U++){O=V[U],T.vmult(O,O),A.vadd(O,O);var H=O.x,G=O.y,X=O.z;H>R.x&&(R.x=H),G>R.y&&(R.y=G),X>R.z&&(R.z=X),H<E.x&&(E.x=H),G<E.y&&(E.y=G),X<E.z&&(E.z=X)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(A,T){function n(A,T,R){E.call(this),this.type=E.types.CONVEXPOLYHEDRON,this.vertices=A||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=T||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=R?R.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3"),z=(A("../math/Quaternion"),A("../math/Transform"));n.prototype=new E,n.prototype.constructor=n;var O=new R;n.prototype.computeEdges=function(){var A=this.faces,T=this.vertices,E=(T.length,this.uniqueEdges);E.length=0;for(var R=O,z=0;z!==A.length;z++)for(var V=A[z],U=V.length,H=0;H!==U;H++){var G=(H+1)%U;T[V[H]].vsub(T[V[G]],R),R.normalize();for(var X=!1,Q=0;Q!==E.length;Q++)if(E[Q].almostEquals(R)||E[Q].almostEquals(R)){X=!0;break}X||E.push(R.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var A=0;A<this.faces.length;A++){for(var T=0;T<this.faces[A].length;T++)if(!this.vertices[this.faces[A][T]])throw new Error("Vertex "+this.faces[A][T]+" not found!");var E=this.faceNormals[A]||new R;this.getFaceNormal(A,E),E.negate(E),this.faceNormals[A]=E;var z=this.vertices[this.faces[A][0]];if(E.dot(z)<0)for(console.error(".faceNormals["+A+"] = Vec3("+E.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),T=0;T<this.faces[A].length;T++)console.warn(".vertices["+this.faces[A][T]+"] = Vec3("+this.vertices[this.faces[A][T]].toString()+")")}};var V=new R,U=new R;n.computeNormal=function(A,T,E,R){T.vsub(A,U),E.vsub(T,V),V.cross(U,R),R.isZero()||R.normalize()},n.prototype.getFaceNormal=function(A,T){var E=this.faces[A],R=this.vertices[E[0]],z=this.vertices[E[1]],O=this.vertices[E[2]];return n.computeNormal(R,z,O,T)};var H=new R;n.prototype.clipAgainstHull=function(A,T,E,z,O,V,U,G,X){for(var Q=H,Z=-1,K=-Number.MAX_VALUE,J=0;J<E.faces.length;J++){Q.copy(E.faceNormals[J]),O.vmult(Q,Q);var $=Q.dot(V);$>K&&(K=$,Z=J)}for(var et=[],nt=E.faces[Z],ot=nt.length,it=0;ot>it;it++){var rt=E.vertices[nt[it]],st=new R;st.copy(rt),O.vmult(st,st),z.vadd(st,st),et.push(st)}Z>=0&&this.clipFaceAgainstHull(V,A,T,et,U,G,X)};var G=new R,X=new R,Q=new R,Z=new R,K=new R,J=new R;n.prototype.findSeparatingAxis=function(A,T,E,R,z,O,V,U){var H=G,$=X,et=Q,nt=Z,ot=K,it=J,rt=Number.MAX_VALUE,st=this;if(st.uniqueAxes)for(var at=0;at!==st.uniqueAxes.length;at++){if(E.vmult(st.uniqueAxes[at],H),!1===(ct=st.testSepAxis(H,A,T,E,R,z)))return!1;rt>ct&&(rt=ct,O.copy(H))}else{var ut=V?V.length:st.faces.length;for(at=0;ut>at;at++){var lt=V?V[at]:at;if(H.copy(st.faceNormals[lt]),E.vmult(H,H),!1===(ct=st.testSepAxis(H,A,T,E,R,z)))return!1;rt>ct&&(rt=ct,O.copy(H))}}if(A.uniqueAxes)for(at=0;at!==A.uniqueAxes.length;at++){if(z.vmult(A.uniqueAxes[at],$),!1===(ct=st.testSepAxis($,A,T,E,R,z)))return!1;rt>ct&&(rt=ct,O.copy($))}else{var ht=U?U.length:A.faces.length;for(at=0;ht>at;at++){var ct;if(lt=U?U[at]:at,$.copy(A.faceNormals[lt]),z.vmult($,$),!1===(ct=st.testSepAxis($,A,T,E,R,z)))return!1;rt>ct&&(rt=ct,O.copy($))}}for(var pt=0;pt!==st.uniqueEdges.length;pt++){E.vmult(st.uniqueEdges[pt],nt);for(var dt=0;dt!==A.uniqueEdges.length;dt++)if(z.vmult(A.uniqueEdges[dt],ot),nt.cross(ot,it),!it.almostZero()){it.normalize();var ft=st.testSepAxis(it,A,T,E,R,z);if(!1===ft)return!1;rt>ft&&(rt=ft,O.copy(it))}}return R.vsub(T,et),et.dot(O)>0&&O.negate(O),!0};var $=[],et=[];n.prototype.testSepAxis=function(A,T,E,R,z,O){n.project(this,A,E,R,$),n.project(T,A,z,O,et);var V=$[0],U=$[1],H=et[0],G=et[1];if(G>V||U>H)return!1;var X=V-G,Q=H-U;return Q>X?X:Q};var nt=new R,ot=new R;n.prototype.calculateLocalInertia=function(A,T){this.computeLocalAABB(nt,ot);var E=ot.x-nt.x,R=ot.y-nt.y,z=ot.z-nt.z;T.x=1/12*A*(2*R*2*R+2*z*2*z),T.y=1/12*A*(2*E*2*E+2*z*2*z),T.z=1/12*A*(2*R*2*R+2*E*2*E)},n.prototype.getPlaneConstantOfFace=function(A){var T=this.faces[A],E=this.faceNormals[A],R=this.vertices[T[0]];return-E.dot(R)};var it=new R,rt=new R,st=new R,at=new R,ut=new R,lt=new R,ht=new R,ct=new R;n.prototype.clipFaceAgainstHull=function(A,T,E,R,z,O,V){for(var U=it,H=rt,G=st,X=at,Q=ut,Z=lt,K=ht,J=ct,$=this,et=R,nt=[],ot=-1,pt=Number.MAX_VALUE,dt=0;dt<$.faces.length;dt++){U.copy($.faceNormals[dt]),E.vmult(U,U);var ft=U.dot(A);pt>ft&&(pt=ft,ot=dt)}if(!(0>ot)){var vt=$.faces[ot];vt.connectedFaces=[];for(var mt=0;mt<$.faces.length;mt++)for(var gt=0;gt<$.faces[mt].length;gt++)-1!==vt.indexOf($.faces[mt][gt])&&mt!==ot&&-1===vt.connectedFaces.indexOf(mt)&&vt.connectedFaces.push(mt);for(var wt=(et.length,vt.length),bt=0;wt>bt;bt++){var xt=$.vertices[vt[bt]],At=$.vertices[vt[(bt+1)%wt]];xt.vsub(At,H),G.copy(H),E.vmult(G,G),T.vadd(G,G),X.copy(this.faceNormals[ot]),E.vmult(X,X),T.vadd(X,X),G.cross(X,Q),Q.negate(Q),Z.copy(xt),E.vmult(Z,Z),T.vadd(Z,Z);var Tt=(Z.dot(Q),vt.connectedFaces[bt]);K.copy(this.faceNormals[Tt]);var St=this.getPlaneConstantOfFace(Tt);J.copy(K),E.vmult(J,J);var Et=St-J.dot(T);for(this.clipFaceAgainstPlane(et,nt,J,Et);et.length;)et.shift();for(;nt.length;)et.push(nt.shift())}for(K.copy(this.faceNormals[ot]),St=this.getPlaneConstantOfFace(ot),J.copy(K),E.vmult(J,J),Et=St-J.dot(T),mt=0;mt<et.length;mt++){var Ct=J.dot(et[mt])+Et;if(z>=Ct&&(console.log("clamped: depth="+Ct+" to minDist="+z),Ct=z),O>=Ct){var It=et[mt];if(0>=Ct){var Rt={point:It,normal:J,depth:Ct};V.push(Rt)}}}}},n.prototype.clipFaceAgainstPlane=function(A,T,E,z){var O,V,U=A.length;if(2>U)return T;var H=A[A.length-1],G=A[0];O=E.dot(H)+z;for(var X=0;U>X;X++){if(G=A[X],V=E.dot(G)+z,0>O)if(0>V)(Q=new R).copy(G),T.push(Q);else{var Q=new R;H.lerp(G,O/(O-V),Q),T.push(Q)}else 0>V&&(Q=new R,H.lerp(G,O/(O-V),Q),T.push(Q),T.push(G));H=G,O=V}return T},n.prototype.computeWorldVertices=function(A,T){for(var E=this.vertices.length;this.worldVertices.length<E;)this.worldVertices.push(new R);for(var z=this.vertices,O=this.worldVertices,V=0;V!==E;V++)T.vmult(z[V],O[V]),A.vadd(O[V],O[V]);this.worldVerticesNeedsUpdate=!1},new R,n.prototype.computeLocalAABB=function(A,T){var E=this.vertices.length,R=this.vertices;A.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),T.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var z=0;E>z;z++){var O=R[z];O.x<A.x?A.x=O.x:O.x>T.x&&(T.x=O.x),O.y<A.y?A.y=O.y:O.y>T.y&&(T.y=O.y),O.z<A.z?A.z=O.z:O.z>T.z&&(T.z=O.z)}},n.prototype.computeWorldFaceNormals=function(A){for(var T=this.faceNormals.length;this.worldFaceNormals.length<T;)this.worldFaceNormals.push(new R);for(var E=this.faceNormals,z=this.worldFaceNormals,O=0;O!==T;O++)A.vmult(E[O],z[O]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var A=0,T=this.vertices,E=0,R=T.length;E!==R;E++){var z=T[E].norm2();z>A&&(A=z)}this.boundingSphereRadius=Math.sqrt(A)};var pt=new R;n.prototype.calculateWorldAABB=function(A,T,E,R){for(var z,O,V,U,H,G,X=this.vertices.length,Q=this.vertices,Z=0;X>Z;Z++){pt.copy(Q[Z]),T.vmult(pt,pt),A.vadd(pt,pt);var K=pt;K.x<z||void 0===z?z=K.x:(K.x>U||void 0===U)&&(U=K.x),K.y<O||void 0===O?O=K.y:(K.y>H||void 0===H)&&(H=K.y),K.z<V||void 0===V?V=K.z:(K.z>G||void 0===G)&&(G=K.z)}E.set(z,O,V),R.set(U,H,G)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(A){A=A||new R;for(var T=this.vertices.length,E=this.vertices,z=0;T>z;z++)A.vadd(E[z],A);return A.mult(1/T,A),A},n.prototype.transformAllPoints=function(A,T){var E=this.vertices.length,R=this.vertices;if(T){for(var z=0;E>z;z++){var O=R[z];T.vmult(O,O)}for(z=0;z<this.faceNormals.length;z++)O=this.faceNormals[z],T.vmult(O,O)}if(A)for(z=0;E>z;z++)(O=R[z]).vadd(A,O)};var dt=new R,ft=new R,vt=new R;n.prototype.pointIsInside=function(A){var T=this.vertices.length,E=this.vertices,R=this.faces,z=this.faceNormals,O=this.faces.length,V=dt;this.getAveragePointLocal(V);for(var U=0;O>U;U++){this.faces[U].length,T=z[U];var H=E[R[U][0]],G=ft;A.vsub(H,G);var X=T.dot(G),Q=vt;V.vsub(H,Q);var Z=T.dot(Q);if(0>X&&Z>0||X>0&&0>Z)return!1}return-1};var mt=(new R,new R),gt=new R;n.project=function(A,T,E,R,O){var V=A.vertices.length,U=mt,H=0,G=0,X=gt,Q=A.vertices;X.setZero(),z.vectorToLocalFrame(E,R,T,U),z.pointToLocalFrame(E,R,X,X);var Z=X.dot(U);G=H=Q[0].dot(U);for(var K=1;V>K;K++){var J=Q[K].dot(U);J>H&&(H=J),G>J&&(G=J)}if((G-=Z)>(H-=Z)){var $=G;G=H,H=$}O[0]=H,O[1]=G}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(A,T){function n(A,T,O,V){var U=V,H=[],G=[],X=[],Q=[],Z=[],K=Math.cos,J=Math.sin;H.push(new R(T*K(0),T*J(0),.5*-O)),Q.push(0),H.push(new R(A*K(0),A*J(0),.5*O)),Z.push(1);for(var $=0;U>$;$++){var et=2*Math.PI/U*($+1),nt=2*Math.PI/U*($+.5);U-1>$?(H.push(new R(T*K(et),T*J(et),.5*-O)),Q.push(2*$+2),H.push(new R(A*K(et),A*J(et),.5*O)),Z.push(2*$+3),X.push([2*$+2,2*$+3,2*$+1,2*$])):X.push([0,1,2*$+1,2*$]),(U%2==1||U/2>$)&&G.push(new R(K(nt),J(nt),0))}X.push(Z),G.push(new R(0,0,1));var ot=[];for($=0;$<Q.length;$++)ot.push(Q[Q.length-$-1]);X.push(ot),this.type=E.types.CONVEXPOLYHEDRON,z.call(this,H,X,G)}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3"),z=(A("../math/Quaternion"),A("./ConvexPolyhedron"));n.prototype=new z},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(A,T){function n(A,T){T=O.defaults(T,{maxValue:null,minValue:null,elementSize:1}),this.data=A,this.maxValue=T.maxValue,this.minValue=T.minValue,this.elementSize=T.elementSize,null===T.minValue&&this.updateMinValue(),null===T.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,E.call(this),this.pillarConvex=new R,this.pillarOffset=new z,this.type=E.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var E=A("./Shape"),R=A("./ConvexPolyhedron"),z=A("../math/Vec3"),O=A("../utils/Utils");T.exports=n,n.prototype=new E,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var A=this.data,T=A[0][0],E=0;E!==A.length;E++)for(var R=0;R!==A[E].length;R++){var z=A[E][R];T>z&&(T=z)}this.minValue=T},n.prototype.updateMaxValue=function(){for(var A=this.data,T=A[0][0],E=0;E!==A.length;E++)for(var R=0;R!==A[E].length;R++){var z=A[E][R];z>T&&(T=z)}this.maxValue=T},n.prototype.setHeightValueAtIndex=function(A,T,E){this.data[A][T]=E,this.clearCachedConvexTrianglePillar(A,T,!1),A>0&&(this.clearCachedConvexTrianglePillar(A-1,T,!0),this.clearCachedConvexTrianglePillar(A-1,T,!1)),T>0&&(this.clearCachedConvexTrianglePillar(A,T-1,!0),this.clearCachedConvexTrianglePillar(A,T-1,!1)),T>0&&A>0&&this.clearCachedConvexTrianglePillar(A-1,T-1,!0)},n.prototype.getRectMinMax=function(A,T,E,R,z){z=z||[];for(var O=this.data,V=this.minValue,U=A;E>=U;U++)for(var H=T;R>=H;H++){var G=O[U][H];G>V&&(V=G)}z[0]=this.minValue,z[1]=V},n.prototype.getIndexOfPosition=function(A,T,E,R){var z=this.elementSize,O=this.data,V=Math.floor(A/z),U=Math.floor(T/z);return E[0]=V,E[1]=U,R&&(0>V&&(V=0),0>U&&(U=0),V>=O.length-1&&(V=O.length-1),U>=O[0].length-1&&(U=O[0].length-1)),!(0>V||0>U||V>=O.length-1||U>=O[0].length-1)},n.prototype.getHeightAt=function(A,T,E){var R=[];this.getIndexOfPosition(A,T,R,E);var z=[];return this.getRectMinMax(R[0],R[1]+1,R[0],R[1]+1,z),(z[0]+z[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(A,T,E){return A+"_"+T+"_"+(E?1:0)},n.prototype.getCachedConvexTrianglePillar=function(A,T,E){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(A,T,E)]},n.prototype.setCachedConvexTrianglePillar=function(A,T,E,R,z){this._cachedPillars[this.getCacheConvexTrianglePillarKey(A,T,E)]={convex:R,offset:z}},n.prototype.clearCachedConvexTrianglePillar=function(A,T,E){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(A,T,E)]},n.prototype.getConvexTrianglePillar=function(A,T,E){var O=this.pillarConvex,V=this.pillarOffset;if(this.cacheEnabled){if(U=this.getCachedConvexTrianglePillar(A,T,E))return this.pillarConvex=U.convex,void(this.pillarOffset=U.offset);O=new R,V=new z,this.pillarConvex=O,this.pillarOffset=V}var U=this.data,H=this.elementSize,G=O.faces;O.vertices.length=6;for(var X=0;6>X;X++)O.vertices[X]||(O.vertices[X]=new z);for(G.length=5,X=0;5>X;X++)G[X]||(G[X]=[]);var Q=O.vertices,Z=(Math.min(U[A][T],U[A+1][T],U[A][T+1],U[A+1][T+1])-this.minValue)/2+this.minValue;E?(V.set((A+.75)*H,(T+.75)*H,Z),Q[0].set(.25*H,.25*H,U[A+1][T+1]-Z),Q[1].set(-.75*H,.25*H,U[A][T+1]-Z),Q[2].set(.25*H,-.75*H,U[A+1][T]-Z),Q[3].set(.25*H,.25*H,-Z-1),Q[4].set(-.75*H,.25*H,-Z-1),Q[5].set(.25*H,-.75*H,-Z-1),G[0][0]=0,G[0][1]=1,G[0][2]=2,G[1][0]=5,G[1][1]=4,G[1][2]=3,G[2][0]=2,G[2][1]=5,G[2][2]=3,G[2][3]=0,G[3][0]=3,G[3][1]=4,G[3][2]=1,G[3][3]=0,G[4][0]=1,G[4][1]=4,G[4][2]=5,G[4][3]=2):(V.set((A+.25)*H,(T+.25)*H,Z),Q[0].set(-.25*H,-.25*H,U[A][T]-Z),Q[1].set(.75*H,-.25*H,U[A+1][T]-Z),Q[2].set(-.25*H,.75*H,U[A][T+1]-Z),Q[3].set(-.25*H,-.25*H,-Z-1),Q[4].set(.75*H,-.25*H,-Z-1),Q[5].set(-.25*H,.75*H,-Z-1),G[0][0]=0,G[0][1]=1,G[0][2]=2,G[1][0]=5,G[1][1]=4,G[1][2]=3,G[2][0]=0,G[2][1]=2,G[2][2]=5,G[2][3]=3,G[3][0]=1,G[3][1]=0,G[3][2]=3,G[3][3]=4,G[4][0]=4,G[4][1]=5,G[4][2]=2,G[4][3]=1),O.computeNormals(),O.computeEdges(),O.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(A,T,E,O,V)},n.prototype.calculateLocalInertia=function(A,T){return(T=T||new z).set(0,0,0),T},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(A,T,E,R){E.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var A=this.data,T=this.elementSize;this.boundingSphereRadius=new z(A.length*T,A[0].length*T,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(A,T){function n(){E.call(this),this.type=E.types.PARTICLE}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(A,T){return(T=T||new R).set(0,0,0),T},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(A,T,E,R){E.copy(A),R.copy(A)}},{"../math/Vec3":30,"./Shape":43}],42:[function(A,T){function n(){E.call(this),this.type=E.types.PLANE,this.worldNormal=new R,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(A){var T=this.worldNormal;T.set(0,0,1),A.vmult(T,T),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(A,T){return T||new R},n.prototype.volume=function(){return Number.MAX_VALUE};var z=new R;n.prototype.calculateWorldAABB=function(A,T,E,R){z.set(0,0,1),T.vmult(z,z);var O=Number.MAX_VALUE;E.set(-O,-O,-O),R.set(O,O,O),1===z.x&&(R.x=A.x),1===z.y&&(R.y=A.y),1===z.z&&(R.z=A.z),-1===z.x&&(E.x=A.x),-1===z.y&&(E.y=A.y),-1===z.z&&(E.z=A.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(A,T){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}T.exports=n;var n=A("./Shape");A("../math/Vec3"),A("../math/Quaternion"),A("../material/Material"),n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(A,T){function n(A){if(E.call(this),this.radius=void 0!==A?Number(A):1,this.type=E.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3");n.prototype=new E,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(A,T){T=T||new R;var E=2*A*this.radius*this.radius/5;return T.x=E,T.y=E,T.z=E,T},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(A,T,E,R){for(var z=this.radius,O=["x","y","z"],V=0;V<O.length;V++){var U=O[V];E[U]=A[U]-z,R[U]=A[U]+z}}},{"../math/Vec3":30,"./Shape":43}],45:[function(A,T){function n(A,T){E.call(this),this.type=E.types.TRIMESH,this.vertices=new Float32Array(A),this.indices=new Int16Array(T),this.normals=new Float32Array(T.length),this.aabb=new O,this.edges=null,this.scale=new R(1,1,1),this.tree=new V,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}T.exports=n;var E=A("./Shape"),R=A("../math/Vec3"),z=(A("../math/Quaternion"),A("../math/Transform")),O=A("../collision/AABB"),V=A("../utils/Octree");n.prototype=new E,n.prototype.constructor=n;var U=new R;n.prototype.updateTree=function(){var A=this.tree;A.reset(),A.aabb.copy(this.aabb);var T=this.scale;A.aabb.lowerBound.x*=1/T.x,A.aabb.lowerBound.y*=1/T.y,A.aabb.lowerBound.z*=1/T.z,A.aabb.upperBound.x*=1/T.x,A.aabb.upperBound.y*=1/T.y,A.aabb.upperBound.z*=1/T.z;for(var E=new O,z=new R,V=new R,U=new R,H=[z,V,U],G=0;G<this.indices.length/3;G++){var X=3*G;this._getUnscaledVertex(this.indices[X],z),this._getUnscaledVertex(this.indices[X+1],V),this._getUnscaledVertex(this.indices[X+2],U),E.setFromPoints(H),A.insert(E,G)}A.removeEmptyNodes()};var H=new O;n.prototype.getTrianglesInAABB=function(A,T){H.copy(A);var E=this.scale,R=E.x,z=E.y,O=E.z,V=H.lowerBound,U=H.upperBound;return V.x/=R,V.y/=z,V.z/=O,U.x/=R,U.y/=z,U.z/=O,this.tree.aabbQuery(H,T)},n.prototype.setScale=function(A){var T=this.scale.x===this.scale.y===this.scale.z,E=A.x===A.y===A.z;T&&E||this.updateNormals(),this.scale.copy(A),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var A=U,T=this.normals,E=0;E<this.indices.length/3;E++){var R=3*E,z=this.indices[R],O=this.indices[R+1],V=this.indices[R+2];this.getVertex(z,K),this.getVertex(O,J),this.getVertex(V,$),n.computeNormal(J,K,$,A),T[R]=A.x,T[R+1]=A.y,T[R+2]=A.z}},n.prototype.updateEdges=function(){for(var A={},f=function(){A[z>R?R+"_"+z:z+"_"+R]=!0},T=0;T<this.indices.length/3;T++){var E=3*T,R=this.indices[E],z=this.indices[E+1];this.indices[E+2],f(),f(),f()}var O=Object.keys(A);for(this.edges=new Int16Array(2*O.length),T=0;T<O.length;T++){var V=O[T].split("_");this.edges[2*T]=parseInt(V[0],10),this.edges[2*T+1]=parseInt(V[1],10)}},n.prototype.getEdgeVertex=function(A,T,E){var R=this.edges[2*A+(T?1:0)];this.getVertex(R,E)};var G=new R,X=new R;n.prototype.getEdgeVector=function(A,T){var E=G,R=X;this.getEdgeVertex(A,0,E),this.getEdgeVertex(A,1,R),R.vsub(E,T)};var Q=new R,Z=new R;n.computeNormal=function(A,T,E,R){T.vsub(A,Z),E.vsub(T,Q),Q.cross(Z,R),R.isZero()||R.normalize()};var K=new R,J=new R,$=new R;n.prototype.getVertex=function(A,T){var E=this.scale;return this._getUnscaledVertex(A,T),T.x*=E.x,T.y*=E.y,T.z*=E.z,T},n.prototype._getUnscaledVertex=function(A,T){var E=3*A,R=this.vertices;return T.set(R[E],R[E+1],R[E+2])},n.prototype.getWorldVertex=function(A,T,E,R){return this.getVertex(A,R),z.pointToWorldFrame(T,E,R,R),R},n.prototype.getTriangleVertices=function(A,T,E,R){var z=3*A;this.getVertex(this.indices[z],T),this.getVertex(this.indices[z+1],E),this.getVertex(this.indices[z+2],R)},n.prototype.getNormal=function(A,T){var E=3*A;return T.set(this.normals[E],this.normals[E+1],this.normals[E+2])};var et=new O;n.prototype.calculateLocalInertia=function(A,T){this.computeLocalAABB(et);var E=et.upperBound.x-et.lowerBound.x,R=et.upperBound.y-et.lowerBound.y,z=et.upperBound.z-et.lowerBound.z;return T.set(1/12*A*(2*R*2*R+2*z*2*z),1/12*A*(2*E*2*E+2*z*2*z),1/12*A*(2*R*2*R+2*E*2*E))};var nt=new R;n.prototype.computeLocalAABB=function(A){var T=A.lowerBound,E=A.upperBound,R=this.vertices.length,z=(this.vertices,nt);this.getVertex(0,z),T.copy(z),E.copy(z);for(var O=0;O!==R;O++)this.getVertex(O,z),z.x<T.x?T.x=z.x:z.x>E.x&&(E.x=z.x),z.y<T.y?T.y=z.y:z.y>E.y&&(E.y=z.y),z.z<T.z?T.z=z.z:z.z>E.z&&(E.z=z.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var A=0,T=this.vertices,E=new R,z=0,O=T.length/3;z!==O;z++){this.getVertex(z,E);var V=E.norm2();V>A&&(A=V)}this.boundingSphereRadius=Math.sqrt(A)};var ot=(new R,new z),it=new O;n.prototype.calculateWorldAABB=function(A,T,E,R){var z=ot,O=it;z.position=A,z.quaternion=T,this.aabb.toWorldFrame(z,O),E.copy(O.lowerBound),R.copy(O.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(A,T,E,R,z){A=A||1,T=T||.5,E=E||8,R=R||6,z=z||2*Math.PI;for(var O=[],V=[],U=0;E>=U;U++)for(var H=0;R>=H;H++){var G=H/R*z,X=U/E*Math.PI*2,Q=(A+T*Math.cos(X))*Math.cos(G),Z=(A+T*Math.cos(X))*Math.sin(G),K=T*Math.sin(X);O.push(Q,Z,K)}for(U=1;E>=U;U++)for(H=1;R>=H;H++){var J=(R+1)*U+H-1,$=(R+1)*(U-1)+H-1,et=(R+1)*(U-1)+H,nt=(R+1)*U+H;V.push(J,$,nt),V.push($,et,nt)}return new n(O,V)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(A,T){function n(){E.call(this),this.iterations=10,this.tolerance=1e-7}T.exports=n;var E=(A("../math/Vec3"),A("../math/Quaternion"),A("./Solver"));n.prototype=new E;var R=[],z=[],O=[];n.prototype.solve=function(A,T){var E,V,U,H,G,X=0,Q=this.iterations,Z=this.tolerance*this.tolerance,K=this.equations,J=K.length,$=T.bodies,et=$.length,nt=A;if(0!==J)for(var ot=0;ot!==et;ot++)$[ot].updateSolveMassProperties();var it=z,rt=O,st=R;for(it.length=J,rt.length=J,st.length=J,ot=0;ot!==J;ot++){var at=K[ot];st[ot]=0,rt[ot]=at.computeB(nt),it[ot]=1/at.computeC()}if(0!==J){for(ot=0;ot!==et;ot++){var ut=(ct=$[ot]).vlambda,lt=ct.wlambda;ut.set(0,0,0),lt&&lt.set(0,0,0)}for(X=0;X!==Q;X++){H=0;for(var ht=0;ht!==J;ht++)at=K[ht],E=rt[ht],V=it[ht],(G=st[ht])+(U=V*(E-at.computeGWlambda()-at.eps*G))<at.minForce?U=at.minForce-G:G+U>at.maxForce&&(U=at.maxForce-G),st[ht]+=U,H+=U>0?U:-U,at.addToWlambda(U);if(Z>H*H)break}for(ot=0;ot!==et;ot++){var ct,pt=(ct=$[ot]).velocity,dt=ct.angularVelocity;pt.vadd(ct.vlambda,pt),dt&&dt.vadd(ct.wlambda,dt)}}return X}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(A,T){function n(){this.equations=[]}T.exports=n,n.prototype.solve=function(){return 0},n.prototype.addEquation=function(A){A.enabled&&this.equations.push(A)},n.prototype.removeEquation=function(A){var T=this.equations,E=T.indexOf(A);-1!==E&&T.splice(E,1)},n.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(A,T){function n(A){for(E.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=A,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function o(A){for(var T=A.length,E=0;E!==T;E++){var R=A[E];if(!(R.visited||R.body.type&U))return R}return!1}function d(A,T,E,R){for(H.push(A),A.visited=!0,T(A,E,R);H.length;)for(var z,O=H.pop();z=o(O.children);)z.visited=!0,T(z,E,R),H.push(z)}function i(A,T,E){T.push(A.body);for(var R=A.eqs.length,z=0;z!==R;z++){var O=A.eqs[z];-1===E.indexOf(O)&&E.push(O)}}function t(A,T){return T.id-A.id}T.exports=n;var E=(A("../math/Vec3"),A("../math/Quaternion"),A("./Solver")),R=A("../objects/Body");n.prototype=new E;var z=[],O=[],V={bodies:[]},U=R.STATIC,H=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(A,T){for(var E=z,R=this.nodePool,U=T.bodies,H=this.equations,G=H.length,X=U.length,Q=this.subsolver;R.length<X;)R.push(this.createNode());E.length=X;for(var Z=0;X>Z;Z++)E[Z]=R[Z];for(Z=0;Z!==X;Z++){var K=E[Z];K.body=U[Z],K.children.length=0,K.eqs.length=0,K.visited=!1}for(var J=0;J!==G;J++){var $=H[J],et=(Z=U.indexOf($.bi),U.indexOf($.bj)),nt=E[Z],ot=E[et];nt.children.push(ot),nt.eqs.push($),ot.children.push(nt),ot.eqs.push($)}var it,rt=0,st=O;Q.tolerance=this.tolerance,Q.iterations=this.iterations;for(var at=V;it=o(E);){st.length=0,at.bodies.length=0,d(it,i,at.bodies,st);var ut=st.length;for(st=st.sort(t),Z=0;Z!==ut;Z++)Q.addEquation(st[Z]);Q.solve(A,at),Q.removeAllEquations(),rt++}return rt}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(A,T){var n=function(){};T.exports=n,n.prototype={constructor:n,addEventListener:function(A,T){void 0===this._listeners&&(this._listeners={});var E=this._listeners;return void 0===E[A]&&(E[A]=[]),-1===E[A].indexOf(T)&&E[A].push(T),this},hasEventListener:function(A,T){if(void 0===this._listeners)return!1;var E=this._listeners;return void 0!==E[A]&&-1!==E[A].indexOf(T)},removeEventListener:function(A,T){if(void 0===this._listeners)return this;var E=this._listeners;if(void 0===E[A])return this;var R=E[A].indexOf(T);return-1!==R&&E[A].splice(R,1),this},dispatchEvent:function(A){if(void 0===this._listeners)return this;var T=this._listeners[A.type];if(void 0!==T){A.target=this;for(var E=0,R=T.length;R>E;E++)T[E].call(this,A)}return this}}},{}],50:[function(A,T){function n(A){A=A||{},this.root=A.root||null,this.aabb=A.aabb?A.aabb.clone():new E,this.data=[],this.children=[]}function o(A,T){(T=T||{}).root=null,T.aabb=A,n.call(this,T),this.maxDepth=void 0!==T.maxDepth?T.maxDepth:8}var E=A("../collision/AABB"),R=A("../math/Vec3");T.exports=o,o.prototype=new n,n.prototype.reset=function(){this.children.length=this.data.length=0},n.prototype.insert=function(A,T,E){var R=this.data;if(E=E||0,!this.aabb.contains(A))return!1;var z=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var O=!1;z.length||(this.subdivide(),O=!0);for(var V=0;8!==V;V++)if(z[V].insert(A,T,E+1))return!0;O&&(z.length=0)}return R.push(T),!0};var z=new R;n.prototype.subdivide=function(){var A=this.aabb,T=A.lowerBound,O=A.upperBound,V=this.children;V.push(new n({aabb:new E({lowerBound:new R(0,0,0)})}),new n({aabb:new E({lowerBound:new R(1,0,0)})}),new n({aabb:new E({lowerBound:new R(1,1,0)})}),new n({aabb:new E({lowerBound:new R(1,1,1)})}),new n({aabb:new E({lowerBound:new R(0,1,1)})}),new n({aabb:new E({lowerBound:new R(0,0,1)})}),new n({aabb:new E({lowerBound:new R(1,0,1)})}),new n({aabb:new E({lowerBound:new R(0,1,0)})})),O.vsub(T,z),z.scale(.5,z);for(var U=this.root||this,H=0;8!==H;H++){var G=V[H];G.root=U;var X=G.aabb.lowerBound;X.x*=z.x,X.y*=z.y,X.z*=z.z,X.vadd(T,X),X.vadd(z,G.aabb.upperBound)}},n.prototype.aabbQuery=function(A,T){for(var E=(this.data,this.children,[this]);E.length;){var R=E.pop();R.aabb.overlaps(A)&&Array.prototype.push.apply(T,R.data),Array.prototype.push.apply(E,R.children)}return T};var O=new E;n.prototype.rayQuery=function(A,T,E){return A.getAABB(O),O.toLocalFrame(T,O),this.aabbQuery(O,E),E},n.prototype.removeEmptyNodes=function(){for(var A=[this];A.length;){for(var T=A.pop(),E=T.children.length-1;E>=0;E--)T.children[E].data.length||T.children.splice(E,1);Array.prototype.push.apply(A,T.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(A,T){function n(){this.objects=[],this.type=Object}T.exports=n,n.prototype.release=function(){for(var A=arguments.length,T=0;T!==A;T++)this.objects.push(arguments[T])},n.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},n.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(A,T){function n(){this.data={keys:[]}}T.exports=n,n.prototype.get=function(A,T){if(A>T){var E=T;T=A,A=E}return this.data[A+"-"+T]},n.prototype.set=function(A,T,E){if(A>T){var R=T;T=A,A=R}var z=A+"-"+T;this.get(A,T)||this.data.keys.push(z),this.data[z]=E},n.prototype.reset=function(){for(var A=this.data,T=A.keys;T.length>0;)delete A[T.pop()]}},{}],53:[function(A,T){function n(){}T.exports=n,n.defaults=function(A,T){for(var E in A=A||{},T)E in A||(A[E]=T[E]);return A}},{}],54:[function(A,T){function n(){R.call(this),this.type=E}T.exports=n;var E=A("../math/Vec3"),R=A("./Pool");n.prototype=new R,n.prototype.constructObject=function(){return new E}},{"../math/Vec3":30,"./Pool":51}],55:[function(A,T){function n(A){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new H,this.world=A,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function o(A,T,E){for(var R=null,z=A.length,O=0;O!==z;O++){var V=A[O],U=St;A[(O+1)%z].vsub(V,U);var H=Et;U.cross(T,H);var G=Ct;E.vsub(V,G);var X=H.dot(G);if(!(null===R||X>0&&!0===R||0>=X&&!1===R))return!1;null===R&&(R=X>0)}return!0}T.exports=n;var E=A("../collision/AABB"),R=A("../shapes/Shape"),z=A("../collision/Ray"),O=A("../math/Vec3"),V=A("../math/Transform"),U=(A("../shapes/ConvexPolyhedron"),A("../math/Quaternion")),H=(A("../solver/Solver"),A("../utils/Vec3Pool")),G=A("../equations/ContactEquation"),X=A("../equations/FrictionEquation");n.prototype.createContactEquation=function(A,T,E,R,z,O){var V;this.contactPointPool.length?((V=this.contactPointPool.pop()).bi=A,V.bj=T):V=new G(A,T),V.enabled=A.collisionResponse&&T.collisionResponse&&E.collisionResponse&&R.collisionResponse;var U=this.currentContactMaterial;V.restitution=U.restitution,V.setSpookParams(U.contactEquationStiffness,U.contactEquationRelaxation,this.world.dt);var H=E.material||A.material,X=R.material||T.material;return H&&X&&H.restitution>=0&&X.restitution>=0&&(V.restitution=H.restitution*X.restitution),V.si=z||E,V.sj=O||R,V},n.prototype.createFrictionEquationsFromContact=function(A,T){var E=A.bi,R=A.bj,z=A.si,O=A.sj,V=this.world,U=this.currentContactMaterial,H=U.friction,G=z.material||E.material,Q=O.material||R.material;if(G&&Q&&G.friction>=0&&Q.friction>=0&&(H=G.friction*Q.friction),H>0){var Z=H*V.gravity.length(),K=E.invMass+R.invMass;K>0&&(K=1/K);var J=this.frictionEquationPool,$=J.length?J.pop():new X(E,R,Z*K),et=J.length?J.pop():new X(E,R,Z*K);return $.bi=et.bi=E,$.bj=et.bj=R,$.minForce=et.minForce=-Z*K,$.maxForce=et.maxForce=Z*K,$.ri.copy(A.ri),$.rj.copy(A.rj),et.ri.copy(A.ri),et.rj.copy(A.rj),A.ni.tangents($.t,et.t),$.setSpookParams(U.frictionEquationStiffness,U.frictionEquationRelaxation,V.dt),et.setSpookParams(U.frictionEquationStiffness,U.frictionEquationRelaxation,V.dt),$.enabled=et.enabled=A.enabled,T.push($,et),!0}return!1};var Q=new O,Z=new O,K=new O;n.prototype.createFrictionFromAverage=function(A){var T=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(T,this.frictionResult)&&1!==A){var E=this.frictionResult[this.frictionResult.length-2],R=this.frictionResult[this.frictionResult.length-1];Q.setZero(),Z.setZero(),K.setZero();for(var z=T.bi,O=(T.bj,0);O!==A;O++)(T=this.result[this.result.length-1-O]).bodyA!==z?(Q.vadd(T.ni,Q),Z.vadd(T.ri,Z),K.vadd(T.rj,K)):(Q.vsub(T.ni,Q),Z.vadd(T.rj,Z),K.vadd(T.ri,K));var V=1/A;Z.scale(V,E.ri),K.scale(V,E.rj),R.ri.copy(E.ri),R.rj.copy(E.rj),Q.normalize(),Q.tangents(E.t,R.t)}};var J=new O,$=new O,et=new U,nt=new U;n.prototype.getContacts=function(A,T,E,R,z,O,V){this.contactPointPool=z,this.frictionEquationPool=V,this.result=R,this.frictionResult=O;for(var U=et,H=nt,G=J,X=$,Q=0,Z=A.length;Q!==Z;Q++){var K=A[Q],ot=T[Q],it=null;K.material&&ot.material&&(it=E.getContactMaterial(K.material,ot.material)||null);for(var rt=0;rt<K.shapes.length;rt++){K.quaternion.mult(K.shapeOrientations[rt],U),K.quaternion.vmult(K.shapeOffsets[rt],G),G.vadd(K.position,G);for(var st=K.shapes[rt],at=0;at<ot.shapes.length;at++){ot.quaternion.mult(ot.shapeOrientations[at],H),ot.quaternion.vmult(ot.shapeOffsets[at],X),X.vadd(ot.position,X);var ut=ot.shapes[at];if(!(G.distanceTo(X)>st.boundingSphereRadius+ut.boundingSphereRadius)){var lt=null;st.material&&ut.material&&(lt=E.getContactMaterial(st.material,ut.material)||null),this.currentContactMaterial=lt||it||E.defaultContactMaterial;var ht=this[st.type|ut.type];ht&&(st.type<ut.type?ht.call(this,st,ut,G,X,U,H,K,ot,st,ut):ht.call(this,ut,st,X,G,H,U,ot,K,st,ut))}}}}},n.prototype[R.types.BOX|R.types.BOX]=n.prototype.boxBox=function(A,T,E,R,z,O,V,U){A.convexPolyhedronRepresentation.material=A.material,T.convexPolyhedronRepresentation.material=T.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,T.convexPolyhedronRepresentation.collisionResponse=T.collisionResponse,this.convexConvex(A.convexPolyhedronRepresentation,T.convexPolyhedronRepresentation,E,R,z,O,V,U,A,T)},n.prototype[R.types.BOX|R.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(A,T,E,R,z,O,V,U){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexConvex(A.convexPolyhedronRepresentation,T,E,R,z,O,V,U,A,T)},n.prototype[R.types.BOX|R.types.PARTICLE]=n.prototype.boxParticle=function(A,T,E,R,z,O,V,U){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexParticle(A.convexPolyhedronRepresentation,T,E,R,z,O,V,U,A,T)},n.prototype[R.types.SPHERE]=n.prototype.sphereSphere=function(A,T,E,R,z,O,V,U){var H=this.createContactEquation(V,U,A,T);R.vsub(E,H.ni),H.ni.normalize(),H.ri.copy(H.ni),H.rj.copy(H.ni),H.ri.mult(A.radius,H.ri),H.rj.mult(-T.radius,H.rj),H.ri.vadd(E,H.ri),H.ri.vsub(V.position,H.ri),H.rj.vadd(R,H.rj),H.rj.vsub(U.position,H.rj),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)};var ot=new O,it=new O,rt=new O;n.prototype[R.types.PLANE|R.types.TRIMESH]=n.prototype.planeTrimesh=function(A,T,E,R,z,U,H,G){var X=new O,Q=ot;Q.set(0,0,1),z.vmult(Q,Q);for(var Z=0;Z<T.vertices.length/3;Z++){T.getVertex(Z,X);var K=new O;K.copy(X),V.pointToWorldFrame(R,U,K,X);var J=it;if(X.vsub(E,J),0>=Q.dot(J)){var $=this.createContactEquation(H,G,A,T);$.ni.copy(Q);var et=rt;Q.scale(J.dot(Q),et),X.vsub(et,et),$.ri.copy(et),$.ri.vsub(H.position,$.ri),$.rj.copy(X),$.rj.vsub(G.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}}};var st=new O,at=new O,ut=(new O,new O),lt=new O,ht=new O,ct=new O,pt=new O,dt=new O,ft=new O,vt=new O,mt=new O,gt=new O,wt=new O,bt=new E,xt=[];n.prototype[R.types.SPHERE|R.types.TRIMESH]=n.prototype.sphereTrimesh=function(A,T,E,R,O,U,H,G){var X=ht,Q=ct,Z=pt,K=dt,J=ft,$=vt,et=bt,nt=lt,ot=at,it=xt;V.pointToLocalFrame(R,U,E,J);var rt=A.radius;et.lowerBound.set(J.x-rt,J.y-rt,J.z-rt),et.upperBound.set(J.x+rt,J.y+rt,J.z+rt),T.getTrianglesInAABB(et,it);for(var At=ut,Tt=A.radius*A.radius,St=0;St<it.length;St++)for(var Et=0;3>Et;Et++)T.getVertex(T.indices[3*it[St]+Et],At),At.vsub(J,ot),ot.norm2()<=Tt&&(nt.copy(At),V.pointToWorldFrame(R,U,nt,At),At.vsub(E,ot),(Rt=this.createContactEquation(H,G,A,T)).ni.copy(ot),Rt.ni.normalize(),Rt.ri.copy(Rt.ni),Rt.ri.scale(A.radius,Rt.ri),Rt.ri.vadd(E,Rt.ri),Rt.ri.vsub(H.position,Rt.ri),Rt.rj.copy(At),Rt.rj.vsub(G.position,Rt.rj),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult));for(St=0;St<it.length;St++)for(Et=0;3>Et;Et++){T.getVertex(T.indices[3*it[St]+Et],X),T.getVertex(T.indices[3*it[St]+(Et+1)%3],Q),Q.vsub(X,Z),J.vsub(Q,$);var Ct=$.dot(Z);J.vsub(X,$);var It=$.dot(Z);if(It>0&&0>Ct&&(J.vsub(X,$),K.copy(Z),K.normalize(),It=$.dot(K),K.scale(It,$),$.vadd(X,$),(Ot=$.distanceTo(J))<A.radius)){var Rt=this.createContactEquation(H,G,A,T);$.vsub(J,Rt.ni),Rt.ni.normalize(),Rt.ni.scale(A.radius,Rt.ri),V.pointToWorldFrame(R,U,$,$),$.vsub(G.position,Rt.rj),V.vectorToWorldFrame(U,Rt.ni,Rt.ni),V.vectorToWorldFrame(U,Rt.ri,Rt.ri),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult)}}for(var _t=mt,zt=gt,Pt=wt,Bt=st,Mt=(St=0,it.length);St!==Mt;St++){T.getTriangleVertices(it[St],_t,zt,Pt),T.getNormal(it[St],Bt),J.vsub(_t,$);var Ot=$.dot(Bt);Bt.scale(Ot,$),J.vsub($,$),Ot=$.distanceTo(J),z.pointInTriangle($,_t,zt,Pt)&&Ot<A.radius&&(Rt=this.createContactEquation(H,G,A,T),$.vsub(J,Rt.ni),Rt.ni.normalize(),Rt.ni.scale(A.radius,Rt.ri),V.pointToWorldFrame(R,U,$,$),$.vsub(G.position,Rt.rj),V.vectorToWorldFrame(U,Rt.ni,Rt.ni),V.vectorToWorldFrame(U,Rt.ri,Rt.ri),this.result.push(Rt),this.createFrictionEquationsFromContact(Rt,this.frictionResult))}it.length=0};var At=new O,Tt=new O;n.prototype[R.types.SPHERE|R.types.PLANE]=n.prototype.spherePlane=function(A,T,E,R,z,O,V,U){var H=this.createContactEquation(V,U,A,T);if(H.ni.set(0,0,1),O.vmult(H.ni,H.ni),H.ni.negate(H.ni),H.ni.normalize(),H.ni.mult(A.radius,H.ri),E.vsub(R,At),H.ni.mult(H.ni.dot(At),Tt),At.vsub(Tt,H.rj),-At.dot(H.ni)<=A.radius){var G=H.ri,X=H.rj;G.vadd(E,G),G.vsub(V.position,G),X.vadd(R,X),X.vsub(U.position,X),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)}};var St=new O,Et=new O,Ct=new O,It=new O,Rt=new O,_t=new O,zt=new O,Pt=[new O,new O,new O,new O,new O,new O],Bt=new O,Mt=new O,Ot=new O,Lt=new O;n.prototype[R.types.SPHERE|R.types.BOX]=n.prototype.sphereBox=function(A,T,E,R,z,O,V,U){var H=this.v3pool,G=Pt;E.vsub(R,It),T.getSideNormals(G,O);for(var X=A.radius,Q=!1,Z=Mt,K=Ot,J=Lt,$=null,et=0,nt=0,ot=0,it=null,rt=0,st=G.length;rt!==st&&!1===Q;rt++){var at=Rt;at.copy(G[rt]);var ut=at.norm();at.normalize();var lt=It.dot(at);if(ut+X>lt&&lt>0){var ht=_t,ct=zt;ht.copy(G[(rt+1)%3]),ct.copy(G[(rt+2)%3]);var pt=ht.norm(),dt=ct.norm();ht.normalize(),ct.normalize();var ft=It.dot(ht),vt=It.dot(ct);if(pt>ft&&ft>-pt&&dt>vt&&vt>-dt){var mt=Math.abs(lt-ut-X);(null===it||it>mt)&&(it=mt,nt=ft,ot=vt,$=ut,Z.copy(at),K.copy(ht),J.copy(ct),et++)}}}if(et){Q=!0;var gt=this.createContactEquation(V,U,A,T);Z.mult(-X,gt.ri),gt.ni.copy(Z),gt.ni.negate(gt.ni),Z.mult($,Z),K.mult(nt,K),Z.vadd(K,Z),J.mult(ot,J),Z.vadd(J,gt.rj),gt.ri.vadd(E,gt.ri),gt.ri.vsub(V.position,gt.ri),gt.rj.vadd(R,gt.rj),gt.rj.vsub(U.position,gt.rj),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult)}for(var wt=H.get(),bt=Bt,xt=0;2!==xt&&!Q;xt++)for(var At=0;2!==At&&!Q;At++)for(var Tt=0;2!==Tt&&!Q;Tt++)wt.set(0,0,0),xt?wt.vadd(G[0],wt):wt.vsub(G[0],wt),At?wt.vadd(G[1],wt):wt.vsub(G[1],wt),Tt?wt.vadd(G[2],wt):wt.vsub(G[2],wt),R.vadd(wt,bt),bt.vsub(E,bt),bt.norm2()<X*X&&(Q=!0,(gt=this.createContactEquation(V,U,A,T)).ri.copy(bt),gt.ri.normalize(),gt.ni.copy(gt.ri),gt.ri.mult(X,gt.ri),gt.rj.copy(wt),gt.ri.vadd(E,gt.ri),gt.ri.vsub(V.position,gt.ri),gt.rj.vadd(R,gt.rj),gt.rj.vsub(U.position,gt.rj),this.result.push(gt),this.createFrictionEquationsFromContact(gt,this.frictionResult));H.release(wt),wt=null;var St=H.get(),Et=H.get(),Ct=(gt=H.get(),H.get()),Nt=(mt=H.get(),G.length);for(xt=0;xt!==Nt&&!Q;xt++)for(At=0;At!==Nt&&!Q;At++)if(xt%3!=At%3){G[At].cross(G[xt],St),St.normalize(),G[xt].vadd(G[At],Et),gt.copy(E),gt.vsub(Et,gt),gt.vsub(R,gt);var kt=gt.dot(St);for(St.mult(kt,Ct),Tt=0;Tt===xt%3||Tt===At%3;)Tt++;mt.copy(E),mt.vsub(Ct,mt),mt.vsub(Et,mt),mt.vsub(R,mt);var qt=Math.abs(kt),Wt=mt.norm();if(qt<G[Tt].norm()&&X>Wt){Q=!0;var Dt=this.createContactEquation(V,U,A,T);Et.vadd(Ct,Dt.rj),Dt.rj.copy(Dt.rj),mt.negate(Dt.ni),Dt.ni.normalize(),Dt.ri.copy(Dt.rj),Dt.ri.vadd(R,Dt.ri),Dt.ri.vsub(E,Dt.ri),Dt.ri.normalize(),Dt.ri.mult(X,Dt.ri),Dt.ri.vadd(E,Dt.ri),Dt.ri.vsub(V.position,Dt.ri),Dt.rj.vadd(R,Dt.rj),Dt.rj.vsub(U.position,Dt.rj),this.result.push(Dt),this.createFrictionEquationsFromContact(Dt,this.frictionResult)}}H.release(St,Et,gt,Ct,mt)};var Nt=new O,kt=new O,qt=new O,Wt=new O,Dt=new O,Vt=new O,Ut=new O,Ht=new O,jt=new O,Gt=new O;n.prototype[R.types.SPHERE|R.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(A,T,E,R,z,O,V,U){var H=this.v3pool;E.vsub(R,Nt);for(var G=T.faceNormals,X=T.faces,Q=T.vertices,Z=A.radius,K=0;K!==Q.length;K++){var J=Q[K],$=Dt;O.vmult(J,$),R.vadd($,$);var et=Wt;if($.vsub(E,et),et.norm2()<Z*Z)return nt=!0,(mt=this.createContactEquation(V,U,A,T)).ri.copy(et),mt.ri.normalize(),mt.ni.copy(mt.ri),mt.ri.mult(Z,mt.ri),$.vsub(R,mt.rj),mt.ri.vadd(E,mt.ri),mt.ri.vsub(V.position,mt.ri),mt.rj.vadd(R,mt.rj),mt.rj.vsub(U.position,mt.rj),this.result.push(mt),void this.createFrictionEquationsFromContact(mt,this.frictionResult)}for(var nt=!1,ot=(K=0,X.length);K!==ot&&!1===nt;K++){var it=G[K],rt=X[K],st=Vt;O.vmult(it,st);var at=Ut;O.vmult(Q[rt[0]],at),at.vadd(R,at);var ut=Ht;st.mult(-Z,ut),E.vadd(ut,ut);var lt=jt;ut.vsub(at,lt);var ht=lt.dot(st),ct=Gt;if(E.vsub(at,ct),0>ht&&ct.dot(st)>0){for(var pt=[],dt=0,ft=rt.length;dt!==ft;dt++){var vt=H.get();O.vmult(Q[rt[dt]],vt),R.vadd(vt,vt),pt.push(vt)}if(o(pt,st,E)){nt=!0;var mt=this.createContactEquation(V,U,A,T);st.mult(-Z,mt.ri),st.negate(mt.ni);var gt=H.get();st.mult(-ht,gt);var wt=H.get();st.mult(-Z,wt),E.vsub(R,mt.rj),mt.rj.vadd(wt,mt.rj),mt.rj.vadd(gt,mt.rj),mt.rj.vadd(R,mt.rj),mt.rj.vsub(U.position,mt.rj),mt.ri.vadd(E,mt.ri),mt.ri.vsub(V.position,mt.ri),H.release(gt),H.release(wt),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult),dt=0;for(var bt=pt.length;dt!==bt;dt++)H.release(pt[dt]);return}for(dt=0;dt!==rt.length;dt++){var xt=H.get(),At=H.get();O.vmult(Q[rt[(dt+1)%rt.length]],xt),O.vmult(Q[rt[(dt+2)%rt.length]],At),R.vadd(xt,xt),R.vadd(At,At);var Tt=kt;At.vsub(xt,Tt);var St=qt;Tt.unit(St);var Et=H.get(),Ct=H.get();E.vsub(xt,Ct);var It=Ct.dot(St);St.mult(It,Et),Et.vadd(xt,Et);var Rt=H.get();if(Et.vsub(E,Rt),It>0&&It*It<Tt.norm2()&&Rt.norm2()<Z*Z){for(mt=this.createContactEquation(V,U,A,T),Et.vsub(R,mt.rj),Et.vsub(E,mt.ni),mt.ni.normalize(),mt.ni.mult(Z,mt.ri),mt.rj.vadd(R,mt.rj),mt.rj.vsub(U.position,mt.rj),mt.ri.vadd(E,mt.ri),mt.ri.vsub(V.position,mt.ri),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult),dt=0,bt=pt.length;dt!==bt;dt++)H.release(pt[dt]);return H.release(xt),H.release(At),H.release(Et),H.release(Rt),void H.release(Ct)}H.release(xt),H.release(At),H.release(Et),H.release(Rt),H.release(Ct)}for(dt=0,bt=pt.length;dt!==bt;dt++)H.release(pt[dt])}}},new O,new O,n.prototype[R.types.PLANE|R.types.BOX]=n.prototype.planeBox=function(A,T,E,R,z,O,V,U){T.convexPolyhedronRepresentation.material=T.material,T.convexPolyhedronRepresentation.collisionResponse=T.collisionResponse,this.planeConvex(A,T.convexPolyhedronRepresentation,E,R,z,O,V,U)};var Xt=new O,Yt=new O,Qt=new O,Zt=new O;n.prototype[R.types.PLANE|R.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(A,T,E,R,z,O,V,U){var H=Xt,G=Yt;G.set(0,0,1),z.vmult(G,G);for(var X=0,Q=Qt,Z=0;Z!==T.vertices.length;Z++)if(H.copy(T.vertices[Z]),O.vmult(H,H),R.vadd(H,H),H.vsub(E,Q),0>=G.dot(Q)){var K=this.createContactEquation(V,U,A,T),J=Zt;G.mult(G.dot(Q),J),H.vsub(J,J),J.vsub(E,K.ri),K.ni.copy(G),H.vsub(R,K.rj),K.ri.vadd(E,K.ri),K.ri.vsub(V.position,K.ri),K.rj.vadd(R,K.rj),K.rj.vsub(U.position,K.rj),this.result.push(K),X++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(K,this.frictionResult)}this.enableFrictionReduction&&X&&this.createFrictionFromAverage(X)};var Jt=new O,$t=new O;n.prototype[R.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(A,T,E,R,z,O,V,U,H,G,X,Q){var Z=Jt;if(!(E.distanceTo(R)>A.boundingSphereRadius+T.boundingSphereRadius)&&A.findSeparatingAxis(T,E,z,R,O,Z,X,Q)){var K=[],J=$t;A.clipAgainstHull(E,z,T,R,O,Z,-100,100,K);for(var $=0,et=0;et!==K.length;et++){var nt=this.createContactEquation(V,U,A,T,H,G),ot=nt.ri,it=nt.rj;Z.negate(nt.ni),K[et].normal.negate(J),J.mult(K[et].depth,J),K[et].point.vadd(J,ot),it.copy(K[et].point),ot.vsub(E,ot),it.vsub(R,it),ot.vadd(E,ot),ot.vsub(V.position,ot),it.vadd(R,it),it.vsub(U.position,it),this.result.push(nt),$++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(nt,this.frictionResult)}this.enableFrictionReduction&&$&&this.createFrictionFromAverage($)}};var ee=new O,ne=new O,oe=new O;n.prototype[R.types.PLANE|R.types.PARTICLE]=n.prototype.planeParticle=function(A,T,E,R,z,O,V,U){var H=ee;H.set(0,0,1),V.quaternion.vmult(H,H);var G=ne;if(R.vsub(V.position,G),0>=H.dot(G)){var X=this.createContactEquation(U,V,T,A);X.ni.copy(H),X.ni.negate(X.ni),X.ri.set(0,0,0);var Q=oe;H.mult(H.dot(R),Q),R.vsub(Q,Q),X.rj.copy(Q),this.result.push(X),this.createFrictionEquationsFromContact(X,this.frictionResult)}};var ie=new O;n.prototype[R.types.PARTICLE|R.types.SPHERE]=n.prototype.sphereParticle=function(A,T,E,R,z,O,V,U){var H=ie;if(H.set(0,0,1),R.vsub(E,H),H.norm2()<=A.radius*A.radius){var G=this.createContactEquation(U,V,T,A);H.normalize(),G.rj.copy(H),G.rj.mult(A.radius,G.rj),G.ni.copy(H),G.ni.negate(G.ni),G.ri.set(0,0,0),this.result.push(G),this.createFrictionEquationsFromContact(G,this.frictionResult)}};var re=new U,se=new O,ae=(new O,new O),ue=new O,le=new O;n.prototype[R.types.PARTICLE|R.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(A,T,E,R,z,O,V,U){var H=-1,G=ae,X=le,Q=null,Z=se;if(Z.copy(R),Z.vsub(E,Z),z.conjugate(re),re.vmult(Z,Z),A.pointIsInside(Z)){A.worldVerticesNeedsUpdate&&A.computeWorldVertices(E,z),A.worldFaceNormalsNeedsUpdate&&A.computeWorldFaceNormals(z);for(var K=0,J=A.faces.length;K!==J;K++){var $=[A.worldVertices[A.faces[K][0]]],et=A.worldFaceNormals[K];R.vsub($[0],ue);var nt=-et.dot(ue);(null===Q||Math.abs(nt)<Math.abs(Q))&&(Q=nt,H=K,G.copy(et))}if(-1!==H){var ot=this.createContactEquation(U,V,T,A);G.mult(Q,X),X.vadd(R,X),X.vsub(E,X),ot.rj.copy(X),G.negate(ot.ni),ot.ri.set(0,0,0);var it=ot.ri,rt=ot.rj;it.vadd(R,it),it.vsub(U.position,it),rt.vadd(E,rt),rt.vsub(V.position,rt),this.result.push(ot),this.createFrictionEquationsFromContact(ot,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[R.types.BOX|R.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(A,T,E,R,z,O,V,U){A.convexPolyhedronRepresentation.material=A.material,A.convexPolyhedronRepresentation.collisionResponse=A.collisionResponse,this.convexHeightfield(A.convexPolyhedronRepresentation,T,E,R,z,O,V,U)};var he=new O,ce=new O,pe=[0];n.prototype[R.types.CONVEXPOLYHEDRON|R.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(A,T,E,R,z,O,U,H){var G=T.data,X=T.elementSize,Q=A.boundingSphereRadius,Z=ce,K=pe,J=he;V.pointToLocalFrame(R,O,E,J);var $=Math.floor((J.x-Q)/X)-1,et=Math.ceil((J.x+Q)/X)+1,nt=Math.floor((J.y-Q)/X)-1,ot=Math.ceil((J.y+Q)/X)+1;if(!(0>et||0>ot||$>G.length||nt>G[0].length)){0>$&&($=0),0>et&&(et=0),0>nt&&(nt=0),0>ot&&(ot=0),$>=G.length&&($=G.length-1),et>=G.length&&(et=G.length-1),ot>=G[0].length&&(ot=G[0].length-1),nt>=G[0].length&&(nt=G[0].length-1);var it=[];T.getRectMinMax($,nt,et,ot,it);var rt=it[0],st=it[1];if(!(J.z-Q>st||J.z+Q<rt))for(var at=$;et>at;at++)for(var ut=nt;ot>ut;ut++)T.getConvexTrianglePillar(at,ut,!1),V.pointToWorldFrame(R,O,T.pillarOffset,Z),E.distanceTo(Z)<T.pillarConvex.boundingSphereRadius+A.boundingSphereRadius&&this.convexConvex(A,T.pillarConvex,E,Z,z,O,U,H,null,null,K,null),T.getConvexTrianglePillar(at,ut,!0),V.pointToWorldFrame(R,O,T.pillarOffset,Z),E.distanceTo(Z)<T.pillarConvex.boundingSphereRadius+A.boundingSphereRadius&&this.convexConvex(A,T.pillarConvex,E,Z,z,O,U,H,null,null,K,null)}};var de=new O,fe=new O;n.prototype[R.types.SPHERE|R.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(A,T,E,R,z,O,U,H){var G=T.data,X=A.radius,Q=T.elementSize,Z=fe,K=de;V.pointToLocalFrame(R,O,E,K);var J=Math.floor((K.x-X)/Q)-1,$=Math.ceil((K.x+X)/Q)+1,et=Math.floor((K.y-X)/Q)-1,nt=Math.ceil((K.y+X)/Q)+1;if(!(0>$||0>nt||J>G.length||nt>G[0].length)){0>J&&(J=0),0>$&&($=0),0>et&&(et=0),0>nt&&(nt=0),J>=G.length&&(J=G.length-1),$>=G.length&&($=G.length-1),nt>=G[0].length&&(nt=G[0].length-1),et>=G[0].length&&(et=G[0].length-1);var ot=[];T.getRectMinMax(J,et,$,nt,ot);var it=ot[0],rt=ot[1];if(!(K.z-X>rt||K.z+X<it))for(var st=this.result,at=J;$>at;at++)for(var ut=et;nt>ut;ut++){var lt=st.length;if(T.getConvexTrianglePillar(at,ut,!1),V.pointToWorldFrame(R,O,T.pillarOffset,Z),E.distanceTo(Z)<T.pillarConvex.boundingSphereRadius+A.boundingSphereRadius&&this.sphereConvex(A,T.pillarConvex,E,Z,z,O,U,H),T.getConvexTrianglePillar(at,ut,!0),V.pointToWorldFrame(R,O,T.pillarOffset,Z),E.distanceTo(Z)<T.pillarConvex.boundingSphereRadius+A.boundingSphereRadius&&this.sphereConvex(A,T.pillarConvex,E,Z,z,O,U,H),st.length-lt>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(A,T){function n(){U.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new R,this.broadphase=new et,this.bodies=[],this.solver=new O,this.constraints=[],this.narrowphase=new V(this),this.collisionMatrix=new H,this.collisionMatrixPrevious=new H,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new Z,this.defaultMaterial=new G("default"),this.defaultContactMaterial=new X(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}T.exports=n;var E=A("../shapes/Shape"),R=A("../math/Vec3"),z=A("../math/Quaternion"),O=A("../solver/GSSolver"),V=(A("../utils/Vec3Pool"),A("../equations/ContactEquation"),A("../equations/FrictionEquation"),A("./Narrowphase")),U=A("../utils/EventTarget"),H=A("../collision/ArrayCollisionMatrix"),G=A("../material/Material"),X=A("../material/ContactMaterial"),Q=A("../objects/Body"),Z=A("../utils/TupleDictionary"),K=A("../collision/RaycastResult"),J=A("../collision/AABB"),$=A("../collision/Ray"),et=A("../collision/NaiveBroadphase");n.prototype=new U;var nt=(new J,new $);if(n.prototype.getContactMaterial=function(A,T){return this.contactMaterialTable.get(A.id,T.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var A=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=A,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(A){-1===this.bodies.indexOf(A)&&(A.index=this.bodies.length,this.bodies.push(A),A.world=this,A.initPosition.copy(A.position),A.initVelocity.copy(A.velocity),A.timeLastSleepy=this.time,A instanceof Q&&(A.initAngularVelocity.copy(A.angularVelocity),A.initQuaternion.copy(A.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=A,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(A){this.constraints.push(A)},n.prototype.removeConstraint=function(A){var T=this.constraints.indexOf(A);-1!==T&&this.constraints.splice(T,1)},n.prototype.rayTest=function(A,T,E){E instanceof K?this.raycastClosest(A,T,{skipBackfaces:!0},E):this.raycastAll(A,T,{skipBackfaces:!0},E)},n.prototype.raycastAll=function(A,T,E,R){return E.mode=$.ALL,E.from=A,E.to=T,E.callback=R,nt.intersectWorld(this,E)},n.prototype.raycastAny=function(A,T,E,R){return E.mode=$.ANY,E.from=A,E.to=T,E.result=R,nt.intersectWorld(this,E)},n.prototype.raycastClosest=function(A,T,E,R){return E.mode=$.CLOSEST,E.from=A,E.to=T,E.result=R,nt.intersectWorld(this,E)},n.prototype.remove=function(A){A.world=null;var T=this.bodies.length-1,E=this.bodies,R=E.indexOf(A);if(-1!==R){E.splice(R,1);for(var z=0;z!==E.length;z++)E[z].index=z;this.collisionMatrix.setNumObjects(T),this.removeBodyEvent.body=A,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(A){this.materials.push(A)},n.prototype.addContactMaterial=function(A){this.contactmaterials.push(A),this.contactMaterialTable.set(A.materials[0].id,A.materials[1].id,A)},"undefined"==typeof performance&&(performance={}),!performance.now){var ot=Date.now();performance.timing&&performance.timing.navigationStart&&(ot=performance.timing.navigationStart),performance.now=function(){return Date.now()-ot}}var it=new R;n.prototype.step=function(A,T,E){if(E=E||10,0===(T=T||0))this.internalStep(A),this.time+=A;else{var R=Math.floor((this.time+T)/A)-Math.floor(this.time/A);R=Math.min(R,E);for(var z=performance.now(),O=0;O!==R&&(this.internalStep(A),!(performance.now()-z>1e3*A));O++);this.time+=T;for(var V=this.time%A/A,U=it,H=this.bodies,G=0;G!==H.length;G++){var X=H[G];X.type!==Q.STATIC&&X.sleepState!==Q.SLEEPING?(X.position.vsub(X.previousPosition,U),U.scale(V,U),X.position.vadd(U,X.interpolatedPosition)):(X.interpolatedPosition.copy(X.position),X.interpolatedQuaternion.copy(X.quaternion))}}};var rt={type:"postStep"},st={type:"preStep"},at={type:"collide",body:null,contact:null},ut=[],lt=[],ht=[],ct=[],pt=(new R,new R,new R,new R,new R,new R,new R,new R,new R,new z,new z),dt=new z,ft=new R;n.prototype.internalStep=function(A){this.dt=A;var T,R=this.contacts,z=ht,O=ct,V=this.numObjects(),U=this.bodies,H=this.solver,G=this.gravity,X=this.doProfiling,Z=this.profile,K=Q.DYNAMIC,J=this.constraints,$=lt,et=(G.norm(),G.x),nt=G.y,ot=G.z,it=0;for(X&&(T=performance.now()),it=0;it!==V;it++)if((Ct=U[it]).type&K){var vt=Ct.force,mt=Ct.mass;vt.x+=mt*et,vt.y+=mt*nt,vt.z+=mt*ot}it=0;for(var gt=this.subsystems.length;it!==gt;it++)this.subsystems[it].update();X&&(T=performance.now()),z.length=0,O.length=0,this.broadphase.collisionPairs(this,z,O),X&&(Z.broadphase=performance.now()-T);var wt=J.length;for(it=0;it!==wt;it++)if(!(Rt=J[it]).collideConnected)for(var bt=z.length-1;bt>=0;bt-=1)(Rt.bodyA===z[bt]&&Rt.bodyB===O[bt]||Rt.bodyB===z[bt]&&Rt.bodyA===O[bt])&&(z.splice(bt,1),O.splice(bt,1));this.collisionMatrixTick(),X&&(T=performance.now());var xt=ut,At=R.length;for(it=0;it!==At;it++)xt.push(R[it]);R.length=0;var Tt=this.frictionEquations.length;for(it=0;it!==Tt;it++)$.push(this.frictionEquations[it]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(z,O,this,R,xt,this.frictionEquations,$),X&&(Z.narrowphase=performance.now()-T),X&&(T=performance.now()),it=0;it<this.frictionEquations.length;it++)H.addEquation(this.frictionEquations[it]);for(var St=R.length,Et=0;Et!==St;Et++){var Ct=(Rt=R[Et]).bi,It=Rt.bj;Rt.si,Rt.sj,(Ct.material&&It.material&&this.getContactMaterial(Ct.material,It.material)||this.defaultContactMaterial).friction,Ct.material&&It.material&&(Ct.material.friction>=0&&It.material.friction>=0&&(Ct.material.friction,It.material.friction),Ct.material.restitution>=0&&It.material.restitution>=0&&(Rt.restitution=Ct.material.restitution*It.material.restitution)),H.addEquation(Rt),Ct.allowSleep&&Ct.type===Q.DYNAMIC&&Ct.sleepState===Q.SLEEPING&&It.sleepState===Q.AWAKE&&It.type!==Q.STATIC&&It.velocity.norm2()+It.angularVelocity.norm2()>=2*Math.pow(It.sleepSpeedLimit,2)&&(Ct._wakeUpAfterNarrowphase=!0),It.allowSleep&&It.type===Q.DYNAMIC&&It.sleepState===Q.SLEEPING&&Ct.sleepState===Q.AWAKE&&Ct.type!==Q.STATIC&&Ct.velocity.norm2()+Ct.angularVelocity.norm2()>=2*Math.pow(Ct.sleepSpeedLimit,2)&&(It._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(Ct,It,!0),this.collisionMatrixPrevious.get(Ct,It)||(at.body=It,at.contact=Rt,Ct.dispatchEvent(at),at.body=Ct,It.dispatchEvent(at))}for(X&&(Z.makeContactConstraints=performance.now()-T,T=performance.now()),it=0;it!==V;it++)(Ct=U[it])._wakeUpAfterNarrowphase&&(Ct.wakeUp(),Ct._wakeUpAfterNarrowphase=!1);for(wt=J.length,it=0;it!==wt;it++){var Rt;(Rt=J[it]).update(),bt=0;for(var _t=Rt.equations.length;bt!==_t;bt++){var zt=Rt.equations[bt];H.addEquation(zt)}}H.solve(A,this),X&&(Z.solve=performance.now()-T),H.removeAllEquations();var Pt=Math.pow;for(it=0;it!==V;it++)if((Ct=U[it]).type&K){var Bt=Pt(1-Ct.linearDamping,A),Mt=Ct.velocity;Mt.mult(Bt,Mt);var Ot=Ct.angularVelocity;if(Ot){var Lt=Pt(1-Ct.angularDamping,A);Ot.mult(Lt,Ot)}}for(this.dispatchEvent(st),it=0;it!==V;it++)(Ct=U[it]).preStep&&Ct.preStep.call(Ct);X&&(T=performance.now());var Nt=pt,kt=dt,qt=this.stepnumber,Wt=Q.DYNAMIC|Q.KINEMATIC,Dt=qt%(this.quatNormalizeSkip+1)==0,Vt=this.quatNormalizeFast,Ut=.5*A;for(E.types.PLANE,E.types.CONVEXPOLYHEDRON,it=0;it!==V;it++){var Ht=U[it],jt=Ht.force,Gt=Ht.torque;if(Ht.type&Wt&&Ht.sleepState!==Q.SLEEPING){var Xt=Ht.velocity,Yt=Ht.angularVelocity,Qt=Ht.position,Zt=Ht.quaternion,Jt=Ht.invMass,$t=Ht.invInertiaWorld;Xt.x+=jt.x*Jt*A,Xt.y+=jt.y*Jt*A,Xt.z+=jt.z*Jt*A,Ht.angularVelocity&&($t.vmult(Gt,ft),ft.mult(A,ft),ft.vadd(Yt,Yt)),Qt.x+=Xt.x*A,Qt.y+=Xt.y*A,Qt.z+=Xt.z*A,Ht.angularVelocity&&(Nt.set(Yt.x,Yt.y,Yt.z,0),Nt.mult(Zt,kt),Zt.x+=Ut*kt.x,Zt.y+=Ut*kt.y,Zt.z+=Ut*kt.z,Zt.w+=Ut*kt.w,Dt&&(Vt?Zt.normalizeFast():Zt.normalize())),Ht.aabb&&(Ht.aabbNeedsUpdate=!0),Ht.updateInertiaWorld&&Ht.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,X&&(Z.integrate=performance.now()-T),this.time+=A,this.stepnumber+=1,this.dispatchEvent(rt),it=0;it!==V;it++){var ee=(Ct=U[it]).postStep;ee&&ee.call(Ct)}if(this.allowSleep)for(it=0;it!==V;it++)U[it].sleepTick(this.time)},n.prototype.clearForces=function(){for(var A=this.bodies,T=A.length,E=0;E!==T;E++){var R=A[E];R.force,R.torque,R.force.set(0,0,0),R.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})),define("node_modules/decentraland-builder-scripts/channel",["require","exports"],(function(A,T){Object.defineProperty(T,"__esModule",{value:!0}),T.createChannel=void 0;var E="__request_value__",R="__reply_value__";T.createChannel=function(A,T,z){var O={},V={},U={};return z.on(T.name,(function(A){var T=O[A.actionId];T&&T(A),V={}})),z.on(E,(function(E){if(E.sender!==A&&E.entityName===T.name){var O=E.key,H=U[O];if(H){var G=H(),X={entityName:T.name,key:O,sender:A,value:G};z.emit(R,X)}delete V[O]}})),z.on(R,(function(E){if(E.sender!==A&&E.entityName===T.name){var R=E.key,z=E.value,O=V[R];O&&O(z),delete V[R]}})),{id:A,bus:z,createAction:function(A,E){return{entityName:T.name,actionId:A,values:E}},sendActions:function(T){var E,R;void 0===T&&(T=[]);try{for(var O=__values(T),V=O.next();!V.done;V=O.next()){var U=V.value,H=__assign(__assign({},U),{sender:A});z.emit(H.entityName,H)}}catch(A){E={error:A}}finally{try{V&&!V.done&&(R=O.return)&&R.call(O)}finally{if(E)throw E.error}}},handleAction:function(A,T){O[A]=T},request:function(R,O){V[R]=O;var U={entityName:T.name,key:R,sender:A},H=setInterval((function(){R in V?z.emit(E,U):clearInterval(H)}),5e3)},reply:function(A,T){U[A]=T}}}})),define("node_modules/decentraland-builder-scripts/inventory",["require","exports"],(function(A,T){Object.defineProperty(T,"__esModule",{value:!0}),T.createInventory=void 0,T.createInventory=function(A,T,E){var R=null,z=null,O={};return{add:function(V,U){var H=O[V]||new E((R||(R=new A),z||((z=new T(R)).isPointerBlocker=!1,z.vAlign="bottom",z.hAlign="right",z.stackOrientation=0,z.spacing=0,z.positionY=75,z.positionX=-25),z),U);H.width=128,H.height=128,H.sourceTop=0,H.sourceLeft=0,H.sourceHeight=256,H.sourceWidth=256,H.isPointerBlocker=!1,H.visible=!0,O[V]=H},remove:function(A){var T=O[A];T&&(T.visible=!1,T.height=0,T.width=0)},has:function(A){return A in O&&O[A].visible}}}})),define("videoStream/src/item",["require","exports"],(function(A,T){Object.defineProperty(T,"__esModule",{value:!0});var E=function(){function Button(){this.channel="",this.video={},this.materials={},this.active={},this.volume={},this.sign={}}return Button.prototype.init=function(){},Button.prototype.toggle=function(A,T){if(log("all screens: ",this.video," setting: ",A.name," to ",T),T){if(this.activeScreen&&this.activeScreen==A)return;this.activeScreen&&this.toggle(this.activeScreen,!1),this.activeScreen=A,this.active[A.name]=!0,this.video[A.name].volume=this.volume[A.name],this.video[A.name].playing=!0,engine.removeEntity(this.sign[A.name])}else{if(!this.activeScreen||this.activeScreen!=A)return;this.activeScreen=null,this.active[A.name]=!1,this.video[A.name].playing=!1}},Button.prototype.spawn=function(A,T,E){var R=this,z=new Entity(A.name+"-screen");z.setParent(A);z.addComponent(new PlaneShape),z.addComponent(new Transform({scale:new Vector3(2.976,1.08*1.55,15.5),position:new Vector3(0,.8494,0)})),T.customStation?this.channel=T.customStation:T.station?this.channel=T.station:this.channel="https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",this.video[z.name]=new VideoTexture(new VideoClip(this.channel)),this.materials[z.name]=new Material,this.materials[z.name].albedoTexture=this.video[z.name],this.materials[z.name].specularIntensity=0,this.materials[z.name].roughness=1,this.materials[z.name].metallic=0,this.materials[z.name].emissiveTexture=this.video[z.name],this.materials[z.name].emissiveIntensity=.8,this.materials[z.name].emissiveColor=new Color3(1,1,1),z.addComponent(this.materials[z.name]),this.sign[z.name]=new Entity(A.name+"-sign"),this.sign[z.name].setParent(z),this.sign[z.name].addComponent(new PlaneShape),this.sign[z.name].addComponent(new Transform({position:new Vector3(0,0,.002),rotation:Quaternion.Euler(180,0,0)})),this.volume[z.name]=T.volume;var O=new Material;O.albedoTexture=new Texture(T.image?T.image:"videoStream/images/stream.png"),O.specularIntensity=0,O.roughness=1,this.sign[z.name].addComponent(O),T.onClick&&(this.sign[z.name].addComponent(new OnPointerDown((function(){E.sendActions(T.onClick)}),{button:ActionButton.POINTER,hoverText:T.onClickText,distance:T.controlDist?T.controlDist:10})),z.addComponent(new OnPointerDown((function(){log("clicked"),E.sendActions(T.onClick)}),{button:ActionButton.POINTER,hoverText:T.onClickText,distance:T.controlDist?T.controlDist:10}))),T.startOn?this.toggle(z,!0):this.toggle(z,!1),E.handleAction("activate",(function(A){var O=A.sender;R.toggle(z,!0),O===E.id&&E.sendActions(T.onActivate)})),E.handleAction("deactivate",(function(A){var O=A.sender;R.toggle(z,!1),O===E.id&&E.sendActions(T.onDeactivate)})),E.handleAction("toggle",(function(A){var O=A.sender,V=!R.active[z.name];R.toggle(z,V),O===E.id&&(V?E.sendActions(T.onActivate):E.sendActions(T.onDeactivate))})),E.request("isActive",(function(A){return R.toggle(z,A)})),E.reply("isActive",(function(){return R.active[z.name]}))},Button}();T.default=E})),define("galleryInfoSign/src/item",["require","exports"],(function(A,T){Object.defineProperty(T,"__esModule",{value:!0}),T.splitTextIntoLines=void 0;var E=function(){function PlainText(){}return PlainText.prototype.init=function(){},PlainText.prototype.spawn=function(A,T,E){var R=new Entity;R.setParent(A);var z=new TextShape(splitTextIntoLines(T.text,140/T.fontSize));switch(z.fontSize=T.fontSize,z.color=Color3.FromHexString(T.color),T.font){case"SF":z.font=new Font(Fonts.SanFrancisco);break;case"SF_Heavy":z.font=new Font(Fonts.SanFrancisco_Heavy)}z.height=10,z.width=10,z.lineSpacing="50px",z.paddingBottom=0,z.paddingTop=0,z.paddingLeft=0,z.paddingRight=0,z.lineCount=10,z.hTextAlign="center",z.vTextAlign="center",z.textWrapping=!1,R.addComponent(z),R.addComponent(new Transform({position:new Vector3(-1,2,.05),rotation:Quaternion.Euler(0,180,0),scale:new Vector3(.2,.2,.2)}));var O=new Entity;O.setParent(A),O.addComponentOrReplace(new GLTFShape("galleryInfoSign/models/PurpleGalleryInfo.glb")),O.addComponentOrReplace(new OnPointerDown((function(A){openExternalURL(T.url?T.url:"https://purplebee.org/")}),{hoverText:"Learn More"}))},PlainText}();function splitTextIntoLines(A,T,E){for(var R="",z=0;z<A.length;z++){var O=R.split("\n");if(O[O.length-1].length>=T&&z!==A.length){if(" "!==R[R.length-1]){if(E&&O.length>=E)return R.concat("...");R=R.concat("-")}if(R=R.concat("\n")," "===A[z])continue}R=R.concat(A[z])}return R}T.default=E,T.splitTextIntoLines=splitTextIntoLines})),define("src/game",["require","exports","node_modules/decentraland-builder-scripts/channel","videoStream/src/item","galleryInfoSign/src/item"],(function(A,T,E,R,z){Object.defineProperty(T,"__esModule",{value:!0});var O=Math.random().toString(16).slice(2),V=new MessageBus,U=new Entity("_scene");engine.addEntity(U);var H=new Transform({position:new Vector3(0,0,0),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});U.addComponentOrReplace(H);var G=new Entity("catwalkHill");engine.addEntity(G),G.setParent(U);var X=new Transform({position:new Vector3(8,0,16),rotation:new Quaternion(0,.5,0,0),scale:new Vector3(1,1,1)});G.addComponentOrReplace(X);var Q=new GLTFShape("GLB/Catwalk-Hill-Scene4.glb");Q.withCollisions=!0,Q.isPointerBlocker=!0,Q.visible=!0,G.addComponentOrReplace(Q);var Z=new Entity("videoStream");engine.addEntity(Z),Z.setParent(U);var K=new Transform({position:new Vector3(8,.92,.4),rotation:new Quaternion(0,0,0,1),scale:new Vector3(4.5,4.5,4.5)});Z.addComponentOrReplace(K);var J=new R.default;J.init(),J.spawn(Z,{startOn:!1,onClickText:"Play/Pause",volume:1,controlDist:20,onClick:[{entityName:"videoStream",actionId:"toggle",values:{}}],image:"https://purplebee.org/wp-content/uploads/purple-bee-live-slate.jpg",station:"https://8343f7014c0ea438.mediapackage.us-west-2.amazonaws.com/out/v1/97ed27876e70411685f551766ae1cec4/index.m3u8"},(0,E.createChannel)(O,Z,V));var $=new Entity("galleryInfoPurple");engine.addEntity($),$.setParent(U);var et=new Transform({position:new Vector3(7.6,3.02,31),rotation:new Quaternion(0,-1,0,0),scale:new Vector3(.5,.5,.5)});$.addComponentOrReplace(et);var nt=new z.default;nt.init(),nt.spawn($,{text:"Welcome to\nPurple Bee TV\nLive-streaming\nconcerts\n\nget info & donate:\npurplebee.org\n\n@purplebeetv\non socials",fontSize:7,font:"SF_Heavy",color:"#000000",url:"https://purplebee.org"},(0,E.createChannel)(O,$,V));var ot=new Material;ot.albedoColor=Color3.Red();var it=new Entity;it.addComponent(ot),it.addComponent(new GLTFShape("GLB/DonkModel4.glb")),it.addComponent(new Transform({position:new Vector3(8,2.5,3)})),engine.addEntity(it);var rt=new Material;rt.albedoColor=new Color3(9,3,1);var st=new Material;st.albedoColor=new Color3(5,1,3.5);var at=new Entity;at.addComponent(new SphereShape),at.addComponent(new Transform({scale:Vector3.Zero()})),at.addComponent(rt),at.getComponent(SphereShape).withCollisions=!1,engine.addEntity(at);var ut=new CANNON.World;ut.quatNormalizeSkip=0,ut.quatNormalizeFast=!1,ut.gravity.set(0,-9.82,0),ut.broadphase=new CANNON.NaiveBroadphase;var lt=new CANNON.Box(new CANNON.Vec3(.5,.5,.5)),ht=new CANNON.Body({mass:5});ht.addShape(lt),ht.position.set(8,2.5,3),ht.linearDamping=.4,ht.angularDamping=.4,ut.addBody(ht);var ct=new CANNON.Plane,pt=new CANNON.Body({mass:0});pt.addShape(ct),pt.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2),pt.position.y=.8,ut.addBody(pt);var dt=new CANNON.Box(new CANNON.Vec3(16,50,1)),ft=new CANNON.Body({mass:0,shape:dt,position:new CANNON.Vec3(8,25,8)});ut.addBody(ft);var vt=new CANNON.Body({mass:0,shape:dt,position:new CANNON.Vec3(8,25,0)});ut.addBody(vt);var mt=new CANNON.Body({mass:0,shape:dt,position:new CANNON.Vec3(0,25,8)});mt.quaternion.setFromAxisAngle(new CANNON.Vec3(0,1,0),-Math.PI/2),ut.addBody(mt);var gt=new CANNON.Body({mass:0,shape:dt,position:new CANNON.Vec3(16,25,8)});gt.quaternion.setFromAxisAngle(new CANNON.Vec3(0,1,0),-Math.PI/2),ut.addBody(gt);var wt,bt,xt=new CANNON.Sphere(.1),At=new CANNON.Body({mass:0});At.addShape(xt),At.collisionFilterGroup=0,At.collisionFilterMask=0,ut.addBody(At);var Tt=function(){function updatePhysicsSystem(){}return updatePhysicsSystem.prototype.update=function(A){ut.step(A),it.getComponent(Transform).position.copyFrom(ht.position),it.getComponent(Transform).rotation.copyFrom(ht.quaternion)},updatePhysicsSystem}();engine.addSystem(new Tt);var St=Input.instance,Et=!1,Ct=!1,It=0;St.subscribe("BUTTON_DOWN",ActionButton.POINTER,!0,(function(A){Et=!0,0!=A.hit.length&&(at.getComponent(Transform).scale.setAll(.1),It=A.hit.length,function(A,T,E,R){bt=R;var z=new CANNON.Vec3(A,T,E).vsub(bt.position),O=bt.quaternion.inverse().vmult(z);At.position.set(A,T,E),wt=new CANNON.PointToPointConstraint(bt,O,At,new CANNON.Vec3(0,0,0)),ut.addConstraint(wt)}(A.hit.hitPoint.x,A.hit.hitPoint.y,A.hit.hitPoint.z,ht))})),St.subscribe("BUTTON_UP",ActionButton.POINTER,!1,(function(){Et=!1,at.getComponent(Transform).scale.setAll(0),at.getComponent(Transform).position.setAll(0),It=0,ut.removeConstraint(wt)})),St.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(){Ct=!0,at.addComponentOrReplace(st)})),St.subscribe("BUTTON_UP",ActionButton.PRIMARY,!1,(function(){Ct=!1,at.addComponentOrReplace(rt)}));var Rt=function(){function UpdateMarkerSystem(){}return UpdateMarkerSystem.prototype.update=function(A){if(Et&&0!=It){this.forwardVector=Vector3.Forward().scale(It).rotate(Camera.instance.rotation),this.forwardVectorTransformed=Camera.instance.position.clone().add(this.forwardVector),at.getComponent(Transform).position.copyFrom(this.forwardVectorTransformed);var T=at.getComponent(Transform).position;E=T.x,R=T.y,z=T.z,At.position.set(E,R,z),wt.update()}var E,R,z;Ct&&0!=It&&It>1&&(It-=5*A)},UpdateMarkerSystem}();engine.addSystem(new Rt)}));